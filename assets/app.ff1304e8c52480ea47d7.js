!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="a4c03f2c-6a1f-49e6-8660-3ee645aedaa4",e._sentryDebugIdIdentifier="sentry-dbid-a4c03f2c-6a1f-49e6-8660-3ee645aedaa4")}catch(e){}}();var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"0b2f2553a1a3c15570b1b9719adef93efb6aa07a"},(self.webpackChunkab_platform_web=self.webpackChunkab_platform_web||[]).push([[524],{26638:(e,t,i)=>{i.d(t,{A:()=>l});const s={appListRowHeight:67,buttonWidthLarge:200,buttonWidthMedium:150,buttonWidthSmall:100,buttonWidthExtraSmall:50,tabWidthLarge:200,tabWidthMedium:120,tabWidthSmall:100,tabWidthExtraSmall:50,columnWidthXLarge:350,columnWidthLarge:250,columnWidthMedium:200,columnWidthSmall:150,columnWidthExtraSmall:100,xSmallSpacer:5,smallSpacer:10,mediumSpacer:25,largeSpacer:50,xLargeSpacer:100,xxLargeSpacer:200,xxxLargeSpacer:400,appListSpacerRowHeight:100,appListSpacerColMinWidth:100,appListSpacerColMaxWidth:200,objectWorkspaceColWidth:20,labelWidthSmall:50,labelWidthMedium:80,labelWidthLarge:120,labelWidthXLarge:150,labelWidthXXLarge:200,labelWidthXXXLarge:280,labelWidthCheckbox:0,hideMobile:!1},a={appListRowHeight:67,buttonWidthLarge:200,buttonWidthMedium:150,buttonWidthSmall:100,buttonWidthExtraSmall:50,tabWidthLarge:200,tabWidthMedium:120,tabWidthSmall:100,tabWidthExtraSmall:50,columnWidthLarge:250,columnWidthMedium:200,columnWidthSmall:150,columnWidthExtraSmall:100,xSmallSpacer:1,smallSpacer:1,mediumSpacer:10,largeSpacer:20,xLargeSpacer:50,xxLargeSpacer:100,xxxLargeSpacer:120,appListSpacerRowHeight:10,appListSpacerColMinWidth:1,appListSpacerColMaxWidth:1,objectWorkspaceColWidth:1,labelWidthSmall:50,labelWidthMedium:80,labelWidthLarge:120,labelWidthXLarge:120,labelWidthXXLarge:120,labelWidthCheckbox:0,hideMobile:!0};var o=i(84529);const n={"appbuilder-portal-autoenter":!0,"appbuilder-portal-fullscreen":!0,"appbuilder-tenant":null,"appbuilder-view":"work","appbuilder-tenant-prefix":null},r={site:{appbuilder:{networkType:"socket",networkNumRetries:3,urlCoreServer:window.location.origin},storage:{encrypted:!1}}},l=new class{constructor(){this._config=null,this._configUser=null,this._settings={}}config(e){this._config=this._config||{},Object.keys(e).forEach((t=>{this._config[t]=e[t]})),(0,o.defaultsDeep)(this._config,r)}configInbox(e){this._config=this._config||{},this._config.inbox=e.inbox||[],this._config.inboxMeta=e.inboxMeta||[]}configUser(e){this._configUser=e}setting(e,t){if(!t)return this._settings[e];this._settings[e]=t}settingsFromDiv(e){Object.keys(n).forEach((t=>{var i=e.getAttribute(t);i||(i=n[t]),"false"===i&&(i=!1),"true"===i&&(i=!0);var s=t.split("-").pop();this.setting(s,i)}))}settings(e={}){for(let t in n){const i=e[t]??n[t];this.setting(t.split("-").pop(),i)}}definitions(){return window.definitions}error(){console.error("Who is calling this? -> move to AB.error() instead.")}labelConfig(){return this._config&&this._config.labels?this._config.labels:(console.error("No Label config found."),{})}languageConfig(){return this._config&&this._config.languages?this._config.languages:(console.error("No Language config found."),{})}metaConfig(){return this._config&&this._config.meta?this._config.meta:(console.error("No Meta config found."),{})}plugins(){return["ABDesigner.js"]}inboxConfig(){return this._config&&this._config.inbox?this._config.inbox:null}inboxMetaConfig(){return this._config&&this._config.inboxMeta?this._config.inboxMeta:null}siteConfig(){return this._config&&this._config.site?this._config.site:r.site}tenantConfig(){return this._config&&this._config.tenant?this._config.tenant:null}uiSettings(){return window.innerWidth<768?a:s}userConfig(){return this._configUser?.user??null}userReal(){return this._configUser?.userReal??!1}}},88096:(e,t,i)=>{var s=i(76431),a=i(64785),o=i.n(a),n=i(26638);var r=i(93692);class l extends r.A{constructor(){super()}ui(){return{id:"portal_loading",view:"label",label:"loading"}}init(e){return this.AB=e,Promise.resolve()}show(){$$("portal_loading").show()}}const c=new l;class d extends r.A{constructor(){super()}ui(){var e=this;if(!this.AB)return{id:"portal_auth_login_container"};var t=this.AB.Label();return{id:"portal_auth_login_container",css:"portalLogin",cols:[{},{rows:[{},{width:360,rows:[{css:"portalLoginForm",padding:30,rows:[{template:"<div style='text-align: center; font-size:160px; line-height: 160px;'><i style='background-color: #666; color: transparent; text-shadow: 0px 1px 1px rgba(255,255,255,0.5); -webkit-background-clip: text; -moz-background-clip: text; background-clip: text;' class='fa fa-user-circle-o'></i></div>",borderless:!0,height:190,type:"clean"},{id:"portal_auth_login_form",view:"form",type:"clean",css:{background:"transparent !important"},borderless:!0,elementsConfig:{bottomPadding:20,height:52},elements:[{view:"text",placeholder:t("Email"),name:"email",id:"email",attributes:{"data-cy":"portal_auth_login_form_email"},validate:webix.rules.isEmail,invalidMessage:t("Please enter a valid email."),validateEvent:"blur"},{view:"text",type:"password",placeholder:t("Password"),name:"password",attributes:{"data-cy":"portal_auth_login_form_password"},validate:webix.rules.isNotEmpty,invalidMessage:t("Please enter your password."),validateEvent:"blur"},{margin:10,paddingX:2,borderless:!0,cols:[{},{view:"button",label:t("Login"),type:"form",id:"portal_auth_login_form_submit",css:"webix_primary",width:150,hotkey:"enter",click(){var t=$$("portal_auth_login_form");if(t.validate()){$$("portal_auth_login_form_submit").hide(),$$("portal_auth_login_form_submit_wait").show();var i=t.getValues();e.error(),e.AB.Network.post({url:"/auth/login",data:i},{key:"portal_auth_login"}).catch((e=>{$$("portal_auth_login_form_submit").show(),$$("portal_auth_login_form_submit_wait").hide(),console.log(e)}))}},on:{onAfterRender(){r.A.CYPRESS_REF(this)}}},{view:"button",label:"<i class='fa fa-circle-o-notch fa-fw fa-spin'></i>",type:"form",id:"portal_auth_login_form_submit_wait",css:"webix_primary",width:150,hidden:!0},{}]},{margin:10,paddingX:2,borderless:!0,cols:[{},{view:"button",label:t("Forgot password?"),id:"portal_auth_login_forgot",css:"webix_transparent",click:()=>{this.emit("request.reset")},width:150,on:{onAfterRender(){r.A.CYPRESS_REF(this)}}},{}]},{id:"portal_auth_login_form_errormsg",view:"template",css:"webix_control",height:32,on:{onAfterRender(){r.A.CYPRESS_REF(this)}}}]}]},{},{cols:[{width:20},{id:"auth_privacy_policy",view:"template",template:'#pretext# <a href="#link#" target="_blank" class="policyAuth">#label#</a>',css:"policyLink noBackground",height:30,hidden:!0},{width:20}]}]},{}]},{}]}}error(e){var t=$$("portal_auth_login_form_errormsg");e?(t.setHTML(`<div class='webix_invalid'><div class='webix_inp_bottom_label'><center>${e}</center></div></div>`),t.show()):t.hide()}init(e){this.AB=e,webix.ui(this.ui(),$$("portal_auth_login_container")),this.error(),this.AB.Network.on("portal_auth_login",((e,t,i)=>{if(t){if(t.code)switch(t.code){case"EINVALIDLOGIN":this.error(t.message);break;case"EFAILEDATTEMPTS":this.error(t.message),$$("portal_auth_login_form_submit").hide();break;default:this.AB.error(t)}}else i.user||"success"==i.status&&i.data.user?window.location.reload(!0):"error"==i.status&&(console.log("what to do with this error:"),console.error(i))}));const{privacyPolicy:t}=this.AB.Config.siteConfig();if(t){const e=this.AB.Label();$$("auth_privacy_policy").setValues({label:e("Privacy Policy"),pretext:e("By signing in you agree to our"),link:t}),$$("auth_privacy_policy").show()}return Promise.resolve()}show(){$$("portal_auth_login_container").show()}}const h=new d;var p=null;class u extends r.A{constructor(){super()}ui(){return this.AB?{id:"portal_auth_login_reset_password",css:"portalLogin",cols:[{},{rows:[{},{width:360,rows:[{id:"portal_auth_login_reset_password_col",css:"portalLoginForm",padding:30,rows:[{template:"<div style='text-align: center; font-size:160px; line-height: 160px;'><i style='background-color: #666; color: transparent; text-shadow: 0px 1px 1px rgba(255,255,255,0.5); -webkit-background-clip: text; -moz-background-clip: text; background-clip: text;' class='fa fa-user-circle-o'></i></div>",borderless:!0,height:190,type:"clean"},{id:"portal_auth_login_reset_password_form",view:"form",type:"clean",css:{background:"transparent !important"},borderless:!0,elementsConfig:{height:52},elements:[{id:"new-password-email",template:` ${this.AB.Account.email()} `,css:{background:"transparent !important",border:"none","font-size":"16px",color:"black","text-align":"center"}},{id:"password-new",view:"text",type:"password",placeholder:p("Enter a new Password"),name:p("Enter a new Password"),validate:e=>e.length>=8,invalidMessage:p("Needs to be at least 8 characters"),validateEvent:"blur",bottomPadding:20,attributes:{"data-cy":"portal_reset_password_new"}},{id:"password-confirm",view:"text",type:"password",placeholder:p("Re-enter Password"),name:"email",validate:e=>e===$$("password-new").getValue(),invalidMessage:p("Passwords do not match"),validateEvent:"blur",bottomPadding:20,attributes:{"data-cy":"portal_reset_password_confirm"}},{margin:10,paddingX:2,borderless:!0,cols:[{},{view:"button",label:p("Save"),type:"form",id:"portal_reset_password_submit",css:"webix_primary",width:150,hotkey:"enter",click:()=>{if($$("portal_auth_login_reset_password_form").validate()){let e=$$("password-new").getValue();this.AB.Network.post({url:"/auth/password/reset",data:{password:e}},{key:"portal_auth_password_reset",context:{}}).catch((e=>{console.log(e)}))}},on:{onAfterRender(){r.A.CYPRESS_REF(this)}}},{}]}]}]}]},{}]},{}]}:{id:"portal_auth_login_reset_password"}}async init(e){this.AB=e,p=(...e)=>this.AB.Multilingual.label(...e),webix.ui(this.ui(),$$("portal_auth_login_reset_password")),this.AB.Network.on("portal_auth_password_reset",((e,t,i)=>{this.AB.emit("portal.show","work")}))}show(){$$("portal_auth_login_reset_password").show()}}const w=new u;var g=null;class f extends r.A{constructor(){super()}ui(){var e=this;return this.AB?{id:"portal_auth_login_reset_request",css:"portalLogin",cols:[{},{rows:[{},{width:360,rows:[{id:"password_reset_email",css:"portalLoginForm",padding:30,rows:[{template:"<div style='text-align: center; font-size:160px; line-height: 160px;'><i style='background-color: #666; color: transparent; text-shadow: 0px 1px 1px rgba(255,255,255,0.5); -webkit-background-clip: text; -moz-background-clip: text; background-clip: text;' class='fa fa-envelope-o'></i></div>",borderless:!0,height:190,type:"clean"},{id:"portal_reset_password_form",view:"form",type:"clean",css:{background:"transparent !important"},borderless:!0,elementsConfig:{bottomPadding:20},elements:[{template:`<p>${g("Enter your email. We'll send a link to reset your password.")}</p>`,autoheight:!0,css:{background:"transparent",border:"none","font-size":"16px",color:"black","text-align":"center"}},{borderless:!0,cols:[{id:"reset_tenantList",view:"select",name:"tenant",attributes:{"data-cy":"reset_tenantList"},value:1,options:[{id:1,value:"Master"},{id:2,value:"Release"}]},{id:"reset-email",view:"text",placeholder:g("Email"),name:"email",validate:webix.rules.isEmail,invalidMessage:g("Please enter a valid email."),validateEvent:"blur",attributes:{"data-cy":"portal_reset_request_email"}},{rows:[{view:"button",icon:"fa fa-paper-plane",type:"icon",css:"webix_primary",id:"portal_reset_request_send",autowidth:!0,hotkey:"enter",click(){var t=$$("reset-email");if(t.validate()){t=t.getValue();var i=$$("reset_tenantList").getValue();e.AB.Network.post({url:"/auth/login/reset",data:{email:t,tenant:i,url:window.location.origin||window.location.href}},{key:"portal_auth_login_reset",context:{email:t}}).catch((e=>{console.log(e)}))}},on:{onAfterRender(){r.A.CYPRESS_REF(this)}}},{}]}]},{view:"button",label:g("Back to log in"),css:"webix_transparent",click(){e.emit("login")}}]}]}]},{}]},{}]}:{id:"portal_auth_login_reset_request"}}async init(e){this.AB=e,g=(...e)=>this.AB.Multilingual.label(...e),webix.ui(this.ui(),$$("portal_auth_login_reset_request"));var t=$$("reset_tenantList"),i=this.AB.Config.siteConfig();if(i?.tenants?.length){var s=[];i.tenants.forEach((e=>{var t={id:e.uuid,value:e.title||e.key};s.push(t)})),t.define("options",s)}var a=this.AB.Tenant.id();a&&(t.define("value",a),s.find((e=>e.id==a))&&t.hide()),this.AB.Network.on("portal_auth_login_reset",((e,t,i)=>{var s=g("<p>An email with instructions on how to reset your password has been sent to <b>{0}</b>.</p><p>Check your spam or junk folder if you donâ€™t see the email in your inbox.</p>",[e.email]);webix.alert({title:g("Email Sent"),ok:g("Okay"),width:500,text:s})}))}show(){$$("portal_auth_login_reset_request").show()}}const m=new f;class b extends r.A{constructor(){super()}ui(){return{id:"portal_auth_login",view:"multiview",animate:!1,rows:[h.ui(),w.ui(),m.ui()]}}async init(e){this.AB=e;var t=[];t.push(h.init(e)),h.on("request.reset",(()=>{m.show()})),t.push(m.init(e)),m.on("login",(()=>{h.show()})),t.push(w.init(e)),w.on("updated",(()=>{console.log(">>>> Password Changed ... NOW WHAT? <<<<<<")})),await Promise.all(t)}show(e){e&&"resetPassword"===e.split("_").pop()?w.show():h.show()}}const _=new b;class $ extends r.A{constructor(){super(),this.ActivePortal=null}ui(){return{id:"portal_auth",view:"multiview",animate:!1,cells:[_.ui()]}}init(e){return this.AB=e,"login"===(this.AB.Tenant.setting("authType")||"login")&&(this.ActivePortal=_),this.ActivePortal?.init(e).then((()=>{this.ActivePortal?.show()}))}show(e){"/home"!=window?.location?.pathname||window?.performance?.navigation?.redirectCount||window.location.replace(window.location.origin),$$("portal_auth").show(),this.ActivePortal.show(e)}}const v=new $;class A extends r.A{constructor(e,t,i,s){super(),this.containerID=e,this.page=t,this.App=i,this.AB=s,this.initialized=!1,this.pageStack=[],this.pageComponents={},this.changePageEventIds={}}ui(){var e={};return this.page&&this.page.isRoot()&&(e={type:"clean",css:{"text-align":"center"},template:'<div style="height: 100vh; width: 100%; background: #ebedf0;" class="webix_progress_icon"><div class="webix_progress_state wxi-sync webix_spin"></div></div>'}),{view:"multiview",css:"ab-main-container ab-generated-page",borderless:!0,id:this.containerID,animate:!1,cells:[e],on:{}}}init(e,t=!1,i=!0){if(e&&(this.AB=e),this.initialized)return Promise.resolve();var s=this.ui();return webix.ui(s,$$(this.containerID)),t?new Promise((e=>{if(this.page.application.datacollectionsIncluded().forEach((e=>{e&&e.init()})),this.renderPage(this.page),this.initialized=!0,this.showPage(),!i){let e=$$(this.containerID).getParentView();e.showBatch(e.getValue(),!1)}e()})):Promise.resolve()}initEvents(e){if(null==e)return;this.changePageEventIds=this.changePageEventIds||{},this.changePageEventIds[e.id]||(this.changePageEventIds[e.id]=e.on("changePage",(e=>{this.showPage(e)})));let t=()=>{this.changePageEventIds={},this.initialized=!1,this.init(this.AB,!0,!1)};!this.updatePageEventId&&e.isRoot()&&(this.updatePageEventId=this.AB.on("ab.interface.update",(function(i){e.id==i.rootPageId&&t()}))),!this.updateDatacollectionEventId&&e.isRoot()&&(this.updateDatacollectionEventId=this.AB.on("ab.datacollection.update",(e=>{this.page.application.datacollectionsIncluded((t=>t.id==e.datacollectionId))[0]&&t()})))}renderPage(e){window.webixLocale&&setTimeout((()=>{webix.i18n.setLocale(window.webixLocale)}),500);var t=e.component(this.App),i=t.ui;this.pageComponents[e.id]=t;var s=$$(this.containerID),a=e.settings?.type??"";if("function"==typeof e.type&&(a=e.type()),"popup"===a){var o={view:"window",id:e.id,modal:!0,position:"center",resize:!0,width:parseInt(e.settings.popupWidth)||700,height:parseInt(e.settings.popupHeight)+44||450,css:"ab-main-container",head:{view:"toolbar",css:"webix_dark",cols:[{view:"label",label:e.label,css:"modal_title",align:"center"},{view:"button",label:"Close",autowidth:!0,align:"center",click:()=>{this.showPage()},on:{onAfterRender:()=>{const t=$$(e.id).queryView("button"),i=`Popup Close Button ${e.name} ${e.id}`;t.getInputNode().setAttribute("data-cy",i)}}}]},body:{view:"scrollview",scroll:!0,body:i}},n=$$(e.id);n&&("window"==n.config.view?n.destructor():s&&s.removeView(e.id));try{webix.ui(o).hide()}catch(t){console.error("Error creating Page:",e),console.error(t)}}else{i.batch=e.id;var r=$$(e.id);r?"window"==r.config.view?(r.destructor(),s.addView(i)):webix.ui(i,r):s&&s.addView(i)}this.initEvents(e),(e.pages()||[]).forEach((e=>{this.renderPage(e)})),t.init()}show(){var e=$$(this.containerID);if(e){if(!this.initialized)var t=e.attachEvent("onViewShow",(()=>{e.detachEvent(t),setTimeout((()=>{this.init(this.AB,!0),e.show()}),50)}));e.show()}}showPage(e,t){var i=null,s=this.pageStack[this.pageStack.length-1];if(s){if(s==e)return;var a=$$(s);a&&a.hide&&a.hide()}e?this.page.id!=e?this.pageStack.push(e):this.pageStack=[]:this.pageStack.pop(),(i=this.pageStack[this.pageStack.length-1])||(i=this.page.id),i?($$(i)&&$$(i).show(),$$(this.containerID).getChildViews().filter((function(e){return e.config.batch==i}))[0]&&$$(this.containerID).showBatch(i),setTimeout((()=>{this.pageComponents[i]&&this.pageComponents[i].onShow&&(this.pageComponents[i].onShow(),t&&$$(t)?.show())}),60)):this.AB.error(new Error(`Unable to resolve showPage() with pageID[${e}]`))}}const y=A;class x extends r.A{constructor(e){super(),this.app=e,this.id=`inbox-accordion-app-holder-${this.app.id}`,this.idUnitList=`inbox-accordion-app-${this.app.id}`}ui(){const e=this;return{header:this.app.label,id:this.id,view:"accordionitem",collapsed:!0,css:"stayCollapsed",hidden:!0,body:{view:"unitlist",id:this.idUnitList,uniteBy:"#uniteLabel#",autoheight:!0,css:"inbox_unitlist",type:{templateHeader:function(e){return'<i style="opacity: 0.4" class="fa fa-fw fa-code-fork fa-rotate-90"></i> '+e.replace(/{(.*?)}/,"")},headerHeight:35},template:function(e){return e.name+" <span class='pull-right webix_badge'>"+e.items.length+"</span>"},select:!0,data:[],click:function(t){const i=this,s=this.getItem(t),a=[];s.items.forEach((function(s){s.data?.url?a.push({id:"task-holder-"+s.uuid,unitlist:i,view:"layout",padding:20,rows:[{id:s.uuid,view:"iframe",src:s.data.url}]}):a.push({id:"task-holder-"+s.uuid,unitlist:i,view:"layout",padding:20,rows:[{id:s.uuid,view:"formiopreview",formComponents:s.ui,formData:s.data,onButton:function(i){e.processItem(t,s,i)}}]})})),e.emit("showTasks",s.name,a)},on:{onAfterRender(){r.A.CYPRESS_REF(this),this.data.each((t=>{r.A.CYPRESS_REF(this.getItemNode(t.id),`${e.id}_${t.id}`)}))}}}}}init(e){return this.AB||(this.AB=e,this.AB.Network.on("inbox.update",((e,t)=>{if(t&&t.message)return webix.message(t.message),void this.AB.notify.developer(t,{context:"portal_work_inbox_accordion:Network[inbox.update]: error updating Inbox item",info:e});const i=$$(this.idUnitList),s=i.getItem(e.unitID);if(s){const t=i.getParentView();s.items=s.items.filter((function(t){return t.uuid!=e.uuid})),i.refresh(),0==s.items.length&&(i.remove(i.getSelectedId()),0==i.count()&&t.hide())}this.emit("item.processed",e.uuid)}))),Promise.resolve()}unitList(){return $$(this.idUnitList)}processItem(e,t,i){this.AB.Network.put({url:`/process/inbox/${t.uuid}`,data:{response:i}},{key:"inbox.update",context:{uuid:t.uuid,unitID:e}})}show(){$$(this.id).show(),$$(this.id).expand(),this.initFormIOPreview()}initFormIOPreview(){this.AB.custom.formiopreview.init()}}const k=x;class I extends r.A{constructor(){super(),this.id="portal_work_inbox_taskwindow",this.idTaskMultiview="taskMultiview",this.idTaskTitle="taskTitle",this.idTaskPager="taskPager"}ui(){var e=(...e)=>this.label(...e);return{id:this.id,view:"window",position:function(e){e.left=e.maxWidth/2-400,e.top=e.maxHeight/2-.7*e.maxHeight/2,e.width=800,e.height=.7*e.maxHeight},modal:!0,head:{view:"toolbar",css:"webix_dark",cols:[{width:17},{id:this.idTaskTitle,view:"label",label:e("Your Tasks")},{view:"button",autowidth:!0,type:"icon",icon:"nomargin fa fa-times",click:()=>{$$(this.id).hide(),$$(this.idTaskMultiview).getChildViews()[0].config.unitlist.unselectAll(),$$(this.idTaskPager).select(0)},on:{onAfterRender(){r.A.CYPRESS_REF(this,"inbox_taskwindow_close")}}}]},body:{rows:[{view:"scrollview",scroll:"xy",body:{id:this.idTaskMultiview,cells:[{view:"layout",padding:20,rows:[{id:"emptyTasks",template:e("No more tasks...good job!")}]}]}},{view:"toolbar",css:"inboxpager",cols:[{id:this.idTaskPager,view:"pager",size:1,group:3,height:45,master:!1,template:'<div style="margin-top:9px; text-align: center;">{common.first()} {common.prev()} {common.pages()} {common.next()} {common.last()}</div>',on:{onAfterRender(){r.A.CYPRESS_REF(this)},onBeforePageChange:e=>{$$(this.idTaskMultiview).getChildViews()[parseInt(e)].show()}}}]}]}}}init(e){return this.AB=e,webix.ui(this.ui()),Promise.resolve()}clearTask(e){var t=$$(this.idTaskMultiview).getChildViews();if(t.length>1){var i=$$("task-holder-"+e);i&&($$(this.idTaskMultiview).index(i)+1==t.length?$$(this.idTaskMultiview).setValue(t[$$(this.idTaskMultiview).index(i)-1].config.id):$$(this.idTaskMultiview).setValue(t[$$(this.idTaskMultiview).index(i)+1].config.id),$$(this.idTaskMultiview).removeView(t[$$(this.idTaskMultiview).index(i)])),$$(this.idTaskPager).blockEvent(),$$(this.idTaskPager).select(0),$$(this.idTaskPager).define("count",$$(this.idTaskMultiview).getChildViews().length),$$(this.idTaskPager).refresh(),$$(this.idTaskPager).select($$(this.idTaskMultiview).index($$(this.idTaskMultiview).getActiveId())),$$(this.idTaskPager).unblockEvent()}else $$(this.id).hide()}hide(){$$(this.id).hide()}show(){$$(this.id).show()}showTasks(e,t){webix.ui({id:this.idTaskMultiview,cells:t},$$(this.idTaskMultiview)),$$(this.idTaskTitle).define("label",e),$$(this.idTaskPager).define("count",t.length),$$(this.idTaskPager).refresh(),$$(this.id).show()}}const E=new I;class B extends r.A{constructor(){super(),this.id="portal_work_inbox",this.entries=[],this.processLookupHash={},this.appLookupHash={},this.appAccordionLists={}}ui(){var e=(...e)=>this.label(...e);return{id:this.id,view:"window",head:{view:"toolbar",css:"webix_dark inbox_drawer",cols:[{width:7},{view:"label",label:e("Inbox")},{view:"button",autowidth:!0,type:"icon",icon:"nomargin fa fa-times",click:()=>{$$(this.id).hide()},on:{onAfterRender(){r.A.CYPRESS_REF(this)}}}]},position:function(e){e.left=e.maxWidth-350,e.top=0,e.width=350,e.height=e.maxHeight},body:{cells:[{id:"inboxItems",view:"scrollview",scroll:"y",body:{view:"accordion",id:"inbox_accordion",css:{background:"#dadee0 !important"},multi:!0,rows:[]}},{id:"emptyInbox",view:"layout",hidden:!0,css:{background:"#dadee0 !important"},rows:[{},{view:"label",align:"center",height:200,label:"<div style='display: block; font-size: 180px; background-color: #666; color: transparent; text-shadow: 0px 1px 1px rgba(255,255,255,0.5); -webkit-background-clip: text; -moz-background-clip: text; background-clip: text;' class='fa fa-thumbs-up'></div>"},{view:"label",align:"center",label:e("No tasks...you're all caught up.")},{}]}]}}}init(e){this.AB=e,this.AB.Network.get({url:"/config/inbox"}).then((t=>{this.AB.Config.configInbox(t),this.initDelayed(e)}))}initDelayed(e){webix.ui(this.ui()),this.allAppAccordions={},this.lang=this.AB.Account.language(),(this.AB.Config.inboxMetaConfig()||[]).forEach((e=>{this.createAccordian(e)})),this.entries=this.AB.Config.inboxConfig()||[],this.entries.forEach((e=>this.addItem(e)));var t=[];for(var i in this.appAccordionLists){const e=this.getProcessList(i),s=this.allAppAccordions[i]?this.allAppAccordions[i].unitList():null;if(s){const a=async()=>{await this.allAppAccordions[i].init(this.AB),s.parse(e),s.show()};t.push(a())}else this.AB.notify.developer(new Error(`could not find an inbox-accordion for index[${i}]`),{context:"portal_work_inbox:init(): config error",inboxMeta:this.AB.Config.inboxMetaConfig(),inbox:this.entries})}return Promise.all(t).then((()=>{this.emit("updated"),this.AB.on("ab.inbox.create",(async e=>{if(!this.entries.find((t=>t.uuid==e.uuid))){this.entries.push(e);const t=!this.appLookupHash[e.definition];if(t){const[t]=await this.AB.Network.post({url:"/process/inbox/meta",data:{ids:[e.definition]}});this.createAccordian(t)}const i=this.appLookupHash[e.definition],s=this.allAppAccordions[i];this.addItem(e),t&&await s.init(this.AB);const a=s.unitList();a.parse(this.appAccordionLists[i][e.definition]),a.show(),a.refresh(),s.show()}this.emit("updated")})),this.AB.on("ab.inbox.update",(e=>{const t=this.appLookupHash[e.definition];this.allAppAccordions[t].AB.Network.emit("inbox.update",{uuid:e.uuid,unitID:e.definition})})),this.AB.Network.post({url:"/process/inbox/register"},{key:"inbox.register",context:{}})}))}createAccordian(e){if(!e)return;this.translate(e,this.lang);const t=new k(e);return $$("inbox_accordion").addView(t.ui()),this.allAppAccordions[e.id]=t,t.on("showTasks",((...e)=>{E.showTasks(...e)})),t.on("item.processed",(e=>{E.clearTask(e),this.entries=this.entries.filter((t=>t.uuid!=e)),0==this.entries.length&&$$("emptyInbox").show(),this.emit("updated")})),(e.processes||[]).forEach((t=>{this.translate(t,this.lang),this.processLookupHash[t.id]=t.label,this.appLookupHash[t.id]=e.id})),t}getProcessList(e){const t=[];for(const i in this.appAccordionLists[e])t.push(this.appAccordionLists[e][i]);return t}addItem(e){e.uniteLabel="{"+e.definition+"}"+this.processLookupHash[e.definition];var t=this.appLookupHash[e.definition];this.appAccordionLists[t]||(this.appAccordionLists[t]={}),this.appAccordionLists[t][e.definition]||(this.appAccordionLists[t][e.definition]={id:e.definition,name:e.name,uniteLabel:e.uniteLabel,items:[]}),this.appAccordionLists[t][e.definition].items.push(e)}show(){0==this.entries.length?$$("emptyInbox").show():$$("inboxItems").show(),$$(this.id).show();for(const e in this.allAppAccordions)this.allAppAccordions[e]?.show()}translate(e,t){if(e?.translations){var i=e.translations.find((e=>e.language_code==t));i||(i=e.translations[0]),i&&Object.keys(i).forEach((t=>{"language_code"!=t&&(e[t]=i[t])}))}}count(){return this.entries.length}}const S=new B;class D extends r.A{constructor(){super("portal_work_user_profile_window",{imageUser:"",uploaderImage:"",formUserInfo:"",dataEmail:"",editModeEmail:"",buttonEditModeEmail:"",editModeButtonsEmail:"",dataLanguage:"",editModeLanguage:"",buttonEditModeLanguage:"",editModeButtonsLanguage:"",formNewPassword:"",fieldNewPassword:"",systemNotification:"",advanceOptions:""})}ui(){const e=this.ids,t=(...e)=>this.label(...e);let i=this.AB.Account.imageID(),s=`<img src="file/${i}" onerror="this.style.display='none'; document.getElementById('errorImage').style.display = 'block';" width="150" height="150" style="border-radius: 50%; margin: 10px auto; display: block; border: 3px solid white;" />`,a='<div id="errorImage" style="display: none; width: 150px; height: 150px; background: #dee2e6; border-radius: 50%; margin: 10px auto; border: 3px solid white;"><i class="fa fa-user" style="font-size: 118px; color: white; margin: 15px 0 0 32px;"></i></div>';return s=i?`${s}${a}`:a.replace("none;","block;"),{id:e.component,view:"window",position:"center",modal:!0,head:{view:"toolbar",css:"webix_dark",cols:[{width:7},{view:"label",label:t("User Profile")},{view:"button",autowidth:!0,type:"icon",icon:"nomargin fa fa-times",on:{onItemClick(){$$(e.component).hide()},onAfterRender(){r.A.CYPRESS_REF(this,"user-profile-close")}}}]},body:{view:"layout",width:460,rows:[{rows:[{id:e.imageUser,view:"template",autoheight:!0,borderless:!0,css:{background:"#222f3e"},template:s},{css:{position:"absolute",top:"185px"},cols:[{},{id:e.uploaderImage,view:"uploader",type:"icon",width:34,height:32,zIndex:999,icon:"fa fa-upload",algin:"center",inputName:"file",apiOnly:!0,multiple:!1,accept:"image/png, image/gif, image/jpeg, image/bmp",upload:`/file/upload/${this.AB.objectUser().id}/6383ce19-b344-44ee-87e6-decced7361f8/1`,on:{onFileUpload:async(t,i)=>{const s=i.data.uuid,a=$$(e.uploaderImage),o=$$(e.imageUser);a.disable(),await this.AB.objectUser().model().update(this.AB.Account.uuid(),{image_id:i.data.uuid}),this.AB.Account._config.image_id=s,o.setHTML(`<img src="file/${this.AB.Account.imageID()}" onerror="this.style.display='none'; document.getElementById('errorImage').style.display = 'block';" width="150" height="150" style="border-radius: 50%; margin: 10px auto; display: block; border: 3px solid white;" /><div id="errorImage" style="display: none; width: 150px; height: 150px; background: #dee2e6; border-radius: 50%; margin: 10px auto; border: 3px solid white;"><i class="fa fa-user" style="font-size: 118px; color: white; margin: 15px 0 0 32px;"></i></div>`),a.enable()},onFileUploadError:(t,i)=>{const s=new Error(i);$$(e.uploaderImage).enable(),this.AB.notify.developer(s,{context:"Error uploading file"}),webix.alert(s)}}},{}]},{id:e.formUserInfo,view:"form",width:460,height:160,borderless:!0,css:{position:"relative",top:"15px"},elements:[{css:{"border-bottom":"1px solid #dee2e6","margin-top":"0 !important"},cols:[{view:"label",width:160,label:t("Tenant")},{view:"label",name:"tenant",value:"",css:"formText",on:{onAfterRender:function(){r.A.CYPRESS_REF(this,"user_profile_tenant")}}}]},{css:{"border-bottom":"1px solid #dee2e6","margin-top":"0 !important"},cols:[{view:"label",width:160,label:t("Username")},{view:"label",name:"username",value:"",css:"formText",on:{onAfterRender:function(){r.A.CYPRESS_REF(this,"user_profile_username")}}}]},{css:{"border-bottom":"1px solid #dee2e6","margin-top":"0 !important"},cols:[{view:"label",width:160,label:t("Email")},{id:e.dataEmail,view:"label",name:"email",value:"",css:"formText",on:{onAfterRender:function(){r.A.CYPRESS_REF(this,"user_profile_email")}}},{id:e.editModeEmail,view:"text",hidden:!0,value:""},{id:e.buttonEditModeEmail,view:"button",type:"icon",icon:"wxi-pencil",width:40,inputWidth:40,on:{onItemClick:()=>{const t=$$(e.dataEmail),i=$$(e.editModeEmail),s=$$(e.buttonEditModeEmail),a=$$(e.editModeButtonsEmail);i.setValue(this.AB.Account.email()),t.hide(),s.hide(),i.show(),a.show()}}},{id:e.editModeButtonsEmail,hidden:!0,cols:[{view:"button",type:"icon",icon:"wxi-close",width:40,inputWidth:40,css:"webix_danger",on:{onItemClick:()=>{const t=$$(e.dataEmail),i=$$(e.editModeEmail),s=$$(e.buttonEditModeEmail),a=$$(e.editModeButtonsEmail);i.hide(),a.hide(),t.show(),s.show()}}},{view:"button",type:"icon",icon:"wxi-check",width:40,inputWidth:40,css:"webix_primary",on:{onItemClick:async()=>{const t=$$(e.dataEmail),i=$$(e.editModeEmail),s=$$(e.buttonEditModeEmail),a=$$(e.editModeButtonsEmail);i.hide(),a.hide(),t.show(),s.show();try{const e=i.getValue();s.disable(),await this.AB.objectUser().model().update(this.AB.Account.uuid(),{email:e}),this.AB.Account._config.email=e}catch(e){this.AB.notify.developer(e,{context:"error updating user profile email"})}finally{t.setValue(this.AB.Account.email()),s.enable()}}}}]}]},{css:{"margin-top":"0 !important"},cols:[{view:"label",width:160,label:t("Language")},{id:e.dataLanguage,view:"label",name:"language",value:"",css:"formText",on:{onAfterRender:function(){r.A.CYPRESS_REF(this,"user_profile_language")}}},{id:e.editModeLanguage,view:"combo",hidden:!0,value:null,options:[]},{id:e.buttonEditModeLanguage,view:"button",type:"icon",icon:"wxi-pencil",width:40,inputWidth:40,on:{onItemClick:async()=>{const t=$$(e.dataLanguage),i=$$(e.editModeLanguage),s=$$(e.buttonEditModeLanguage),a=$$(e.editModeButtonsLanguage);s.disable(),i.define("options",await this.getLanguages()),i.refresh(),i.setValue(this.AB.Account.language()),t.hide(),s.hide(),i.show(),a.show()}}},{id:e.editModeButtonsLanguage,hidden:!0,cols:[{view:"button",type:"icon",icon:"wxi-close",width:40,inputWidth:40,css:"webix_danger",on:{onItemClick:async()=>{const t=$$(e.dataLanguage),i=$$(e.editModeLanguage),s=$$(e.buttonEditModeLanguage),a=$$(e.editModeButtonsLanguage);i.hide(),a.hide(),t.show(),s.show();try{t.setValue(await this.languageCodeToWord(this.AB.Account.language()))}catch(e){t.setValue(null),this.AB.notify.developer(e,{context:"portal_work_user_profile_window: Error updating language"})}finally{s.enable()}}}},{view:"button",type:"icon",icon:"wxi-check",width:40,inputWidth:40,css:"webix_primary",on:{onItemClick:async()=>{const t=$$(e.dataLanguage),i=$$(e.editModeLanguage),s=$$(e.buttonEditModeLanguage),a=$$(e.editModeButtonsLanguage);i.hide(),a.hide(),t.show(),s.show();try{const e=i.getValue();await this.AB.objectUser().model().update(this.AB.Account.uuid(),{languageCode:e}),this.AB.Account._config.languageCode=e}catch(e){this.AB.notify.developer(e,{context:"portal_work_user_profile_window: Error updating language Code"})}finally{try{t.setValue(await this.languageCodeToWord(this.AB.Account.language()))}catch(e){t.setValue(null),this.AB.notify.developer(e,{context:"portal_work_user_profile_window: Error updating languageCodeToWord()"})}s.enable()}}}}]}]}]}]},{rows:[{view:"button",type:"icon",icon:"wxi-angle-down",height:40,css:"webix_primary",label:t("Advanced Options"),on:{onItemClick:t=>{const i=$$(t),s=$$(e.advanceOptions);s.isVisible()?(i.define("icon","wxi-angle-down"),i.refresh(),s.hide()):(i.define("icon","wxi-angle-up"),i.refresh(),s.show())}}},{id:e.advanceOptions,hidden:!0,rows:[{view:"form",width:460,borderless:!0,elements:[{cols:[{rows:[{height:3},{view:"label",width:160,label:t("New Password")},{}]},{id:e.formNewPassword,view:"form",borderless:!0,width:260,padding:0,elements:[{id:e.fieldNewPassword,view:"text",name:"newPassword",type:"password",placeholder:t("Enter a new Password (at least 8)"),value:"",validate:e=>e.length>=8},{view:"text",name:"confirmPassword",type:"password",placeholder:t("Confirm Password"),value:"",validate:t=>t===$$(e.fieldNewPassword).getValue()},{view:"button",type:"form",value:"Save",align:"right",height:32,width:75,inputWidth:75,css:"webix_primary",on:{onItemClick:async t=>{const i=$$(e.formNewPassword),s=$$(t);if(i.validate()){try{const t=$$(e.fieldNewPassword).getValue();s.disable(),i.disable(),await this.AB.Network.post({url:"/auth/password/reset",data:{password:t}},{key:"portal_auth_password_reset",context:{}})}catch(e){this.AB.notify.developer(e,{context:"portal_work_user_profile_window:Error resetting password"})}finally{i.clear(),i.enable(),s.enable()}webix.alert("The new password is successfully updated!")}}}}]}]},{css:{"border-top":"1px solid #dee2e6"},cols:[{view:"label",width:160,label:t("System Notification")},{id:e.systemNotification,view:"checkbox",borderless:!0,width:27,css:{"text-align":"center !important",padding:"0 10px"},value:0,on:{onItemClick:async()=>{const t=$$(e.systemNotification);try{const e=t.getValue();await this.AB.objectUser().model().update(this.AB.Account.uuid(),{sendEmailNotifications:e}),this.AB.Account._config.sendEmailNotifications=e}catch(e){this.AB.notify.developer(e,{context:"portal_work_user_profile_window:Error updating email notifications"})}finally{t.setValue(this.AB.Account.sendEmailNotifications())}}}}]}]}]}]}]}}}async init(e){this.AB=e,webix.ui(this.ui())}async languageCodeToWord(e){if("string"!=typeof e)throw new Error('The argrument "code" should be a string');const t=await this.getLanguages();for(let i=0;i<t.length;i++)if(t[i].id===e)return t[i].value;return null}async getLanguages(){const e=[];try{const t=this.AB.objectLanguage(),i=await t.model().findAll();for(let t=0;t<i.data.length;t++)e.push({id:i.data[t].language_code,value:i.data[t].language_label})}catch(e){this.AB.notify.developer(e,{context:"Error getting Languages"})}return e}async populate(){const e=this.ids,t=$$(e.formUserInfo),i=$$(e.systemNotification);(async()=>{const t=$$(e.dataLanguage),i=$$(e.buttonEditModeLanguage);i.disable();try{t.setValue(await this.languageCodeToWord(this.AB.Account.language()))}catch(e){t.setValue(null),this.AB.notify.developer(e,{context:"Error setting Languages"})}i.enable()})(),t.setValues({tenant:this.AB.Tenant.id(),username:this.AB.Account.username(),email:this.AB.Account.email()}),i.setValue(this.AB.Account.sendEmailNotifications())}hide(){const e=this.ids;$$(e.component).hide()}show(){const e=this.ids;$$(e.component).show(),this.populate()}}const C=new D;var P=null;P||(P=class extends r.A{constructor(){super("portal_work_user_switcheroo",{userIcon:"",userName:"",switchBack:"",switchBackReplacer:"",list:""})}ui(){var e=(...e)=>this.label(...e);const t=this.ids;return{id:t.component,view:"window",position:"center",hidden:!0,close:!0,modal:!0,css:"switcheroo",head:e("Switcheroo"),body:{padding:10,rows:[{height:30,cols:[{id:t.userIcon,view:"label",align:"center",width:44},{id:t.userName,view:"label",align:"center"},{id:t.switchBack,view:"button",value:'<div style="text-align: center; font-size: 12px;"><i class="fa-fw fa fa-times"></i></div>',align:"center",css:"webix_transparent",width:44,on:{onItemClick:()=>{this.switchUser(),this.hide()}}},{id:t.switchBackReplacer,width:44}]},{view:"label",label:e("View site as:"),align:"left"},{id:t.list},{cols:[{view:"button",value:e("Switch"),css:"webix_primary",on:{onAfterRender:function(){r.A.CYPRESS_REF(this,"switcheroo_switch_button")},onItemClick:()=>{const i=$$(t.list).getValue();i?(this.switchUser(i),this.hide()):webix.message(e("Please select a user."))}}}]}]}}}init(e,t=!1){return this.AB=e,t||(webix.ui(this.ui()),this.populate()),Promise.resolve()}hide(){$$(this.ids.component).hide()}show(){$$(this.ids.component).show()}async switcherooClear(){return this.switchUser(null)}async switchUser(e){const t=(this.AB.Account.userList()||[]).find((t=>t.uuid===e));t&&e?await this.AB.Network.post({url:`/auth/switcheroo/${t.uuid}`}):await this.AB.Network.delete({url:"/auth/switcheroo"}),window.location.reload(!0)}populate(){const e=this.ids,t=this.AB.Account.uuid(),i=(this.AB.Account.userList()||[]).filter((e=>e.uuid!==t)).map((e=>({id:e.uuid,value:e.username})));let s=null;if(this.AB.Account.isSwitcherood()&&(s=t),webix.ui({id:e.list,view:"combo",options:{body:{template:e=>e.id===s?`<i class='fa-fw fa fa-user-secret'></i> ${e.value}`:`<span data-cy="switcheroo_option_${e.value}">${e.value}</span>`},data:i},on:{onAfterRender:function(){r.A.CYPRESS_REF(this,"switcheroo_user_list")},onItemClick:e=>{$$(e).setValue("")}}},$$(e.list)),$$(e.userName).setValue(this.AB.Account.username()),this.AB.Account.isSwitcherood())return $$(e.userIcon).setValue("<i class='fa-fw fa fa-user-secret'></i>"),$$(e.switchBackReplacer)?.hide(),void $$(e.switchBack)?.show();$$(e.userIcon).setValue("<i class='fa-fw fa fa-user'></i>"),$$(e.switchBack).hide(),$$(e.switchBackReplacer).show()}});const T=new P;class L extends r.A{constructor(){super(),this.id="portal_work_user_qr_window",this.idTaskMultiview="taskMultiview",this.idTaskTitle="taskTitle",this.idTaskPager="taskPager",this.classQrImageDom="qr-code-image-dom"}ui(){var e=(...e)=>this.label(...e);return{id:this.id,view:"window",position:function(e){e.left=e.maxWidth/2-300,e.top=e.maxHeight/2-.7*e.maxHeight/2,e.width=500,e.height=400},modal:!0,head:{view:"toolbar",css:"webix_dark",cols:[{width:17},{id:this.idTaskTitle,view:"label",label:e("Connect Mobile App")},{view:"button",type:"icon",css:"webix_transparent",width:40,icon:"fa fa-repeat",click:()=>{$$("qr-code-image").refresh()},on:{onAfterRender(){r.A.CYPRESS_REF(this,"qr_image_reload")}}},{view:"button",type:"icon",css:"webix_transparent",width:40,icon:"nomargin fa fa-times",click:()=>{$$(this.id).hide()},on:{onAfterRender(){r.A.CYPRESS_REF(this,"qr_window_close")}}}]},body:{css:{"text-align":"center"},rows:[{height:10},{borderless:!0,template:`<span style="font-size:14px;font-weight:500;">${e("Use your phone's camera app to scan this QR code, and it will open a webpage to the conneXted mobile app. You only need to scan the code for the first time.")}</span>`},{id:"qr-code-image",borderless:!0,autoheight:!0,autowidth:!0,template:`<img src='/relay/user-qr' class='${this.classQrImageDom}' style='margin: 10px auto 20px;display:block;' />`,on:{onAfterRender:()=>{$$("qr-code-image").$view.getElementsByClassName(this.classQrImageDom)[0].onload=()=>{$$("qr-code-image").adjust()}}}},{borderless:!0,template:`<div style="font-size:14px;font-weight:500;font-weight:500;">${e("This code can only be used once. It will expire after 7 days.")}</div>`}]}}}init(e){return this.AB=e,webix.ui(this.ui()),Promise.resolve()}hide(){$$(this.id).hide()}show(){$$(this.id).show()}}const M=new L;class R extends r.A{constructor(){super("portal_work_user_qr_window",{description:"",instructions:"",title:"",qrcode:"",taskPager:""})}ui(){var e=(...e)=>this.label(...e);const t=this.ids;return{id:t.component,view:"window",position:function(e){e.left=e.maxWidth/2-300,e.top=e.maxHeight/2-.7*e.maxHeight/2,e.width=500,e.height=400},modal:!0,head:{view:"toolbar",css:"webix_dark",cols:[{width:17},{id:t.title,view:"label",label:e("Connect Mobile App")},{view:"button",type:"icon",css:"webix_transparent",width:40,icon:"fa fa-repeat",click:()=>{$$("qr-code-image").refresh()},on:{onAfterRender(){r.A.CYPRESS_REF(this,"qr_image_reload")}}},{view:"button",type:"icon",css:"webix_transparent",width:40,icon:"nomargin fa fa-times",click:()=>{$$(t.component).hide()},on:{onAfterRender(){r.A.CYPRESS_REF(this,"qr_window_close")}}}]},body:{css:{"text-align":"center"},rows:[{height:10},{id:t.description,borderless:!0,template:'<span style="font-size:14px;font-weight:500;">The App\'s Description should go here.</span>'},{id:t.instructions,borderless:!0,template:`<span style="font-size:14px;font-weight:500;">${e("Use your phone's camera app to scan this QR code, and it will open a webpage to the {0} mobile app. You only need to scan the code for the first time.")}</span>`},{id:t.qrcode,height:175,borderless:!0,autowidth:!0,template:"<img src='/relay/user-qr' style='margin: 10px auto 20px;display:block;' />"},{}]}}}init(e){return this.AB=e,webix.ui(this.ui()),Promise.resolve()}load(e){let t=$$(this.ids.title);t.define("label",e.label),t.refresh();let i=$$(this.ids.description);i.define("template",`<span style="font-size:14px;font-weight:500;">${e.description}</span>`),i.refresh(),$$(this.ids.instructions).define("template",`<span style="font-size:14px;font-weight:500;">${((...e)=>this.label(...e))("Use your phone's camera app to scan this QR code, and it will open a webpage to the {0} mobile app. You only need to scan the code for the first time.",[e.label])}</span>`);let s=$$(this.ids.qrcode);s.define("template",`<img src='/mobile/qr/${e.id}' style='margin: 10px auto 20px;display:block;' />`),s.refresh(),$$(this.ids.component)?.refresh?.()}hide(){$$(this.ids.component).hide()}show(){$$(this.ids.component).show()}}const W=new R;class V extends r.A{constructor(){super(),this.accessLevels=[{id:"0",value:"No Access"},{id:"1",value:"Read Only"},{id:"2",value:"Full Access"}]}ui(){const e={view:"scrollview",css:"lightgray ab_amp",body:{rows:[{view:"accordion",id:"amp_accordion",roles:[],hidden:!0,collapsed:!0,css:"webix_dark",rows:[]},{id:"amp_accordion_noSelection",rows:[{},{view:"label",align:"center",height:200,label:"<div style='display: block; font-size: 180px; background-color: #666; color: transparent; text-shadow: 0px 1px 1px rgba(255,255,255,0.5); -webkit-background-clip: text; -moz-background-clip: text; background-clip: text;' class='fa fa-unlock-alt'></div>"},{view:"label",align:"center",label:"Add a role to control access."},{cols:[{},{view:"button",label:"Add Role",type:"form",css:"webix_primary",autowidth:!0,click:()=>{webix.ui(t).show();const e=this.roles.filter((e=>-1==$$("amp_accordion").config.roles.indexOf(e.id)));$$("role_popup_options").define("options",e),$$("role_popup_options").refresh()}},{}]},{}]}]}},t={view:"popup",id:"role_popup",position:"center",height:250,width:350,modal:!0,body:{rows:[{view:"toolbar",id:"myToolbarABLiveTool",css:"webix_dark",cols:[{view:"label",label:"Add Role",align:"center"}]},{view:"form",elements:[{view:"combo",label:"",id:"role_popup_options",placeholder:"Choose role",options:[]},{cols:[{view:"button",value:"Cancel",click:()=>{$$("role_popup").hide()}},{view:"button",value:"Add",id:"role_popup_options_add",css:"webix_primary",click:()=>{const e=$$("role_popup_options").getValue();$$(`amp_accordionitem_${e}`)?($$(`amp_accordionitem_${e}`).show(),$$("amp_accordion").config.roles.push(e)):this.buildAccessAccordion(e),$$("role_popup").hide()}}]}]}]}};return{view:"window",css:"ampWindow",id:"access_manager",position:function(e){e.left=e.maxWidth-350,e.top=0,e.width=350,e.height=e.maxHeight},on:{onShow:()=>{var e=0;$$("amp_accordion").getChildViews().forEach((t=>{0==e?$$(t).expand():$$(t).collapse(),e++,$$("amp_accordion").show(),$$("amp_accordion_noSelection").hide()}))}},head:{view:"toolbar",css:"webix_dark",cols:[{width:15},{view:"label",label:"Access Manager",autowidth:!0},{},{view:"button",label:"Add Role",width:100,css:"webix_primary",click:()=>{webix.ui(t).show();var e=this.roles.filter((e=>-1==$$("amp_accordion").config.roles.indexOf(e.id)));$$("role_popup_options").define("options",e),$$("role_popup_options").refresh()}},{view:"button",width:35,css:"webix_transparent",type:"icon",icon:"nomargin fa fa-times",click:()=>{this.hide()}}]},body:e}}init(e){this.AB=e.AB,this.portal=e,this.appId=e.AppState.lastSelectedApp;const t=this.AB.Config.userConfig().languageCode;this.roles=this.AB.Config.metaConfig().roles.map((e=>{const i=e.translations.filter((e=>e.code==t)),s=1==i.length?i[0].name:e.name;return{id:e.id,value:s}})),webix.ui(this.ui());const i=this.AB.applicationByID(this.appId);if(i.isAccessManaged){const e=[];i.pages().forEach((t=>{Object.keys(t.accessLevels).forEach((t=>{-1==e.indexOf(t)&&e.push(t)}))})),e.forEach((e=>{this.buildAccessAccordion(e)}))}}show(){$$("access_manager").show()}hide(){$$("access_manager").hide()}showPage(e,t,i){i.application={},i.application.id=this.appId,this.portal.showPage(i),this.portal.pageContainers[i.id].showPage(t,e)}views(e){return this.AB.applicationByID(this.appId).views(e)}buildAccessAccordion(e){const t=this.AB.Label(),i=this.AB.applicationByID(this.appId),s=1==parseInt(i.accessManagers.useRole)&&i.accessManagers.role.indexOf(e)>-1,a={rows:[{height:10},{cols:[{width:10},{view:"button",type:"icon",icon:"fa fa-trash",css:"webix_danger_inverse",label:"Remove",click:async()=>{if(await webix.confirm("Remove role from app?")){const t=$$(`linetree_${e}`),i=this.AB.applicationByID(this.appId).pages();await i.forEach((async e=>{const i=t.getItem(e.id);i.access="0",await e.updateAccessLevels(t.config.role,"0"),t.updateItem(e.id,i)})),$$(`amp_accordionitem_${e}`).hide();const s=$$("amp_accordion").config.roles.indexOf(e);s>-1&&$$("amp_accordion").config.roles.splice(s,1)}}},{width:10}]},{height:10}]};$$("amp_accordion").config.roles.push(e);const o=e=>{if(!e.parent)return!1;var t=e.parent;if(!t.parent)return!1;t.parent.emit("changeTab",t.id),o(t.parent)},n=(e,t)=>{let i=$$(t).getItem(e);return 0==i.$parent?i:n(i.$parent,t)},r={id:`linetree_${e}`,view:"edittree",type:"lineTree",editable:!0,role:e,editor:"combo",editValue:"access",threeState:!0,template:(t,i)=>{let s,a;switch($$(`linetree_${e}`).config.options.find((e=>e.id===t.access)).id){case"1":s="#FFAB00",a="eye";break;case"2":s="#00C853",a="pencil";break;default:s="#ff4938",a="lock"}return`<span class="accessLevel">\n                     <span class="fa-stack">\n                        <i style="color: ${s};" class="fa fa-circle fa-stack-2x"></i>\n                        <i class="fa fa-${a} fa-stack-1x fa-inverse"></i>\n                     </span>\n                     ${i.icon(t,i)}\n                     <span>${t.label}</span>\n                     <i class="externalLink fa fa-external-link"></i>\n                  </span>`},options:this.accessLevels,data:this.getAccessLevelTree(e),onClick:{externalLink:(t,i,s)=>{const a=$$(`linetree_${e}`).getItem(i),r=n(i,`linetree_${e}`);if("tab"==a.type){this.showPage(i,a.pageId,r);const e=this.views((e=>e.id==a.id))[0];if(!e)return!1;const t=e.parent;if(!t)return!1;if(o(t),!$$(e.id)||!$$(e.id).isVisible()){const i=setInterval((()=>{$$(e.id)&&$$(e.id).isVisible()&&clearInterval(i),t.emit("changeTab",e.id)}),200)}}else this.showPage(i,a.id,r);return!1}},on:{onAfterEditStop:async(t,i,s)=>{if(t.old==t.value)return!1;const a=$$(`linetree_${e}`),o=this.views((e=>e.id==i.id))[0];await o.updateAccessLevels(a.config.role,t.value),console.log(`Role: ${a.config.role} set to Access Level: ${t.value} on view: ${o.id}`)},onDataUpdate:async(t,i,s)=>{const a=$$(`linetree_${e}`);if("0"==i.access){const e=this.views((e=>e.id==t))[0];await e.updateAccessLevels(a.config.role,i.access),a.blockEvent(),await a.data.eachSubItem(t,(async e=>{const t=a.getItem(e.id);if(t.access!=i.access){t.access=i.access;const s=this.views((t=>t.id==e.id))[0];await s.updateAccessLevels(a.config.role,i.access),console.log(`Role: ${a.config.role} set to Access Level: ${i.access} on view: ${s.id}`),a.updateItem(e.id,t)}})),a.unblockEvent()}else{const e=a.getParentId(t),i=a.getItem(e);if(i&&"0"==i.access){i.access="1";const t=this.views((t=>t.id==e))[0];await t.updateAccessLevels(a.config.role,i.access),console.log(`Role: ${a.config.role} set to Access Level: ${i.access} on view: ${t.id}`),a.updateItem(e,i)}}}}},l={view:"accordionitem",id:`amp_accordionitem_${e}`,header:()=>`${this.roles?.find((t=>t.id===e))?.value??e} ${s?`<span class="header" webix_tooltip="${t("This role has been assigned as a Page Access Manager for this App. This means they have full access. Please remove the permissions from the App's Setting page if you would like to manage their access here.")}">${this.WARNING_ICON}</span>`:""}`,collapsed:!0,body:{type:"clean",rows:[r,a]}};$$("amp_accordion").addView(l,-1),$$("amp_accordion").show(),$$("amp_accordion_noSelection").hide(),s&&this.AB.Webix.TooltipControl.addTooltip($$(`amp_accordionitem_${e}`).$view),$$(`linetree_${e}`).openAll()}getAccessLevelTree(e){const t=new webix.TreeCollection,i=(s,a,o,n)=>{const r=s.accessLevels[e]??"0",l={id:s.id,access:r,label:s.label,pageId:o,type:n};if(t.add(l,a,o),"detail"==s.defaults.key)return;const c=s.pages?s.pages():[];c.forEach(((e,t)=>{i(e,t,s.id,"page")})),s.views((e=>"tab"==e.defaults.key)).forEach(((e,t)=>{e.views().forEach(((e,a)=>{const o=c.length+t+a;i(e,o,s.id,"tab")}))}))};return this.AB.applicationByID(this.appId).pages().forEach(((e,t)=>{i(e,t,null,"page")})),t}}const N=new V;class q extends r.A{constructor(){super(),this.containerDomID="domID"}ui(){const e={view:"scrollview",css:"lightgray ab_amp",body:{rows:[{view:"accordion",id:`qtt_accordion_${this.containerDomID}`,roles:[],hidden:!0,collapsed:!0,css:"webix_dark",rows:[]},{id:`qtt_accordion_noSelection_${this.containerDomID}`,rows:[{}]}]}};return{view:"window",css:"qttWindow",id:`quickTranslationTool_${this.containerDomID}`,position:function(e){e.left=e.maxWidth-400,e.top=0,e.width=400,e.height=e.maxHeight},on:{onShow:()=>{var e=0;$$(`qtt_accordion_${this.containerDomID}`).getChildViews().forEach((t=>{0==e?$$(t).expand():$$(t).collapse(),e++,$$(`qtt_accordion_${this.containerDomID}`).show(),$$(`qtt_accordion_noSelection_${this.containerDomID}`).hide()}))}},head:{rows:[{view:"toolbar",css:"webix_dark",cols:[{width:15},{view:"label",label:"Translation Tool",autowidth:!0},{},{view:"button",width:38,css:"webix_transparent",icon:"fa fa-cog",type:"iconTop",click:function(){$$("translationSettings").config.hidden?$$("translationSettings").show():$$("translationSettings").hide()}},{view:"button",width:35,css:"webix_transparent",type:"icon",icon:"nomargin fa fa-times",click:()=>{$$(`quickTranslationTool_${this.containerDomID}`).hide()}}]},{view:"toolbar",id:"translationSettings",hidden:!0,css:"webix_dark",rows:[{id:`qtt_accordion_${this.containerDomID}_translateTo`,view:"select",labelWidth:120,label:"Translate to:",labelAlign:"right",options:[],on:{onChange:(e,t)=>{e!=t&&this.buildTranslationAccordion(this.application.objectsIncluded(),this.application.pages(),this.application.hintsIncluded())}}},{id:`qtt_accordion_${this.containerDomID}_translateHint`,view:"select",labelWidth:120,label:"Hint language:",bottomLabel:"*Hover over label to display hint",labelAlign:"right",options:[],on:{onChange:(e,t)=>{e!=t&&this.buildTranslationAccordion(this.application.objectsIncluded(),this.application.pages(),this.application.hintsIncluded())}}}]}]},body:e}}init(e){this.AB=e.AB,this.portal=e,this.appId=e.AppState.lastSelectedApp,this.application=this.AB.applicationByID(this.appId);const t=this.AB.Config.userConfig().languageCode;let i=[];try{this.AB.Network.get({url:"/app_builder/model/d84cd351-d96c-490f-9afb-2a0b880ca0ec"}).then((e=>{e.data.forEach((e=>{i.push({id:e.language_code,value:e.language_label})})),$$(`qtt_accordion_${this.containerDomID}_translateTo`).define({options:i,value:t}),$$(`qtt_accordion_${this.containerDomID}_translateTo`).refresh(),$$(`qtt_accordion_${this.containerDomID}_translateHint`).define({options:i,value:i[0].id}),$$(`qtt_accordion_${this.containerDomID}_translateHint`).refresh(),this.buildTranslationAccordion(this.application.objectsIncluded(),this.application.pages(),this.application.hintsIncluded())})),webix.ready((function(){webix.protoUI({name:"edittree"},webix.EditAbility,webix.ui.tree)})),webix.ui(this.ui())}catch(e){console.error(e)}}show(){$$(`quickTranslationTool_${this.containerDomID}`).show()}hide(){$$(`quickTranslationTool_${this.containerDomID}`).hide()}showPage(e){let t=this.application.views((t=>t.id==e))[0];this.portal.showPage(t)}views(e){return this.AB.applicationByID(this.appId).views(e)}tutorials(e){return this.AB.applicationByID(this.appId).hints(e)}buildTranslationAccordion(e,t,i){$$(`qtt_accordion_${this.containerDomID}`).removeView(`qtt_accordionitem_${this.containerDomID}_objects`),$$(`qtt_accordion_${this.containerDomID}`).removeView(`qtt_accordionitem_${this.containerDomID}_views`),$$(`qtt_accordion_${this.containerDomID}`).removeView(`qtt_accordionitem_${this.containerDomID}_tutorials`);var s=e=>{if(!e.parent)return!1;var t=e.parent;if(!t.parent)return!1;t.parent.emit("changeTab",t.id),s(t.parent)},a=[{id:`qtt_object_progress${this.containerDomID}`,height:7},{id:`linetree_${this.containerDomID}_objects`,view:"edittree",type:"lineTree",editable:!0,tooltip:"#hint#",editor:"text",editValue:"value",template:(e,t)=>{let i=$$(`qtt_accordion_${this.containerDomID}_translateTo`).getValue();var s="gray";return e.value.indexOf(`[${i}]`)>-1&&(s="#ff5c4c"),e.icon||(e.icon="minus"),`<span><span class="fa-stack" style="margin: 0 5px 0 4px;">\n                                             <i style="color: ${s};" class="fa fa-circle fa-stack-2x"></i>\n                                             <i class="fa fa-${e.icon} fa-stack-1x fa-inverse"></i>\n                                          </span>`+t.icon(e,t)+`<span>${e.value}</span>`},data:[],on:{onAfterLoad:t=>{$$(`qtt_object_progress${this.containerDomID}`).showProgress||webix.extend($$(`qtt_object_progress${this.containerDomID}`),webix.ProgressBar),$$(`linetree_${this.containerDomID}_objects`).parse(this.getTranslationToolObjectsTree(e,this.containerDomID)),$$(`linetree_${this.containerDomID}_objects`).openAll()},onAfterEditStop:(e,t,i)=>{if(e.old==e.value)return!1;let s=$$(`qtt_accordion_${this.containerDomID}_translateTo`).getValue(),a=$$(`linetree_${this.containerDomID}_objects`).data.getItem(t.id),o=a.field,n=a.objectId?a.objectId:a.id,r=a.fieldId?a.fieldId:"",l=this.AB.objectByID(n);if(r){let t=l.fields((e=>e.id==r))[0];if("option"==a.type)t.settings.options.forEach((i=>{if(i.id==a.id){if(l.languageDefault()==s?(c=!0,i[o]=e.value):i.translations.forEach((t=>{t.language_code==s&&(c=!0,t[o]=e.value)})),!c){var n={};n.language_code=s,n[o]=e.value,i.translations.push(n)}t.save()}}));else{var c=!1;if(l.languageDefault()==s?(c=!0,t[o]=e.value):t.translations.forEach((t=>{t.language_code==s&&(c=!0,t[o]=e.value)})),!c){var d={};d.language_code=s,d[o]=e.value,t.translations.push(d)}t.save()}}else{let t=!1;if(l.languageDefault()==s?(t=!0,l[o]=e.value):l.translations.forEach((i=>{i.language_code==s&&(t=!0,i[o]=e.value)})),!t){let t={};t.language_code=s,t[o]=e.value,l.translations.push(t)}l.save()}let h=$$(`qtt_object_progress${this.containerDomID}`),p=h.config.total,u=h.config.completed;-1==e.old.indexOf(`[${s}]`)&&e.value.indexOf(`[${s}]`)>-1?u--:e.old.indexOf(`[${s}]`)>-1&&e.value.indexOf(`[${s}]`)>-1||u++;let w=u/p+1e-5;h.define({total:p,completed:u}),h.showProgress({type:"top",position:w})}}}],o=[{id:`qtt_view_progress${this.containerDomID}`,height:7},{id:`linetree_${this.containerDomID}_views`,view:"edittree",type:"lineTree",editable:!0,tooltip:"#hint#",editor:"text",editValue:"value",template:(e,t)=>{let i=$$(`qtt_accordion_${this.containerDomID}_translateTo`).getValue();var s="gray";e.value.indexOf(`[${i}]`)>-1&&(s="#ff5c4c"),e.icon||(e.icon="minus");var a="";return-1==["button","label","menu"].indexOf(e.type)&&(a='<i style="float:right; color: lightgray" class="externalLink fa fa-external-link"></i>'),`<span><span class="fa-stack" style="margin: 0 5px 0 4px;">\n                                             <i style="color: ${s};" class="fa fa-circle fa-stack-2x"></i>\n                                             <i class="fa fa-${e.icon} fa-stack-1x fa-inverse"></i>\n                                          </span>`+t.icon(e,t)+`<span>${e.value}</span>`+a},data:[],onClick:{externalLink:(e,t,i)=>{var a=$$(`linetree_${this.containerDomID}_views`).getItem(t);if(this.showPage(a.pageId||a.viewId),"tab"==a.type){var o=this.application.views((e=>e.id==a.id))[0];if(!o)return!1;var n=o.parent;if(!n)return!1;if(s(n),!$$(o.id)||!$$(o.id).isVisible())var r=setInterval((function(){$$(o.id)&&$$(o.id).isVisible()&&clearInterval(r),n.emit("changeTab",o.id)}),200)}else if("page"==a.type){var l=this.application.views((e=>e.id==a.id))[0];if(!l)return!1;l.emit("changePage",l.id)}return!1}},on:{onAfterLoad:e=>{$$(`qtt_view_progress${this.containerDomID}`).showProgress||webix.extend($$(`qtt_view_progress${this.containerDomID}`),webix.ProgressBar),$$(`linetree_${this.containerDomID}_views`).parse(this.getTranslationToolViewsTree(t,this.containerDomID)),$$(`linetree_${this.containerDomID}_views`).openAll()},onAfterEditStop:(e,t,i)=>{if(e.old==e.value)return!1;let s=$$(`qtt_accordion_${this.containerDomID}_translateTo`).getValue(),a=$$(`linetree_${this.containerDomID}_views`).data.getItem(t.id),o=a.field;if("menu"==a.type){let t=this.application.views((e=>e.id==a.viewId))[0];t.settings.order.forEach((i=>{if(i.pageId==a.buttonId){let a=!1;if(i.translations.forEach((t=>{t.language_code==s&&(a=!0,t[o]=e.value)})),!a){let t={};t.language_code=s,t[o]=e.value,i.translations.push(t)}t.save()}}))}else if("button"==a.type){let t=this.application.views((e=>e.id==a.viewId))[0];var n=!1;if(t.languageDefault()==s?(n=!0,t.settings[o]=e.value):t.settings.translations.forEach((t=>{t.language_code==s&&(n=!0,t[o]=e.value)})),!n){var r={};r.language_code=s,r[o]=e.value,t.settings.translations.push(r)}t.save()}else{let t=this.application.views((e=>e.id==a.id))[0],i=!1;if(t.languageDefault()==s?(i=!0,t[o]=e.value):t.translations.forEach((t=>{t.language_code==s&&(i=!0,t[o]=e.value)})),!i){let i={};i.language_code=s,i[o]=e.value,t.translations.push(i)}t.save()}let l=$$(`qtt_view_progress${this.containerDomID}`),c=l.config.total,d=l.config.completed;-1==e.old.indexOf(`[${s}]`)&&e.value.indexOf(`[${s}]`)>-1?d--:e.old.indexOf(`[${s}]`)>-1&&e.value.indexOf(`[${s}]`)>-1||d++;let h=d/c+1e-5;l.define({total:c,completed:d}),l.showProgress({type:"top",position:h})}}}],n=[{id:`qtt_tutorials_progress${this.containerDomID}`,height:7},{id:`linetree_${this.containerDomID}_tutorials`,view:"edittree",type:"lineTree",editable:!0,tooltip:"#hint#",editor:"text",editValue:"value",template:(e,t)=>{let i=$$(`qtt_accordion_${this.containerDomID}_translateTo`).getValue();var s="gray";return e.value.indexOf(`[${i}]`)>-1&&(s="#ff5c4c"),e.icon||(e.icon="minus"),`<span><span class="fa-stack" style="margin: 0 5px 0 4px;">\n                                             <i style="color: ${s};" class="fa fa-circle fa-stack-2x"></i>\n                                             <i class="fa fa-${e.icon} fa-stack-1x fa-inverse"></i>\n                                          </span>`+t.icon(e,t)+`<span>${e.value}</span>`},data:[],on:{onAfterLoad:e=>{$$(`qtt_tutorials_progress${this.containerDomID}`).showProgress||webix.extend($$(`qtt_tutorials_progress${this.containerDomID}`),webix.ProgressBar),$$(`linetree_${this.containerDomID}_tutorials`).parse(this.getTranslationToolTutorialsTree(i,this.containerDomID)),$$(`linetree_${this.containerDomID}_tutorials`).openAll()},onAfterEditStop:(e,t,i)=>{if(e.old==e.value)return!1;let s=$$(`qtt_accordion_${this.containerDomID}_translateTo`).getValue(),a=$$(`linetree_${this.containerDomID}_tutorials`).data.getItem(t.id),o=a.field;if("tutorial"==a.type){let t=this.AB.hints((e=>e.id==a.viewId))[0],i=!1;if(t.languageDefault()==s?(i=!0,t[o]=e.value):t.translations.forEach((t=>{t.language_code==s&&(i=!0,t[o]=e.value)})),!i){let i={};for(const[e,a]of Object.entries(t.translations[0]))i[e]=`[${s}] ${a}`;i.language_code=s,i[o]=e.value,t.translations.push(i)}t.save()}else if("step"==a.type){let t=this.AB.hints((e=>e.id==a.hintId))[0]._steps[a.viewId],i=!1;if(t.languageDefault()==s?(i=!0,t[o]=e.value):t.translations.forEach((t=>{t.language_code==s&&(i=!0,t[o]=e.value)})),!i){let i={};for(const[e,a]of Object.entries(t.translations[0]))i[e]=`[${s}] ${a}`;i.language_code=s,i[o]=e.value,t.translations.push(i)}t.save()}let n=$$(`qtt_tutorials_progress${this.containerDomID}`),r=n.config.total,l=n.config.completed;-1==e.old.indexOf(`[${s}]`)&&e.value.indexOf(`[${s}]`)>-1?l--:e.old.indexOf(`[${s}]`)>-1&&e.value.indexOf(`[${s}]`)>-1||l++;let c=l/r+1e-5;n.define({total:r,completed:l}),n.showProgress({type:"top",position:c})}}}],r={view:"accordionitem",id:`qtt_accordionitem_${this.containerDomID}_objects`,header:"Data Objects",collapsed:!0,body:{type:"clean",rows:a}},l={view:"accordionitem",id:`qtt_accordionitem_${this.containerDomID}_views`,header:"Interface Items",collapsed:!0,body:{type:"clean",rows:o}},c={view:"accordionitem",id:`qtt_accordionitem_${this.containerDomID}_tutorials`,header:"Tutorials",collapsed:!0,body:{type:"clean",rows:n}};$$(`qtt_accordion_${this.containerDomID}`).addView(r,-1),$$(`qtt_accordion_${this.containerDomID}`).addView(l,-1),$$(`qtt_accordion_${this.containerDomID}`).addView(c,-1),$$(`qtt_accordion_${this.containerDomID}`).show(),$$(`qtt_accordionitem_${this.containerDomID}_views`).collapse(),$$(`qtt_accordionitem_${this.containerDomID}_tutorials`).collapse(),$$(`qtt_accordion_noSelection_${this.containerDomID}`).hide(),$$(`linetree_${this.containerDomID}_objects`).openAll(),$$(`linetree_${this.containerDomID}_views`).openAll(),$$(`linetree_${this.containerDomID}_tutorials`).openAll()}getTranslations(e,t,i,s,a){var o=!1,n=!1,r=$$(`qtt_accordion_${t}_translateTo`).getValue(),l=e.filter((e=>e.language_code==r))[0];l||(n=!0,l=e[0]);var c=$$(`qtt_accordion_${t}_translateHint`).getValue(),d=e.filter((e=>e.language_code==c))[0];d||(o=!0,d=e[0]);var h="",p="";i&&(h=d[i],p=l[i]),h||(h=d.label),p||(p=l.label);var u="";o&&(u=`[${c}] `);var w="";return n&&(w=`[${r}] `),-1!=(p||"").indexOf(`[${r}]`)||n||s++,{hint:u+h,value:w+p,completed:s,total:++a}}getTranslationToolViewsTree(e,t){var i=0,s=0,a=new webix.TreeCollection,o=(e,n,r,l="label",c)=>{var d=e.translations,h=e.id;"button"==r&&(d=e.settings.translations,h=`${e.id}_${l}`);var p=this.getTranslations(d,t,l,i,s);i=p.completed,s=p.total;var u=e.tabicon?e.tabicon:e.icon,w={id:h,value:p.value,hint:p.hint,field:l,viewId:c,translations:e.translations,pageId:n,buttonId:e.pageId,type:r,icon:u};a.add(w,null,n),(e.pages?e.pages():[]).forEach(((t,i)=>{o(t,e.id,"page")})),e.views&&(e.views((e=>"label"==e.defaults.key)).forEach(((t,i)=>{o(t,e.id,"label","text",t.id)})),e.views((e=>"tab"==e.defaults.key)).forEach(((t,i)=>{t.views().forEach(((i,s)=>{o(i,e.id,"tab","label",t.id)}))})),e.views((e=>"menu"==e.defaults.key)).forEach(((t,i)=>{t.settings.order&&t.settings.order.forEach(((i,s)=>{o(i,e.id,"menu","aliasname",t.id)}))})),e.views((e=>"form"==e.defaults.key)).forEach(((t,i)=>{t.views().forEach(((t,i)=>{if("button"==t.key)for(const i in t.settings.translations[0])"language_code"!=i&&o(t,e.id,"button",i,t.id)}))})),e.views((e=>"chart"==e.defaults.key)).forEach(((t,i)=>{t.views().forEach(((t,i)=>{"label"==t.key&&o(t,e.id,"label","text",t.id)}))})))};e.forEach(((e,t)=>{o(e,null,"page","label",e.id)}));let n=$$(`qtt_view_progress${t}`),r=i/s+1e-4;return n.showProgress({type:"top",position:r}),n.define({total:s,completed:i}),a}getTranslationToolObjectsTree(e,t){var i=0,s=0,a=new webix.TreeCollection,o=(e,n,r,l="label",c,d)=>{var h=e.translations;if(h){var p=this.getTranslations(h,t,l,i,s);i=p.completed,s=p.total;var u={id:e.id,value:p.value,hint:p.hint,translations:e.translations,pageId:n,objectId:d,type:r,field:l,fieldId:c,icon:"object"==r?"database":e.icon?e.icon:""};a.add(u,null,n),(e.fields?e.fields():[]).forEach(((t,i)=>{o(t,e.id,"field","label",t.id,e.id)})),e.settings&&e.settings.options&&e.settings.options.length&&e.settings.options.forEach(((t,i)=>{o(t,e.id,"option","text",c,n)}))}};e.forEach(((e,t)=>{o(e,null,"object")}));let n=$$(`qtt_object_progress${t}`),r=i/s+1e-4;return n.showProgress({type:"top",position:r}),n.define({total:s,completed:i}),a}getTranslationToolTutorialsTree(e,t){var i=0,s=0,a=new webix.TreeCollection,o=(e,n,r,l=["label"],c=null)=>{var d=e.translations;if(!d)return;let h="",p="";l.forEach((o=>{""==p&&(p=o),h=o;var l=this.getTranslations(d,t,o,i,s);i=l.completed,s=l.total;var u={id:e.id+o,viewId:e.id,value:l.value,hint:l.hint,translations:e.translations,field:o,type:r,hintId:c,icon:"tutorial"==r?"info-circle":e.icon?e.icon:"minus-circle"};a.add(u,null,n),n=e.id+p})),(e.stepIDs||[]).forEach((t=>{o(e._steps[t],n,"step",["name","text"],e.id)}))};e.forEach(((e,t)=>{o(e,null,"tutorial",["name","description"])}));let n=$$(`qtt_tutorials_progress${t}`),r=i/s+1e-4;return n.showProgress({type:"top",position:r}),n.define({total:s,completed:i}),a}}const F=new q;let O=(...e)=>AB.Multilingual.label(...e);class U extends r.A{constructor(){super()}ui(e){const t=e=>({view:"window",id:"stepManager"+e,head:{view:"toolbar",css:"webix_dark",cols:[{width:15},{view:"label",label:"Tutorial Steps Manager",autowidth:!0},{},{view:"button",type:"icon",icon:"fa fa-plus",label:"Step",autowidth:!0,css:"webix_primary",click:async()=>{let t=await this.createStep(e);await t.save();let i=this.AB.hints((t=>t.id==e))[0];i?.stepIDs&&Array.isArray(i.stepIDs)?i.stepIDs.push(t.id):i.stepIDs=[t.id],i._steps[t.id]=t,$$("hint_steps_"+i.id).addView(this.stepUI(t,i))}},{view:"button",width:35,css:"webix_transparent",type:"icon",icon:"nomargin fa fa-times",click:()=>{$$("stepManager"+e).close(),this.show()}}]},width:800,height:500,move:!0,position:"center",resize:!0,body:{rows:[{view:"scrollview",body:{rows:[o(e),{id:"hint_steps_"+e,rows:[]}]}},a(e)]}}),i={view:"scrollview",css:"lightgray ab_tutorial",body:{rows:[{view:"list",id:"tutorial_list",template:'<div class="deleteHint">\n                                 <i class="fa fa-times"></i>\n                              </div>\n                              <div class="active#settings.active# abTutorial">\n                                 <h1>#name#</h1>\n                                 <p>#description#</p>\n                              </div>',data:this._hints,hidden:0==this._hints.length,type:{css:"hintItem",height:"auto"},onClick:{deleteHint:(e,t)=>(webix.confirm({title:O("Delete Tutorial"),text:O("Are you sure you want to delete this tutorial?"),type:"confirm-error"}).then((e=>(this.AB.hintID(t).destroy(this.application),$$("tutorial_list").remove(t),0==$$("tutorial_list").count()&&($$("tutorial_list").hide(),$$("tutorial_list_noSelection").show()),!1))).fail((()=>{})),!1),hintItem:(e,i)=>{webix.ui(t(i)).show(),this.steps(i),this.hide()}}},{id:"tutorial_list_noSelection",hidden:this._hints.length>0,rows:[{},{view:"label",align:"center",height:200,label:"<div style='display: block; font-size: 180px; background-color: #666; color: transparent; text-shadow: 0px 1px 1px rgba(255,255,255,0.5); -webkit-background-clip: text; -moz-background-clip: text; background-clip: text;' class='fa fa-info-circle'></div>"},{view:"label",align:"center",label:"Add a tutorial to this page."},{cols:[{},{view:"button",label:"Create Tutorial",type:"form",css:"webix_primary",autowidth:!0,click:()=>{webix.ui(s).show(),$$("view_popup_options").define("options",this.options),$$("view_popup_options").define("value",this.portal.AppState.lastPages[this.portal.AppState.lastSelectedApp]),$$("view_popup_options").refresh()}},{}]},{}]}]}},s={view:"popup",id:"newTutorialPopup",position:"center",height:250,width:350,modal:!0,body:{rows:[{view:"toolbar",id:"myToolbarABLiveTool",css:"webix_dark",cols:[{view:"label",label:O("Create Tutorial"),align:"center"}]},{view:"form",elements:[{view:"combo",label:"",id:"view_popup_options",placeholder:O("Choose Page or Tab"),options:[]},{cols:[{view:"button",value:O("Cancel"),click:()=>{$$("newTutorialPopup").hide()}},{view:"button",value:"Create",id:"view_popup_options_add",css:"webix_primary",click:()=>{let e=$$("view_popup_options").getValue(),t=$$("view_popup_options").getText().trim();this.createTutorial(e,t),$$("newTutorialPopup").hide()}}]}]}]}},a=e=>({cols:[{},{view:"button",value:O("Cancel"),width:100,click:()=>{$$("stepManager"+e).close(),this.show()}},{view:"button",value:O("Save"),width:100,css:"webix_primary",click:async(t,i)=>{let s=$$("stepform"+e).validate(),a=this.AB.hints((t=>t.id==e))[0];if(a.stepIDs.forEach((e=>{if(a?._steps?.[e])if($$("step_form"+e).validate({disabled:!0})){let t=$$("step_form"+e).getValues();a._steps[e].name=t.name,a._steps[e].text=t.text,a._steps[e].settings.event=t.event,a._steps[e].settings.el=t.el}else s=!1})),!s)return!1;var o=$$("stepform"+e).getValues();a.name=o.name,a.description=o.description,a.settings.view=o.view,a.settings.active=o.active;for(const e of a.stepIDs)a?._steps?.[e]&&await a._steps[e].save();await a.save(),$$("stepManager"+e).close(),this.show()}},{}]}),o=e=>{let t=this.AB.hints((t=>t.id==e))[0],i=t?.settings?.active??"1";return{view:"form",id:"stepform"+e,borderless:!0,cols:[{id:"step_window",rows:[{view:"text",label:O("Title"),name:"name",validate:webix.rules.isNotEmpty,invalidMessage:O("Title is required"),value:t.name},{view:"textarea",label:O("Text"),labelAlign:"left",height:100,name:"description",value:t?.description||""}]},{width:300,rows:[{cols:[{view:"label",label:O("Page/Tab"),align:"left",width:100},{view:"combo",name:"view",value:t.settings.view,options:{view:"suggest",css:"wider_popup",body:{view:"list",css:"wider_popup",data:this.options,template:"#value#"}}}]},{view:"switch",label:O("Active"),labelWidth:100,name:"active",value:i}]}]}};return{view:"window",css:"tutorialWindow",id:"tutorial_manager",position:function(e){e.left=e.maxWidth-350,e.top=0,e.width=350,e.height=e.maxHeight},on:{onShow:()=>{}},head:{view:"toolbar",css:"webix_dark",cols:[{width:15},{view:"label",label:"Tutorial Manager",autowidth:!0},{},{view:"button",type:"icon",icon:"fa fa-plus",label:"Tutorial",width:95,css:"webix_primary",click:()=>{webix.ui(s).show(),$$("view_popup_options").define("options",this.options),$$("view_popup_options").define("value",this.portal.AppState.lastPages[this.portal.AppState.lastSelectedApp]),$$("view_popup_options").refresh()}},{view:"button",width:35,css:"webix_transparent",type:"icon",icon:"nomargin fa fa-times",click:()=>{this.hide()}}]},body:i}}init(e){this.AB=e.AB,this.portal=e,this.appId=e.AppState.lastSelectedApp,this.application=this.AB.applicationByID(this.appId);const t=this.application.pages();this.options=this.getViewOptions(t),this._hints=this.AB.hints((e=>this.application.hintIDs.indexOf(e.id)>-1)),webix.ui(this.ui())}show(){$$("tutorial_manager").show(),this._hints=this.AB.hints((e=>this.application.hintIDs.indexOf(e.id)>-1)),$$("tutorial_list").define("data",this._hints),$$("tutorial_list").refresh()}hide(){$$("tutorial_manager").hide()}pageTabWindow(e){return{view:"window",id:"pageTabWindow",width:160,height:160,move:!0,head:{view:"toolbar",css:"webix_dark",cols:[{},{view:"button",width:35,css:"webix_transparent",type:"icon",icon:"nomargin fa fa-times",click:()=>{$$("stepManager"+e).show(),$$("pageTabWindow").hide(),document.removeEventListener("contextmenu",this.handleRightClick,!1)}}]},position:function(e){e.left=e.maxWidth-e.width,e.top=e.maxHeight-e.height},body:{template:"<div class='highlightWin'>"+O("Click the page or tab that will start this tutorial")+"</div>"}}}focusWindow(e){return{view:"window",id:"focusWindow",width:160,height:160,move:!0,head:{view:"toolbar",css:"webix_dark",cols:[{},{view:"button",width:35,css:"webix_transparent",type:"icon",icon:"nomargin fa fa-times",click:()=>{$$("stepManager"+e).show(),$$("focusWindow").hide(),document.removeEventListener("contextmenu",this.handleRightClick,!1),document.body.classList.remove("findDataCy")}}]},position:function(e){e.left=e.maxWidth-e.width,e.top=e.maxHeight-e.height},body:{template:"<div class='highlightWin'>"+O("Right click the element you want to highlight.")+"</div>"}}}updateStepsUI(e){const t=$$("hint_steps_"+e).getChildViews();let i=[];t.forEach((e=>{i.push(e.config.id)})),i.forEach((t=>{$$("hint_steps_"+e).removeView(t)})),this.steps(e)}addHighlightClass(e){let t=$$(e.currentTarget),i=$$("step_form"+t.config.stepId).getValues();document.querySelector(i?.el).classList.add("highlightMe")}removeHighlightClass(e){let t=$$(e.currentTarget),i=$$("step_form"+t.config.stepId).getValues();document.querySelector(i?.el).classList.remove("highlightMe")}steps(e){let t=this.AB.hints((t=>t.id==e))[0];if(t?.stepIDs?.length)t.stepIDs.forEach((i=>{$$("hint_steps_"+e).addView(this.stepUI(t._steps[i],t))}));else{let t={id:"addStepBelow",padding:20,rows:[{css:"ab-component-form-rules",rows:[{},{view:"label",align:"center",height:80,label:"<div style='display: block; font-size: 80px; background-color: #666; color: transparent; text-shadow: 0px 1px 1px rgba(255,255,255,0.5); -webkit-background-clip: text; -moz-background-clip: text; background-clip: text;' class='fa fa-info-circle'></div>"},{view:"label",align:"center",label:O("Add a step to this tutorial.")},{cols:[{},{view:"button",type:"icon",icon:"fa fa-plus",label:O("Step"),autowidth:!0,css:"webix_primary",click:async()=>{let t=await this.createStep(e);await t.save();let i=this.AB.hints((t=>t.id==e))[0];i?.stepIDs&&Array.isArray(i.stepIDs)?i.stepIDs.push(t.id):i.stepIDs=[t.id],i._steps[t.id]=t,$$("hint_steps_"+i.id).removeView("addStepBelow"),$$("hint_steps_"+i.id).addView(this.stepUI(t,i))}},{}]},{}]}]};$$("hint_steps_"+e).addView(t)}const i=document.querySelectorAll(".focusElement");for(let e=0;e<i.length;e++)i[e].addEventListener("mouseover",this.addHighlightClass,!1),i[e].addEventListener("mouseout",this.removeHighlightClass,!1)}stepUI(e,t){let i=$$("hint_steps_"+t.id).getChildViews().length+1;return{view:"form",id:"step_form"+e.id,css:"my",padding:15,borderless:!0,rows:[{borderless:!0,cols:[{width:50,rows:[{view:"label",label:`<h1 class="stepPos">${i}</h1>`,align:"center"},{view:"icon",class:"moveStepUp",icon:"fa fa-caret-up",disabled:1==i,align:"center",click:(i,s)=>{this.moveStep(e,t,"up")}},{view:"icon",class:"moveStepDown",icon:"fa fa-caret-down",disabled:t.stepIDs.length==i,align:"center",click:(i,s)=>{this.moveStep(e,t,"down")}}]},{css:"ab-component-form-rules",padding:15,cols:[{minWidth:300,rows:[{view:"text",label:O("Title"),validate:webix.rules.isNotEmpty,invalidMessage:O("Title is required"),labelWidth:100,name:"name",value:e?.name||""},{view:"textarea",label:O("Text"),labelAlign:"left",labelWidth:100,height:150,name:"text",value:e?.text||""},{cols:[{view:"label",label:O("Highlight"),align:"left",width:100},{view:"button",icon:"fa fa-crosshairs",type:"icon",label:O("select"),css:"focusElement webix_primary",stepId:e.id,width:100,click:()=>{$$("stepManager"+t.id).hide(),document.body.classList.add("findDataCy"),document.addEventListener("contextmenu",this.handleRightClick,!1),document.stepId=e.id,document.hintId=t.id,webix.ui(this.focusWindow(t.id)).show()}},{view:"text",name:"el",value:e.settings.el,disabled:!0,placeholder:O("Click the 'select' button to pick an element to highlight."),bottomLabel:O("Hover over the 'select' button to highlight the chosen element."),validate:webix.rules.isNotEmpty,invalidMessage:O("Please choose an item to highlight")}]},{cols:[{view:"label",label:O("Event"),align:"left",width:100},{view:"combo",value:e.settings.event,name:"event",options:[{id:"click",value:O("Click")},{id:"enter",value:O("Enter")}]}]}]}]},{view:"template",borderless:!0,template:'<div class="deleteStep"><i class="fa fa-times"></i></div>',width:15,onClick:{deleteStep:(i,s)=>(webix.confirm({title:O("Delete Step"),text:O("Are you sure you want to delete this step?"),type:"confirm-error"}).then((async i=>(t.stepRemove(e.id),await t.save(),this.updateStepsUI(t.id),!1))).fail((()=>{})),!1)}}]}]}}async moveStep(e,t,i){let s=t.stepIDs.indexOf(e.id);"up"===i?t.stepIDs.splice(s-1,0,t.stepIDs.splice(s,1)[0]):t.stepIDs.splice(s+1,0,t.stepIDs.splice(s,1)[0]),await t.save(),this.updateStepsUI(t.id)}getViewOptions(e){var t=[],i=(e,s,a)=>{if(-1!=["page","tab","viewcontainer"].indexOf(e.key)){var o="";for(let e=0;e<a;e++)o+="<i style='display:inline-block; width: 10px;'></i>";let i="braille"==e.icon?"external-link-square":e.icon;var n={id:e.id,value:`${o} <i class="fa fa-${i}"></i> ${e.label}`};t.push(n)}(e.pages?e.pages():[]).forEach(((t,s)=>{i(t,e.id,a+1)})),e.views().forEach(((t,s)=>{i(t,e.id,a+1)}))};return e.forEach(((e,t)=>{i(e,null,0)})),t}async createTutorial(e,t){let i=this.AB.hintNew({name:t,settings:{view:e}});await i.save(),Array.isArray(this?.application?.hintIDs)?this.application.hintIDs.unshift(i.id):this.application.hintIDs=[i.id],this.application.save();let s=this.application.views((t=>t.id==e))[0];s.settings.hintID=i.id,s.save(),$$("tutorial_list").add(i,0),this.AB.hints().length&&($$("tutorial_list").show(),$$("tutorial_list_noSelection").hide())}async createStep(e){return this.AB.stepNew(null,e)}handleRightClick(e){if(document?.stepId){e.preventDefault(),e.stopPropagation();let t=function e(t){return t?.dataset?.cy?t.dataset.cy:t?.parentElement?e(t.parentElement):(webix.alert({text:O("Sorry, try another element.")}),"")}(e.target);if(!t)return!1;$$("step_form"+document.stepId).setValues({el:"[data-cy='"+t+"']"},!0)}return $$("stepManager"+document.hintId).show(),$$("focusWindow").hide(),document.removeEventListener("contextmenu",this.handleRightClick,!1),document.body.classList.remove("findDataCy"),delete document.stepId,delete document.hintId,!1}}const H=new U;class z extends r.A{constructor(){super()}ui(){return{id:"portal_work",rows:[{id:"portal_work_network_warning",height:30,css:"portal_work_warning_banner warning_custom_css",hidden:!0,cols:[{width:5},{id:"portal_work_network_warning_label",view:"label",align:"center"},{id:"portal_work_network_warning_button",view:"button",align:"center",hidden:!0,width:100,css:"webix_transparent"},{width:5}]},{id:"portal_work_switcheroo_user_switched",height:30,css:"portal_work_switcheroo_user_switched",hidden:!0,cols:[{width:5},{id:"portal_work_switcheroo_user_switched_label",view:"label",align:"center"},{id:"portal_work_switcheroo_user_switched_loading",view:"label",hidden:!0,align:"center",width:30,label:'<i class="fa fa-refresh fa-spin" aria-hidden="true"></i>'},{view:"button",value:'<div style="text-align: center; font-size: 12px; color:#FFFFFF"><i class="fa-fw fa fa-times"></i></div>',align:"center",width:30,css:"webix_transparent",on:{onAfterRender:function(){r.A.CYPRESS_REF(this,"switcheroo_clear_button")},onItemClick:async()=>{this.busy(),await T.switcherooClear(),this.ready(),$$("portal_work_switcheroo_user_switched").hide()}}},{width:5}]},{view:"toolbar",id:"mainToolbar",css:"webix_dark mainToolbar",padding:10,cols:[{id:"portal_work_menu_sidebar",view:"button",type:"icon",width:50,icon:"fa fa-bars no-margin",click:()=>{let e=$$("navSidebar");if(e.isVisible())e.hide();else{e.show();let t=$$("abSidebarMenu");if(""==t.getSelectedId()){t.blockEvent();const e=t.getFirstId();t.select(e),t.unblockEvent()}}},on:{onAfterRender(){r.A.CYPRESS_REF(this)}}},{view:"label",autowidth:!0,id:"portal_work_menu_title",label:"AppBuilder",align:"left",on:{onAfterRender(){r.A.CYPRESS_REF(this)}}},{},{id:"portal_work_menu_pages",css:"appPages",cols:[],on:{onAfterRender(){r.A.CYPRESS_REF(this)}}},{},{id:"inbox_icon",view:"button",type:"icon",icon:"fa fa-envelope no-margin",width:40,click:()=>{S.show()},on:{onAfterRender(){r.A.CYPRESS_REF(this)}}},{id:"settings_icon",view:"button",type:"icon",icon:"fa fa-cog fa-lg no-margin",width:40,hidden:!0,popup:"settingsMenu",on:{onAfterRender(){r.A.CYPRESS_REF(this)}}},{id:"user_icon",view:"button",type:"icon",icon:"fa fa-user-circle no-margin",width:40,popup:"userMenu",on:{onAfterRender(){r.A.CYPRESS_REF(this)}}}]},{cols:[{id:"navSidebar",hidden:!0,autoheight:!0,borderless:!0,rows:[{id:"abNavSidebarScrollView",view:"scrollview",scroll:"y",css:"darkScrollview",body:{rows:[{view:"sidebar",id:"abSidebarMenu",borderless:!0,css:"webix_dark mainSidebar",data:[],on:{onAfterRender(){this.data.each((e=>{r.A.CYPRESS_REF(this.getItemNode(e.id),e.id)}))},onAfterSelect:()=>{},onItemClick:e=>{this.selectApplication(e)}}}]}},{view:"template",borderless:!0,css:"appDevDesigns",height:110},{id:"portal_work_privacy_policy",view:"template",template:'<a href="#link#" target="_blank" class="policyMenu">#label#</a>',css:"policyLink",height:30,hidden:!0}]},{id:"abWorkPages",template:"No Applications Have Been Loaded."}]}]}}async init(e){this.AB=e,this.storageKey="portal_work_state",this.pageContainers={};const t=(...e)=>this.label(...e),i=[];i.push(C.init(this.AB)),i.push(T.init(this.AB));const s=(this.AB.applications((e=>e.isWebApp&&e.isAccessibleForRoles(this.AB.Account.rolesAll()??[])))||[]).concat(this.AB.plugins()||[]),a=[];for(let e=0;e<s.length;e++)a.push(this.uiSideBarMenuEntry(s[e]));let{privacyPolicy:o,relay:n}=this.AB.Config.siteConfig();o&&($$("portal_work_privacy_policy").setValues({label:t("Privacy Policy"),link:o}),$$("portal_work_privacy_policy").show()),$$("abSidebarMenu").define("data",a),this.sidebarResize(),W.init(e);const l=[{id:"user_profile",label:t("User Profile"),icon:"user"},{id:"user_logout",label:t("Logout"),icon:"ban"}];this.AB.applications((e=>e.isMobile)).forEach((e=>{l.splice(1,0,{id:e.id,label:e.label,icon:e.icon.replace("fa-","")})})),this.AB.Account.canSwitcheroo()&&l.splice(1,0,{id:"user_switcheroo",label:t("Switcheroo"),icon:"user-secret"}),this.AB.Account.isSwitcherood()&&($$("portal_work_switcheroo_user_switched_label").setValue(`<i class="fa-fw fa fa-user-secret"></i>\n            ${t('You are viewing this site as "{0}"',[this.AB.Account.username()])}`),$$("portal_work_switcheroo_user_switched").show()),this.networkWarnings={no_network:{label:`<i class="fa fa-exclamation-triangle" aria-hidden="true"></i>\n            ${t("No network detected. Work will not be saved.")}`,priority:1},no_server:{label:`<i class="fa fa-exclamation-triangle" aria-hidden="true"></i>\n            ${t("Uh oh...we cannot communicate with our servers, please wait before saving data.")}`,priority:2,click:()=>this.AB.Network._connectionCheck(),button:`<i class="fa fa-refresh" aria-hidden="true"></i> #value# ${t("requests")}`,value:0},slow:{label:`<i class="fa fa-exclamation-triangle" aria-hidden="true"></i>\n            ${t("Slow Network Detected! This may affect your experience.")}`,priority:5,click:()=>{this.networkWarningClear("slow"),this.networkWarnings.slow.disabled=!0},button:`<i class="fa fa-times" aria-hidden="true"></i> ${t("dismiss")}`,css:"background: #c98025"}},navigator.onLine||this.networkWarningDisplay("no_network"),window.addEventListener("offline",(()=>{this.networkWarningDisplay("no_network")})),window.addEventListener("online",(()=>{this.networkWarningClear("no_network")})),n&&l.splice(2,0,{id:"user_qr",label:t("Connect Mobile App"),icon:"qrcode"}),this.AB.Webix.ui({view:"popup",id:"userMenu",width:150,body:{view:"list",data:l,template:"<i class='fa-fw fa fa-#icon#'></i> #label#",autoheight:!0,select:!0,on:{onItemClick:t=>{switch(t){case"user_profile":C.show();break;case"user_switcheroo":T.show();break;case"user_logout":e.Account.logout();break;case"user_qr":M.init(e),M.show();break;default:{const e=this.AB.applicationByID(t);if(e)W.load(e),W.show();else{const e=l.filter((e=>e.id==t))[0];this.AB.Webix.message(`<b>Not yet implemented</b><br/>\n                           Menu item:<i>${e.label}</i><br/>\n                           Menu ID:<i>${e.id}</i>`)}}}$$("userMenu").hide()},onAfterRender(){this.data.each((e=>{r.A.CYPRESS_REF(this.getItemNode(e.id),e.id)}))}}}});const c=await this.AB.Storage.get(this.storageKey)??{lastSelectedApp:null,lastPages:{}};if(this.AppState=c,!this.AppState.lastSelectedApp&&a.length)for(let e=0;e<a.length;e++)if((a[e].abApplication.pages().filter((e=>e.getUserAccess?.()>0))||[]).length>0){this.AppState.lastSelectedApp=a[e].abApplication.id;break}let d=null;const h=$$("abSidebarMenu");if(h){let e=this.sidebarMenuEntryByID(this.AppState.lastSelectedApp);if(!e)for(let t=0;t<a.length&&!((a[t].abApplication.pages()||[]).length>0&&(e=this.sidebarMenuEntryByID(a[t].abApplication.id)||null,e));t++);if(e){h.select(e.id),this.selectApplication(e.id);const t=this.AppState.lastPages[e.abApplication.id];d=e.abApplication.pages((e=>e.id===t))[0],d||(d=e.abApplication.pages()[0])}}const p=[];for(let e=0;e<s.length;e++){const t=s[e].pages()||[];for(let e=0;e<t.length;e++)0!==t[e].getUserAccess?.()&&p.push({id:this.pageID(t[e]),template:`Page: ${t[e].label||t[e].name}`})}if(p.length>0&&this.AB.Webix.ui({view:"multiview",keepViews:!0,animate:!1,cells:p},$$("abWorkPages")),this.App||(this.App=new this.AB.Class.ABComponent(null,"portal_work",this.AB).App),d){const e=new y(this.pageID(d),d,this.App,this.AB),t=async()=>{await e.init(this.AB,!0),this.showPage(d)};this.pageContainers[d.id]=e,i.push(t())}for(let e=0;e<s.length;e++){const t=s[e].pages()||[];for(let e=0;e<t.length;e++)if(0!==t[e].getUserAccess?.()&&(!d||t[e].id!==d.id)){const s=new y(this.pageID(t[e]),t[e],this.App,this.AB);this.pageContainers[t[e].id]=s,i.push(s.init(this.AB))}}this.refreshSettingsMenu(),S.on("updated",(()=>{const e=S.count();$$("inbox_icon").define({badge:e||!1}),$$("inbox_icon").refresh()})),await S.init(this.AB),i.push(E.init(this.AB)),this.AB.Network.on("queued",(()=>{const e=this.AB.Network.queueCount();e>0?this.networkWarningDisplay("no_server",e):this.networkWarningClear("no_server")})),this.AB.Network.on("queue.synced",(()=>{this.networkWarningDisplay("no_server",0),this.networkWarningClear("no_server")})),this.AB.Network.isNetworkSlow()&&this.networkWarningDisplay("slow"),this.AB.Network.on("networkslow",(e=>{e?this.networkWarningDisplay("slow"):this.networkWarningClear("slow")})),this.emit("ready"),setTimeout((()=>{$$("portal_work_menu_title").resize()}),200),this.AB.Network._connectionCheck(),["portal_work_menu_pages"].forEach((e=>{r.A.CYPRESS_REF($$(e))})),await Promise.all(i)}networkWarningDisplay(e,t){let i;e&&(this.networkWarnings[e].active=!0),e&&t&&(this.networkWarnings[e].value=t);for(const e in this.networkWarnings){const t=this.networkWarnings[e];t.active&&!t.disabled&&(!i||i.priority>t.priority)&&(i=t)}if(!i)return void $$("portal_work_network_warning").hide();$$("portal_work_network_warning_label").setValue(i.label);const s=$$("portal_work_network_warning_button");if(i.click){s.define("click",i.click);const e=(i.button??"").replaceAll("#value#",i.value);s.define("label",e),s.refresh(),s.show()}else s.hide();i.css?this.AB.Webix.html.addStyle(`.warning_custom_css{${i.css}}`,"warning_custom_css"):this.AB.Webix.html.removeStyle("warning_custom_css"),$$("portal_work_network_warning").show()}networkWarningClear(e){this.networkWarnings[e].active=!1,this.networkWarningDisplay()}pageID(e){return`page_${e.id||e}`}selectApplication(e){const t=$$("abSidebarMenu").getItem(e),i=[];let s=!0,a=null;this.AppState.lastSelectedApp!=t.abApplication.id&&(this.AppState.lastSelectedApp=t.abApplication.id,this.saveState(),this.refreshSettingsMenu()),a=this.AppState.lastPages[t.abApplication.id],a&&(s=!1),(t.abApplication.pages()||[]).forEach((e=>{if(0==e.getUserAccess?.())return;let o="";(s||e.id==a)&&(o="activePage",s=!1,this.AppState.lastPages[t.abApplication.id]=e.id);let n=e.label;"function"==typeof e.label&&(n=e.label()),i.push({view:"button",css:o,type:"icon",label:n,autowidth:!0,icon:`fa fa-${e.icon}`,abPage:e,click:e=>{const t=$$(e);$$("portal_work_menu_pages").queryView({css:"activePage"},"all").forEach((e=>{e!=t&&(e.define("css",""),e.$view.classList.remove("activePage"))})),t.define("css","activePage"),t.$view.classList.add("activePage"),this.showPage(t.data.abPage)},on:{onAfterRender(){r.A.CYPRESS_REF(this,e.id)}}})})),webix.ui(i,$$("portal_work_menu_pages")),$$("portal_work_menu_title").setValue(t.value),$$("portal_work_menu_title").resize();let o=null;$$("portal_work_menu_pages").queryView({css:"activePage"},"all").forEach((e=>{o=e})),this.showPage(o?.data?.abPage);const n=$$("navSidebar");n.isVisible()&&n.hide()}saveState(){this._saveTimeoutID&&clearTimeout(this._saveTimeoutID),this._saveTimeoutID=setTimeout((()=>{this.AB.Storage.set(this.storageKey,this.AppState)}),500)}show(){$$("portal_work").show()}showPage(e){const t=this.pageContainers[e?.id];t&&(t.show(),this.AppState.lastPages[e.application.id]=e.id,this.saveState())}sidebarMenuEntryByID(e){const t=$$("abSidebarMenu");let i=null;if(t){let s=t.getFirstId();for(;!i&&s;){let a=t.getItem(s);a.abApplication.id==e&&(i=a),s=t.getNextId(s)}}return i}sidebarResize(){const e=$$("abSidebarMenu"),t=45*e.count()+1;e.define("height",t),e.resize()}uiSideBarMenuEntry(e){return{id:e.id,icon:`fa ${e.icon}`,value:e.label||e.name,abApplication:e}}refreshSettingsMenu(){const{uuid:e,roles:t}=this.AB.Config.userConfig(),i=this.AB.applicationByID(this.AppState.lastSelectedApp),s=[];if(!i)return $$("settings_icon").hide();if(i.isAccessManaged){let a=!1;"1"==i.accessManagers.useAccount&&i.accessManagers.account.indexOf(e)>-1&&(a=!0),a||"1"!=i.accessManagers.useRole||t.forEach((e=>{i.accessManagers.role.indexOf(e.uuid)>-1&&(a=!0)})),a&&s.push({id:"accessLevel",label:this.label("Access Manager"),icon:"lock"})}if(i.isTranslationManaged){let a=!1;"1"==i.translationManagers.useAccount&&i.translationManagers.account.indexOf(e)>-1&&(a=!0),a||"1"!=i.translationManagers.useRole||t.forEach((e=>{i.translationManagers.role.indexOf(e.uuid)>-1&&(a=!0)})),a&&s.push({id:"translation",label:this.label("Translation Tool"),icon:"language"})}if(i.isTutorialManaged){let a=!1;"1"==i.tutorialManagers.useAccount&&i.tutorialManagers.account.indexOf(e)>-1&&(a=!0),a||"1"!=i.tutorialManagers.useRole||t.forEach((e=>{i.tutorialManagers.role.indexOf(e.uuid)>-1&&(a=!0)})),a&&s.push({id:"tutorial",label:this.label("Tutorial Manager"),icon:"info-circle"})}if(s.length<1)return $$("settings_icon").hide();$$("settings_icon").show(),webix.ui({view:"popup",id:"settingsMenu",width:150,body:{view:"list",data:s,template:"<i class='fa-fw fa fa-#icon#'></i> #label#",autoheight:!0,select:!0,on:{onItemClick:e=>{switch(e){case"accessLevel":N.init(this),N.show();break;case"translation":F.init(this),F.show();break;case"tutorial":H.init(this),H.show();break;default:const t=s.filter((t=>t.id==e))[0];webix.message(`<b>Not yet implemented</b><br/>\n                           Menu item:<i>${t.label}</i><br/>\n                           Menu ID:<i>${t.id}</i>`)}$$("settingsMenu").hide()},onAfterRender(){this.data.each((e=>{r.A.CYPRESS_REF(this.getItemNode(e.id),e.id)}))}}}})}busy(){$$("portal_work_switcheroo_user_switched_loading")?.show()}ready(){$$("portal_work_switcheroo_user_switched_loading")?.hide()}}const j=new z;class Y extends r.A{constructor(){super(),this.ShownPortal=null,this.portalWorkReady=!1}ui(){return{view:"popup",fullscreen:!0,modal:!0,body:{id:"portal",view:"multiview",keepViews:!0,animate:!1,rows:[c.ui(),v.ui(),j.ui()]}}}init(e){this.AB=e,this.AB.on("portal.show",(e=>{this.showPortal(e)}));var t=[];return t.push(v.init(e)),this.AB.Account.isAuthenticated&&(this.AB.Account.on("logout",(e=>{e?.redirect?window.document.location.href=e?.redirect:this.showAuthPortal()})),this.AB.Network.on("reauth",(()=>{this.showAuthPortal()})),j.on("ready",(()=>{this.portalWorkReady=!0,this.showDefaultView()})),t.push(c.init(e)),t.push(j.init(e))),Promise.all(t).then((()=>{this.showDefaultView()}))}showAuthPortal(e){this.ShownPortal!=v&&(v.show(e),this.ShownPortal=v)}showWorkPortal(){this.portalWorkReady?this.ShownPortal!=j&&(j.show(),this.ShownPortal=j):this.ShownPortal||c.show()}showDefaultView(){if(this.AB.Account.isAuthenticated){let t=this.AB.Config.setting("view");if(t){var e=t.split("_");this.showPortal(e[0],t)}else this.portalWorkReady?this.showWorkPortal():this.ShownPortal||c.show()}else this.showAuthPortal()}showPortal(e,t){switch(e){case"auth":this.showAuthPortal(t);break;case"work":this.showWorkPortal()}}}const X=new Y;class K extends r.A{constructor(){super(),this.hiddenElements=[]}ui(){return{id:"labelClickToEnter",view:"label",label:"Hello",on:{onItemClick:()=>{this.portalShow()}}}}init(e){this.AB=e;var t=this.AB.Tenant.textClickToEnter;return t&&$$("labelClickToEnter").define({label:t}),this.popup=X.attach(),X.init(e).then((()=>{this.AB.Config.setting("autoenter")?this.portalShow():this.portalHide()}))}portalHide(){this.popup.hide()}portalShow(){this.popup.show()}}const G=new K;class Q extends r.A{ui(){return{rows:[{id:"switched",height:23,css:"portal_work_switcheroo_user_switched",hidden:!0,cols:[{width:5},{id:"switched_label",view:"label",align:"center"},{view:"button",value:'<div style="text-align: center; font-size: 12px; color:#FFFFFF"><i class="fa-fw fa fa-times"></i></div>',align:"center",width:30,css:"webix_transparent",on:{onItemClick:()=>{T.init(this.AB,!0),T.switcherooClear(),$$("switched").hide()}}},{width:5}]},{id:"error_no_defs",css:"portalLogin",cols:[{},{rows:[{},{width:360,height:200,rows:[{css:"portalLoginForm",padding:30,rows:[{id:"error_no_defs_text",template:`<div style='text-align: center; font-size:14px;'>\n                                       ${((...e)=>this.label(...e))("You don't have any Roles in the system defined.  Talk to an Administrator.")}\n                                    </div>`,borderless:!0}]}]},{}]},{}]}]}}async init(e){this.AB=e}switcherooUser(e){$$("switched").show(),$$("switched_label").setValue(((...e)=>this.label(...e))('*You are viewing this site as "{0}"*',[this.AB.Account.username()]))}preloadMessage(e){$$("error_no_defs_text").setValues({text:e})}destroy(){$$("error_no_defs").destructor()}}const J=new Q,Z=o().EventEmitter,ee=new class extends Z{constructor(){super(),this.setMaxListeners(0),this.Config=n.A,this._div=null,this._plugins=[],this._ui=null,this.on("error",(e=>{s.A.error(e)}))}async init(e){const t=Promise.all([i.e(315),i.e(478)]).then(i.bind(i,61981)),a=e=>document.getElementById("preload-text").innerHTML=e,o=()=>document.getElementById("preloader").remove(),r=new Worker(new URL(i.p+i.u(583),i.b));let l=!1;var c;r.onmessage=({data:e})=>{l!==e&&(l=e,document.getElementById("preload_network_warning").hidden=!l,s.A.setContext("breadcrumb",{category:"network",message:l?"Slow network detected":"Network speed restored",level:"info"}))},a("Waiting for the API Server"),s.A.mark("bootstrap",{op:"function"}),s.A.mark("initDiv",{op:"ui.render"}),await(c=this,new Promise(((e,t)=>{var i=document.querySelector("div[appbuilder-portal]");i||((i=document.createElement("Div")).setAttribute("appbuilder-portal-autoenter","true"),i.setAttribute("appbuilder-portal-fullscreen","true"),document.getElementsByTagName("body")[0].appendChild(i)),i.id||(i.id="AppBuilder"),c.div(i),c.Config.settingsFromDiv(i),e()}))),s.A.measure("initDiv"),s.A.mark("initConfig",{op:"function"}),a("Getting Configuration Settings"),await(async e=>{try{e.Config.settings(window.__AB_Settings);let t=window.__AB_Config;delete t.settings,e.Config.config(t)}catch(t){e.error("initConfig: GET /config:",t),"Failed to fetch"==t.message&&window.location.replace(window.location.origin)}})(this),s.A.measure("initConfig"),await(async e=>{try{let t={user:window.__AB_Config_User,userReal:window.__AB_Config_User_Real};e.Config.configUser(t)}catch(t){e.error("initConfig: GET /config:",t),"Failed to fetch"==t.message&&window.location.replace(window.location.origin)}})(this);const d=n.A.userConfig();if(d)s.A.setContext("user",{id:d.id});else{let{options:e}=n.A.tenantConfig();if(e="string"==typeof e?JSON.parse(e):e,"login"!==e.authType)return void window.location.assign("/auth/login")}s.A.mark("loadPlugins",{op:"function"}),(window.__AB_Plugins||[]).forEach((e=>{this.addPlugin(e)})),s.A.measure("loadPlugins"),s.A.mark("createABFactory",{op:"function"}),a("Starting AppBuilder");const{default:h}=await t;let p=n.A.definitions()||null;if(p&&this._plugins.forEach((e=>{p=p.concat(e.definitions())})),this.AB=new h(p),window.AB||(window.AB=this.AB),this.AB.Network.registerNetworkTestWorker(r,l),await this.AB.init(),await e,d&&0==d.roles.length){s.A.measure("createABFactory"),J.init(this.AB),J.attach(),J.show(),n.A.userReal()&&J.switcherooUser(n.A.userConfig()),o(),this.ui(J);let e=new Error("No Definitions");throw e.code="ENODEFS",e}this._plugins.forEach((e=>{e.apply(this.AB);const t=e.labels(this.AB.Multilingual.currentLanguage());this.AB.Multilingual.pluginLoadLabels(e.key,t)})),s.A.measure("createABFactory"),s.A.mark("initUI",{op:"ui.render"}),webix.ready((()=>{const e={en:"en-US","zh-hans":"zh-CN",th:"th-TH"},{languageCode:t}=AB.Config.userConfig()??{};window.webixLocale=!(!Object.prototype.hasOwnProperty.call(e,t)||!Object.prototype.hasOwnProperty.call(webix.i18n.locales,e[t]))&&e[t],webix.CustomScroll.init();const i=this.div();G.attach(i.id),o(),this.ui(G),this.ui().init(this.AB).then((()=>{s.A.measure("initUI"),s.A.measure("bootstrap")}))}))}addPlugin(e){this._plugins.push(e)}alert(e){webix.alert(e)}div(e){if(!e)return this._div;this._div=e}error(...e){console.error(...e);let t=e[0];this.emit(t)}ui(e){if(!e)return this._ui;this._ui=e}};s.A.init();const te=i.e(592).then(i.t.bind(i,59166,23)).then((async e=>{window.webix=e,i.e(761).then(i.bind(i,92783))}));window.__AB_preload.then((()=>{ee.init(te).catch((e=>{if("ENODEFS"!=e.code){var t=e.toString();ee.alert({type:"alert-error",title:"Error initializing Portal:",text:t}),ee.error(e)}}))}))},93692:(e,t,i)=>{i.d(t,{A:()=>o});var s=i(64785);class a extends s.EventEmitter{constructor(e,t){super(),this.ids={},e&&("string"==typeof e?this.ids={component:e}:(this.ids=e,e=this.ids.base??this.ids.component)),t&&Object.keys(t).forEach((i=>{if(t[i])return this.ids[i]=t[i];this.ids[i]=`${e}_${i}`})),Object.keys(this.ids).forEach((t=>{this.ids[t]=this.ids[t]||`${e}_${t}`})),this.ids.component=this.ids.component||e}static CYPRESS_REF(e,t){if(e){if(t=t||e.config?.id,e.getInputNode){var i=e.getInputNode();if(i)return void i.setAttribute("data-cy",t)}e.$view?e.$view.setAttribute("data-cy",t):e.setAttribute?.("data-cy",t)}}attach(e){var t=this.ui();return t&&e&&(t.container=e),this.el=webix.ui(t),this.el}changePage(e){this.emit("changePage",e)}hide(){this.ids?.component&&$$(this.ids.component).hide()}label(e,...t){return this.AB?this.AB.Multilingual.label(e,e,...t):(console.error(".labels() called before .AB was set!"),e)}ui(){console.error("ClassUI.ui(): it is expected that sub classes of ClassUI will implement their own ui() method.")}show(){this.ids?.component&&$$(this.ids.component)?.show()}get WARNING_ICON(){return'<span class="webix_sidebar_dir_icon webix_icon fa fa-warning pulseLight smalltext"></span>'}get WARNING_ICON_DARK(){return this.WARNING_ICON.replace("pulseLight","pulseDark")}}const o=a},76431:(e,t,i)=>{i.d(t,{A:()=>w});var s=i(71478),a=i(28103),o=i(7043),n=i(8900);let r,l,c="development";try{c="production",l="https://c16443e39a66eae141954dfd23890812@o144358.ingest.sentry.io/4505832903147520",r="1.10.9+c20403"}catch(e){console.warn("Error reading from webpack, check the DefinePlugin is working correctly",e)}const d=l?"sentry":"development"===c?"browser":void 0;class h{init(){}error(){}mark(){}measure(){}notify(e,t,i){console.groupCollapsed(`Notify ${e}: ${t?.message??""}`),console.error(t),console.log("info",i),console.groupEnd()}setContext(){}}const p={sentry:class extends h{constructor(){super(),this.childSpans={}}init(){s.Ts({dsn:l,environment:c,release:r,integrations:[new a.Jh],normalizeDepth:5,sampleRate:.05,tracesSampleRate:.05})}error(e){o.Cp(e)}mark(e,t={}){t.name=e,this.mainSpan?this.childSpans[e]=this.mainSpan.startChild(t):(this.mainSpanKey=e,this.mainSpan=o.nb(t))}measure(e){this.mainSpanKey===e?(this.mainSpan.finish(),delete this.mainSpan,delete this.mainSpanKey,this.childSpans={}):(this.childSpans[e]?.finish?.(),delete this.childSpans[e])}notify(e,t,i){const s=new n.H;"builder"==e&&s.setLevel("warning"),s.setTag("domain",e),s.setContext("info",i),o.Cp(t,s),super.notify(e,t,i)}setContext(e,t){switch(e){case"tags":o.Wt(t);break;case"user":o.gV(t);break;case"breadcrumb":o.ZQ(t);break;default:o.o(e,t)}}},browser:class extends h{error(e){console.error(e)}mark(e,t){this.mainSpanKey||(this.mainSpanKey=e),window.performance.mark(e,{detail:t})}measure(e){try{const t=window.performance.getEntriesByName(e,"mark")[0],i=window.performance.measure(e,{start:e,detail:t?.detail});if(this.mainSpanKey===e){console.groupCollapsed(`${i.name} finished in ${i.duration} ms`);const e=window.performance.getEntriesByType("measure");e.length>1?console.table(e,["name","duration","startTime"]):console.log(i),console.groupEnd(),delete this.mainSpanKey,window.performance.clearMarks(),window.performance.clearMeasures()}}catch(e){}}}};let u;const w=(u||(u=new class{constructor(e){this.mode=e,this.initialized=!1,this._source=new(p[e]??h)}init(){this.initialized||(this._source.init(),this.initialized=!0)}error(e){this._source.error(e)}mark(e,t){this._source.mark(e,t)}measure(e){this._source.measure(e)}notify(e,t,i){this._source.notify(e,t,i)}setContext(e,t){this._source.setContext(e,t)}}(d)),u)}},e=>{e.O(0,[524],(()=>{e.E(315),e.E(478)}),5),e.O(0,[680],(()=>(88096,e(e.s=88096)))),e.O()}]);
//# sourceMappingURL=app.ff1304e8c52480ea47d7.js.map