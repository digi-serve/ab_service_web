/*! For license information please see AB.0db397646ae48c78c0ea.js.LICENSE.txt */
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="cdffb070-0cdd-4324-8cea-f6878cd67ea4",e._sentryDebugIdIdentifier="sentry-dbid-cdffb070-0cdd-4324-8cea-f6878cd67ea4")}catch(e){}}();var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"171f3f978b78d4a902e0f1bf0df8a7da3d1f5a45"},(self.webpackChunkab_platform_web=self.webpackChunkab_platform_web||[]).push([[944],{46700:(e,t,i)=>{var s={"./af":94506,"./af.js":94506,"./ar":59687,"./ar-dz":62887,"./ar-dz.js":62887,"./ar-kw":66307,"./ar-kw.js":66307,"./ar-ly":51664,"./ar-ly.js":51664,"./ar-ma":89926,"./ar-ma.js":89926,"./ar-ps":68634,"./ar-ps.js":68634,"./ar-sa":85207,"./ar-sa.js":85207,"./ar-tn":52912,"./ar-tn.js":52912,"./ar.js":59687,"./az":5011,"./az.js":5011,"./be":25997,"./be.js":25997,"./bg":4427,"./bg.js":4427,"./bm":85385,"./bm.js":85385,"./bn":67703,"./bn-bd":57002,"./bn-bd.js":57002,"./bn.js":67703,"./bo":39841,"./bo.js":39841,"./br":45642,"./br.js":45642,"./bs":69038,"./bs.js":69038,"./ca":53512,"./ca.js":53512,"./cs":39497,"./cs.js":39497,"./cv":6479,"./cv.js":6479,"./cy":89318,"./cy.js":89318,"./da":97229,"./da.js":97229,"./de":63460,"./de-at":51044,"./de-at.js":51044,"./de-ch":26445,"./de-ch.js":26445,"./de.js":63460,"./dv":32096,"./dv.js":32096,"./el":16048,"./el.js":16048,"./en-au":74301,"./en-au.js":74301,"./en-ca":66855,"./en-ca.js":66855,"./en-gb":761,"./en-gb.js":761,"./en-ie":46127,"./en-ie.js":46127,"./en-il":49157,"./en-il.js":49157,"./en-in":37199,"./en-in.js":37199,"./en-nz":31511,"./en-nz.js":31511,"./en-sg":47309,"./en-sg.js":47309,"./eo":92160,"./eo.js":92160,"./es":68582,"./es-do":71885,"./es-do.js":71885,"./es-mx":68131,"./es-mx.js":68131,"./es-us":16962,"./es-us.js":16962,"./es.js":68582,"./et":98890,"./et.js":98890,"./eu":37704,"./eu.js":37704,"./fa":22562,"./fa.js":22562,"./fi":70877,"./fi.js":70877,"./fil":34246,"./fil.js":34246,"./fo":78341,"./fo.js":78341,"./fr":19867,"./fr-ca":82347,"./fr-ca.js":82347,"./fr-ch":17683,"./fr-ch.js":17683,"./fr.js":19867,"./fy":21982,"./fy.js":21982,"./ga":13905,"./ga.js":13905,"./gd":13443,"./gd.js":13443,"./gl":66905,"./gl.js":66905,"./gom-deva":91324,"./gom-deva.js":91324,"./gom-latn":41890,"./gom-latn.js":41890,"./gu":37134,"./gu.js":37134,"./he":96835,"./he.js":96835,"./hi":81394,"./hi.js":81394,"./hr":13564,"./hr.js":13564,"./hu":46269,"./hu.js":46269,"./hy-am":57269,"./hy-am.js":57269,"./id":44254,"./id.js":44254,"./is":8699,"./is.js":8699,"./it":28301,"./it-ch":92887,"./it-ch.js":92887,"./it.js":28301,"./ja":64642,"./ja.js":64642,"./jv":62168,"./jv.js":62168,"./ka":94501,"./ka.js":94501,"./kk":49537,"./kk.js":49537,"./km":45808,"./km.js":45808,"./kn":34881,"./kn.js":34881,"./ko":62951,"./ko.js":62951,"./ku":92452,"./ku-kmr":36063,"./ku-kmr.js":36063,"./ku.js":92452,"./ky":1853,"./ky.js":1853,"./lb":77639,"./lb.js":77639,"./lo":34502,"./lo.js":34502,"./lt":60874,"./lt.js":60874,"./lv":18237,"./lv.js":18237,"./me":87878,"./me.js":87878,"./mi":64234,"./mi.js":64234,"./mk":17535,"./mk.js":17535,"./ml":43896,"./ml.js":43896,"./mn":63046,"./mn.js":63046,"./mr":80927,"./mr.js":80927,"./ms":37224,"./ms-my":66332,"./ms-my.js":66332,"./ms.js":37224,"./mt":24866,"./mt.js":24866,"./my":24206,"./my.js":24206,"./nb":66723,"./nb.js":66723,"./ne":45097,"./ne.js":45097,"./nl":37529,"./nl-be":1355,"./nl-be.js":1355,"./nl.js":37529,"./nn":30296,"./nn.js":30296,"./oc-lnc":4802,"./oc-lnc.js":4802,"./pa-in":77057,"./pa-in.js":77057,"./pl":69850,"./pl.js":69850,"./pt":15552,"./pt-br":83726,"./pt-br.js":83726,"./pt.js":15552,"./ro":1717,"./ro.js":1717,"./ru":79117,"./ru.js":79117,"./sd":61742,"./sd.js":61742,"./se":92049,"./se.js":92049,"./si":83329,"./si.js":83329,"./sk":27619,"./sk.js":27619,"./sl":76707,"./sl.js":76707,"./sq":84281,"./sq.js":84281,"./sr":60436,"./sr-cyrl":13408,"./sr-cyrl.js":13408,"./sr.js":60436,"./ss":27500,"./ss.js":27500,"./sv":6950,"./sv.js":6950,"./sw":54222,"./sw.js":54222,"./ta":73746,"./ta.js":73746,"./te":1130,"./te.js":1130,"./tet":34740,"./tet.js":34740,"./tg":13378,"./tg.js":13378,"./th":20628,"./th.js":20628,"./tk":92622,"./tk.js":92622,"./tl-ph":30100,"./tl-ph.js":30100,"./tlh":22871,"./tlh.js":22871,"./tr":33600,"./tr.js":33600,"./tzl":18985,"./tzl.js":18985,"./tzm":3627,"./tzm-latn":51145,"./tzm-latn.js":51145,"./tzm.js":3627,"./ug-cn":4790,"./ug-cn.js":4790,"./uk":97712,"./uk.js":97712,"./ur":99529,"./ur.js":99529,"./uz":99141,"./uz-latn":61737,"./uz-latn.js":61737,"./uz.js":99141,"./vi":98205,"./vi.js":98205,"./x-pseudo":20697,"./x-pseudo.js":20697,"./yo":37826,"./yo.js":37826,"./zh-cn":83994,"./zh-cn.js":83994,"./zh-hk":36892,"./zh-hk.js":36892,"./zh-mo":43884,"./zh-mo.js":43884,"./zh-tw":85136,"./zh-tw.js":85136};function n(e){var t=a(e);return i(t)}function a(e){if(!i.o(s,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return s[e]}n.keys=function(){return Object.keys(s)},n.resolve=a,e.exports=n,n.id=46700},73978:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>z});var s=i(78332),n=i.n(s),a=i(53059),r=i.n(a),o=i(36105),l=i.n(o),c=i(31222),u=i(78570),d=i(18320),h=i(67483),p=i.n(h),f=i(15435),m=i(5939).EventEmitter;const g=new class extends m{constructor(){super(),this.isAuthenticated=!1,this._config=null,this._listRoles=null,this._listScopes=null,this._listUsers=null}init(e){this.AB=e;var t=this.AB.Config.userConfig();t&&(this.isAuthenticated=!0,this._config=t);var i=this.AB.Config.metaConfig();return i&&(this._listRoles=i.roles||[],this._listScopes=i.scopes||[],this._listUsers=i.users||[]),this.AB.Network.on("account.logout",((e,t,i)=>{t?console.error(t):this.emit("logout",i)})),Promise.resolve()}canSwitcheroo(){return this.roles((e=>"320ef94a-73b5-476e-9db4-c08130c64bb8"===e.uuid)).length>0}isSwitcherood(){return this.AB.Config.userReal()}isSystemDesigner(){return this.roles((e=>"6cc04894-a61b-4fb5-b3e5-b8c3f78bd331"===e.uuid)).length>0}email(){return this._config?.email??""}language(){return this._config?.languageCode??"en"}logout(){return this.AB.Network.post({url:"/auth/logout",data:{tenantUrl:this.AB.Tenant.setting("url")}},{key:"account.logout",context:{}})}roles(e=(()=>!0)){return(this._config?.roles||[]).filter(e)}rolesAll(){return this._listRoles}scopes(){return this._listScopes}username(){return this._config?.username}userList(){return this._listUsers}uuid(){return this._config?.uuid}imageID(){return this._config?.image_id}sendEmailNotifications(){return this._config?.sendEmailNotifications}};var b=i(32019);const v={Alert:function(e){webix.alert({title:e.title||AB.Multilingual.label("opp.dialog.alert.title","*Alert"),text:e.text||e.message||AB.Multilingual.label("opp.dialog.alert.text","*Something is wrong."),ok:e.ok||AB.Multilingual.label("opp.dialog.alert.ok","*OK")})},Confirm:function(e){var t=e.title||AB.Multilingual.label("opp.dialog.confirm.confirmTitle","* Confirm"),i=e.text||e.message||AB.Multilingual.label("opp.dialog.confirm.confirmMsg","* Are you sure you want to do this?"),s=e.labelYes||e.ok||AB.Multilingual.label("opp.common.yes","* yes"),n=e.labelNo||e.cancel||AB.Multilingual.label("opp.common.no","* no");webix.confirm({title:t,text:i,ok:s,cancel:n,callback:function(t){t?e.fnYes&&e.fnYes():e.fnNo&&e.fnNo(),e.callback&&e.callback(t)}})},ConfirmDelete:function(e){this.Confirm({title:e.title||AB.Multilingual.label("opp.dialog.confirm.deleteTitle","* Confirm Delete"),ok:e.ok||AB.Multilingual.label("opp.common.delete","* Delete"),cancel:e.cancel||AB.Multilingual.label("opp.common.cancel","* Cancel"),text:e.text||e.message||AB.Multilingual.label("opp.dialog.confirm.deleteMsg","* Are you sure you want to delete this?",["this"]),callback:function(t){t?e.fnYes&&e.fnYes():e.fnNo&&e.fnNo(),e.callback&&e.callback(t)}})},Message:function(e){var t=e.text||e.message,i=e.timeout||2e3;webix.message({text:t,expire:i})}};var w=i(70504);const y=new class extends w{constructor(){super([],{}),this.isAuthenticated=!1,this._config=null,this._missingLabelID=!1,this._missingLabels={},this._pluginLabelsMissing={}}init(e){return this.AB=e,this.labels=this.AB.Config.labelConfig(),this._languages=this.AB.Config.languageConfig(),this.pluginLabels={},Promise.resolve()}currentLanguage(){return this.AB.Account.language()}label(e,t,i=[],s=!0){void 0===t&&e&&(t=e),2==arguments.length&&Array.isArray(t)&&(i=t,t=e),t=t.replace(/"/g,'\\"'),e=e.replace(/"/g,'\\"');var n=t;"*"==n[0]&&(n=n.slice(1));var a=this.labels[n];return a||(s&&this.postMissingLabel(e,t),a=t),i.forEach(((e,t)=>{var i=`{${t}}`;a=a.replaceAll(i,e)})),a=a.replace(/\\"/g,'"')}labelPlugin(e,t,i=[]){var s=this.label(t,t,i,!1);return s||(s=this.pluginLabels[e][t]),s||(this._pluginLabelsMissing[e]=this._pluginLabelsMissing[e]||{},this._pluginLabelsMissing[e][t]=t,s=t),i.forEach(((e,t)=>{var i=`{${t}}`;s=s.replaceAll(i,e)})),s}languages(){return this._languages}pluginLoadLabels(e,t){this.pluginLabels[e]=t}pluginLabelReport(e){console.warn("missing labels for plugin: ",e),console.warn("current language:",this.currentLanguage());var t=JSON.stringify(this._pluginLabelsMissing[e],null,3);console.warn(t)}postMissingLabel(e,t){this._missingLabelID&&clearTimeout(this._missingLabelID);var i=()=>{var e=[];let t=Object.keys(this._missingLabels).map((e=>this._missingLabels[e]));if(t.length<=50)e=t,this._missingLabels={};else for(var s=0;s<=50;s++){var n=t.shift();e.push(n),delete this._missingLabels[n.key]}this.AB.Network.post({url:"/multilingual/label-missing",data:{labels:JSON.stringify(e)}}).then((()=>{Object.keys(this._missingLabels).length>0&&i()})).catch((e=>{e.toString().indexOf("unable to get")>-1&&console.error("Missing language file for :"+this.currentLanguage())}))};this._missingLabelID=setTimeout((()=>{i()}),1e3),this._missingLabels[e]={key:e,altText:t}}destroy(){return console.error("Multilingual:destroy(): Should not be called."),Promise.resolve()}save(){return console.error("Multilingual:save(): Should not be called."),Promise.resolve()}toObj(){return console.error("Multilingual:toObj(): Should not be called."),{}}toDefinition(){return console.error("Multilingual:toDefinition(): Should not be called."),{}}};var _=i(5939).EventEmitter;const x=i(8262);var k=null;const C=class extends _{constructor(e){super({wildcard:!0,newListener:!1,maxListeners:0}),this.baseURL=null,this.numRetries=3,this._network=e,this.isRealTime=!1}init(e,t){return this.AB=e,k=this.AB.Config.siteConfig(),(t=t||{})&&(this.baseURL=t.baseURL||k.appbuilder.urlCoreServer,this.numRetries=t.networkNumRetries||k.appbuilder.networkNumRetries),Promise.resolve()}get(e,t){e.type=e.type||"GET";var i=e.data||e.params;if(i){var s=["string","number","boolean"],n=Object.keys(i).map((function(e){var t=i[e];return-1==s.indexOf(typeof t)&&(t=JSON.stringify(t)),e+"="+encodeURIComponent(t)})).join("&"),a="?";e.url.indexOf("?")>-1&&(a="&"),e.url=[e.url,n].join(a)}return this._request(e,t)}post(e,t){return e.type=e.type||"POST",this._request(e,t)}put(e,t){return e.type=e.type||"PUT",this._request(e,t)}delete(e,t){return e.type=e.type||"DELETE",this._request(e,t)}isNetworkConnected(){return this._network.isNetworkConnected()}salSend(e){return x(e.url,e).then((e=>e.data))}_request(e,t){if(e._retry=e._retry||0,e._retry>=this.numRetries){var i=new Error(`Too many retries (${this.numRetries}) for ${e.url}`);return i.code="E_TOMANYRETRIES",this.AB.notify.developer(i,{context:"NetworkRest:_request: Too Many Retries"}),t&&this._network.publishResponse(t,i),Promise.reject(i)}return new Promise(((i,s)=>{e.url=e.url||"/","/"==e.url[0]&&(e.url=this.baseURL+e.url),e.headers=e.headers||{},this.AB.Account.authToken&&(e.headers.Authorization=this.AB.Account.authToken),e.headers["Content-type"]="application/json";var n=this.AB.Tenant.id();n&&(e.headers["tenant-token"]=n),this.isNetworkConnected()?(e.method=e.method||e.type,e.timeout=6e3,e.data=e.data||e.params,delete e.params,this.salSend(e).then((e=>{var s=e;t&&this._network.publishResponse(t,null,s),i(s)})).catch((n=>{if("Request timeout"==n.statusText||n.message&&n.message.indexOf("disconnected")>-1)return this.AB.Analytics.log("NetworkRest._request():network connection error detected. Trying again"),e._retry++,void this._request(e).then((e=>{this.AB.warn("*** NetworkRest._request().then(): attempt resolved."),i(e)})).catch((e=>{this.AB.notify.developer(e,{message:"*** NetworkRest._request().catch(): retry failed:"}),s(e)}));403==n.status?this.emit("error.badAuth",n):n.status>=400&&n.status<500?this.emit("error.badRequest",n):n.status>=500&&this.emit("error.badServer",n);var a=null;if(n.responseText)try{a=JSON.parse(n.responseText)}catch(e){}if(a&&"error"==a.status)return 5==a.id||"E_REAUTH"==a.code?void this._network.emit("reauth"):(this.AB.notify.developer(new Error(a.message),{context:"NetworkRest:_request:Error returned from Server (req.ab.error())",data:a.data,status:a.status}),t&&this._network.publishResponse(t,a,null),s(a.data));var r=new Error(`${n.status} ${n.statusText||n.message}: ${e.method} ${e.url}`);return r.response=n.responseText,r.text=n.statusText,r.err=n,r.url=`${e.method} ${e.url}`,this.AB.notify.developer(r,{context:"NetworkRest:_request:Unknown Error returned from server",err:n,response:n.responseText,text:n.statusText||n.message,url:r.url}),t&&this._network.publishResponse(t,r),s(r)}))):(this.AB.Analytics.log("NetworkRest:_request(): Network is offline. Queuing request."),this._network.queue(e,t).then((()=>{i({status:"queued"})})).catch(s))}))}resend(e,t){return this._request(e,t)}},A=["ab.datacollection.create","ab.datacollection.update","ab.datacollection.stale","ab.datacollection.delete","ab.inbox.create","ab.inbox.update"];function D(e,t){I[e]||(I[e]={packets:0,length:0}),I[e].packets++,I[e].length+=t}let I={};const $=class extends C{constructor(e){super(e),this.isRealTime=!0,A.forEach((e=>{io.socket.on(e,(t=>{if(function(e,t){let i="??";try{i=JSON.stringify(t).length}catch(e){console.log(e)}console.warn(`socket: ${e} (${i})`,t),t.jobID&&(D(t.jobID,i),D(`${t.jobID}-${e}`,i))}(e,t),e.indexOf("ab.datacollection")>-1&&t.data){let i=this.AB.objectByID(t.objectId);if(i){let s=i.model();if("ab.datacollection.delete"!=e){let i=this.AB.jobID();d.Z.mark(`${e}:normalization`,{op:"function",data:{jobID:i}}),s.normalizeData(t.data),d.Z.measure(`${e}:normalization`)}}}this.AB.emit(e,t)}))}))}socketLog(){console.warn(JSON.stringify(I,null,4))}isNetworkConnected(){return io.socket.isConnected()}salSend(e){let t,i;try{[,t,i]=e.url.match(/https?:\/\/[^/]+(\/[^?]+)\??(.*)/),t=t.replace(/\b[a-fA-F\d-]{36}\b/g,":ID"),d.Z.mark(t,{op:"websocket.client",data:{http:{query:i||void 0,method:e.method},url:e.url}})}catch(e){this.AB.notify.developer(e,{context:"salSend() create performance.mark"})}return new Promise(((i,s)=>{e.method=e.method.toLowerCase(),io.socket.request(e,((e,n)=>{if(n.statusCode>=400){var a=n.error?n.error.toString():n.body,r=new Error(`Socket Error: ${a}`);r.status=n.statusCode,r.statusText=a,r.responseText=n.body,s(r)}else{if(e instanceof Error)return void s(e);"string"==typeof e&&(d.Z.mark("JSON.parse",{op:"serialize"}),e=JSON.parse(e),d.Z.measure("JSON.parse")),"error"==e?.status?s({status:n.statusCode,responseText:JSON.Stringify(e)}):(d.Z.measure(t),i(e))}}))}))}};var E=i(5939).EventEmitter;const F=new class extends E{constructor(){super(),this.setMaxListeners(0),this.queueLock=null,this._config=null,this._network=null,this._queueCount=0}init(e){if(this.AB=e,this.queueLock=new this.AB.Lock,this._config=this.AB.Config.siteConfig(),this._config){switch(this._config.appbuilder.networkType){case"relay":break;case"socket":this._network=new $(this);break;default:this._network=new C(this)}return this._network.init(e)}return console.error("??? Why No site config ???"),io&&io.socket?io.socket.on("connected",(()=>{this.queueFlush(),this.idConnectionCheck&&(clearTimeout(this.idConnectionCheck),this.idConnectionCheck=null)})):(console.error("!!! Network.init() : Did not find io.socket"),window.addEventListener("online",(()=>this.queueFlush()))),Promise.resolve()}get isRealTime(){return this._network.isRealTime}get(...e){return this._network.get(...e).then((e=>this.normalizeData(e)))}post(...e){return this._network.post(...e).then((e=>this.normalizeData(e)))}put(...e){return this._network.put(...e).then((e=>this.normalizeData(e)))}delete(...e){return this._network.delete(...e).then((e=>this.normalizeData(e)))}_connectionCheck(){this.isNetworkConnected()?(this.queueFlush().catch((()=>{this.idConnectionCheck=setTimeout((()=>{this._connectionCheck()}),250)})),this.idConnectionCheck=null):this.idConnectionCheck=setTimeout((()=>{this._connectionCheck()}),250)}isNetworkSlow(){return!!this._networkSlow}registerNetworkTestWorker(e,t){this._networkTestWorker=e,this._networkSlow=t,this._networkTestWorker.onmessage=({data:e})=>{this._networkSlow!==e&&(this._networkSlow=e,this.emit("networkslow",this._networkSlow),d.Z.setContext("breadcrumb",{category:"network",message:this._networkSlow?"Slow network detected":"Network speed restored",level:"info"}))}}networkStatus(){return navigator.connection.type}isNetworkConnected(){return io&&io.socket&&io.socket.isConnected?io.socket.isConnected():"undefined"==typeof Connection?navigator.onLine:this.networkStatus()!=Connection.NONE}publishResponse(e,t,i){i&&(i=this.normalizeData(i)),this.emit(e.key,e.context,t,i)}normalizeData(e){return"error"===e.status?e:e.data||e}refQueue(){return"networkQueue"}queueCount(){return this._queueCount}queue(e,t){var i=this.refQueue();return new Promise(((s,n)=>{this.queueLock.acquire().then((()=>this.AB.Storage.get(i))).then((s=>((s=s||[]).push({data:e,jobResponse:t}),this.AB.log(`:::: ${s.length} request${s.length>1?"s":""} queued`),this._queueCount=s.length,this.AB.Storage.set(i,s)))).then((()=>{this.emit("queued"),this.idConnectionCheck||this._connectionCheck(),this.queueLock.release(),s()})).catch((e=>{this.AB.notify.developer(e,{message:"Error while queueing data"}),this.AB.Analytics.logError(e),n(e),this.queueLock.release()}))}))}queueFlush(){var e=this.refQueue();if(!this.isNetworkConnected()){var t=new Error("Not connected to the internet.");return t.code="E_NOTCONNECTED",Promise.reject(t)}return new Promise(((t,i)=>{this.queueLock.acquire().then((()=>this.AB.Storage.get(e))).then((e=>{e=e||[];var t=i=>{if(0==e.length)i();else{var s=e.shift(),n=s.data,a=s.jobResponse;this._network.resend(n,a).then((()=>{t(i)})).catch((e=>{e&&"E_TOMANYRETRIES"==e.code?i(e):t(i)}))}};return new Promise(((e,i)=>{t((t=>{t?i(t):e()}))}))})).then((()=>(this._queueCount=0,this.AB.Storage.set(e,[])))).then((()=>(this.emit("queue.synced"),this.queueLock.release()))).then((()=>{t()})).catch((e=>{this.AB.notify.developer(e,{message:"commAPI queueFlush error"}),this.AB.Analytics.logError(e),this.queueLock.release().then((()=>{i(e)}))}))}))}reset(){return Promise.resolve()}type(){return this._config.appbuilder.networkType}getTokens(){return{}}};var S=i(5939).EventEmitter;const N=new class extends S{constructor(){super(),this.tenantStorage=null}init(e){this.AB=e;var t=this.AB.Tenant.id();return t||(t="noAuth"),this.tenantStorage=this.AB.Webix.storage.prefix(t,this.AB.Webix.storage.local),Promise.resolve()}set(e,t){return Promise.resolve().then((()=>this.tenantStorage.put(e,t)))}get(e){return Promise.resolve().then((()=>this.tenantStorage.get(e)))}clear(e){return Promise.resolve().then((()=>this.tenantStorage.remove(e)))}clearAll(){return Promise.resolve().then((()=>this.tenantStorage.clear()))}};var j=i(5939).EventEmitter;const B=new class extends j{constructor(){super(),this.tenantStorage=null,this._config=null,this._storage=null}init(e){this.AB=e;var t=this.AB.Config.siteConfig();return t?(t.storage&&t.storage.encrypted?(console.error("TODO: Implement Encrypted Storage"),this._storage=N):this._storage=N,this._storage.init(e)):(console.error("??? Why No site config ???"),Promise.resolve())}set(...e){return this._storage.set(...e)}get(...e){return this._storage.get(...e)}clear(...e){return this._storage.clear(...e)}clearAll(...e){return this._storage.clearAll(...e)}};var O=i(60979),V=i.n(O),T=i(5939).EventEmitter;const P=new class extends T{constructor(){super(),this.text=!1,this._config=null,this.textClickToEnter=null}init(){var e=f.Z.tenantConfig();if(e){if("string"==typeof e.options||e.options instanceof String)try{e.options=JSON.parse(e.options)}catch(e){console.error(e)}this._config=e,this.textClickToEnter=e.options.textClickToEnter}return Promise.resolve()}id(){return this._config&&"??"!=this._config.id?this._config.id:null}setting(e,t){if(this._config)return t?void(this._config.options[e]=t):this._config.options[e]}},L={appListRowHeight:67,buttonWidthLarge:200,buttonWidthMedium:150,buttonWidthSmall:100,buttonWidthExtraSmall:50,tabWidthLarge:200,tabWidthMedium:120,tabWidthSmall:100,tabWidthExtraSmall:50,columnWidthXLarge:350,columnWidthLarge:250,columnWidthMedium:200,columnWidthSmall:150,columnWidthExtraSmall:100,xSmallSpacer:5,smallSpacer:10,mediumSpacer:25,largeSpacer:50,xLargeSpacer:100,xxLargeSpacer:200,xxxLargeSpacer:400,appListSpacerRowHeight:100,appListSpacerColMinWidth:100,appListSpacerColMaxWidth:200,objectWorkspaceColWidth:20,labelWidthSmall:50,labelWidthMedium:80,labelWidthLarge:120,labelWidthXLarge:150,labelWidthXXLarge:200,labelWidthXXXLarge:280,labelWidthCheckbox:0,hideMobile:!1},R={appListRowHeight:67,buttonWidthLarge:200,buttonWidthMedium:150,buttonWidthSmall:100,buttonWidthExtraSmall:50,tabWidthLarge:200,tabWidthMedium:120,tabWidthSmall:100,tabWidthExtraSmall:50,columnWidthLarge:250,columnWidthMedium:200,columnWidthSmall:150,columnWidthExtraSmall:100,xSmallSpacer:1,smallSpacer:1,mediumSpacer:10,largeSpacer:20,xLargeSpacer:50,xxLargeSpacer:100,xxxLargeSpacer:120,appListSpacerRowHeight:10,appListSpacerColMinWidth:1,appListSpacerColMaxWidth:1,objectWorkspaceColWidth:1,labelWidthSmall:50,labelWidthMedium:80,labelWidthLarge:120,labelWidthXLarge:120,labelWidthXXLarge:120,labelWidthCheckbox:0,hideMobile:!0},M={config:function(){return window.innerWidth<768?R:L},icons:["500px","address-book","address-book-o","address-card","address-card-o","adjust","adn","align-center","align-justify","align-left","align-right","amazon","ambulance","american-sign-language-interpreting","anchor","android","angellist","angle-double-down","angle-double-left","angle-double-right","angle-double-up","angle-down","angle-left","angle-right","angle-up","apple","archive","area-chart","arrow-circle-down","arrow-circle-left","arrow-circle-o-down","arrow-circle-o-left","arrow-circle-o-right","arrow-circle-o-up","arrow-circle-right","arrow-circle-up","arrow-down","arrow-left","arrow-right","arrow-up","arrows","arrows-alt","arrows-h","arrows-v","asl-interpreting","assistive-listening-systems","asterisk","at","audio-description","automobile","backward","balance-scale","ban","bandcamp","bank","bar-chart","bar-chart-o","barcode","bars","bath","bathtub","battery","battery-0","battery-1","battery-2","battery-3","battery-4","battery-empty","battery-full","battery-half","battery-quarter","battery-three-quarters","bed","beer","behance","behance-square","bell","bell-o","bell-slash","bell-slash-o","bicycle","binoculars","birthday-cake","bitbucket","bitbucket-square","bitcoin","black-tie","blind","bluetooth","bluetooth-b","bold","bolt","bomb","book","bookmark","bookmark-o","braille","briefcase","btc","bug","building","building-o","bullhorn","bullseye","bus","buysellads","cab","calculator","calendar","calendar-check-o","calendar-minus-o","calendar-o","calendar-plus-o","calendar-times-o","camera","camera-retro","car","caret-down","caret-left","caret-right","caret-square-o-down","caret-square-o-left","caret-square-o-right","caret-square-o-up","caret-up","cart-arrow-down","cart-plus","cc","cc-amex","cc-diners-club","cc-discover","cc-jcb","cc-mastercard","cc-paypal","cc-stripe","cc-visa","certificate","chain","chain-broken","check","check-circle","check-circle-o","check-square","check-square-o","chevron-circle-down","chevron-circle-left","chevron-circle-right","chevron-circle-up","chevron-down","chevron-left","chevron-right","chevron-up","child","chrome","circle","circle-o","circle-o-notch","circle-thin","clipboard","clock-o","clone","close","cloud","cloud-download","cloud-upload","cny","code","code-fork","codepen","codiepie","coffee","cog","cogs","columns","comment","comment-o","commenting","commenting-o","comments","comments-o","compass","compress","connectdevelop","contao","copy","copyright","creative-commons","credit-card","credit-card-alt","crop","crosshairs","css3","cube","cubes","cut","cutlery","dashboard","dashcube","database","deaf","deafness","dedent","delicious","desktop","deviantart","diamond","digg","dollar","dot-circle-o","download","dribbble","drivers-license","drivers-license-o","dropbox","drupal","edge","edit","eercast","eject","ellipsis-h","ellipsis-v","empire","envelope","envelope-o","envelope-open","envelope-open-o","envelope-square","envira","eraser","etsy","eur","euro","exchange","exclamation","exclamation-circle","exclamation-triangle","expand","expeditedssl","external-link","external-link-square","eye","eye-slash","eyedropper","fa","facebook","facebook-f","facebook-official","facebook-square","fast-backward","fast-forward","fax","feed","female","fighter-jet","file","file-archive-o","file-audio-o","file-code-o","file-excel-o","file-image-o","file-movie-o","file-o","file-pdf-o","file-photo-o","file-picture-o","file-powerpoint-o","file-sound-o","file-text","file-text-o","file-video-o","file-word-o","file-zip-o","files-o","film","filter","fire","fire-extinguisher","firefox","first-order","flag","flag-checkered","flag-o","flash","flask","flickr","floppy-o","folder","folder-o","folder-open","folder-open-o","font","font-awesome","fonticons","fort-awesome","forumbee","forward","foursquare","free-code-camp","frown-o","futbol-o","gamepad","gavel","gbp","ge","gear","gears","genderless","get-pocket","gg","gg-circle","gift","git","git-square","github","github-alt","github-square","gitlab","gittip","glass","glide","glide-g","globe","google","google-plus","google-plus-circle","google-plus-official","google-plus-square","google-wallet","graduation-cap","gratipay","grav","group","h-square","hacker-news","hand-grab-o","hand-lizard-o","hand-o-down","hand-o-left","hand-o-right","hand-o-up","hand-paper-o","hand-peace-o","hand-pointer-o","hand-rock-o","hand-scissors-o","hand-spock-o","hand-stop-o","handshake-o","hard-of-hearing","hashtag","hdd-o","header","headphones","heart","heart-o","heartbeat","history","home","hospital-o","hotel","hourglass","hourglass-1","hourglass-2","hourglass-3","hourglass-end","hourglass-half","hourglass-o","hourglass-start","houzz","html5","i-cursor","id-badge","id-card","id-card-o","ils","image","imdb","inbox","indent","industry","info","info-circle","inr","instagram","institution","internet-explorer","intersex","ioxhost","italic","joomla","jpy","jsfiddle","key","keyboard-o","krw","language","laptop","lastfm","lastfm-square","leaf","leanpub","legal","lemon-o","level-down","level-up","life-bouy","life-buoy","life-ring","life-saver","lightbulb-o","line-chart","link","linkedin","linkedin-square","linode","linux","list","list-alt","list-ol","list-ul","location-arrow","lock","long-arrow-down","long-arrow-left","long-arrow-right","long-arrow-up","low-vision","magic","magnet","mail-forward","mail-reply","mail-reply-all","male","map","map-marker","map-o","map-pin","map-signs","mars","mars-double","mars-stroke","mars-stroke-h","mars-stroke-v","maxcdn","meanpath","medium","medkit","meetup","meh-o","mercury","microchip","microphone","microphone-slash","minus","minus-circle","minus-square","minus-square-o","mixcloud","mobile","mobile-phone","modx","money","moon-o","mortar-board","motorcycle","mouse-pointer","music","navicon","neuter","newspaper-o","object-group","object-ungroup","odnoklassniki","odnoklassniki-square","opencart","openid","opera","optin-monster","outdent","pagelines","paint-brush","paper-plane","paper-plane-o","paperclip","paragraph","paste","pause","pause-circle","pause-circle-o","paw","paypal","pencil","pencil-square","pencil-square-o","percent","phone","phone-square","photo","picture-o","pie-chart","pied-piper","pied-piper-alt","pied-piper-pp","pinterest","pinterest-p","pinterest-square","plane","play","play-circle","play-circle-o","plug","plus","plus-circle","plus-square","plus-square-o","podcast","power-off","print","product-hunt","puzzle-piece","qq","qrcode","question","question-circle","question-circle-o","quora","quote-left","quote-right","ra","random","ravelry","rebel","recycle","reddit","reddit-alien","reddit-square","refresh","registered","remove","renren","reorder","repeat","reply","reply-all","resistance","retweet","rmb","road","rocket","rotate-left","rotate-right","rouble","rss","rss-square","rub","ruble","rupee","s15","safari","save","scissors","scribd","search","search-minus","search-plus","sellsy","send","send-o","server","share","share-alt","share-alt-square","share-square","share-square-o","shekel","sheqel","shield","ship","shirtsinbulk","shopping-bag","shopping-basket","shopping-cart","shower","sign-in","sign-language","sign-out","signal","signing","simplybuilt","sitemap","skyatlas","skype","slack","sliders","slideshare","smile-o","snapchat","snapchat-ghost","snapchat-square","snowflake-o","soccer-ball-o","sort","sort-alpha-asc","sort-alpha-desc","sort-amount-asc","sort-amount-desc","sort-asc","sort-desc","sort-down","sort-numeric-asc","sort-numeric-desc","sort-up","soundcloud","space-shuttle","spinner","spoon","spotify","square","square-o","stack-exchange","stack-overflow","star","star-half","star-half-empty","star-half-full","star-half-o","star-o","steam","steam-square","step-backward","step-forward","stethoscope","sticky-note","sticky-note-o","stop","stop-circle","stop-circle-o","street-view","strikethrough","stumbleupon","stumbleupon-circle","subscript","subway","suitcase","sun-o","superpowers","superscript","support","table","tablet","tachometer","tag","tags","tasks","taxi","telegram","television","tencent-weibo","terminal","text-height","text-width","th","th-large","th-list","themeisle","thermometer","thermometer-0","thermometer-1","thermometer-2","thermometer-3","thermometer-4","thermometer-empty","thermometer-full","thermometer-half","thermometer-quarter","thermometer-three-quarters","thumb-tack","thumbs-down","thumbs-o-down","thumbs-o-up","thumbs-up","ticket","times","times-circle","times-circle-o","times-rectangle","times-rectangle-o","tint","toggle-down","toggle-left","toggle-off","toggle-on","toggle-right","toggle-up","trademark","train","transgender","transgender-alt","trash","trash-o","tree","trello","tripadvisor","trophy","truck","try","tty","tumblr","tumblr-square","turkish-lira","tv","twitch","twitter","twitter-square","umbrella","underline","undo","universal-access","university","unlink","unlock","unlock-alt","unsorted","upload","usb","usd","user","user-circle","user-circle-o","user-md","user-o","user-plus","user-secret","user-times","users","vcard","vcard-o","venus","venus-double","venus-mars","viacoin","viadeo","viadeo-square","video-camera","vimeo","vimeo-square","vine","vk","volume-control-phone","volume-down","volume-off","volume-up","warning","wechat","weibo","weixin","whatsapp","wheelchair","wheelchair-alt","wifi","wikipedia-w","window-close","window-close-o","window-maximize","window-minimize","window-restore","windows","won","wordpress","wpbeginner","wpexplorer","wpforms","wrench","xing","xing-square","y-combinator","y-combinator-square","yahoo","yc","yc-square","yelp","yen","yoast","youtube","youtube-play","youtube-square"]};class q{constructor(e){this.AB=e,this.errors=[]}addError(e,t){this.errors.push({name:e,message:t})}pass(){return 0==this.errors.length}fail(){return this.errors.length>0}toValidationObject(){var e={error:"E_VALIDATION",invalidAttributes:{}},t=e.invalidAttributes;return this.errors.forEach((e=>{t[e.name]=t[e.name]||[],t[e.name].push(e)})),e}updateForm(e){var t=this.toValidationObject();this.AB.Validation.isFormValidationError(t,e)}updateGrid(e,t){var i=this.toValidationObject();this.AB.Validation.isGridValidationError(i,e,t)}}class U extends(n()){constructor(e){super(e),this.Config=f.Z,this.Account=g,this.Dialog=v,this.Multilingual=y,this.Network=F,this.Storage=B,this.Tenant=P,this.Webix=webix,this.ClassUI=b.Z,this.Class.FilterComplex=p(),this.Class.ABViewManager=V(),this.Analytics={log:()=>{},logError:()=>{}},this.Lock=class{constructor(){}acquire(){return Promise.resolve()}release(){return Promise.resolve()}},this.UISettings=M,this.Validation={validator:()=>new q(this),errorSailsCleanup:function(e){return e&&(e.error&&"E_UNKNOWN"==e.error&&e.raw&&e.raw.length>0&&(e=e.raw[0]),e.err&&(e=e.err),e.data&&e.data.error&&"E_VALIDATION"==e.data.error&&(e=e.data)),e},isFormValidationError:function(e,t){var i=!1;if(e&&((e=this.errorSailsCleanup(e)).error&&"E_VALIDATION"==e.error||e.code&&"E_VALIDATION"==e.code)){var s=e.invalidAttributes;if(s){var n=!1;for(var a in s)if(t.elements[a]){var r=s[a],o=[];r.forEach((function(e){o.push(e.message)})),t.markInvalid(a,o.join(", ")),i||(t.elements[a].focus(),i=!0),n=!0}if(n)return!0}}return!1},isGridValidationError:function(e,t,i){if(e&&((e=this.errorSailsCleanup(e)).error&&"E_VALIDATION"==e.error||e.code&&"E_VALIDATION"==e.code)){var s=e.invalidAttributes;if(s){var n=!1;for(var a in s){i.addCellCss(t,a,"webix_invalid"),i.addCellCss(t,a,"webix_invalid_cell");var r=[];s[a].forEach((e=>{r.push(e.message)})),webix.alert({text:a+": "+r.join(", ")}),n=!0}if(i.refresh(t),i.clearSelection(),n)return!0}}return!1}},this.Definitions={},this.on("error",(e=>{console.error(e)})),this._plugins=[],this._pendingNetworkRequests={},this.Network.on("definition.create",((e,t,i)=>{var s=this._pendingNetworkRequests[e.uuid];if(t)return void s?.reject(t);var n={id:i.id,data:i};this.emit("ab.abdefinition.create",n);let a=this.definitionNew(i);s?.resolve(a)})),this.Network.on("definition.update",((e,t,i)=>{var s=this._pendingNetworkRequests[e.uuid];if(t)return t.toString().indexOf("Not Found")>-1?this.definitionCreate(e.values).then(s?.resolve).catch(s?.reject):void s?.reject(t);this._definitions[e.id]=i;var n={id:i.id,data:i};this.emit("ab.abdefinition.update",n),s?.resolve(i)})),this.Network.on("definition.delete",((e,t,i)=>{var s=this._pendingNetworkRequests[e.uuid];if(t)s?.reject(t);else{delete this._definitions[e.id];var n={id:e.id,data:i};this.emit("ab.abdefinition.delete",n),s?.resolve()}}));const t={toDate:(e="",t={})=>{if(!e)return;t.ignoreTime&&(e=e.replace(/T.*/,""));let i=t.format?l()(e,t.format):l()(e);return["YYYY-MM-DD","YYYY/MM/DD","DD/MM/YYYY","MM/DD/YYYY","DD-MM-YYYY","MM-DD-YYYY"].forEach((t=>{i&&i.isValid()||(i=l()(e,t))})),new Date(i)},toDateFormat:(e,t)=>{if(!e)return"";let i=l()(e);return t.localeCode&&i.locale(t.localeCode),i.format(t.format)},subtractDate:(e,t,i)=>l()(e).subtract(t,i).toDate(),addDate:(e,t,i)=>l()(e).add(t,i).toDate()};(Object.keys(t)||[]).forEach((e=>{this.rules[e]=t[e]}))}async init(){var e=[];e.push(this.Account.init(this)),e.push(this.Multilingual.init(this)),e.push(this.Network.init(this)),e.push(this.Tenant.init(this)),await Promise.all(e),await this.Storage.init(this);var t=await this.Storage.get("local_settings");return this._localSettings=t||{},this.on("ab.abdefinition.create",(e=>{if("string"==typeof e.data.json)try{e.data.json=JSON.parse(e.data.json)}catch(e){console.log(e)}this._definitions[e.id]=e.data,this.definitionSync("created",e.id,e.data)})),this.on("ab.abdefinition.update",(e=>{if("string"==typeof e.data.json)try{e.data.json=JSON.parse(e.data.json)}catch(e){console.log(e)}this._definitions[e.id]=e.data,this.definitionSync("updated",e.id,e.data)})),this.on("ab.abdefinition.delete",(e=>{if("string"==typeof e.data.json)try{e.data.json=JSON.parse(e.data.json)}catch(e){console.log(e)}delete this._definitions[e.id],this.definitionSync("destroyed",e.id,e.data)})),super.init()}async definitionCreate(e){return void 0===e.id&&(e.id=this.uuid(),e.json.id=e.id),new Promise(((t,i)=>{var s=this.uuid();this._pendingNetworkRequests[s]={resolve:t,reject:i};var n={key:"definition.create",context:{uuid:s}};this.Network.post({url:"/definition/create",data:e},n).catch((t=>{var i="Error attempting to CREATE definitions";"E_NOPERM"==t.code&&(i="User Doesn't have permission to CREATE definitions"),this.notify.developer(t,{context:"ABFactory.definitionCreate()",message:i,def:e})}))}))}async definitionDestroy(e){return new Promise(((t,i)=>{var s=this.uuid();this._pendingNetworkRequests[s]={resolve:t,reject:i};var n={key:"definition.delete",context:{id:e,uuid:s}};this.Network.delete({url:`/definition/${e}`},n).catch((t=>{var i="Error attempting to DESTROY definitions";"E_NOPERM"==t.code&&(i="User Doesn't have permission to DELETE definitions"),this.notify.developer(t,{context:"ABFactory.definitionDestroy()",message:i,id:e})}))}))}async definitionUpdate(e,t){return new Promise(((i,s)=>{var n=this.uuid();this._pendingNetworkRequests[n]={resolve:i,reject:s};var a={key:"definition.update",context:{id:e,uuid:n,values:t}};this.Network.put({url:`/definition/${e}`,data:t},a).catch((e=>{var t="Error attempting to UPDATE definitions";"E_NOPERM"==e.code&&(t="User Doesn't have permission to UPDATE definitions"),this.notify.developer(e,{context:"ABFactory.definitionUpdate()",message:t})}))}))}notify(e,t,i){d.Z.notify(e,t,i)}plugins(){return this._plugins}pluginLoad(e){this._plugins.push(e)}alert(e){this.Webix.alert(e)}cloneDeep(e){return r().cloneDeep(e)}error(e,...t){var i={message:`ABFactory[${this.Tenant.id()}]:${e.toString()}`};console.error(i.message),e instanceof Error&&(i.error=e,console.error(e)),t&&t.length>0&&t.forEach((e=>{if(e instanceof Error&&(i.error=e,console.error(e)),"object"==typeof e)for(var t in e)i[t]=e[t],console.error(t,e[t])})),this.emit("error",i)}jobID(){return(0,c.x0)()}Label(){return(...e)=>this.Multilingual.label(...e)}localSettings(e,t){return void 0===t?this._localSettings[e]:(this._localSettings[e]=t,this.Storage.set("local_settings",this._localSettings))}log(e,...t){console.log(e),t.forEach((e=>{console.log(e)}))}isUUID(e){return RegExp("^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$","i").test(e)}merge(...e){return r().merge(...e)}orderBy(...e){return r().orderBy(...e)}uniq(...e){return r().uniq(...e)}kebabCase(...e){return r().kebabCase(...e)}sumBy(...e){return r().sumBy(...e)}meanBy(...e){return r().meanBy(...e)}maxBy(...e){return r().maxBy(...e)}minBy(...e){return r().minBy(...e)}uuid(){return(0,u.Z)()}warn(e,...t){console.warn(e),t.forEach((e=>{console.warn(e)}))}isString(...e){return r().isString(e)}}const z=U},45434:(e,t,i)=>{const s=i(96649);var n=i(70504);e.exports=class extends n{constructor(e,t){var i;super(["label","description"],t),e.json=e.json||{},this.id=e.id,this.type=e.type||"application",this.appType=e.appType||"web",this.json=e.json,"string"==typeof this.json&&(this.json=JSON.parse(this.json)),this.json.versionData=e.json?.versionData||{versionNumber:"1.0.0",changeLog:{"1.0.0":{author:"N/A",version:"1.0.0",keepVersion:0,commitMessage:"Initial Version",timestamp:(new Date).toISOString()}}},"string"==typeof this.json.versionData&&(this.json.versionData=JSON.parse(this.json.versionData)),this.name=e.name||this.json.name||"",this.icon=e.icon||"fa-rocket",this.isSystemObject=void 0!==(i=e.isSystemObject)&&""!==i&&"false"!==i&&"0"!==i&&("true"===i||"1"===i||i),this.roleAccess=e.roleAccess||[],Array.isArray(this.roleAccess)||(this.roleAccess=[this.roleAccess]),this.roleAccess=this.roleAccess.filter((e=>e)),this.isAccessManaged=JSON.parse(e.isAccessManaged||!1),this.accessManagers=e.accessManagers,"string"==typeof this.accessManagers&&(this.accessManagers=JSON.parse(this.accessManagers)),this.isTranslationManaged=JSON.parse(e.isTranslationManaged||!1),this.translationManagers=e.translationManagers,"string"==typeof this.translationManagers&&(this.translationManagers=JSON.parse(this.translationManagers)),this.isTutorialManaged=JSON.parse(e.isTutorialManaged||!1),this.tutorialManagers=e.tutorialManagers,"string"==typeof this.tutorialManagers&&(this.tutorialManagers=JSON.parse(this.tutorialManagers)),this.hintIDs=e.json.hintIDs||[],this.objectIDs=e.json.objectIDs||[],this.queryIDs=e.json.queryIDs||[],this.datacollectionIDs=e.json.datacollectionIDs||[];let s=[];(e.json.pageIDs||[]).forEach((e=>{var t=this.AB.definitionByID(e);t?s.push(this.pageNew(t)):this.emit("warning",`App[${this.id}] is referenceing an unknown Page[${e}]`,{appID:this.id,pageID:e})})),this._pages=s,(e.json.processIDs||[]).forEach((e=>{this.AB.processByID(e)||this.emit("warning","Application is referencing an unknown process.",{appID:this.id,processID:e})})),this.processIDs=e.json.processIDs||[],e.json.objectListSettings=e.json.objectListSettings||{},this.objectListSettings=this.objectListSettings||{},this.objectListSettings.isOpen=JSON.parse(e.json.objectListSettings.isOpen||!1),this.objectListSettings.searchText=e.json.objectListSettings.searchText||"",this.objectListSettings.sortDirection=e.json.objectListSettings.sortDirection||"asc",this.objectListSettings.isGroup=JSON.parse(e.json.objectListSettings.isGroup||!1),e.translations=e.translations||e.json.translations,super.fromValues(e)}get ViewManager(){return s}isAccessibleForRoles(e){var t=!1;return this.isAccessManaged?(parseInt(this.accessManagers.useRole)&&(e||[]).forEach((e=>{this.accessManagers.role.indexOf(e.uuid||e)>-1&&(t=!0)})),t||((this.pages()||[]).forEach((i=>{i.isAccessibleForRoles(e)&&(t=!0)})),t)):((e||[]).forEach((e=>{this.roleAccess.indexOf(e.uuid||e)>-1&&(t=!0)})),t)}get isWebApp(){return"web"==this.appType}get isMobile(){return"mobile"==this.appType}toObj(){let e=this.json.versionData;return this.json=super.toObj(),this.json.name=this.name,this.json.versionData=e,this.json.objectIDs=this.objectIDs,this.json.objectListSettings=this.objectListSettings,this.json.hintIDs=this.hintIDs,this.json.queryIDs=this.queryIDs,this.json.datacollectionIDs=this.datacollectionIDs,this.json.pageIDs=(this._pages||[]).map((e=>e.id)),this.json.processIDs=this.processIDs||[],{id:this.id,type:this.type||"application",appType:this.appType||"web",name:this.name,icon:this.icon,isSystemObject:this.isSystemObject,json:this.json,roleAccess:this.roleAccess,translations:this.json.translations,isAccessManaged:this.isAccessManaged,isTranslationManaged:this.isTranslationManaged,isTutorialManaged:this.isTutorialManaged,accessManagers:this.accessManagers,translationManagers:this.translationManagers,tutorialManagers:this.tutorialManagers}}datacollectionsExcluded(e=(()=>!0)){return this.AB.datacollections((e=>-1==this.datacollectionIDs.indexOf(e.id))).filter(e)}datacollectionsIncluded(e=(()=>!0),t){const i=t??((e,t)=>e.label.localeCompare(t.label));return this.AB.datacollections((e=>this.datacollectionIDs.indexOf(e.id)>-1)).filter(e).sort(i)}objectsExcluded(e=(()=>!0)){return this.AB.objects((e=>-1==this.objectIDs.indexOf(e.id))).filter(e)}objectsIncluded(e=(()=>!0),t){const i=t??((e,t)=>e.label.localeCompare(t.label));return this.AB.objects((e=>this.objectIDs.indexOf(e.id)>-1)).filter(e).sort(i)}hintsExcluded(e=(()=>!0)){return this.AB.hints((e=>-1==this.hintIDs.indexOf(e.id))).filter(e)}hintsIncluded(e=(()=>!0),t){const i=t??((e,t)=>e.label.localeCompare(t.label));return this.AB.hints((e=>this.hintIDs.indexOf(e.id)>-1)).filter(e).sort(i)}connectedObjects(e){if(console.error("ABApplicationCore.connectedObjects(): who is calling this?"),""==e)return[];var t=this.AB.objectByID(e).connectFields(),i={};t.forEach((e=>{i[e.settings.linkObject]=this.AB.objectByID(e.settings.linkObject)}));var s=[];return Object.keys(i).forEach((function(e){s.push({id:this[e].id,value:this[e].label})}),i),s}connectedFields(e,t){console.error("!!! Who is calling this?");var i=this.AB.objectByID(e).connectFields((e=>e.settings.linkObject==t)),s=[];return i.forEach((e=>{s.push({id:e.columnName,value:e.label})})),s}pages(e=(()=>!0),t=!1){var i=[];return!this._pages||this._pages.length<1?i:i=e&&t?this._searchDeep(this,"_pages",e):(this._pages||[]).filter(e)}_searchDeep(e,t,i){let s=e[t]??[],n=s.filter?.(i)??[];for(let e of s){let s=this._searchDeep(e,t,i);s.length&&(n=n.concat(s))}return n}processes(e=(()=>!0)){return this.AB.processes((e=>this.processIDs.indexOf(e.id)>-1)).filter(e)}hasProcess(e){return!(!e||!e.id)&&this.processIDs.indexOf(e.id)>-1}views(e){var t=[],i=[],s=[];return(!this._pages||this._pages.length<1)&&(!this._views||this._views.length<1)||(e?(this._views&&(i=this._views.filter(e)).length<1&&this._views.forEach((t=>{var s=t.views(e,!0);s&&s.length>0&&(i=s)})),i.length?t=i:(t=this._pages.filter(e)).length<1&&function i(s){s._pages&&s._pages.length&&s._pages.forEach((s=>{var n=s.views(e,!0);if(n&&n.length>0&&(t=n),t.length<1){var a=s.pages(e,!0);a&&a.length>0&&(t=a),t.length<1&&i(s)}}))}(this)):(this._views&&(i=this._views).length&&i.forEach((e=>{var t=e.views((()=>!0),!0);t&&t.length&&(i=i.concat(t))})),this._pages&&(s=this._pages).length&&s.forEach((e=>{var t=e.views((()=>!0),!0);t&&t.length&&(i=i.concat(t));var n=e.pages((()=>!0),!0);n&&n.length&&(s=s.concat(n),n.forEach((e=>{var t=e.views((()=>!0),!0);t&&t.length&&(i=i.concat(t))})))})),t=t.concat(s,i))),t}viewAll(e=(()=>!0)){return this.ViewManager.allViews(e)}queriesExcluded(e=(()=>!0)){return this.AB.queries((e=>-1==this.queryIDs.indexOf(e.id))).filter(e)}queriesIncluded(e=(()=>!0),t){const i=t??((e,t)=>e.label.localeCompare(t.label));return this.AB.queries((e=>this.queryIDs.indexOf(e.id)>-1)).filter(e).sort(i)}urlResolve(e){var t=e.split("/"),i=(t,s)=>{if(0==s.length)return t;var n=s.shift();if("#"==n)return i(this,s);if(Array.isArray(t))return t=t.filter((function(e){return e.id==n}))[0],i(t,s);if(t&&t[n])return i(t[n],s);if("_objects"==n){console.error(new Error("REFACTOR: old objectBy url reference:"));var a=s.shift();return i(this.AB.objectByID(a),s)}return console.error("!!! failed to lookup url:"+e),null};return i(this,t)}urlPointer(e){return e?"#/"+this.id+"/":"#/"}urlObject(e){return this.urlPointer(e)+"_objects/"}urlPage(e){return this.urlPointer(e)+"_pages/"}urlQuery(e){return this.urlPointer(e)+"_queries/"}get version(){return this.json?.versionData?.versionNumber??"0.0.0"}get objectlistIsOpen(){return this.objectListSettings.isOpen}set objectlistIsOpen(e){this.objectListSettings.isOpen=e}get objectlistSearchText(){return this.objectListSettings.searchText}set objectlistSearchText(e){this.objectListSettings.searchText=e}get objectlistSortDirection(){return this.objectListSettings.sortDirection}set objectlistSortDirection(e){this.objectListSettings.sortDirection=e}get objectlistIsGroup(){return this.objectListSettings.isGroup}set objectlistIsGroup(e){this.objectListSettings.isGroup=e}pageNew(e){return e.key="page",this.ViewManager.newView(e,this,null)}pageByID(e,t=!0){return this.pages((t=>t.id==e),t)[0]}viewNew(e,t,i){return this.ViewManager.newView(e,t,i)}cloneDeep(){throw new Error("ABApplicationCore.cloneDeep(): Depreciated!  Use AB.cloneDeep() instead.")}}},50085:(e,t,i)=>{const s=i(69155);var n=i(95995);e.exports=class extends n{constructor(e,t){super(e,t),this.appType="mobile",this.networkType=e.networkType,this.pageDefault=e.pageDefault}get ViewManager(){return s}pageNew(e){return console.error("TODO: pageNew for ApplicationMobile"),null}toObj(){var e=super.toObj();return e.appType="mobile",e.networkType=this.networkType,e.pageDefault=this.pageDefault,e}}},5179:(e,t,i)=>{const s=i(70504);var n={id:"uuid",label:"",object:{},query:{},settings:{datasourceID:"",linkDatacollectionID:"",linkFieldID:"",followDatacollectionID:"",objectWorkspace:{filterConditions:{glue:"and",rules:[]},sortFields:[]},loadAll:!1,populate:!0,isQuery:!1,fixSelect:"",syncType:1}};e.exports=class extends s{constructor(e,t){super(["label"],t),e=e||{},this.fromValues(e),this.__dataCollection=this._dataCollectionNew([]),this.refreshFilterConditions(),this.__bindComponentIds=[],this.__flexComponentIds=[],this._dataStatus=this.dataStatusFlag.notInitial,this.__filterCond=null}static contextKey(){return"datacollection"}fromValues(e){if(this.id=e.id,this.name=e.name||null,this.type=e.type||"datacollection",e.settings=e.settings||{},this.settings=this.settings||{},this.settings.linkDatacollectionID=e.settings.linkDatacollectionID||n.settings.linkDatacollectionID,this.settings.linkFieldID=e.settings.linkFieldID||n.settings.linkFieldID,this.settings.followDatacollectionID=e.settings.followDatacollectionID||n.settings.followDatacollectionID,this.settings.objectWorkspace=e.settings.objectWorkspace||{filterConditions:n.settings.objectWorkspace.filterConditions,sortFields:n.settings.objectWorkspace.sortFields},this.settings.fixSelect=e.settings.fixSelect,this.settings.loadAll=JSON.parse(e.settings.loadAll||n.settings.loadAll),this.settings.isQuery=JSON.parse(e.settings.isQuery||n.settings.isQuery),this.settings.populate=null!=e.settings.populate?e.settings.populate:1!=e.settings.preventPopulate&&"1"!=e.settings.preventPopulate&&n.settings.populate,this.settings.syncType=parseInt(e.settings.syncType||n.settings.syncType),this.__datasource=null,this.settings.datasourceID=e.settings.datasourceID||n.settings.datasourceID,this.settings.datasourceID){var t=this.AB.objectByID(this.settings.datasourceID);t||(t=this.AB.queryByID(this.settings.datasourceID)),t?(this.__datasource=t,this.settings.isQuery="query"===t.type,this.settings.isQuery&&this.__datasource.isGroup&&(this.__treeCollection||(this.__treeCollection=this._treeCollectionNew()),this.__isGroup=!0)):console.error(`ABDataCollection[${this.name}][${this.id}] unable to find datasource [${this.settings.datasourceID}]`)}super.fromValues(e)}toObj(){var e=super.toObj();return{id:this.id,name:this.name||this.label,type:this.type||"datacollection",settings:this.AB.cloneDeep(this.settings||{}),translations:e.translations}}async save(){return this.id||(this.label=this.label||this.name),await super.save(),this}destroy(){var e=()=>new Promise(((e,t)=>{const i=this.AB.applications();var s=[];return i.filter((e=>e.datacollectionsIncluded((e=>e.id==this.id)))).forEach((e=>{s.push(e.datacollectionRemove(this))})),Promise.all(s).then(e).catch(t)}));return Promise.resolve().then((()=>e())).then((()=>super.destroy())).then((()=>{this.emit("destroyed")}))}get $dc(){return this.__dataCollection}get datasource(){if(!this.__datasource){if(this.id&&this.name){var e=new Error(`DataCollection[${this.name}][${this.id}] missing reference datasource`);this.AB.notify("builder",e,{datacollection:this.toObj()})}return null}var t=this.AB.objectByID(this.__datasource.id);return t||(t=this.AB.queryByID(this.__datasource.id)),t}set datasource(e){this.__datasource=e,this.refreshFilterConditions()}get sourceType(){return this.settings.isQuery?"query":"object"}get datacollectionLink(){return this.AB?this.AB.datacollectionByID(this.settings.linkDatacollectionID):null}get fieldLink(){let e=this.datasource;return e?e.fieldByID(this.settings.linkFieldID):null}get model(){let e=this.datasource;return e?e.model():null}get dataStatusFlag(){return{notInitial:0,initializing:1,initialized:2}}get dataStatus(){return this._dataStatus}setCursor(e){if(this.settings.fixSelect&&("_FirstRecordDefault"!=this.settings.fixSelect||this.settings.fixSelect==e))return;if(this.__treeCollection){this.setCursorTree(e);let t=this.__treeCollection.getCursor();if(t){let i=this.__treeCollection.getItem(t);i&&(e=i._itemId)}}let t=this.__dataCollection;t&&(this.__previousCursorId=t.getCursor(),null==e?t.setCursor(null):t.getCursor()==e?this.emit("changeCursor",this.getCursor()):t.exists(e)&&t.setCursor(e))}setCursorTree(e){let t=this.__treeCollection;if(t&&t.getCursor()!=e)if(t.find({id:e},!0))t.setCursor(e);else{let i=t.find({_itemId:e,$parent:0},!0);i?t.setCursor(i.id):t.setCursor(null)}}getCursor(e=!1){if(e&&this.__treeCollection){let e=this.__treeCollection.getCursor();if(e){let t=this.__treeCollection.getItem(e);this.__treeCollection.filter((e=>e._itemId==t._itemId));let i=this.__treeCollection.serialize()[0]||null;return this.refreshLinkCursor(),i}}let t=this.__dataCollection;if(null==t)return null;let i=t.getCursor();return t.getItem(i)}getFirstRecord(){var e=this.__dataCollection;if(null==e)return null;var t=e.getFirstId();return e.getItem(t)}getNextRecord(e){var t=this.__dataCollection;if(null==t)return null;var i=t.getNextId(e.id);return t.getItem(i)}refreshLinkCursor(e=!1){if(this.refreshFilterConditions(),!this.settings.loadAll&&!e)return;let t,i=this.datacollectionLink;i&&(t=i.getCursor());let s=e=>null==e||(t?this.isParentFilterValid(e):!i);this.__dataCollection&&this.__dataCollection.filter(s),this.__treeCollection&&this.__treeCollection.filter(s)}setStaticCursor(){if(this.settings.fixSelect)if("_CurrentUser"==this.settings.fixSelect){var e=this.currentUserUsername(),t=this.datasource.fields((e=>"user"==e.key)),i=this.__dataCollection.find((i=>{var s=!1;return t.forEach((t=>{s||null==i[t.columnName]||(i[t.columnName].filter?s=i[t.columnName].filter((t=>t.id==e)).length>0:i[t.columnName]==e&&(s=!0))})),s}),!0);i&&(this.__dataCollection.setCursor(i.id),this.setCursorTree(i.id))}else if("_FirstRecord"==this.settings.fixSelect||"_FirstRecordDefault"==this.settings.fixSelect){let e=this.__dataCollection.getCursor();if(!e||e&&!this.__dataCollection.exists(e)){let e=this.__dataCollection.getFirstId();this.__dataCollection.setCursor(e||null),this.setCursorTree(e)}}else this.__dataCollection.setCursor(this.settings.fixSelect),this.setCursorTree(this.settings.fixSelect);if(this.isCursorFollow){const e=this.__dataCollection.getFirstId();this.setCursor(e||null),this.setCursorTree(e||null);const t=this.datacollectionFollow;!e&&t.getCursor()&&this.loadData()}}filterCondition(e=null){this.__filterCond=e}init(){if(this.initialized)return;this.initialized=!0,this.__dataCollection.___AD.onAfterCursorChange||(this.__dataCollection.___AD.onAfterCursorChange=this.__dataCollection.attachEvent("onAfterCursorChange",(()=>{var e=this.getCursor();this.emit("changeCursor",e)})));let e=(e,t,i="id")=>Array.isArray(e)?e.filter((e=>(e[i]||e)==t)).length>0:e&&(e[i]||e)==t;this.on("ab.datacollection.create",(t=>{if(this.isCursorFollow)return;let i=this.datasource;if(!i)return;if(!t||!t.data)return;let s=!1,n=[];Promise.resolve().then((()=>new Promise(((e,a)=>{if(i instanceof this.AB.Class.ABObjectQuery){let r=i.objects((e=>e.id==t.objectId))||[];if(s=r.length>0,!s)return e();let o={glue:"or",rules:[]};r.forEach((e=>{let s=t.data[`${e.PK()}`];s&&o.rules.push({key:`${e.alias||i.objectAlias(e.id)}.${e.PK()}`,rule:"equals",value:s})})),i.model().findAll({where:o}).then((t=>{n=t.data||[],n.forEach((e=>{delete e.id})),e()})).catch(a)}else s=i.id==t.objectId,n=[t.data],e()})))).then((()=>{if(s&&((n||[]).forEach((e=>{this.isValidData(e)&&(this.datacollectionLink&&!this.isParentFilterValid(e)||(this.__dataCollection.exists(e[`${i.PK()}`])||this.__reloadWheres?!this.__dataCollection.exists(e[`${i.PK()}`])&&this.__reloadWheres&&this.isParentFilterValid(e)&&this.__bindComponentIds.concat(this.__flexComponentIds).forEach((e=>{if($$(e+"_reloadView"))return!1;var t=0,i=$$(e).getParentView();$$(e).getParentView().index?t=$$(e).getParentView().index($$(e)):$$(e).getParentView().getParentView().index&&(i=$$(e).getParentView().getParentView(),t=$$(e).getParentView().getParentView().index($$(e).getParentView()));var s=this;if(i.addView){var n=this.AB.Label();i.addView({id:e+"_reloadView",view:"button",value:n("New data available. Click to reload."),css:"webix_primary webix_warn",click:function(e,t){s.reloadData(),$$(e).getParentView().removeView(e)}},t)}})):(this.__dataCollection.add(e,0),this.emit("create",e))))})),this.__treeCollection&&this.parseTreeCollection({data:n})),!(i instanceof this.AB.Class.ABObjectQuery)){let s=this.datasource.connectFields((e=>e.datasourceLink&&e.datasourceLink.id==t.objectId));if(n=n[0],n&&s&&s.length>0){let t=s[0].object.PK();n.id||"id"==t||(n.id=n[t]),this.__dataCollection.find({}).forEach((a=>{let r={};s.forEach((i=>{var s={};i&&i.fieldLink&&(s=n[i.fieldLink.relationName()]||{});let o=a[i.relationName()]||{},l=e(s,a.id,t);Array.isArray(o)&&o.filter((e=>e==n.id||e.id==n.id||e[t]==n.id)).length<1&&l?(o.push(n),r[i.relationName()]=o,r[i.columnName]=r[i.relationName()].map((e=>e.id||e[t]||e))):Array.isArray(o)||o==n.id&&o.id==n.id&&o[t]==n.id||!l||(r[i.relationName()]=n,r[i.columnName]=n.id||n)})),Object.keys(r).length>0&&(i.model(),this.__dataCollection.updateItem(a.id,r),this.__treeCollection&&this.__treeCollection.updateItem(a.id,r),this.emit("update",this.__dataCollection.getItem(a.id)))}))}}this.updateRelationalDataFromLinkDC(t.objectId,t.data),this.refreshLinkCursor(),this.setStaticCursor()}))})),this.on("ab.datacollection.update",(t=>{let i=this.datasource;if(!i)return;let s=t.data;if(!s)return;let n=!1,a=!1,r=[],o=[],l={};if(i instanceof this.AB.Class.ABObjectQuery){let e=i.objects((e=>e.id==t.objectId))||[];n=e.length>0,n&&((e||[]).forEach((e=>{r=r.concat(this.__dataCollection.find((t=>t[`${this.datasource.objectAlias(e.id)}.${e.PK()}`]==(s[e.PK()]||s.id))).map((e=>e.id))||[]),this.__treeCollection&&(o=o.concat(this.__treeCollection.find((t=>t[`${this.datasource.objectAlias(e.id)}.${e.PK()}`]==(s[e.PK()]||s.id))).map((e=>e.id))||[]))})),a=r.length>0,l=this._queryUpdateData(e,s))}else n=i.id==t.objectId,n&&(s.id||"id"==i.PK()||(s.id=s[i.PK()]),r.push(s.id),a=this.__dataCollection.exists(s.id),l=s);if(n)if(a)if(this.isValidData(l)){l=this.AB.cloneDeep(l),this.__dataCollection&&(r=this.AB.uniq(r),r.forEach((e=>{this.__dataCollection.updateItem(e,l)}))),this.__treeCollection&&(o=this.AB.uniq(o),o.forEach((e=>{this.__treeCollection.updateItem(e,l)}))),this.emit("update",l);let e=this.getCursor();e?.id==l.id&&this.emit("cursorStale",e)}else{let e=this.getCursor();r.forEach((t=>{e?.id==t&&this.emit("cursorStale",null),this.__dataCollection.remove(t),this.emit("delete",t)}))}else this.isValidData(l)&&(this.__dataCollection.add(l,0),this.__treeCollection&&this.parseTreeCollection({data:[l]}),this.emit("create",l));let c=this.getCursor(),u=null,d=i.connectFields((e=>e.datasourceLink&&e.datasourceLink.id==t.objectId));if(i instanceof this.AB.Class.ABObject&&d?.length>0){let t=i.PK();s.id||"id"==t||(s.id=s[t]),this.__dataCollection.count()>0&&this.__dataCollection.find({}).forEach((i=>{let n={id:i.id};if(d.forEach((a=>{if(!a)return;let r={},o=i[a.relationName()]||{};a.fieldLink&&(r=s[a.fieldLink.relationName()]||{});let l=e(r,i.id,t);Array.isArray(o)&&o.filter((e=>e==s.id||e.id==s.id||e[t]==s.id)).length>0&&!l?(n[a.relationName()]=o.filter((e=>(e[t]||e.id||e)!=s.id)),n[a.columnName]=n[a.relationName()].map((e=>e.id||e[t]||e))):Array.isArray(o)||o!=s.id&&o.id!=s.id&&o[t]!=s.id||l||(n[a.relationName()]=null,n[a.columnName]=null),l&&(s=this.AB.cloneDeep(s)),Array.isArray(o)&&l?(o.filter((e=>e==s.id||e.id==s.id||e[t]==s.id)).length>0?o.forEach(((e,i)=>{e!=s.id&&e.id!=s.id&&e[t]!=s.id||(o[i]=s)})):o.push(s),n[a.relationName()]=o,n[a.columnName]=n[a.relationName()].map((e=>a.getRelationValue(e)))):Array.isArray(o)||o==s.id&&o.id==s.id&&o[t]==s.id||!l||(n[a.relationName()]=s,n[a.columnName]=a.getRelationValue(s))})),Object.keys(n).length>1){if(this.__treeCollection?.exists(i.id)){const e=Object.assign(this.__treeCollection.getItem(i.id),n);this.__treeCollection.updateItem(i.id,e)}if(this.__dataCollection?.exists(i.id)){const e=Object.assign(this.__dataCollection.getItem(i.id),n);this.__dataCollection.updateItem(i.id,e),this.emit("update",this.__dataCollection.getItem(i.id)),c?.id==e.id&&(u=e)}}}))}u&&this.emit("cursorStale",null),this.refreshLinkCursor(),this.setStaticCursor()})),this.on("ab.datacollection.stale",(e=>{if(this.datasource&&this.model&&this.datasource.id==e.objectId){var t=e.data;if(t){var i=this.model.object.PK();if(t[i]||(i="id"),!this.isCursorFollow||this.getCursor()?.[i]==(t[i]??t.id)){if(t&&this.__dataCollection.exists(t[i])){var s={where:{}};s.where[i]=t[i],this.model.staleRefresh(s).then((e=>{if(Array.isArray(e.data)&&e.data.length){if(!this.datasource)return;this.__dataCollection.exists(t[i])&&this.__dataCollection.updateItem(t[i],e.data[0]);var s=this.getCursor();s?.[i]==t[i]&&this.emit("cursorStale",s)}else this.getCursor()==t[i]&&this.emit("cursorStale",null),this.__dataCollection.remove(t[i]),this.emit("delete",t[i])}))}this.refreshLinkCursor(),this.setStaticCursor()}}}})),this.on("ab.datacollection.delete",(e=>{let t=this.datasource;if(!t)return;let i=e.data,s=!1,n=[],a=[];if(t instanceof this.AB.Class.ABObjectQuery){let r=t.objects((t=>t.id==e.objectId))||[];s=r.length>0,s&&(r||[]).forEach((e=>{n=this.__dataCollection.find((t=>t[`${e.alias}.${e.PK()}`]==i)).map((e=>e.id))||[],this.__treeCollection&&(a=this.__treeCollection.find((t=>t[`${e.alias}.${e.PK()}`]==i)).map((e=>e.id))||[])}))}else s=t.id==e.objectId,s&&n.push(i);if(s){var r=this.getCursor();n.forEach((e=>{r?.[t.PK()]==e&&this.emit("cursorStale",null),this.__dataCollection.exists(e)&&this.__dataCollection.remove(e)})),this.__treeCollection&&a.forEach((e=>{this.__treeCollection.exists(e)&&this.__treeCollection.remove(e)})),n[0]&&this.emit("delete",n[0])}let o=t.connectFields((t=>t.datasourceLink&&t.datasourceLink.id==e.objectId));if(t instanceof this.AB.Class.ABObject&&o&&o.length>0){let e=o[0].object.PK();this.__dataCollection.find({}).forEach((t=>{let s={};o.forEach((n=>{let a=t[n.relationName()];null!=a&&(Array.isArray(a)?(s[n.relationName()]=a.filter((t=>(t.id||t[e]||t)!=i)),s[n.columnName]=s[n.relationName()].map((t=>t.id||t[e]||t))):a!=i&&a.id!=i&&a[e]!=i||(s[n.relationName()]=null,s[n.columnName]=null))})),Object.keys(s).length>0&&(this.__dataCollection.updateItem(t.id,s),this.__treeCollection&&this.__treeCollection.updateItem(t.id,s),this.emit("update",this.__dataCollection.getItem(t.id)))}))}}));const t=this.datacollectionLink;t&&(this.eventAdd({emitter:t,eventName:"changeCursor",listener:e=>{this.settings?.loadAll||e?.id==t.previousCursorId||this.clearAll(),this.refreshLinkCursor(),this.setStaticCursor()}}),this.eventAdd({emitter:t,eventName:"cursorStale",listener:e=>{if(this.settings?.loadAll)this.refreshLinkCursor(),this.setStaticCursor();else{let e=this.datacollectionLink,t=e.shouldPopulate;if(Array.isArray(t)){let e=this.fieldLink.fieldLink.columnName;t=t.indexOf(e)>-1}if(t){let t;if(e&&(t=e.getCursor()),!t)return void this.clearAll();let i=this.datasource.PK(),s=this.fieldLink.fieldLink.relationName(),n={},a=t[s]||[];Array.isArray(a)||(a=[a]),a=a.filter((e=>e)),a.forEach((e=>{n[e[i]]=e}));let r=[];if(this.__dataCollection.find((()=>!0)).forEach((e=>{n[e[i]]?delete n[e[i]]:r.push(e[i])})),this.__dataCollection.remove(r),n=Object.keys(n),n.length>0){let e={where:{}};e.where[i]=n,this.model.staleRefresh(e).then((e=>{Array.isArray(e.data)&&e.data.length&&e.data.forEach((e=>{this.__dataCollection.add(e)}))}))}}else{let e=20;this.__dataCollection.count()>e&&(e=this.__dataCollection.count()),this.__treeCollection?.count()>e&&(e=this.__treeCollection.count());let t=this.__dataCollection.getCursor();this.clearAll(),this.reloadData(0,e).then((()=>{this.__dataCollection.setCursor(t),this.emit("cursorSelect",t)}))}}}}));const i=this.datacollectionFollow;i&&(this.eventAdd({emitter:i,eventName:"changeCursor",listener:()=>{const e=i.getCursor(),t=this.getCursor();e?.[i.datasource.PK()]!=t?.[this.datasource.PK()]&&(this.clearAll(),this.loadData())}}),this.eventAdd({emitter:i,eventName:"cursorStale",listener:()=>{this.clearAll(),this.loadData()}}))}async waitForDataCollectionToInitialize(e,t){return e.init(),new Promise(((t,i)=>{switch(e.dataStatus){case e.dataStatusFlag.notInitial:e.loadData().catch(i);case e.dataStatusFlag.initializing:this.eventRemove("initializedData"),this.eventAdd({emitter:e,eventName:"initializedData",listener:()=>{t()}});break;case e.dataStatusFlag.initialized:default:t()}}))}async loadData(e,t){this._dataStatus==this.dataStatusFlag.notInitial&&(this._dataStatus=this.dataStatusFlag.initializing,this.emit("initializingData",{}));var i=this.datasource;if(null==i)return this._dataStatus=this.dataStatusFlag.initialized,Promise.resolve([]);var s=i.model();if(null==s)return this._dataStatus=this.dataStatusFlag.initialized,Promise.resolve([]);var n=this.settings.objectWorkspace.sortFields||[];let a=this.AB.cloneDeep(this.settings.objectWorkspace.filterConditions??{});this.__reloadWheres&&(a=this.__reloadWheres),a.glue=a.glue||"and",a.rules=a.rules||[];const r={glue:"and",rules:[]};this.__filterCond?.rules?.length>0&&r.rules.push(this.__filterCond);let o=this.ruleLinkedData();if(!this.settings.loadAll&&o)r.rules.push(o);else if(this.datacollectionFollow){const i=this.datacollectionFollow.getCursor();let s=this.datasource.PK();this.datacollectionFollow.settings.isQuery&&(s="BASE_OBJECT."+s),i?(e=0,t=null,a={glue:"and",rules:[{key:this.datasource.PK(),rule:"equals",value:i[s]}]}):a={glue:"and",rules:[{key:this.datasource.PK(),rule:"equals",value:"NO RESULT ROW"}]}}r.rules.length&&(a.rules.length&&r.rules.unshift(a),a=r),a=i.whereCleanUp(a);var l={where:a||{},skip:e||0,sort:n,populate:this.shouldPopulate};null!=t&&(l.limit=t),this.settings.loadAll&&!this.isCursorFollow&&delete l.limit;const c=this.datacollectionLink??this.datacollectionFollow;if(c&&await this.waitForDataCollectionToInitialize(c),a?.rules?.length){const e=[];a.rules.forEach((t=>{if("in_data_collection"==t.rule||"not_in_data_collection"==t.rule){const i=this.AB.datacollectionByID(t.value);i&&e.push(this.waitForDataCollectionToInitialize(i))}})),await Promise.all(e)}return new Promise(((e,t)=>{this._pendingLoadDataResolve={resolve:e,reject:t},this.platformFind(s,l).catch((e=>{t(e)}))}))}platformFind(e,t){return e.findAll(t).then((e=>this.processIncomingData(e)))}get shouldPopulate(){return this.settings.populate??!this.settings.preventPopulate}async queuedParse(e,t){const i=e?.data||e;if(!i?.length)return t?.(),Promise.resolve();const s=e.total_count;let n;if(i.length>250){let e=this.__dataCollection.count(),t=i.splice(250);n={data:t,pos:e+i.length,total_count:s}}const a={data:i,pos:e.pos,total_count:s};return this.__dataCollection.parse(a),new Promise((e=>{setTimeout((async()=>{await this.queuedParse(n),t?.(),e()}),15)}))}processIncomingData(e){return Promise.resolve().then((()=>{this.__totalCount=e.total_count,this.__dataCollection.find({}).length||this.__dataCollection.clearAll(),this.__throttleIncoming&&clearTimeout(this.__throttleIncoming),this.__throttleIncoming=setTimeout((async()=>{await this.queuedParse(e),this.__dataCollection.load((async()=>(setTimeout((()=>{this.refreshLinkCursor()}),250),{data:[],pos:e.pos,total_count:e.total_count}))),this.parseTreeCollection(e),this.datacollectionLink?(this.refreshLinkCursor(),this.setStaticCursor()):this.setStaticCursor(),this._pendingLoadDataResolve&&(this._pendingLoadDataResolve.resolve(),this._pendingLoadDataResolve=null),this.settings.loadAll&&this.emit("loadData",{}),this._dataStatus!=this.dataStatusFlag.initialized&&(this._dataStatus=this.dataStatusFlag.initialized,this.emit("initializedData",{}))}),100)}))}reloadData(e,t){return Promise.resolve().then((()=>(this.reloadTimer&&(clearTimeout(this.reloadTimer),delete this.reloadTimer),this.reloadPromise||(this.reloadPromise=new Promise(((e,t)=>{this.reloadPromise__resolve=e,this.reloadPromise__reject=t}))),this.reloadTimer=setTimeout((()=>(this.clearAll(),this.loadData(e,t).then((()=>{this.reloadPromise&&(this.reloadPromise__resolve(),delete this.reloadPromise,delete this.reloadPromise__resolve,delete this.reloadPromise__reject),clearTimeout(this.reloadTimer),delete this.reloadTimer})).catch((e=>{this.reloadPromise&&(this.reloadPromise__reject(e),delete this.reloadPromise,delete this.reloadPromise__resolve,delete this.reloadPromise__reject),clearTimeout(this.reloadTimer),delete this.reloadTimer})))),50),this.reloadPromise)))}reloadWheres(e){this.__reloadWheres=e}getData(e){var t=this.__dataCollection;return t?t.find((t=>{let i=!0;return this.datacollectionLink&&this.settings.loadAll&&i&&(i=this.isParentFilterValid(t)),i&&e&&(i=e(t)),i})):[]}isParentFilterValid(e){if(null==e)return!1;var t=this.datacollectionLink;if(null==t)return!0;const i=t.datasource;if(null==i)return!0;var s=this.fieldLink;if(null==s)return!0;var n=t.getCursor();if(null==n)return!0;var a=e[s.relationName()];if(null==a){if(!e[s.columnName])return!1;a=e[s.columnName]}let r=s.object.PK();return a.filter?a.filter((e=>(e[r]||e.id||e)==(n[i.PK()]||n.id||n))).length>0:(a[r]||a.id||a)==(n[i.PK()]||n.id||n)}clearAll(){this.__dataCollection&&this.__dataCollection.clearAll(),this.__treeCollection&&this.__treeCollection.clearAll(),this._dataStatus=this.dataStatusFlag.notInitial}get totalCount(){return this.__totalCount||0}bind(){console.error("Platform.ABDataCollection.bind() Not implemented")}unbind(){console.error("Platform.ABDataCollection.unbind() Not implemented")}removeComponent(e){let t=this.__bindComponentIds.indexOf(e);this.__bindComponentIds.splice(t,1)}ruleLinkedData(){let e=null;const t=this.datacollectionLink,i=this.fieldLink;if(t&&i){const s=t?.getCursor()?.id;s&&(e={alias:i.alias,key:i.id,rule:i.alias?"contains":"equals",value:i.getRelationValue(t.__dataCollection.getItem(s))})}return e}refreshFilterConditions(e=null){if(null==this.__filterDatasource&&(this.__filterDatasource=this.AB.filterComplexNew(`${this.id}_filterDatasource`)),this.datasource){let e;this.__filterDatasource.fieldsLoad(this.datasource.fields()),this.datasource instanceof this.AB.Class.ABObjectQuery&&(e=this.datasource.where),e?this.__filterDatasource.setValue(e):this.__filterDatasource.setValue({})}else this.__filterDatasource.fieldsLoad([]),this.__filterDatasource.setValue(n.settings.objectWorkspace.filterConditions);null==this.__filterDatacollection&&(this.__filterDatacollection=this.AB.filterComplexNew(`${this.id}_filterDatacollection`)),this.__filterDatacollection.fieldsLoad(this.datasource?this.datasource.fields():[]),e&&(this.settings.objectWorkspace.filterConditions=e);let t=this.AB.cloneDeep(this.settings.objectWorkspace?.filterConditions??{glue:"and",rules:[]});t.glue=t.glue||"and",t.rules=t.rules||[];let i=this.ruleLinkedData();if(i){"many"==this.fieldLink?.linkType()&&(i.rule="contains");let e=!1,s=Object.keys(i);(t.rules||[]).forEach((t=>{if(e)return;let n=!0;s.forEach((e=>{t[e]!=i[e]&&(n=!1)})),e=n})),e||("and"==t.glue?t.rules.push(i):t={glue:"and",rules:[t,i]})}if((t.rules||[]).length>0&&!this.isCursorFollow?this.__filterDatacollection.setValue(t):this.__filterDatacollection.setValue(n.settings.objectWorkspace.filterConditions),null==this.__filterScope&&(this.__filterScope=this.AB.filterComplexNew(`${this.id}_filterScope`)),this.datasource){let e=(this.userScopes||[]).filter((e=>!e.allowAll&&(e.objectIds||[]).indexOf(this.datasource.id)>-1));if(e&&e.length>0){this.__filterScope.fieldsLoad(this.datasource.fields()||[]);let t=[];e.filter((e=>e.filter&&e.filter.rules&&e.filter.rules.length)).forEach((e=>{let i=(e.filter.rules||[]).filter((e=>this.datasource.fields((t=>t.id==e.key)).length>0));t=t.concat(i)}));let i={glue:"or",rules:t};this.__filterScope.setValue(i)}}}get isGroup(){return this.__isGroup||!1}get syncTypeFlag(){return{server:1,client:2}}get syncType(){return this.settings.syncType||n.syncType}_dataCollectionNew(){var e=new Error("the platform.ABDataCollection._dataCollectionNew() is expected to return a proper DataCollection!");return console.error(e),null}_treeCollectionNew(){return console.error("the platform.ABDataCollection._treeCollectionNew() is expected to return a proper TreeCollection!"),null}parseTreeCollection(e={}){e==={}&&console.log("Platform.ABDataCollection.parseTreeCollection() missing!")}_queryUpdateData(e,t){let i={};return Object.keys(t).forEach((s=>{e.forEach((e=>{let n=this.datasource.objectAlias(e.id);i[`${n}.${s}`]=t[s],"translations"==s&&t.translations&&t.translations.length&&(i.translations=[],t.translations.forEach((e=>{let t={};Object.keys(e).forEach((i=>{"language_code"==i?t.language_code=e.language_code:t[`${n}.${i}`]=e[i]})),i.translations.push(t)})))}))})),i}isValidData(e){let t=!0;return this.__filterDatasource&&(t=t&&this.__filterDatasource.isValid(e)),this.__filterDatacollection&&(t=t&&this.__filterDatacollection.isValid(e)),t&&this.__filterScope&&(t=t&&this.__filterScope.isValid(e)),t}updateRelationalDataFromLinkDC(e,t){const i=this.datacollectionLink,s=i?.getCursor();if(i?.datasource.id==e&&s&&s.id==t?.id){const e=this.datasource,i=this.fieldLink;let s=t[i.fieldLink.relationName()];s&&!Array.isArray(s)&&(s=[s]),(s??[]).forEach((s=>{if(null!=s&&!this.__dataCollection.exists(s[e.PK()])){const e=this.AB.cloneDeep(s);e[i.relationName()]=[t],this.__dataCollection.add(e)}})),this.emit("warnRefresh")}}clone(e){e=e||this.toObj();var t=new this.constructor(e,this.AB);t.__datasource=this.__datasource,t._dataStatus=this._dataStatus,t.__filterDatacollection.setValue(e.settings.objectWorkspace.filterConditions),(()=>{t.__dataCollection&&t.__dataCollection.parse(this.__dataCollection.find({}).filter((e=>t.__filterDatacollection.isValid(e)))),t.__treeCollection&&t.__treeCollection.parse(this.__treeCollection.find({}).filter((e=>t.__filterDatacollection.isValid(e))))})(),t.setStaticCursor();var i=this.getCursor();return i&&(i.id&&(i=i.id),t.setCursor(i)),t}filteredClone(e){var t=this.toObj();return e?.rules?.length&&(t.settings.objectWorkspace.filterConditions?.rules?.length?t.settings.objectWorkspace.filterConditions.rules=t.settings.objectWorkspace.filterConditions.rules.concat(e.rules):t.settings.objectWorkspace.filterConditions=e),this.clone(t)}eventAdd(e){if(!e||!e.emitter||!e.listener)return;this.__events=this.__events||[];let t=this.__events.find((t=>t.emitter==e.emitter&&t.eventName==e.eventName));(!t||t.length<1)&&(this.__events.push({emitter:e.emitter,eventName:e.eventName,listener:e.listener}),e.emitter.on(e.eventName,e.listener))}eventClear(){this.__events&&this.__events.length>0&&this.__events.forEach((e=>{e.emitter.removeListener(e.eventName,e.listener)}))}eventRemove(e){this.__events?.length>0&&e&&(this.__events.forEach((t=>{e==t.eventName&&t.emitter.removeListener(t.eventName,t.listener)})),this.__events=this.__events.filter((t=>t.eventName!=e)))}get userScopes(){return[]}get isCursorFollow(){return this.settings.followDatacollectionID&&(!this.settings.linkDatacollectionID||!this.settings.linkFieldID)}get datacollectionFollow(){return this.isCursorFollow?(this.AB??AB).datacollectionByID(this.settings.followDatacollectionID):null}get previousCursorId(){return this.__previousCursorId}}},32877:e=>{e.exports=class{constructor(e,t){this.AB=t,this.fromValues(e)}fromValues(e){e.id&&(this.id=e.id),this.name=e?.name||e?.json?.name||e?.json?.label||e?.json?.translations?.[0]?.label||"",this.name||this.AB.notify.builder(new Error("Attributes for definition had no 'name'"),{context:"ABDefinitionCore.fromValues()",attributes:e}),this.type=e.type||e?.json?.type||"",this.json=e.json||null}toObj(){return{id:this.id,name:this.name,type:this.type,json:this.json}}destroy(){return this.AB.definitionDestroy(this.id)}async save(){return this.id?this.AB.definitionUpdate(this.id,this.toObj()):this.AB.definitionCreate(this.toObj())}}},78332:(e,t,i)=>{const s=i(95995),n=i(90804),a=i(84650),r=i(52174),o=i(67431),l=i(97938),c=i(24869),u=i(2550),d=i(38968),h=i(34532),p=i(35122),f=i(76500),m=i(17063),g=i(63509),b=i(98618),v=i(94410),w=i(78949),y=i(21002),_=i(54325),x=i(48933),k=i(21579),C=i(12416),A=i(67483),D=i(70504),I=i(26263);e.exports=class extends I{constructor(e){if(super(),this.setMaxListeners(0),this._definitions=e||{},Array.isArray(e)){var t={};e.forEach((e=>{t[e.id]=e})),this._definitions=t}this._allApplications=[],this._allObjects=[],this._allHints=[],this._allProcesses=[],this._allQueries=[],this._allSteps=[],this._allDatacollections=[],this.Class={ABApplication:s,ABComponent:r,ABDefinition:a,ABFieldManager:o,ABIndex:l,ABMLClass:D,ABObject:c,ABObjectExternal:u,ABObjectImport:d,ABObjectApi:h,ABObjectQuery:f,ABProcessParticipant:b,ABProcessTaskManager:w,ABViewDetailItem:_,ABViewFormItem:x,ABMobileViewFormItem:k},this.rules={isUUID:function(e){return RegExp("^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$","i").test(e)},nameFilter:function(e){return String(e).replace(/[^a-z0-9_.]/gi,"")},toApplicationNameFormat:function(e){return"AB_"+this.nameFilter(e)},toFieldRelationFormat:function(e){return this.nameFilter(e)+"__relation"},toJunctionTableFK:function(e,t){var i=e+"_"+t;return i.length>64&&(i=i.substring(0,64)),i},toJunctionTableNameFormat:function(e,t,i,s){return(e=this.toApplicationNameFormat(e)).length>17&&(e=e.substring(0,17)),t.length>15&&(t=t.substring(0,15)),i.length>15&&(i=i.substring(0,15)),(s=this.nameFilter(s)).length>14&&(s=s.substring(0,14)),"{appName}_{sourceName}_{targetName}_{colName}".replace("{appName}",e).replace("{sourceName}",t).replace("{targetName}",i).replace("{colName}",s)},toObjectNameFormat:function(e){return`AB_${this.nameFilter(e)}`}},this.notify.builder=(...e)=>{this.notify("builder",...e)},this.notify.developer=(...e)=>{this.notify("developer",...e)}}definitionClean(e){if("string"==typeof e.json)try{e.json=JSON.parse(e.json)}catch(t){console.log(t),console.error(` Error on definition id[${e.id}]`)}}init(){let e=Object.keys(this._definitions).map((e=>this._definitions[e]));return e.forEach((e=>{this.definitionClean(e)})),["object","query","datacollection","process","hint","step","application"].forEach((t=>{e.filter((e=>e.type==t)).forEach((e=>{let{keyList:t,keyFn:i}=this.objectKeysByDef(e);t&&this[t].push(this[i](e.json))}))})),this.emit("init.objects_ready"),Promise.resolve()}objectKeysByDef(e){switch(e.type){case"application":return{keyList:"_allApplications",keyFn:"applicationNew"};case"datacollection":return{keyList:"_allDatacollections",keyFn:"datacollectionNew"};case"hint":return{keyList:"_allHints",keyFn:"hintNew"};case"steps":return{keyList:"_allSteps",keyFn:"stepNew"};case"object":return{keyList:"_allObjects",keyFn:"objectNew"};case"process":return{keyList:"_allProcesses",keyFn:"processNew"};case"query":return{keyList:"_allQueries",keyFn:"queryNew"};default:return{keyList:null,keyFn:null}}}definitionByID(e,t=!1){return this._definitions[e]?t?this._definitions[e]:this._definitions[e].json:null}definitionNew(e){return new a(e,this)}definitionsParse(e=[]){return Array.isArray(e)||(e=[e]),e.forEach((e=>{this.definitionClean(e),this._definitions[e.id]=e})),e.forEach((e=>{this.definitionSync("updated",e.id,e)})),Promise.resolve()}definitionSync(e,t,i){var s,{keyList:n,keyFn:a}=this.objectKeysByDef(i);if(n)switch(e){case"created":this[n].push(this[a](i.json)),this.emit("definition.created",i.json);break;case"updated":s=this[n].find((e=>e.id==t)),this[n]=this[n].filter((e=>e.id!=t)),this[n].push(this[a](i.json)),s?s.emit("definition.updated",i.json):this.emit("definition.updated",i.json);break;case"destroyed":(s=this[n].find((e=>e.id==t)))&&(this[n]=this[n].filter((e=>e.id!=t)),s.emit("definition.deleted",i.json),this.emit("definition.deleted",i.json))}}applications(e=(()=>!0)){return(this._allApplications||[]).filter(e)}applicationByID(e){return this.applications((t=>t.id==e))[0]}applicationNew(e){return"mobile"==e.appType?this.applicationMobileNew(e):new s(e,this)}applicationMobileNew(e){return new n(e,this)}datacollections(e=(()=>!0)){return(this._allDatacollections||[]).filter(e)}datacollectionByID(e){return e?this.datacollections((t=>t.id==e||t.name==e||t.label==e))[0]:null}datacollectionNew(e){var t=new p(e,this);return t.on("destroyed",(()=>{this._allDatacollections=this._allDatacollections.filter((e=>e.id!=t.id))})),t}fieldNew(e,t){return o.newField(e,t)}indexNew(e,t){return new l(e,t)}Label(){return(e,t,i=[])=>{var s=e;return t&&(Array.isArray(t)?i=t:s=t),i.forEach(((e,t)=>{var i=`{${t}}`;s=s.replaceAll(i,e)})),s}}objects(e=(()=>!0)){return(this._allObjects||[]).filter(e)}objectByID(e){return this.objects((t=>t.id==e||t.name==e||t.label==e))[0]}objectNew(e){return 1==e.isExternal?new u(e,this):1==e.isImported?new d(e,this):1==e.isAPI?new h(e,this):new c(e,this)}objectFile(){return this.objectByID("4a9d89c9-f4eb-41af-91e4-909eff389f3e")}objectLanguage(){return this.objectByID("d84cd351-d96c-490f-9afb-2a0b880ca0ec")}objectProcessForm(){return this.objectByID("d36ae4c8-edef-48d8-bd9c-79a0edcaa067")}objectProcessInstance(){return this.objectByID("2ba85be0-78db-4eda-ba43-c2c4e3831849")}objectRole(){return this.objectByID("c33692f3-26b7-4af3-a02e-139fb519296d")}objectScope(){return this.objectByID("af10e37c-9b3a-4dc6-a52a-85d52320b659")}objectToken(){return this.objectByID("08826ac7-4b33-4745-a3d7-f7831ca4ff59")}objectUser(){return this.objectByID("228e3d91-5e42-49ec-b37c-59323ae433a1")}objectKey(){return this.objectByID("d734fe8c-b615-446c-8a5f-793ddece19f9")}objectSecret(){return this.objectByID("db5b3b26-5300-4c92-bc73-8ce4f4696992")}hints(e=(()=>!0)){return(this._allHints||[]).filter(e)}hintID(e){return this.hints((t=>t.id==e||t.name==e||t.label==e))[0]}hintNew(e){return new m(e,this)}steps(e=(()=>!0)){return(this._allSteps||[]).filter(e)}stepID(e){return this.steps((t=>t.id==e||t.name==e||t.label==e))[0]}stepNew(e,t){var i=this.definitionByID(e);return new y(i||{settings:{hint:t}},this)}processes(e=(()=>!0)){return(this._allProcesses||[]).filter(e)}processByID(e){return this.processes((t=>t.id==e||t.name==e||t.label==e))[0]}processNew(e){return new g(e,this)}processElementNew(e,t){var i=this.definitionByID(e);if(i)switch(i.type){case b.defaults().type:return new b(i,t,this);case v.defaults().type:return new v(i,t,this);default:return w.newTask(i,t,this)}return null}processElementNewForModelDefinition(e,t){var i=null;switch(e.type){case"bpmn:Participant":i=new b({},t,this);break;case"bpmn:Lane":i=new v({},t,this);break;default:var s=w.definitionForElement(e);s&&(i=w.newTask(s,t,this))}return i&&i.fromElement(e),i}queries(e=(()=>!0)){return(this._allQueries||[]).filter(e)}queryByID(e){return this.queries((t=>t.id==e||t.name==e||t.label==e))[0]}queryNew(e){return new f(e,this)}rowfilterNew(e,t){return e&&console.error("!! Who is calling this with an App?"),new C(e||this._App,t,this)}filterComplexNew(e,t={}){return new A(e,this,t)}viewNewDetatched(e){return this._mockApp||(this._mockApp=this.applicationNew({})),this._mockApp.viewNew(e,this._mockApp)}notify(){console.error("ABFactory.notify() is expected to be overwritten by the platform!")}_notifyInfo(e){var t={};return e&&Object.keys(e).forEach((i=>{switch(i){case"field":t.objectID=e[i].object?.id,t.objectName=e[i].object?.name,t.fieldID=e[i].id,t.fieldName=e[i].label||e[i].name;break;case"object":t.objectID=e[i].id,t.objectName=e[i].name;break;case"datacollection":t.datacollectionID=e[i].id,t.datacollectionName=e[i].label||e[i].name;var s=e[i].datasource;s&&(t.datacollectionDSID=s.id,t.datacollectionDSName=s.name);break;case"process":t.processID=e[i].id,t.processName=e[i].label||e[i].name;break;case"req":t.req={jobID:e[i].jobID,tenantID:e[i]._tenantID,user:e[i]._user};break;case"task":e[i].process&&(t.processID=e[i].process.id,t.processName=e[i].process.label||e[i].process.name),t.taskID=e[i].id,t.taskName=e[i].label||e[i].name;break;case"view":e[i].application&&(t.applicationID=e[i].application.id,t.applicationName=e[i].application.label||e[i].application.name),t.viewID=e[i].id,t.viewName=e[i].label||e[i].name,t.viewKey=e[i].key;break;default:t[i]=e[i]}})),t}}},67431:(e,t,i)=>{var s={};[i(2163),i(26331),i(18799),i(4637),i(85690),i(9740),i(34963),i(10567),i(75922),i(72408),i(15884),i(78025),i(89981),i(59675),i(81961),i(37900),i(44322),i(4213),i(63048),i(53317)].forEach((e=>{s[e.defaults().key]=e})),e.exports=class{static allFields(){var e=[];for(var t in s)e.push(s[t]);return e}static fieldByKey(e){return s[e]}static newField(e,t){if(!e.key)throw console.log("-------"),console.log("values:"),console.error(e),console.log(),console.error("object:"),console.error(t),console.log("-------"),new Error(`ABFieldManager.newField(): Unknown Field Key [${e.name}][${e.key}] for object[${t.name}]`);try{return new s[e.key](e,t)}catch(t){console.log("Error",t),console.log("Available fields",s),console.log("Requested field",e.key)}}}},43472:(e,t,i)=>{var s=i(70504);i(60659),e.exports=class extends s{constructor(e,t){super(["name","description"],t),this.fromValues(e)}fromValues(e){let t=e?.settings?.active??"1";this.id=e?.id||"",this.name=e?.name||"New Tutorial",this.description=e?.description||"",this.type=e?.type||"hint",this.settings={},this.settings.active=t,this.settings.transition=e?.settings?.transition,this.settings.showIntroStep=e?.settings?.showIntroStep,this.settings.view=e?.settings?.view||"",this.stepIDs=e?.stepIDs||[],this?._steps,this._steps={},(e?.stepIDs||[]).forEach((e=>{if(e){var t=this.AB.stepNew(e,this.id);t&&(this._steps[e]=t)}})),e&&super.fromValues(e),this.label||(this.label=this.name)}toObj(){this.label||(this.label=this.name);var e=super.toObj();return["type","settings","stepIDs","id","name"].forEach((t=>{e[t]=this[t]})),e}steps(e=(()=>!0)){return Object.keys(this._steps).map((e=>this._steps[e])).filter(e)}stepAdd(e){this._steps[e.id]=e}stepByID(e){return this._steps[e]??null}stepRemove(e){let t=this.stepIDs.indexOf(e);t>-1&&this.stepIDs.splice(t,1),delete this._steps[e]}}},12796:(e,t,i)=>{const s=i(70504);e.exports=class extends s{constructor(e,t){super(["label"],t.AB),this.object=t,this.fromValues(e)}fromValues(e){if(this.id=e.id,this.type="index",this.name=e.name,this.unique=JSON.parse(e.unique||!1),e.fieldIDs&&!Array.isArray(e.fieldIDs)&&(e.fieldIDs=[e.fieldIDs]),this._unknownFieldIDs=[],this.fields=(e.fieldIDs||[]).map((e=>{let t=this.object.fieldByID(e);if(!t){this._unknownFieldIDs.push(e);let t=new Error(`Index[${this.name}][${this.id}] is referencing an unknown field[${e}]`);this.AB.notify.developer(t,{index:this.id,field:e})}return t})).filter((e=>e)),0==this.fields.length){let t=new Error(`Index[${this.name}][${this.id}] is not referencing any fields`);this.AB.notify.developer(t,{index:this.id,attributeFieldIDs:e.fieldIDs||[]})}super.fromValues(e)}toObj(){let e=super.toObj();return e.id=this.id,e.type="index",e.name=this.name,e.unique=this.unique,this.fields&&!Array.isArray(this.fields)&&(this.fields=[this.fields]),e.fieldIDs=(this.fields||[]).map((e=>e.id||e)).filter((e=>e)),this._unknownFieldIDs.forEach((t=>{e.fieldIDs.push(t)})),e}get indexName(){return`${this.object.dbTableName()}_${this.name}`.replace(/ /g,"").substring(0,64)}get uniqueName(){return`${this.indexName.substring(0,57)}_unique`}}},21177:(e,t,i)=>{var s=i(26263);e.exports=class extends s{constructor(e,t){super(),this.mlFields=e||["label"],this.AB=t}fromValues(e){this.translations=e.translations,this.translations?this.translate():(this.mlFields||[]).forEach((t=>{e[t]&&(this[t]=e[t])}))}defaultTranslations(e,t){t=t||{};var i={language_code:"en"};return e.forEach((e=>{i[e]=t[e]||e})),[i]}languageDefault(){return"en"}toObj(){return this.unTranslate(),{translations:this.translations}}toDefinition(){return this.AB.definitionNew({id:this.id,name:this.name,type:this.type,json:this.toObj()})}translate(e,t,i,s=null){e||(e=this),t||(t=this),i||(i=this.mlFields||[]),t.translations||(t.translations=[]),"string"==typeof t.translations&&(t.translations=JSON.parse(t.translations));var n=s||this.languageDefault();if(i&&i.length>0){var a=null,r=!1;t.translations.forEach((function(t){a||(a=t),t.language_code==n&&(r=!0,i.forEach((function(i){null!=t[i]&&(e[i]=t[i]),e[i]=t[i]||""})))})),!r&&a&&i.forEach((function(t){null!=a[t]&&""!=a[t]?e[t]=`[${n}]${a[t]}`:e[t]=""}))}}unTranslate(e,t,i){e||(e=this),t||(t=this),i||(i=this.mlFields||[]),t.translations||(t.translations=[]);var s=this.languageDefault();if(i&&i.length>0){var n=!1;if(t.translations.forEach((function(t){t.language_code==s&&(i.forEach((function(i){null!=e[i]&&(t[i]=e[i])})),n=!0)})),!n){var a={};a.language_code=s,i.forEach((function(t){null!=e[t]&&(a[t]=e[t])})),t.translations.push(a)}}}}},69410:e=>{e.exports=class{constructor(e){this.object=e,this.AB=e.AB,this._where=null,this._sort=null,this._skip=null,this._limit=null,this.staleRefreshInProcess=!1,this.staleRefreshMap={},this.staleRefreshPending=[],this.staleRefreshTimerID=null,this.responseContext={key:"--",context:{}}}contextKey(e){this.responseContext.key=e||"--"}contextValues(e){this.responseContext.context=e||{}}prepareMultilingualData(e){var t=this.object.multilingualFields(),i=!1;t.length&&t.forEach((function(t){null!=e[t]&&(i=!0)})),i&&(null!=e.translations&&void 0!==e.translations&&""!=e.translations||(e.translations=[]),this.object.unTranslate(e,e,t))}request(e,t){return console.error("!!! ABModelCore.request() should be overridden by platform."),Promise.resolve()}urlParamsCreate(e){return{url:this.object.urlRest(),params:e}}urlParamsDelete(e){return{url:this.object.urlRestItem(e)}}urlParamsFind(e){return{url:this.object.urlRest(),params:e||{}}}urlParamsUpdate(e,t){return{url:this.object.urlRestItem(e),params:t}}count(e){e=e||{};var t={url:this.object.urlRestCount(),params:e};return this.request("get",t).then((e=>e)).catch((e=>{console.error(e)}))}staleRefresh(e){var t=this.object.PK(),i=e[t];return e.where&&(i=e.where[t]),new Promise(((s,n)=>{if(!i){var a=new Error("Model.staleRefresh(): could not resolve ."+t);return a.cond=e,void n(a)}var r={resolve:s,reject:n};r[t]=i,this.staleRefreshPending.push(r),this.staleRefreshInProcess||(this.staleRefreshTimerID&&clearTimeout(this.staleRefreshTimerID),this.staleRefreshTimerID=setTimeout((()=>{this.staleRefreshProcess()}),200))}))}staleRefreshProcess(){this.staleRefreshInProcess=!0;var e=this.staleRefreshPending;this.staleRefreshPending=[];var t=this.object.PK(),i={},s={where:{}};s.where[t]=[],console.log("Model.staleRefreshProcess(): buffered "+e.length+" requests"),e.forEach((e=>{i[e[t]]=i[e[t]]||[],i[e[t]].push(e)})),s.where[t]=Object.keys(i),this.findAll(s).then((e=>{Array.isArray(e.data)&&e.data.length&&e.data.forEach((e=>{i[e[t]]?(i[e[t]].forEach((t=>{(0,t.resolve)({data:[e]})})),delete i[e[t]]):console.error("Model.staleRefreshProcess(): returned entry was not in our responseHash:",e,i)}));var s=Object.keys(i);s.length>0&&console.warn("Model.staleRefreshProcess(): "+s.length+" entries with no responses. "),s.forEach((e=>{(0,i[e].resolve)({data:[]}),delete i[e]})),this.staleRefreshPending.length>0?this.staleRefreshProcess():this.staleRefreshInProcess=!1}))}findConnected(e,t){return void 0===t&&(Array.isArray(e)||"object"!=typeof e||(t=e,e=[])),"string"==typeof e&&(e=[e]),new Promise(((i,s)=>{if(!t.id)return void i(null);let n={};n[this.object.PK()]=t.id,this.findAll({where:n,populate:!0}).then((t=>{if(t.data&&Array.isArray(t.data)&&0!=t.data.length){var s=t.data[0];if(1==e.length){let t=s[e[0].replace(/[^a-z0-9.]/gi,"")+"__relation"];return t?(Array.isArray(t)||(t=[t]),void i(t)):i([])}0==e.length&&this.object.fields((e=>e.settings.linkType)).forEach((t=>{e.push(t.columnName)}));var n={};e.forEach((e=>{n[e]=s[e.replace(/[^a-z0-9.]/gi,"")+"__relation"]})),i(n)}else i([])})).catch((e=>{console.error("!!! error with findConnected() attempt:",e),s(e)}))}))}upsert(e){for(var t in this.prepareMultilingualData(e),e)null==e[t]&&delete e[t];var i={url:this.object.urlRest(),params:e};return this.request("put",i).then((e=>(this.normalizeData(e),e))).catch((e=>{console.error(e)}))}where(e){return this._where=e,this}sort(e){return this._sort=e,this}refresh(){return console.error("!!! Depreciated: where is this being called from?"),Promise.resolve()}normalizeData(e){e instanceof Array||(e=[e]);var t=this.object.connectFields(),i=this.object.multilingualFields(),s=this.object.fields((function(e){return"date"==e.key||"datetime"==e.key}))||[],n=this.object.fields((e=>"calculate"==e.key));e.forEach((e=>{null!=e&&(e.id||"id"==this.object.PK()||(e.id=e[this.object.PK()]),t.forEach((t=>{var i=t.relationName();if(null==e[i])return;"string"==typeof e[i]&&e[i].length>0&&(e[i]=JSON.parse(e[i])),Array.isArray(e[i])?e[i].forEach((e=>{e.translations&&"string"==typeof e.translations&&(e.translations=JSON.parse(e.translations))})):e[i].translations&&"string"==typeof e[i].translations&&(e[i].translations=JSON.parse(e[i].translations));let s=t.datasourceLink;if(!s)return;let n=s.PK();var a=s.multilingualFields();if(Array.isArray(e[i]))e[i].forEach((e=>{const i=t.getRelationValue(e);"id"!=n&&(e.id=i),a.length&&s.translate(e,e,a)}));else{const n=t.getRelationValue(e[i]);n&&(e[i].id=n),a.length&&s.translate(e[i],e[i],a)}if(!e[t.columnName])if("one"==t.linkType())e[i]?e[t.columnName]=t.getRelationValue(e[i]):e[t.columnName]=null;else if(e[i])if(Array.isArray(e[i]))try{e[t.columnName]=(e[i]||[]).map((e=>t.getRelationValue(e)))}catch(s){console.log("+++++++++++++++"),console.log(`ID:[${t.id}]`),console.log(`ColumnName:[${t.label}]`),console.log(`relationName:[${i}]`),console.log(`linkType:[${t.linkType()}]`),console.log("data:"),console.log(JSON.stringify(e[i])),console.log("+++++++++++++++")}else console.log("+++++++++++++++"),console.log(`ID:[${t.id}]`),console.log(`ColumnName:[${t.label}]`),console.log(`relationName:[${i}]`),console.log(`linkType:[${t.linkType()}]`),console.log("data:"),console.log(JSON.stringify(e[i])),console.log("+++++++++++++++"),e[t.columnName]=[t.getRelationValue(e[i])];else e[t.columnName]=[]})),i.length&&this.object.translate(e,e,i),s.forEach((t=>{e&&null!=e[t.columnName]&&"string"==typeof e[t.columnName]&&("date"==t.key?e[t.columnName]=this.AB.rules.toDate(e[t.columnName],{format:"MM/DD/YYYY",ignoreTime:!0}):e[t.columnName]=this.AB.rules.toDate(e[t.columnName]))})),n.forEach((t=>{e[t.columnName]=t.format(e)})))}))}}},84227:(e,t,i)=>{const s=i(24869),n=i(34697);e.exports=class extends s{constructor(e,t){super(e,t),this.isAPI=!0,this.fromValues(e)}fromValues(e){super.fromValues(e),this.readonly=parseInt(e.readonly)||0,this.apiType=e.apiType||"Read",this.request=e.request??{},this.request.headers=e.request?.headers??[],this.response=e.response??{},this.response.fields=e.response?.fields??[],this.isFetched=e.isFetched??!1}toObj(){const e=super.toObj();return e.isAPI=this.isAPI,e.readonly=this.readonly,e.apiType=this.apiType,e.request=this.request??{},e.request.headers=this.request?.headers??[],e.response=this.response??{},e.response.fields=this.response?.fields??[],e.isFetched=this.isFetched,e}model(){var e=new n(this);return e.contextKey(this.constructor.contextKey()),e.contextValues({id:this.id}),e}getPagingValues({skip:e,limit:t}){const i={},s=this.request?.paging??{};return s.start&&null!=e&&(i[s.start]=e),s.limit&&null!=t&&(i[s.limit]=t),i}dataFromKey(e){let t=[];return Array.isArray(e)||(e=[e]),e.forEach((e=>{let i={...e};(this.response.dataKey??"").split(".").forEach((e=>{""!=e&&null!=e&&(i=i?.[e])})),Array.isArray(i)?t=t.concat(i):i&&t.push(i)})),t}get headers(){const e={};return(this.request.headers??[]).forEach((t=>{null!=t?.value&&(e[t.key]=t.value)})),e}}},83899:(e,t,i)=>{var s=i(58174),n=i(70504);const a=(...e)=>AB.Multilingual.label(...e);e.exports=class e extends n{constructor(e,t){super(["label"],t),this.fromValues(e)}static contextKey(){return"object"}fromValues(e){this.id=e.id,this.type=e.type||"object",this.connName=e.connName||void 0,this.name=e.name||"",this.labelFormat=e.labelFormat||"",this.labelSettings=e.labelSettings||{},this.labelSettings.isNoLabelDisplay=parseInt(this.labelSettings.isNoLabelDisplay||0),this.isImported=parseInt(e.isImported||0),this.isExternal=parseInt(e.isExternal||0),this.tableName=e.tableName||"",this.tableName=this.tableName.replace(/[^a-zA-Z0-9_ ]/gi,""),this.primaryColumnName=e.primaryColumnName||"",this.transColumnName=e.transColumnName||"",this.urlPath=e.urlPath||"",this.isSystemObject=e.isSystemObject,void 0!==this.isSystemObject&&"false"!=this.isSystemObject||(this.isSystemObject=!1),this.createdInAppID=e.createdInAppID,void 0!==e.objectWorkspace&&(void 0===e.objectWorkspace.sortFields&&(e.objectWorkspace.sortFields=[]),void 0===e.objectWorkspace.filterConditions&&(e.objectWorkspace.filterConditions=[]),void 0===e.objectWorkspace.frozenColumnID&&(e.objectWorkspace.frozenColumnID=""),void 0===e.objectWorkspace.hiddenFields&&(e.objectWorkspace.hiddenFields=[])),this.objectWorkspace=e.objectWorkspace||{sortFields:[],filterConditions:[],frozenColumnID:"",hiddenFields:[]};var t=[];this.fieldIDs=e.fieldIDs||[],this.importedFieldIDs=e.importedFieldIDs||[],this._unknownFieldIDs=[],this.fieldIDs.forEach((e=>{if(e){var i=this.AB.definitionByID(e);if(i)t.push(this.AB.fieldNew(i,this));else{this._unknownFieldIDs.push(e);let t=new Error(`O[${this.name}] is referenceing an unknown field id[${e}]`);this.AB.notify.builder(t,{field:{id:e,object:{id:this.id,name:this.name}}})}}})),this._fields=t,this.importIndexes(e.indexIDs),super.fromValues(e)}importIndexes(e){this._unknownIndex=[];var t=[];(e||[]).forEach((e=>{var i=this.AB.definitionByID(e);if(i)t.push(this.AB.indexNew(i,this));else{this._unknownIndex.push(e);let t=new Error(`O[${this.name}] is referenceing an unknown index id[${e}]`);this.AB.notify.builder(t,{field:{id:e,object:{id:this.id,name:this.name}}})}})),this._indexes=t}toObj(){var e=super.toObj(),t=this.fields().map((e=>e.id));(this._unknownFieldIDs||[]).forEach((e=>{t.push(e)}));var i=this.indexes().map((e=>e.id));return(this._unknownIndex||[]).forEach((e=>{i.push(e)})),{id:this.id,type:this.type||"object",connName:this.connName,name:this.name,labelFormat:this.labelFormat,labelSettings:this.labelSettings||{},isImported:this.isImported,isExternal:this.isExternal,tableName:this.tableName,primaryColumnName:this.primaryColumnName,transColumnName:this.transColumnName,urlPath:this.urlPath,objectWorkspace:this.objectWorkspace,isSystemObject:this.isSystemObject,translations:e.translations,fieldIDs:t,importedFieldIDs:this.importedFieldIDs,indexIDs:i,createdInAppID:this.createdInAppID}}objectLinks(){return this.connectFields().map((e=>e.datasourceLink))}fields(e=(()=>!0)){return this._fields.filter(e)}fieldByID(e){return this.fields((t=>t?.id==e))[0]}connectFields(e=(()=>!0)){return this.fields((e=>e&&e.isConnection)).filter(e)}fieldImport(e){if(e&&(-1==this.importedFieldIDs.indexOf(e)&&this.importedFieldIDs.push(e),!this._fields.find((t=>t.id==e)))){var t=this.AB.definitionByID(e);if(t)this._fields.push(this.AB.fieldNew(t,this));else{this._unknownFieldIDs=this._unknownFieldIDs||[],this._unknownFieldIDs.push(e);let t=new Error(`O[${this.name}] is importing an unknown field id[${e}]`);this.AB.notify.builder(t,{field:{id:e,object:{id:this.id,name:this.name}}})}}}fieldNew(e){return this.AB.fieldNew(e,this)}fieldRemove(e){var t=this._fields.length;return this._fields=this.fields((function(t){return t.id!=e.id})),this.importedFieldIDs=this.importedFieldIDs.filter((t=>t!=e.id)),this._fields.length<t?this.save():Promise.resolve()}fieldReorder(e,t){let i=null,s=0;for(var n=0;n<this._fields.length;n++)if(this._fields[n].columnName==e){i=this._fields[n],this._fields.splice(n,1),s=n;break}for(var a=0;a<this._fields.length;a++)if(this._fields[a].columnName==t){s<=a&&a++,this._fields.splice(a,0,i);break}return this.save()}fieldSave(e){return this.fieldByID(e.id)?Promise.resolve():(this._fields.push(e),this.save())}fieldAdd(e){return this.fieldByID(e.id)?Promise.resolve():(this._fields.push(e),this.save())}imageFields(e=(()=>!0)){return this.fields((e=>e&&"image"==e.key)).filter(e)}multilingualFields(){return this.fields((e=>e&&e.isMultilingual)).map((e=>e.columnName))}indexes(e=(()=>!0)){return this._indexes.filter(e)}indexByID(e){return this.indexes((t=>t.id==e))[0]}indexRemove(e){var t=this._indexes.length;return this._indexes=this.indexes((function(t){return t.id!=e.id})),t!=this._indexes.length?this.save():Promise.resolve()}indexSave(e){return this.indexByID(e.id)?Promise.resolve():(this._indexes.push(e),this.save())}model(){var t=new s(this);return t.contextKey(e.contextKey()),t.contextValues({id:this.id}),t}urlRest(){return`/app_builder/model/${this.id}`}urlRestBatch(){return`/app_builder/batch/model/${this.id}`}urlRestItem(e){return`/app_builder/model/${this.id}/${e}`}urlRestLog(){return`/app_builder/object/${this.id}/track`}urlRestRefresh(){return`/app_builder/model/refreshobject/${this.id}`}urlRestCount(){return`/app_builder/model/count/${this.id}`}get workspaceSortFields(){if(this.workspaceViews){let e=this.workspaceViews.getCurrentView();return e?e.sortFields:null}return this.objectWorkspace.sortFields}set workspaceSortFields(e){if(this.workspaceViews){let t=this.workspaceViews.getCurrentView();t&&(t.sortFields=e)}else this.objectWorkspace.sortFields=e}get workspaceFilterConditions(){if(this.workspaceViews){let e=this.workspaceViews.getCurrentView();return e?e.filterConditions:null}return this.objectWorkspace.filterConditions}set workspaceFilterConditions(e){if(this.workspaceViews){let t=this.workspaceViews.getCurrentView();t&&(t.filterConditions=e)}else this.objectWorkspace.filterConditions=e}get workspaceFrozenColumnID(){return this.objectWorkspace.frozenColumnID}set workspaceFrozenColumnID(e){this.objectWorkspace.frozenColumnID=e}get workspaceHiddenFields(){return this.objectWorkspace.hiddenFields||[]}set workspaceHiddenFields(e){this.objectWorkspace.hiddenFields=e}get isReadOnly(){return this.isImported||this.isExternal||this.readonly}defaultValues(){var e={};return this.fields().forEach((t=>{t.defaultValue(e)})),e}isValidData(){return console.warn("Platform.ABObject.isValidData() missing"),!0}urlPointer(e){return console.error("Who is calling this?"),null==this.application?null:this.application.urlObject(e)+this.id}urlField(e){return console.error("Who is calling this?"),this.urlPointer(e)+"/_fields/"}PK(){return this.primaryColumnName||"uuid"}remoteCreate(e){console.log("object["+this.name+"] received a remoteCreate() with data:",e)}clone(){let e=JSON.parse(JSON.stringify(this));return["application","_fields"].forEach((t=>{e[t]=this[t]})),e}minRelationData(){var e=[this.PK()];this.multilingualFields().length>0&&e.push("translations");var t=(this.labelFormat||"").match(/\{[^}]+\}/g);return t&&t.forEach&&t.forEach((t=>{var i=t.replace("{","").replace("}",""),s=this.fieldByID(i);null!=s&&e.push(s.columnName)})),e=e.concat(this.fields((e=>"number"==e.key)).map((e=>e.columnName)))}displayData(e){if(null==e)return"";var t=this.multilingualFields();this.translate(e,e,t);var i=this.labelFormat||"";if(!i&&this.fields().length>0){var s=this.fields((e=>e.fieldUseAsLabel()))[0];if(s)i="{"+s.id+"}";else if(!i.trim()){let t=this.labelSettings||{};i=t&&t.isNoLabelDisplay?a(t.noLabelText||"[No Label]"):`${this.AB.rules.isUUID(e.id)?"ID: ":""}${e.id}`}}var n=i.match(/\{[^}]+\}/g);if(n&&n.forEach&&n.forEach((t=>{var s=t.replace("{","").replace("}",""),n=this.fieldByID(s);null!=n&&(i=i.replace(t,n.format(e)||""))})),!i.trim()){let t=this.labelSettings||{};i=t&&t.isNoLabelDisplay?a(t.noLabelText||"[No Label]"):`${this.AB.rules.isUUID(e.id)?"ID: ":""}${e.id}`}return i}whereCleanUp(e){if(e){if(e.glue&&e.rules){let t={glue:e.glue,rules:[]};return e.rules.forEach((e=>{let i=this.whereCleanUp(e);i&&t.rules.push(i)})),t.rules.length>0?t:null}return Object.keys(e).length>0?e:null}return null}}},2732:(e,t,i)=>{var s=i(24869),n=i(63549);e.exports=class extends s{constructor(e,t){super(e,t),this.isQuery=!0,this.__missingObject=this.__missingObject??[],this.__missingFields=this.__missingFields??[],this.__cantFilter=[],this.__duplicateFields=[],this.__linkProblems=[]}static contextKey(){return"query"}fromValues(e){super.fromValues(e),this.type="query",this.alias2Obj={},this.objectIDs=[],this.viewName=e.viewName||"",this.importJoins(e.joins||{}),this._fields=null,this.importFields(e.fields||[]),this.where=e.where||{},this.where&&!this.where.glue&&this.where.rules&&this.where.rules.length>0&&(this.where.glue="and"),this._objectWorkspaceViews=e.objectWorkspaceViews||{},this.settings=this.settings||{},e&&e.settings&&(this.settings.grouping=JSON.parse(e.settings.grouping||!1),this.settings.hidePrefix=JSON.parse(e.settings.hidePrefix||!1))}toObj(){var e=super.toObj();return e.viewName=this.viewName,e.joins=this.exportJoins(),e.fields=this.exportFields(),e.where=this.where,e.settings=this.settings,e}importFields(e){var t=[];(e||[]).forEach((e=>{if(null==e)return;let i=this.objectByAlias(e.alias);if(!i&&this.AB&&(i=this.AB.objectByID(e.objectID),i&&(this._objects=this._objects||{},this._objects[e.alias]=i)),!i)return this.__missingObject=this.__missingObject??[],void this.__missingObject.push(e);let s=i.fieldByID(e.fieldID);if(!s)return this.__missingFields=this.__missingFields??[],void this.__missingFields.push({objID:i.id,fieldID:e.fieldID,fieldInfo:e});this.canFilterField(s)||(this.__cantFilter=this.__cantFilter??[],this.__cantFilter.push({field:s,fieldInfo:e}));let n=t.filter((t=>t.alias==e.alias&&t.field.id==e.fieldID)).length<1;if(n||(this.__duplicateFields=this.__duplicateFields??[],this.__duplicateFields.push({fieldInfo:e})),s&&this.canFilterField(s)&&n){var a=s.toObj();let i=new s.constructor(a,s.object);i.alias=e.alias;let n=e.alias;Array.isArray(this.joins())&&(n=s.object.name),t.push({alias:n,field:i})}})),this._fields=t}exportFields(){var e=[];return this._fields.forEach((t=>{e.push({alias:t.alias,objectID:t.field.object.id,fieldID:t.field.id})})),(this.__missingObject||[]).forEach((t=>{e.push(t)})),(this.__cantFilter||[]).forEach((t=>{e.push(t.fieldInfo)})),e}fields(e=(()=>!0)){return e||(e=()=>!0),this._fields.map((e=>e.field)).filter(e)}joins(){return this._joins||{}}objects(e=(()=>!0)){return this.AB.objects((e=>this.objectIDs.indexOf(e.id)>-1)).filter(e)}objectAlias(e){let t=null;return Object.keys(this.alias2Obj||{}).forEach((i=>{t||this.alias2Obj[i]!=e||(t=i)})),t}objectBase(){return this._joins.objectID&&this.AB.objectByID(this._joins.objectID)||null}objectByAlias(e){var t=this.alias2Obj[e];return t?this.objects((e=>e.id==t))[0]:null}objectByID(e){return e?this.objects((t=>t.id==e))[0]:null}links(e=(()=>!0)){return(this._links||[]).filter(e)}importJoins(e){this._joins=this.AB.cloneDeep(e);var t={},i=[];let s=(e,i)=>{e&&(this.alias2Obj[i]=e.id,t[e.id]=e.id)},n=e=>{(e||[]).forEach((e=>{i.push(e)}))};this.__linkProblems=this.__linkProblems??[];let a=(e,t)=>{e&&(t||[]).forEach((t=>{var i=e.fieldByID(t.fieldID);if(i){var r=this.AB.objectByID(i.settings.linkObject);r?(s(r,t.alias),n(t.links),a(r,t.links)):this.__linkProblems.push({message:`could not resolve our linked field -> linkObject[${i.settings.linkObject}]`,data:{link:t}})}else this.__linkProblems.push({message:`could not resolve our linkField[${t.fieldID}]`,data:{link:t}})}))};var r=this.objectBase();r?(s(r,"BASE_OBJECT"),n(e.links),a(r,e.links),this._links=i,this.objectIDs=Object.keys(t)):this.__linkProblems.push({message:"could not resolve our base object",data:{objectID:this._joins?.objectID}})}exportJoins(){return this.AB.cloneDeep(this._joins||{})}model(){var e=new n(this);return e.contextKey(this.constructor.contextKey()),e.contextValues({id:this.id}),e}canFilterObject(e){return!!e&&this.objects((t=>t.id==e.id)).length>0}canFilterField(e){if(!e)return!1;let t=e.object;var i=e.datasourceLink;return this.canFilterObject(t)||this.canFilterObject(i)}urlPointer(e){return console.error("ABQueryCore.urlPointer(): Depreciated: Where is this being called?"),this.application.urlQuery(e)+this.id}get isGroup(){return this.settings.grouping||!1}get isReadOnly(){return!0}isDisabled(){return this.disabled||!1}get workspaceFilterConditions(){let e=super.workspaceFilterConditions;return null!=e&&null!=e.rules&&e.rules.length||(e=this.where),e}}},42260:(e,t,i)=>{var s=i(70504);const n=i(60659),a=i(39966);e.exports=class extends s{constructor(e,t){super(["label"],t),this.fromValues(e),this.elements().forEach((e=>{e.onProcessReady()}))}fromValues(e){this.id=e.id,this.name=e.name||"",this.type=e.type||"process",this.xmlDefinition=e.xmlDefinition||null;let t=this._elements||{};this._elements={},(e.elementIDs||[]).forEach((e=>{var i=this.AB.processElementNew(e,this);i?this._elements[e]=i:t[e]?this._elements[e]=t[e]:this.emit("warning",`P[${this.name}] is referencing an unknown process element id[${e}]`,{process:this.id,eID:e})})),this._connections=e.connections||{},super.fromValues(e),this.label||(this.label=this.name)}toObj(){this.label||(this.label=this.name);var e=super.toObj();for(var t in["id","name","xmlDefinition"].forEach((t=>{e[t]=this[t]})),e.elementIDs=[],this._elements)e.elementIDs.push(this._elements[t].id??this._elements[t].diagramID);return e.connections=this._connections,e}modelDefinition(){return this.xmlDefinition}modelNew(){this.xmlDefinition=`<?xml version="1.0" encoding="UTF-8"?>\n<bpmn2:definitions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bpmn2="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xsi:schemaLocation="http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd" id="process-def-${this.id}" targetNamespace="http://bpmn.io/schema/bpmn">\n  <bpmn2:process id="Process_1" isExecutable="true">\n    <bpmn2:startEvent id="StartEvent_1"/>\n  </bpmn2:process>\n  <bpmndi:BPMNDiagram id="BPMNDiagram_1">\n    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Process_1">\n      <bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1">\n        <dc:Bounds height="36.0" width="36.0" x="412.0" y="240.0"/>\n      </bpmndi:BPMNShape>\n    </bpmndi:BPMNPlane>\n  </bpmndi:BPMNDiagram>\n</bpmn2:definitions>`}modelUpdate(e){this.xmlDefinition=e}connections(e=(()=>!0)){var t=Object.keys(this._connections).map((e=>this._connections[e]));return this.process&&"SubProcess"===this.key&&(t=t.concat(this.process.connections())),t.filter(e)}connectionForDiagramID(e){return this.connections((t=>t.id==e))[0]}connectionsIncoming(e){return this.connections((t=>t.to==e))}connectionsOutgoing(e){return this.connections((t=>t.from==e))}connectionRemove(e){delete this._connections[e.id]}connectionSimplyElement(e){var t=e.businessObject,i=null;t.sourceRef&&(i=t.sourceRef.id);var s=null;return t.targetRef&&(s=t.targetRef.id),{id:e.id,type:e.type,from:i,to:s}}connectionUpsert(e){var t=this.connectionSimplyElement(e);t.from&&t.to&&e.parent?this._connections[t.id]=t:this.connectionRemove(e)}elements(e=(()=>!0)){return Object.keys(this._elements).map((e=>this._elements[e])).filter(e)}elementAdd(e){this._elements[e.id||e.diagramID]=e}elementByID(e){return this._elements[e]??null}elementForDiagramID(e){return this.elements((t=>t.diagramID==e))[0]}elementRemove(e){delete this._elements[e.id||e.diagramID]}isTriggeredBy(e){return null!=this.taskForTriggerKey(e)}connectionNextTask(e){var t=[];return this.connections((t=>t.from==e.diagramID)).forEach((e=>{var i=this.elements((t=>t.diagramID==e.to))[0];i&&t.push(i)})),t}connectionPreviousTask(e){var t=[];return this.connections((t=>t.to==e.diagramID)).forEach((e=>{var i=this.elements((t=>t.diagramID==e.from))[0];i&&t.push(i)})),t}processData(e,t){var i=this.allPreviousTasks(e),s=r(i,"processData",t,this);return s.length>0?s.length>1?s:s[0]:null}processDataFields(e){var t=this.allPreviousTasks(e),i=r(t,"processDataFields",null,this);return i.length>0?i:null}allPreviousConnectionsForConnection(e,t){this.connections((t=>t.to==e.from)).forEach((e=>{t[e.id]||(t[e.id]=e,this.allPreviousConnectionsForConnection(e,t))}))}allPreviousConnectionsForElement(e){var t=this.connections((t=>t.to==e.diagramID)),i={};return t.forEach((e=>{i[e.id]=e,this.allPreviousConnectionsForConnection(e,i)})),Object.keys(i).map((e=>i[e]))}allPreviousTasks(e){var t,i={};return this.allPreviousConnectionsForElement(e).forEach((e=>{(t=this.elementForDiagramID(e.to))&&(i[t.id]=t),(t=this.elementForDiagramID(e.from))&&(i[t.id]=t)})),Object.keys(i).map((e=>i[e])).filter((t=>t.id!=e.id))}processDataObjects(e){var t=this.connectionPreviousTask(e),i=r(t,"processDataObjects",null,this);return i.length>0?i:null}taskForTriggerKey(e){return this.elements((t=>t.triggerKey==e))[0]||null}};var r=(e,t,i,s,o,l)=>{if(void 0===o&&(o=[]),void 0===l&&(l=[]),0==e.length)return o;{const c=e.shift();if(-1==l.indexOf(c.diagramID)){l.push(c.diagramID);let r=null;c instanceof a||(r=c[t].apply(c,i)),null===r&&(r=[]),o=n(o,r),e=n(e,s.connectionPreviousTask(c))}return r(e,t,i,s,o,l)}}},73323:(e,t,i)=>{var s=i(70504);i(60659),e.exports=class extends s{constructor(e,t){super(["name","text"],t),this.fromValues(e)}fromValues(e){this.id=e.id,this.name=e.name||"New Step",this.type=e.type||"step",this.text=e.text||"",this.settings=e.settings||{},this.settings.event=e?.settings?.event||"click",this.settings.el=e?.settings?.el||"",super.fromValues(e),this.label||(this.label=this.name)}toObj(){this.label||(this.label=this.name);var e=super.toObj();return["id","name","settings","type"].forEach((t=>{e[t]=this[t]})),e}}},60979:(e,t,i)=>{var s=[i(94784),i(68732),i(73936),i(2909),i(69623),i(6765),i(28280),i(39058),i(45025),i(87821),i(35798),i(11200),i(74841),i(54013),i(24216),i(84648),i(25473),i(44998),i(47935),i(90427),i(94116),i(85342),i(2983),i(7617),i(40912),i(69366),i(69330),i(41161),i(13665),i(25583),i(68695),i(65862),i(11865),i(6101),i(52378),i(71951),i(97654),i(18745),i(40194),i(44388),i(93452),i(55030),i(36365),i(31223),i(51533),i(54045),i(26314),i(87262),i(24215),i(83743),i(20297)],n={};s.forEach((e=>{e.default?.common&&(e=e.default),n[e.common().key]=e})),e.exports=class{static allViews(e=(()=>!0)){var t=[];for(var i in n){var s=n[i];e(s)&&t.push(s)}return t}static newView(e,t,i){if(i=i||null,"detailselectivity"==e.key&&(e.key="detailconnect"),e.key)return n[e.key]?new n[e.key](e,t,i):(console.error("!! View["+e.key+"] not yet defined.  Have an ABView instead:"),new n.view(e,t,i));var s=new Error(`Unknown view key [${e.key}]`);return console.error(s),console.error({error:s,values:e,application:t}),null}static viewClass(e){if(n[e])return n[e];console.error(`Unknown View Key[${e}]`)}}},42428:(e,t,i)=>{var s={};[i(18315),i(94197),i(55957),i(85507),i(82097),i(89274),i(32747),i(24207),i(81854),i(57078),i(11228),i(79880),i(80585),i(12767),i(32763),i(28131),i(78310),i(98534),i(76944)].forEach((e=>{e.default?.common&&(e=e.default),s[e.common().key]=e})),e.exports=class{static allViews(e=(()=>!0)){var t=[];for(var i in s){var n=s[i];e(n)&&t.push(n)}return t}static newView(e,t,i){if(i=i||null,"detailselectivity"==e.key&&(e.key="detailconnect"),e.key)return s[e.key]?new s[e.key](e,t,i):(console.error("!! View["+e.key+"] not yet defined.  Have an ABView instead:"),new s["mobile-view"](e,t,i));var n=new Error(`Unknown view key [${e.key}]`);return console.error(n),console.error({error:n,values:e,application:t}),null}static viewClass(e){if(s[e])return s[e];console.error(`Unknown View Key[${e}]`)}}},78260:(e,t,i)=>{const s=i(52174);function n(e,t){if(!t)return null;if(!t.columnName)return null;const i=t.columnName;let s=null;if(i.indexOf(".")>-1){let t=i.split(".")[1];s=e[i]||e[t]}else s=e[i];if(null==s&&t.relationName){const i=t.relationName(),n=i.split(".")[1];s=e[i]||e[n]}if(null!=s&&!isNaN(s))return s;for(const i in e){const n=i.split(".")[1];n&&n==t.id&&(s=e[i])}return(null==s||"number"==typeof s&&isNaN(s))&&t.format&&(s=t.format(e)),s}e.exports=class extends s{constructor(e,t){e=e||"ab_filter_complex",void 0===t&&console.error("FilterComplexCore(): being called without an AB!"),super(null,e,t),this.Account={username:"??"},this._settings={},this.condition={},this._QueryFields=[],this._Fields,this._logic={callbacks:{onChange:()=>{}},removeHtmlTags:function(e){let t="";try{let i=document.createElement("div");i.innerHTML=e,t=i.textContent||i.innerText||""}catch(i){t=(e||"").replace(/(<([^>]+)>)/gi,"")}return t}}}init(e={}){this._settings=e}isValid(e,t=this.condition){if(t?.rules?.length&&null==e)return!1;if(!t?.rules?.length||null==e)return!0;let i="and"===t.glue;return t.rules.forEach((s=>{if(s?.rules?.length)return void(i="or"===t.glue?i||this.isValid(e,s):i&&this.isValid(e,s));if(!s.key||!s.rule)return;const a=(this._Fields||[]).filter((e=>e.id==s.key||e.columnName==s.key))[0];if(!a)return;let r=null,o=a.key;void 0===a.key&&("this_object"!=a.id?(a.key="connectField",o=a.key):o="this_object");let l=null;switch(l=a.relationName?function(e,t){let i="";if(e){let s=t.relationName();if(e[s])i=(t.indexField?e[s][t.indexField.columnName]:null)??(t.indexField2?e[s][t.indexField2.columnName]:null)??e[s].id??e[s];else{let s=n(e,t);null!=s&&(i=s)}}return i}(e,a):n(e,a),o){case"string":case"LongText":case"email":null==l&&(l=""),r=this.textValid(l,s.rule,s.value);break;case"date":case"datetime":r=this.dateValid(l,s.rule,s.value);break;case"number":case"calculate":case"formula":r=this.numberValid(l,s.rule,s.value);break;case"list":r=this.listValid(l,s.rule,s.value);break;case"boolean":r=this.booleanValid(l,s.rule,s.value);break;case"user":r=this.userValid(l,s.rule,s.value);break;case"connectField":case"connectObject":r=this.connectFieldValid(e,a,s.rule,s.value);break;case"this_object":r=this.thisObjectValid(e,s.rule,s.value)}i="and"===t.glue?i&&r:i||r})),i}textValid(e,t,i){let s=!1;e=e.trim().toLowerCase(),e=this._logic.removeHtmlTags(e);const n=(i=i.trim().toLowerCase().replace(/  +/g," ")).split(" ");switch(t){case"contains":n.forEach((t=>{0==s&&(s=e.indexOf(t)>-1)}));break;case"not_contains":s=!0,n.forEach((t=>{1==s&&(s=e.indexOf(t)<0)}));break;case"equals":n.forEach((t=>{0==s&&(s=e==t)}));break;case"not_equal":s=!0,n.forEach((t=>{1==s&&(s=e!=t)}));break;case"is_empty":s=""==e||null==e;break;case"is_not_empty":s=""!=e&&null!=e;break;default:s=this.queryFieldValid(e,t,i)}return s}dateValid(e,t,i){let s=!1;switch(e instanceof Date||(e=new Date(e)),i instanceof Date||(i=new Date(i)),t){case"less":s=e<i;break;case"greater":s=e>i;break;case"less_or_equal":s=e<=i;break;case"greater_or_equal":s=e>=i;break;default:s=this.queryFieldValid(e,t,i)}return s}numberValid(e,t,i){let s=!1;switch(e=Number(e),i=Number(i),t){case"equal":case"equals":s=e==i;break;case"not_equal":s=e!=i;break;case"less":s=e<i;break;case"greater":s=e>i;break;case"less_or_equal":s=e<=i;break;case"greater_or_equal":s=e>=i;break;default:s=this.queryFieldValid(e,t,i)}return s}listValid(e,t,i){let s=!1;switch(Array.isArray(i)||(i=[i]),t){case"equals":e&&(s=i.indexOf(e)>-1);break;case"not_equal":s=!e||i.indexOf(e)<0;break;default:s=this.queryFieldValid(e,t,i)}return s}booleanValid(e,t,i){let s=!1;switch(t){case"checked":s=1==e||e>0||"true"==e;break;case"unchecked":s=0==e||e<=0||"false"==e||null==e;break;default:s=this.queryFieldValid(e,t,i)}return s}userValid(e,t,i){if(!e)return!1;let s=!1;switch(t){case"is_current_user":s=e==this.Account.username;break;case"is_not_current_user":s=e!=this.Account.username;break;case"contain_current_user":i=this.Account.username;case"equals":Array.isArray(e)||(e=[e]),s=e.filter((e=>(e.username||e)==i)).length>0;break;case"not_contain_current_user":i=this.Account.username;case"not_equal":Array.isArray(e)||(e=[e]),s=e.filter((e=>(e.username||e)==i)).length<1;break;default:s=this.queryFieldValid(e,t,i)}return s}queryFieldValid(e,t,i){let s=!1;if(!i)return s;const n=i.split(":")[0],a=i.split(":")[1],r=this.AB.queries((e=>e.id==n))[0];if(!r)return s;if(!r.fields((e=>e.id==a))[0])return s;let o="{idBase}-query-field-{id}".replace("{idBase}",this.idBase).replace("{id}",r.id),l=new this.constructor(o,this.AB);switch(l.Account=this.Account,l.fieldsLoad(r.fields()),l.setValue(r.workspaceFilterConditions),t){case"in_query_field":s=l.isValid(e);break;case"not_in_query_field":s=!l.isValid(e)}return s}inQueryValid(e,t,i){let s=!1;if(!i||!this.AB)return s;let n=this.AB.queries((e=>e.id==i))[0];if(!n)return s;let a="{idBase}-query-{id}".replace("{idBase}",this.idBase).replace("{id}",n.id),r=new this.constructor(a,this.AB);switch(r.Account=this.Account,r.fieldsLoad(n.fields()),r.setValue(n.workspaceFilterConditions),t){case"in_query":s=r.isValid(e);break;case"not_in_query":s=!r.isValid(e)}return s}dataCollectionValid(e,t,i){let s=!1;if(!i)return s;let n=this.AB.datacollections((e=>e.id==i))[0];switch(t){case"in_data_collection":if(!n)return!1;s=n.getData((t=>t.id==e.id)).length>0;break;case"not_in_data_collection":if(!n)return!0;s=n.getData((t=>t.id==e.id)).length<1}return s}connectFieldValid(e,t,i,s){let a=t.relationName(),r="";if(e)if(e[a])r=((t.indexField?e[a][t.indexField.columnName]:null)??(t.indexField2?e[a][t.indexField2.columnName]:null)??e[a].id??e[a]).toString().toLowerCase();else{let i=n(e,t);null!=i&&(r=i)}"object"==typeof r&&(r=r[t.indexField.columnName]??r[t.indexField2.columnName]??r[t.columnName]??r);let o="string"==typeof s?s.toLowerCase?.():s;switch(i){case"contains":return r.toString().indexOf(o)>-1;case"not_contains":return-1==r.toString().indexOf(o);case"equals":return r==o;case"not_equal":return r!=o;case"in_query":case"not_in_query":return this.inQueryValid(e[a],i,s);case"is_current_user":case"is_not_current_user":case"contain_current_user":case"not_contain_current_user":return this.userValid(r,i,s);case"is_empty":return null==e[a]||e[a].length<1||""==e[a];case"is_not_empty":return null!=e[a]&&(Array.isArray(e[a])&&e[a].length>0||""!=e[a]);case"in_data_collection":case"not_in_data_collection":return this.dataCollectionValid(r,i,s)}}thisObjectValid(e,t,i){let s=null,n=null,a=null,r=null;switch(t){case"in_query":case"not_in_query":return!!this._Object&&(s=this.AB.queries((e=>e.id==i))[0],!!s&&(n=s.objects((e=>e.id==this._Object.id)),n.length>1?(console.error("HEY!  Can't compare this_object to a query that has > 1 copy of that object!"),!0):(a=s.objectAlias(this._Object.id),r={},Object.keys(e).forEach((t=>{r[`${a}.${t}`]=e[t]})),this.inQueryValid(r,t,i))));case"in_data_collection":case"not_in_data_collection":return this.dataCollectionValid(e,t,i)}}processFieldsLoad(e=[]){e&&!Array.isArray(e)&&(e=[e]),this._ProcessFields=e,this.uiInit()}fieldsLoad(e=[],t=null){if(this._Fields=e.filter((e=>e&&e.fieldIsFilterable&&e.fieldIsFilterable())),this._QueryFields=this._Fields?this._Fields.filter((e=>e&&e.isConnection&&"user"!=e.key)):[],t){this._Object=t;let e={id:"this_object",label:t.label,key:"uuid"};t.viewName&&(e.alias="BASE_OBJECT"),this._Fields.unshift(e)}else delete this._Object}fieldsToQB(){return(this._Fields||[]).map((e=>{let t=e.label;this._settings.showObjectName&&e.object&&e.object.label&&(t=`${e.object.label}.${e.label}`);let i="text",s=[],n=[],a=!0;if(this._settings.isProcessParticipant)switch(e.key){case"connectObject":case"uuid":a=!1}else switch(e.key){case"boolean":s=s.concat(this.fieldsAddFiltersBoolean(e)),n=["boolean"];break;case"connectObject":s=this.fieldsAddFiltersConnectObject(e),("one"==e.settings.linkType&&"many"==e.settings.linkViaType||"one"==e.settings.linkType&&"one"==e.settings.linkViaType&&e.settings.isSource)&&(s=this.fieldsAddFiltersString(e).filter((t=>e.settings.isCustomFK||"is_empty"==t.id||"is_not_empty"==t.id)).concat(s)),a=!1,n=["connectObject"];break;case"date":case"datetime":i="date",s=s.concat(this.fieldsAddFiltersDate(e)),n=["date","datetime"];break;case"calculate":case"formula":case"number":i="number",s=s.concat(this.fieldsAddFiltersNumber(e)),n=["calculate","formula","number"];break;case"string":case"LongText":case"email":case"AutoIndex":s=s.concat(this.fieldsAddFiltersString(e)),n=["string","LongText","email","AutoIndex"];break;case"list":s=s.concat(this.fieldsAddFiltersList(e));break;case"user":s=s.concat(this.fieldsAddFiltersUser(e)),n=["user"];break;case"uuid":s=s.concat(this.fieldsAddFiltersThisObject(e)),a=!1}return s=s.concat(this.fieldsAddFiltersQuery(e,a)),this._settings.isRecordRule&&(s=s.concat(this.fieldsAddFiltersRecordRule(e))),(this._ProcessFields||[]).filter((t=>{if(!t)return!1;if(t.field)return n.includes(t.field.key);if(t.key){let i=t.key.split(".").pop();return i==e.id||i==e.key}})).length>0&&(s=s.concat(this.fieldsAddFiltersContext(e))),s=s.concat(this.fieldsAddFiltersCustom(e)),{id:e.id,value:t,type:i,conditions:s}}))}fieldsAddFiltersDate(e){let t={less:this.labels.component.beforeCondition,greater:this.labels.component.afterCondition,less_or_equal:this.labels.component.onOrBeforeCondition,greater_or_equal:this.labels.component.onOrAfterCondition,less_current:this.labels.component.beforeCurrentCondition,greater_current:this.labels.component.afterCurrentCondition,less_or_equal_current:this.labels.component.onOrBeforeCurrentCondition,greater_or_equal_current:this.labels.component.onOrAfterCurrentCondition,last_days:this.labels.component.onLastDaysCondition,next_days:this.labels.component.onNextDaysCondition},i=[];for(let e in t)i.push({id:e,value:t[e],batch:"datepicker",handler:(t,i)=>this.dateValid(t,e,i)});return i}fieldsAddFiltersString(e){let t={contains:{batch:"text",label:this.labels.component.containsCondition},not_contains:{batch:"text",label:this.labels.component.notContainsCondition},equals:{batch:"text",label:this.labels.component.isCondition},not_equal:{batch:"text",label:this.labels.component.isNotCondition},is_empty:{batch:"none",label:this.labels.component.isEmpty},is_not_empty:{batch:"none",label:this.labels.component.isNotEmpty}},i=[];for(let e in t)i.push({id:e,value:t[e].label,batch:t[e].batch,handler:(t,i)=>this.textValid(t,e,i)});return i}fieldsAddFiltersNumber(e){let t={equals:this.labels.component.equalCondition,not_equal:this.labels.component.notEqualCondition,less:this.labels.component.lessThanCondition,greater:this.labels.component.moreThanCondition,less_or_equal:this.labels.component.lessThanOrEqualCondition,greater_or_equal:this.labels.component.moreThanOrEqualCondition},i=[];for(let e in t)i.push({id:e,value:t[e],batch:"text",handler:(t,i)=>this.numberValid(t,e,i)});return i}fieldsAddFiltersList(e){let t={equals:this.labels.component.equalListCondition,not_equal:this.labels.component.notEqualListCondition},i=[];for(let e in t)i.push({id:e,value:t[e],batch:"list",handler:(t,i)=>this.listValid(t,e,i)});return i}fieldsAddFiltersBoolean(e){let t={checked:this.labels.component.checkedCondition,unchecked:this.labels.component.notCheckedCondition},i=[];for(let e in t)i.push({id:e,value:t[e],batch:"none",handler:(t,i)=>this.booleanValid(t,e,i)});return i}fieldsAddFiltersUser(e){let t={is_current_user:{batch:"none",label:this.labels.component.isCurrentUserCondition},is_not_current_user:{batch:"none",label:this.labels.component.isNotCurrentUserCondition},contain_current_user:{batch:"none",label:this.labels.component.containsCurrentUserCondition},not_contain_current_user:{batch:"none",label:this.labels.component.notContainsCurrentUserCondition},equals:{batch:"user",label:this.labels.component.equalListCondition},not_equal:{batch:"user",label:this.labels.component.notEqualListCondition}},i=[];for(let e in t)i.push({id:e,value:t[e].label,batch:t[e].batch,handler:(t,i)=>this.userValid(t,e,i)});return i}fieldsAddFiltersConnectObject(e){const t={same_as_user:{batch:"user",label:this.labels.component.sameAsUser,handler:(e,t)=>this.userValid(e,"same_as_user",t)},not_same_as_user:{batch:"user",label:this.labels.component.notSameAsUser,handler:(e,t)=>this.userValid(e,"not_same_as_user",t)},in_data_collection:{batch:"datacollection",label:this.labels.component.inDataCollection,handler:(e,t)=>this.dataCollectionValid(e,"in_data_collection",t)},not_in_data_collection:{batch:"datacollection",label:this.labels.component.notInDataCollection,handler:(e,t)=>this.dataCollectionValid(e,"not_in_data_collection",t)}},i=[];for(let e in t)i.push({id:e,value:t[e].label,batch:t[e].batch,handler:t[e].handler});return i}fieldsAddFiltersQuery(e,t=!1){const i=t?{in_query_field:{label:this.labels.component.inQueryField,batch:"queryField"},not_in_query_field:{label:this.labels.component.notInQueryField,batch:"queryField"}}:{in_query:{label:this.labels.component.inQuery,batch:"query"},not_in_query:{label:this.labels.component.notInQuery,batch:"query"}},s=[];for(const e in i)s.push({id:e,value:i[e].label,batch:i[e].batch,handler:(t,i)=>this.queryFieldValid(t,e,i)});return s}fieldsAddFiltersThisObject(e){let t={in_data_collection:{batch:"datacollection",label:this.labels.component.inDataCollection},not_in_data_collection:{batch:"datacollection",label:this.labels.component.notInDataCollection}},i=[];for(let e in t)i.push({id:e,value:t[e].label,batch:t[e].batch,handler:(t,i)=>this.thisObjectValid(t,e,i)});return i}fieldsAddFiltersRecordRule(e){let t={same_as_field:this.labels.component.sameAsField,not_same_as_field:this.labels.component.notSameAsField},i=[];for(let e in t)i.push({id:e,value:t[e],batch:"recordRule",handler:(e,t)=>!0});return i}fieldsAddFiltersContext(e){let t={context_equals:{batch:"context",label:this.labels.component.equalsProcessValue,handler:(e,t)=>e==t},context_not_equal:{batch:"context",label:this.labels.component.notEqualsProcessValueCondition,handler:(e,t)=>e!=t},context_in:{batch:"context",label:this.labels.component.inProcessValueCondition,handler:(e,t)=>e.indexOf(t)>-1},context_not_in:{batch:"context",label:this.labels.component.notInProcessValueCondition,handler:(e,t)=>-1==e.indexOf(t)}},i=[];for(let e in t)i.push({id:e,value:t[e].label,batch:t[e].batch,handler:t[e].handler});return i}fieldsAddFiltersCustom(e){return((this._customOptions??{})[e.id||e]??{}).conditions??[]}queriesLoad(e=[]){this._Queries=e}queries(e=(()=>!0)){return(this._Queries??this.AB?.queries?.()??[]).filter((t=>e(t)))}setValue(e){this.condition=e||{},this.condition.rules=this.condition.rules||[]}getValue(){return void 0===this.condition.glue&&(this.condition.glue="and"),this.condition}isComplete(){let e=!0;const t=["is_current_user","is_not_current_user","contain_current_user","not_contain_current_user","same_as_user","not_same_as_user","is_empty","is_not_empty","checked","unchecked"],i=(s=[])=>{0!=e&&s.forEach((s=>{s?.rules&&Array.isArray(s?.rules)?i(s?.rules):e=e&&null!=s?.key&&""!=s?.key&&null!=s?.rule&&""!=s?.rule&&(null!=s?.value&&""!=s?.value||t.indexOf(s?.rule)>-1)}))};return i(this.condition?.rules),e}}},87674:(e,t,i)=>{const s=i(52174);function n(e,t,i=!0){if(!t)return null;if(!t.columnName)return null;e&&e[0]&&(e=e[0]);let s=t.id,n=t.columnName,a=null;if(n.indexOf(".")>-1){let t=n.split(".")[1];a=e[n]||e[t]||e[s]}else a=e[n]||e[s];if(a)return a;for(var r in e){var o=r.split(".")[1];!o||o!=s&&o!=n||(a=e[r])}return a&&Array.isArray(a)&&(a=a.filter((e=>null!=e)),i&&(a=a[0])),a}e.exports=class extends s{constructor(e,t,i){super(e,t=t||"ab_row_filter",i),this.Account={username:"??"},this._settings={},this.config_settings={},this._QueryFields=[],this._Fields;var s=this._logic={callbacks:{onChange:()=>{}},getValue:()=>this.config_settings,removeHtmlTags:function(e){let t="";try{let i=document.createElement("div");i.innerHTML=e,t=i.textContent||i.innerText||""}catch(i){t=(e||"").replace(/(<([^>]+)>)/gi,"")}return t},textValid:function(e,t,i,a){var r=!1,o=n(e,t);null==o&&(o=""),o=o.toString().trim().toLowerCase(),o=s.removeHtmlTags(o);var l=(a=a.toString().trim().toLowerCase().replace(/  +/g," ")).split(" ");switch(i){case"contains":l.forEach((e=>{0==r&&(r=o.indexOf(e)>-1)}));break;case"not_contains":r=!0,l.forEach((e=>{1==r&&(r=o.indexOf(e)<0)}));break;case"equals":l.forEach((e=>{0==r&&(r=o==e)}));break;case"not_equal":r=!0,l.forEach((e=>{1==r&&(r=o!=e)}));break;case"is_empty":r=null==o||""==o;break;case"is_not_empty":r=null!=o&&""!=o;break;default:r=s.queryValid(e,i,a)}return r},dateValid:function(e,t,i,a){var r=!1,o=n(e,t);switch(o instanceof Date||(o=new Date(o)),a instanceof Date||(a=new Date(a)),i){case"equals":r=o==a;break;case"not_equal":r=o!=a;break;case"less":r=o<a;break;case"greater":r=o>a;break;case"less_or_equal":r=o<=a;break;case"greater_or_equal":r=o>=a;break;default:r=s.queryValid(e,i,a)}return r},numberValid:function(e,t,i,a){var r=!1,o=n(e,t);switch(o=Number(o),a=Number(a),i){case"equals":r=o==a;break;case"not_equal":r=o!=a;break;case"less":r=o<a;break;case"greater":r=o>a;break;case"less_or_equal":r=o<=a;break;case"greater_or_equal":r=o>=a;break;default:r=s.queryValid(e,i,a)}return r},listValid:function(e,t,i,a){var r=!1,o=n(e,t);switch(o&&o.toLowerCase&&(o=o.toLowerCase()),a=a.toLowerCase(),Array.isArray(a)||(a=[a]),i){case"equals":o&&(r=a.indexOf(o)>-1);break;case"not_equal":r=!o||a.indexOf(o)<0;break;default:r=s.queryValid(e,i,a)}return r},booleanValid:function(e,t,i,a){var r=!1,o=n(e,t);switch(null==o&&(o=!1),i){case"equals":r=o==a;break;case"not_equal":r=o!=a;break;default:r=s.queryValid(e,i,a)}return r},userValid:(e,t,i,a)=>{var r=!1,o=n(e,t);switch(i){case"is_current_user":r=o==this.Account.username;break;case"is_not_current_user":r=o!=this.Account.username;break;case"contain_current_user":if(!o){r=!1;break}Array.isArray(o)||(o=[o]),r=(o||[]).filter((e=>!!e&&(e.username||e.id||e.text||e)==this.Account.username)).length>0;break;case"not_contain_current_user":if(!o){r=!1;break}Array.isArray(o)||(o=[o]),r=0==(o||[]).filter((e=>!!e&&(e.username||e.id||e.text||e)==this.Account.username)).length;break;case"equals":r=o.indexOf(a)>-1;break;case"not_equal":r=o.indexOf(a)<0;break;default:r=s.queryValid(e,i,a)}return r},queryValid:(e,i,s)=>{var n=!1;if(!this.AB||!s)return n;var a=s.split(":")[0],r=s.split(":")[1],o=this.queries((e=>e.id==a))[0];if(!o)return n;if(!o.fields((e=>e.id==r))[0])return n;let l="{idBase}-query-field-{id}".replace("{idBase}",t).replace("{id}",o.id),c=new this.constructor(this.App,l);switch(c.Account=this.Account,c.fieldsLoad(o.fields()),c.setValue(o.workspaceFilterConditions),i){case"in_query_field":n=c.isValid(e);break;case"not_in_query_field":n=!c.isValid(e)}return n},inQueryValid:(e,i,s,n)=>{let a=!1;if(i&&(e=e[i]||{}),!n||!this.AB)return a;let r=this.queries((e=>e.id==n))[0];if(!r)return a;let o="{idBase}-query-{id}".replace("{idBase}",t).replace("{id}",r.id),l=new this.constructor(this.App,o);switch(l.Account=this.Account,l.fieldsLoad(r.fields()),l.setValue(r.workspaceFilterConditions),s){case"in_query":a=l.isValid(e);break;case"not_in_query":a=!l.isValid(e)}return a},dataCollectionValid:(e,t,i,s)=>{var n=!1;if(!s||!this.AB)return n;t&&(e=e[t]||{});let a=this.AB.datacollectionByID(s);switch(i){case"in_data_collection":if(!a)return!1;n=a.getData((t=>(t.id||t.uuid)==(e.id||e.uuid))).length>0;break;case"not_in_data_collection":if(!a)return!0;n=a.getData((t=>(t.id||t.uuid)==(e.id||e.uuid))).length<1}return n},connectFieldValid:function(e,t,i,a){let r=t.relationName(),o="";if(e)if(e[r])o=(!!t.indexField&&e[r][t.indexField.columnName]||!!t.indexField2&&e[r][t.indexField2.columnName]||e[r].id||e[r]).toString().toLowerCase();else{let i=n(e,t);null!=i&&(o=i,"object"==typeof o&&(o=t.datasourceLink.displayData(o)))}let l=(a||"").toLowerCase();switch(i){case"contains":return o.toString().indexOf(l)>-1;case"not_contains":return-1==o.toString().indexOf(l);case"equals":return o==l;case"not_equal":return o!=l;case"in_query":case"not_in_query":return s.inQueryValid(e,r,i,a);case"is_current_user":case"is_not_current_user":case"contain_current_user":case"not_contain_current_user":return s.userValid(e,t,i,a);case"is_empty":return null==e[r]||e[r].length<1||""==e[r];case"is_not_empty":return null!=e[r]&&(Array.isArray(e[r])&&e[r].length>0||""!=e[r]);case"in_data_collection":case"not_in_data_collection":return s.dataCollectionValid(e,r,i,a)}},thisObjectValid:(e,t,i)=>{switch(t){case"in_query":case"not_in_query":if(!this.AB||!this._Object)return!1;var n=this.queries((e=>e.id==i))[0];if(!n)return!1;if(n.objects((e=>e.id==this._Object.id)).length>1)return console.error("HEY!  Can't compare this_object to a query that has > 1 copy of that object!"),!0;var a=n.objectAlias(this._Object.id),r={};return Object.keys(e).forEach((t=>{r[`${a}.${t}`]=e[t]})),s.inQueryValid(r,null,t,i);case"in_data_collection":case"not_in_data_collection":return s.dataCollectionValid(e,null,t,i)}}};this.getValue=s.getValue}init(e){e.showObjectName&&(this._settings.showObjectName=e.showObjectName)}isValid(e){var t=this.config_settings,i=this._logic;if(null==t||null==t.rules||0==t.rules.length)return!0;if(null==e)return!1;var s="and"===t.glue;return t.rules.forEach((n=>{if(n?.key&&n?.rule){var a=this._Fields.filter((e=>e.id==n.key))[0];if(a){var r,o=a.key;switch(void 0===a.key&&("this_object"!=a.id?(a.key="connectField",o=a.key):o="this_object"),o){case"string":case"LongText":case"email":r=i.textValid(e,a,n.rule,n.value);break;case"date":case"datetime":r=i.dateValid(e,a,n.rule,n.value);break;case"number":case"formula":r=i.numberValid(e,a,n.rule,n.value);break;case"list":r=i.listValid(e,a,n.rule,n.value);break;case"boolean":r=i.booleanValid(e,a,n.rule,n.value);break;case"user":r=i.userValid(e,a,n.rule,n.value);break;case"connectField":case"connectObject":r=i.connectFieldValid(e,a,n.rule,n.value);break;case"this_object":r=i.thisObjectValid(e,n.rule,n.value)}s="and"===t.glue?s&&r:s||r}}})),s}fieldsLoad(e=[],t=null){if(this._Fields=e.filter((e=>e?.fieldIsFilterable?.())),this._QueryFields=this._Fields?this._Fields.filter((e=>e&&e.isConnection&&"user"!=e.key)):[],t){this._Object=t;let e={id:"this_object",label:t.label};t.viewName&&(e.alias="BASE_OBJECT"),this._Fields.unshift(e)}else delete this._Object}queriesLoad(e=[]){this._Queries=e}queries(e=(()=>!0)){let t=[];return this.AB&&(t=t.concat(this.AB.queries(e))),this._Queries&&(t=t.concat((this._Queries||[]).filter((i=>e(i)&&t.filter((e=>e.id==i.id)).length<1)))),t}setValue(e){this.config_settings=e||{},this.config_settings.rules=this.config_settings.rules||[]}}},374:(e,t,i)=>{const s=i(34117);function n(e,t){return t}const a={key:"AutoIndex",description:"Auto Increment Value",icon:"key",isFilterable:!0,isSortable:!0,menuName:"Auto Index",supportRequire:!1,supportUnique:!1,useAsLabel:!0,compatibleOrmTypes:["number"],compatibleMysqlTypes:["tinyint","smallint","mediumint","int","integer"]},r={prefix:"",delimiter:"none",displayLength:4,previewText:"0000"};e.exports=class extends s{constructor(e,t){super(e,t,a)}static defaults(){return a}static defaultValues(){return r}static getDelimiterSign(e){const t=this.delimiterList().filter((t=>t.id==e))[0];return t?t.sign:""}static delimiterList(){return[{id:"none",value:n(),sign:""},{id:"comma",value:n(),sign:", "},{id:"slash",value:n(),sign:"/"},{id:"space",value:n(),sign:" "},{id:"dash",value:n(),sign:"-"},{id:"colon",value:n(),sign:":"}]}static setValueToIndex(e,t,i,s){return e+this.getDelimiterSign(t)+("0000000000"+s).slice(-parseInt(i))}fromValues(e){super.fromValues(e),this.settings.displayLength=parseInt(this.settings.displayLength)}defaultValue(e){delete e[this.columnName]}format(e){if(!e?.[this.columnName])return"";try{return this.constructor.setValueToIndex(this.settings.prefix,this.settings.delimiter,this.settings.displayLength,e[this.columnName])}catch(e){return""}}}},85410:(e,t,i)=>{const s=i(34117),n={key:"boolean",description:"A single checkbox that can be checked or unchecked.",icon:"check-square-o",isFilterable:!0,isSortable:!1,menuName:"Checkbox",supportRequire:!0,supportUnique:!1,useAsLabel:!0,compatibleOrmTypes:["boolean"],compatibleMysqlTypes:["bool","boolean"]},a={default:0};e.exports=class extends s{constructor(e,t){super(e,t,n)}static defaults(){return n}static defaultValues(){return a}fromValues(e){super.fromValues(e),null!=this.settings.default&&(this.settings.default=parseInt(this.settings.default))}defaultValue(e){null==e[this.columnName]&&null!=this.settings.default&&(e[this.columnName]=this.settings.default)}}},88238:(module,__unused_webpack_exports,__webpack_require__)=>{const ABField=__webpack_require__(34117);function L(e,t){return t}function AGE(e){if(!e)return 0;const t=new Date(e);if(!t)return 0;const i=(new Date-t)/31536e6;return i<1?Math.round(10*i)/10:Math.floor(i)}function YEAR(e){if(!e)return 0;const t=new Date(e);return t?t.getFullYear():0}function MONTH(e){if(!e)return 0;const t=new Date(e);return t?t.getMonth():0}function DAY(e){if(!e)return 0;const t=new Date(e);return t?t.getDate():0}function DATE(e){if(!e)return 0;const t=new Date(e);return t?Math.round(t.getTime()/864e5):0}function HOUR(e){if(!e)return 0;const t=new Date(e);return t?Math.round(t.getTime()/36e5):0}function MINUTE(e){if(!e)return 0;const t=new Date(e);return t?Math.round(t.getTime()/6e4):0}function MINUTE_TO_HOUR(e){const t=e/60,i=Math.floor(t),s=60*(t-i),n=Math.round(s);return parseFloat(`${i}.${n}`)}const ABFieldCalculateDefaults={key:"calculate",description:"Perform a calculation based upon existing values",icon:"calculator",isFilterable:e=>0==["MINUTE_TO_HOUR","DATE","HOUR","MINUTE"].filter((t=>e.settings.formula.includes(t))).length,isSortable:!1,menuName:"Calculate",supportRequire:!1,supportUnique:!1,useAsLabel:!0,compatibleOrmTypes:["number"],compatibleMysqlTypes:["tinyint","smallint","mediumint","int","integer","bigint","decimal","dec","numeric","fixed","float","real"]},defaultValues={formula:"",decimalSign:"none",decimalPlaces:0};module.exports=class ABFieldCalculateCore extends ABField{constructor(e,t){super(e,t,ABFieldCalculateDefaults)}static defaults(){return ABFieldCalculateDefaults}static defaultValues(){return defaultValues}static convertToJs(object,formula,rowData,place,alias=null){return formula?(formula=formula.replace(/\(CURRENT\)/g,"(new Date())"),object.fields().forEach((e=>{let t=e.columnName;if(t.indexOf(".")>-1&&(t=t.split(".")[1]),formula.indexOf("{"+t+"}")<0)return;const i=rowData[`${object.alias??alias}.${e.columnName}`]??rowData[e.columnName];if("number"==e.key){const e=`(${i||0})`;formula=formula.replace(new RegExp("{"+t+"}","g"),e)}else if("calculate"==e.key||"formula"==e.key){let i=e.format(rowData)||0;"string"==typeof i&&(i=i.replace(/[^-0-9.]/g,"")),i=`(${i})`,formula=formula.replace(new RegExp("{"+t+"}","g"),i)}else if("date"==e.key||"datetime"==e.key){const e=`"${i||""}"`;formula=formula.replace(new RegExp("{"+t+"}","g"),e)}else if("boolean"==e.key){const e=`(${i||0})`;formula=formula.replace(new RegExp("{"+t+"}","g"),e)}})),eval(formula).toFixed(place||0)):""}defaultValue(e){delete e[this.columnName]}format(e){let t=0;"none"!=this.settings.decimalSign&&(t=this.settings.decimalPlaces);try{let i=this.constructor.convertToJs(this.object,this.settings.formula,e,t,this.alias);switch("string"==typeof i&&(i=i.replace(/[^-0-9.]/g,"")),this.settings.decimalSign){case"comma":i=i.replace(".",",");break;case"space":i=i.replace("."," ")}return i}catch(e){return""}}}},72131:(e,t,i)=>{const s=i(34117),n={key:"combined",description:"Combined Value",icon:"key",isFilterable:!0,isSortable:!1,menuName:"Combined Field",supportRequire:!1,supportUnique:!1,useAsLabel:!0,compatibleOrmTypes:["string"],compatibleMysqlTypes:["text","mediumtext","longtext"]},a={combinedFields:"",delimiter:"plus"};e.exports=class extends s{constructor(e,t){super(e,t,n)}static defaults(){return n}static defaultValues(){return a}fromValues(e){super.fromValues(e),this.settings.delimiter=e.settings.delimiter||a.delimiter}defaultValue(e){delete e[this.columnName]}}},63800:(e,t,i)=>{var s=i(34117);const n={key:"connectObject",description:"Connect two data objects together",icon:"external-link",isFilterable:!0,isSortable:e=>["one:many","one:one"].indexOf(`${e?.settings?.linkType}:${e?.settings?.linkViaType}`)>-1,menuName:"Connect to another record",supportRequire:!1,supportUnique:!1,useAsLabel:!1,compatibleOrmTypes:["string"],compatibleMysqlTypes:["char","varchar","tinytext"]},a={linkObject:"",linkType:"one",linkViaType:"many",linkColumn:"",isSource:null,isCustomFK:0,indexField:"",indexField2:""};e.exports=class extends s{constructor(e,t,i=n){super(e,t,i),this.isConnection=!0}static defaults(){return n}static defaultValues(){return a}fromValues(e){super.fromValues(e),this.settings.isSource=parseInt(this.settings.isSource||0),this.settings.isCustomFK=parseInt(this.settings.isCustomFK||0)}defaultValue(){}isValidData(e,t){super.isValidData(e,t)}relationName(){if(this.columnName.indexOf(".")>-1){const e=this.columnName.split(".");return`${e[0]}.${this.AB.rules.toFieldRelationFormat(e[1])}`}return this.AB.rules.toFieldRelationFormat(this.columnName)}get datasourceLink(){const e=this.AB.objectByID(this.settings.linkObject);if(!e){const e=new Error(`ConnectField[${this.label}][${this.id}] unable to find linkObject[${this.settings.linkObject}]`);this.AB.notify.builder(e,{field:this,linkObject:this.settings.linkObject})}return e}get fieldLink(){const e=this.datasourceLink;if(!e)return null;const t=e.fieldByID(this.settings.linkColumn);if(!t){const e=new Error(`ConnectField[${this.label}][${this.id}] unable to find linkColumn[${this.settings.linkColumn}]`);this.AB.notify.builder(e,{field:this,linkColumn:this.settings.linkColumn})}return t}pullRelationValues(e){let t;const i=this.datasourceLink;let s=this.dataValue(e);if(s&&i){if("string"==typeof s)try{s=JSON.parse(s)}catch(e){t=s}t=s}return t}dataValue(e){if(null==e)return"";const t=`${this.object.name}.${this.relationName()}`;return e[this.relationName()]||e[t]||e[this.columnName]||""}format(e){const t=this.pullRelationValues(e),i=this.datasourceLink;return Array.isArray(t)?t.map((e=>null==e.text?i.displayData(e)||"":e.text||"")).join(", "):t?null==t.text?i.displayData(e)||"":t.text?t.text||"":void 0:""}linkType(){return this.settings.linkType}linkViaType(){return this.settings.linkViaType}isSource(){return this.settings.isSource}get indexField(){if(!this.settings.isCustomFK||!this.settings.indexField)return null;const e=`${this.settings.linkType}:${this.settings.linkViaType}`;if("one:many"===e)return this.datasourceLink.fieldByID(this.settings.indexField);if("one:one"===e)return this.settings.isSource?this.datasourceLink.fieldByID(this.settings.indexField):this.object.fieldByID(this.settings.indexField);if("many:one"===e)return this.object.fieldByID(this.settings.indexField);if("many:many"===e){let e=this.object.fieldByID(this.settings.indexField);return null==e&&(e=this.datasourceLink.fieldByID(this.settings.indexField)),e}return null}get indexField2(){if(!this.settings.isCustomFK||!this.settings.indexField2)return null;let e;return"many"==this.settings.linkType&&"many"==this.settings.linkViaType&&(e=this.object.fieldByID(this.settings.indexField2),null==e&&(e=this.datasourceLink.fieldByID(this.settings.indexField2))),e}getRelationValue(e,t={}){if(null==e)return;let i;const s=this.indexField,n=this.datasourceLink,a=`${this.settings.linkType}:${this.settings.linkViaType}`;if("many:many"===a){const e=this.indexField2;s&&s.object.id==n.id?i=s.columnName:e&&e.object.id==n.id&&(i=e.columnName)}else s&&("one:many"===a||"one:one"===a&&this.settings.isSource)?i=s.columnName:"many:one"===a?i=t.forUpdate?n.PK():s?s.columnName:this.fieldLink.columnName:n&&(i=n.PK());let r=e[i]||e[this.object?.PK()]||e.id||e;return"id"==i&&(r=parseInt(r)),r}}},34493:(e,t,i)=>{const s=i(70504);e.exports=class extends s{constructor(e,t,i){super(["label"],t.AB),this.defaults=i||{},this.object=t,this.fromValues(e)}static get reservedNames(){return["id","created_at","updated_at","properties","createdAt","updatedAt"]}static defaultValues(){return{}}fieldKey(){return this.defaults.key}fieldOrmTypes(){return this.defaults.compatibleOrmTypes?Array.isArray(this.defaults.compatibleOrmTypes)?this.defaults.compatibleOrmTypes:[this.defaults.compatibleOrmTypes]:[]}fieldMysqlTypes(){return this.defaults.compatibleMysqlTypes?Array.isArray(this.defaults.compatibleMysqlTypes)?this.defaults.compatibleMysqlTypes:[this.defaults.compatibleMysqlTypes]:[]}fieldIcon(){return this.defaults.icon}fieldMenuName(){return this.defaults.menuName}fieldDescription(){return this.defaults.description}fieldIsFilterable(){return null!=this.defaults.isFilterable?"function"==typeof this.defaults.isFilterable?this.defaults.isFilterable(this):this.defaults.isFilterable:1}fieldIsSortable(){return null!=this.defaults.isSortable?"function"==typeof this.defaults.isSortable?this.defaults.isSortable(this):this.defaults.isSortable:1}fieldUseAsLabel(){return null!=this.defaults.useAsLabel?"function"==typeof this.defaults.useAsLabel?this.defaults.useAsLabel(this):this.defaults.useAsLabel:1}fieldSupportRequire(){return!this.defaults.supportRequire||this.defaults.supportRequire}fieldSupportQuery(){return null==this.defaults.supportQuery||("function"==typeof this.defaults.supportQuery?this.defaults.supportQuery(this):this.defaults.supportQuery)}toObj(){const e=super.toObj();return{id:this.id,type:this.type||"field",key:this.key,icon:this.icon,isImported:this.isImported,columnName:this.columnName,settings:this.settings,translations:e.translations}}defaultCheck(e,t){let i=t;return void 0!==e&&(i=e),i}fromValues(e){this.id||(this.id=e.id),this.type,e.type,this.key=e.key||this.fieldKey(),this.icon=e.icon||this.fieldIcon(),e.settings=e.settings||{},this.label=e.label||e.settings.label||"?label?",this.columnName=e.columnName||"",this.isImported=e.isImported||0,this.settings=e.settings,this.settings.showIcon=this.defaultCheck(e.settings.showIcon,"1"),this.settings.required=this.defaultCheck(e.settings.required,"0"),this.settings.width=this.defaultCheck(e.settings.width,"0"),this.isImported=parseInt(this.isImported),this.settings.showIcon=parseInt(this.settings.showIcon),this.settings.required=parseInt(this.settings.required),this.settings.unique=parseInt(this.settings.unique||0),this.settings.width=parseInt(this.settings.width);const t=this.constructor.defaultValues()||{};for(const i in t)this.settings[i]=this.defaultCheck(e.settings[i],t[i]);super.fromValues(e),this.columnName=this.columnName||this.label,this.columnName=this.columnName.replace(/[^a-zA-Z0-9_ ]/gi,"")}urlPointer(){return this.object.urlField()+this.id}defaultValue(e){e[this.columnName]=""}isValidData(e,t){!this.settings.required||null!=e[this.columnName]&&""!=e[this.columnName]||0==e[this.columnName]||t.addError(this.columnName,"This is a required field.")}get isMultilingual(){return!1}dataValue(e){const t=`${this.alias||this.object.name}.${this.columnName}`;let i="";return null!=e?.[this.columnName]?i=e[this.columnName]:null!=e?.[t]&&(i=e[t]),i}format(e){return e?this.dataValue(e):""}toDefinition(){const e=super.toDefinition();return""==e.name&&(e.name=e.json.name||e.json.label||e.json.columnName),this.object&&this.object.name&&(e.name=`${this.object.name}->${e.name}`),e}}},36009:(e,t,i)=>{const s=i(34117);function n(e,t){return t}const a={key:"date",description:"Pick one from a calendar.",icon:"calendar",isFilterable:!0,isSortable:!0,menuName:"Date",supportRequire:!0,supportUnique:!1,useAsLabel:!0,compatibleOrmTypes:["date"],compatibleMysqlTypes:["date"]},r={dateFormat:2,defaultDate:1,defaultDateValue:null,validateCondition:"none",validateRangeUnit:"days",validateRangeBefore:0,validateRangeAfter:0,validateStartDate:null,validateEndDate:null};e.exports=class extends s{constructor(e,t,i=a){super(e,t,i)}static defaults(){return a}static defaultValues(){return r}fromValues(e){super.fromValues(e),this.settings.dateFormat=parseInt(this.settings.dateFormat),this.settings.defaultDate=parseInt(this.settings.defaultDate)}defaultValue(e){if(null!=e[this.columnName])return;let t;2==this.settings.defaultDate?t=new Date:3==this.settings.defaultDate&&this.settings.defaultDateValue&&(t=new Date(this.settings.defaultDateValue)),null!=t&&(e[this.columnName]=this.AB.rules.toDateFormat(t,{format:"YYYY-MM-DD"}))}isValidData(e,t){if(super.isValidData(e,t),e[this.columnName]){let i=e[this.columnName];if(i instanceof Date||(i=this.AB.rules.toDate(i)),"[object Date]"===Object.prototype.toString.call(i)&&isFinite(i)){let s=!0;if(this.settings&&this.settings.validateCondition){const e=this.settings.validateStartDate?new Date(this.settings.validateStartDate):null,a=this.settings.validateEndDate?new Date(this.settings.validateEndDate):null,r=this.getDateDisplay(e),o=this.getDateDisplay(a),l=this.AB.rules.subtractDate(new Date,this.settings.validateRangeBefore,this.settings.validateRangeUnit),c=this.AB.rules.addDate(new Date,this.settings.validateRangeAfter,this.settings.validateRangeUnit);switch(this.settings.validateCondition){case"dateRange":l<i&&i<c?s=!0:(s=!1,t.addError(this.columnName,n(0,[this.getDateDisplay(l),this.getDateDisplay(c)])));break;case"between":e<i&&i<a?s=!0:(s=!1,t.addError(this.columnName,n(0,[r,o])));break;case"notBetween":i<e&&a<i?s=!0:(s=!1,t.addError(this.columnName,n(0,[r,o])));break;case"=":s=i.getTime&&e.getTime&&i.getTime()==e.getTime(),s||t.addError(this.columnName,n(0,[r]));break;case"<>":s=i.getTime&&e.getTime&&i.getTime()!=e.getTime(),s||t.addError(this.columnName,n(0,[r]));break;case">":s=i.getTime&&e.getTime&&i.getTime()>e.getTime(),s||t.addError(this.columnName,n(0,[r]));break;case"<":s=i.getTime&&e.getTime&&i.getTime()<e.getTime(),s||t.addError(this.columnName,n(0,[r]));break;case">=":s=i.getTime&&e.getTime&&i.getTime()>=e.getTime(),s||t.addError(this.columnName,n(0,[r]));break;case"<=":s=i.getTime&&e.getTime&&i.getTime()<=e.getTime(),s||t.addError(this.columnName,n(0,[r]))}}s&&(e[this.columnName]=this.exportValue(i))}else t.addError(this.columnName,"Should be a Date!")}}format(e){const t=this.dataValue(e);if(""==t||null==t)return"";const i=this.AB.rules.toDate(t);return this.getDateDisplay(i)}getFormat(){let e="";switch(this.settings&&this.settings.dateFormat?this.settings.dateFormat:""){case 2:default:e="%d/%m/%Y";break;case 3:e="%m/%d/%Y";break;case 4:e="%M %d, %Y";break;case 5:e="%d %M, %Y"}return e}getDateDisplay(e){const t=this.getFormat();return this.dateToString(t,e)}exportValue(e){return e?this.AB.rules.toDateFormat(e,{format:"YYYY-MM-DD"}):""}dateToString(e,t){return t&&t.toString?t.toString():""}},e.exports.RegEx="^[0-9]{4}-[0-9]{2}-[0-9]{2}$"},32965:(e,t,i)=>{const s=i(36009),n={key:"datetime",description:"Pick one from date & time.",icon:"clock-o",isFilterable:!0,isSortable:!1,menuName:"Date & Time",supportRequire:!0,supportUnique:!1,useAsLabel:!0,compatibleOrmTypes:["datetime"],compatibleMysqlTypes:["datetime"]},a={timeFormat:2,defaultTime:1,defaultTimeValue:null};e.exports=class extends s{constructor(e,t){super(e,t,n)}static defaults(){return n}static defaultValues(){const e=super.defaultValues();return Object.assign(e,a)}fromValues(e){super.fromValues(e),this.settings.timeFormat=parseInt(this.settings.timeFormat),this.settings.defaultTime=parseInt(this.settings.defaultTime)}defaultValue(e){if(null!=e[this.columnName])return;let t;if(super.defaultValue(e),e[this.columnName]&&(t=this.AB.rules.toDate(e[this.columnName])),2==this.settings.defaultTime){const e=new Date;null==t&&(t=new Date),t.setHours(e.getHours()),t.setMinutes(e.getMinutes()),t.setSeconds(e.getSeconds()),t.setMilliseconds(e.getMilliseconds())}else if(3==this.settings.defaultTime&&this.settings.defaultTimeValue){const e=new Date(this.settings.defaultTimeValue);null==t&&(t=new Date),t.setHours(e.getHours()),t.setMinutes(e.getMinutes()),t.setSeconds(e.getSeconds()),t.setMilliseconds(e.getMilliseconds())}null!=t&&(e[this.columnName]=t.toISOString())}getFormat(){const e=this.getTimeFormat();return this.settings=this.settings||{},1==this.settings.dateFormat?e:`${super.getFormat()} ${e}`}format(e){const t=this.getFormat(),i=this.dataValue(e),s=this.AB.rules.toDate(i);return""==i||null==i?"":webix.Date.dateToStr(t)(s)}getTimeFormat(){switch(this.settings=this.settings||{},this.settings.timeFormat){case 2:return" %h:%i %A";case 3:return" %H:%i";default:return""}}exportValue(e){return e?.toISOString?.()??""}},e.exports.RegEx="^[0-9]{4}-[0-9]{2}-[0-9]{2} [0-9]{2}:[0-9]{2}:[0-9]{2}$"},95905:(e,t,i)=>{const s=i(34117),n={key:"email",description:"Email fields are used to store email addresses.",icon:"envelope",isFilterable:!0,isSortable:!1,menuName:"Email",supportRequire:!0,supportUnique:!0,useAsLabel:!0,compatibleOrmTypes:["string"],compatibleMysqlTypes:["char","varchar","tinytext"]},a={default:"",defaultCheckbox:0};e.exports=class extends s{constructor(e,t){super(e,t,n)}static defaults(){return n}static defaultValues(){return a}fromValues(e){super.fromValues(e),this.settings.default=e.settings.default||""}defaultValue(e){e[this.columnName]||this.settings.default&&(e[this.columnName]=this.settings.default)}isValidData(e,t){if(e[this.columnName]){const i=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;let s=e[this.columnName];s=String(s).toLowerCase(),i.test(s)||t.addError(this.columnName,"Invalid email")}}}},34921:(e,t,i)=>{const s=i(34117),n={key:"file",description:"Attach a File to this object.",icon:"file",isFilterable:!1,isSortable:!1,menuName:"File Attachment",supportRequire:!1,supportUnique:!1,useAsLabel:!1,compatibleOrmTypes:["string"],compatibleMysqlTypes:["char","varchar","tinytext"]},a={removeExistingData:0,fileSize:0,fileType:""};e.exports=class extends s{constructor(e,t){super(e,t,n)}static defaults(){return n}static defaultValues(){return a}fromValues(e){super.fromValues(e),this.settings.fileSize=parseInt(this.settings.fileSize),this.settings.limitFileSize=parseInt(this.settings.limitFileSize),this.settings.limitFileType=parseInt(this.settings.limitFileType),this.settings.removeExistingData=parseInt(this.settings.removeExistingData)}dataValue(e){const t=`${this.alias||this.object.name}.${this.columnName}`;let i=e[this.columnName]||e[t]||{};if("string"==typeof i)try{i=JSON.parse(i)}catch(e){}return i}defaultValue(e){e[this.columnName]="{}"}format(e){let t=this.dataValue(e);if(t){if("string"==typeof t)try{t=JSON.parse(t)}catch(e){}return t&&t.filename||""}return""}requestParam(e){const t=super.requestParam(e);let i=t?.[this.columnName];if("{}"!=i&&""!=i||delete t[this.columnName],"string"==typeof i)try{t[this.columnName]=JSON.parse(i)}catch(e){}return t}}},75193:(e,t,i)=>{const s=i(34117),n={key:"formula",description:"Perform a calculation by a formula type based upon existing values",icon:"circle-o-notch",isFilterable:!0,isSortable:!1,menuName:"Formula",supportQuery:e=>{const t=e.fieldLink;return null!=t&&"calculate"!==t.key},supportRequire:!1,supportUnique:!1,useAsLabel:!1,compatibleOrmTypes:["number"],compatibleMysqlTypes:["tinyint","smallint","mediumint","int","integer","bigint","decimal","dec","numeric","fixed","float","real"]},a={field:"",objectLink:"",fieldLink:"",type:"sum",where:""};e.exports=class extends s{constructor(e,t){super(e,t,n)}static defaults(){return n}static defaultValues(){return a}defaultValue(e){delete e[this.columnName]}format(e,t=!1,i=!1){const s=this.fieldLink,n=e=>{if(s&&"calculate"!=s.key){const t={};return t[s.columnName]=e,s.format(t)}return e};if(null!=e[this.columnName]&&!t&&!i)return n(e[this.columnName]);if(null!=e[this.columnName]&&!t&&i)return e[this.columnName];if(!s)return 0;const a=this.fieldBase();if(!a)return 0;let r=e[a.relationName()]||e[a.columnName]||[];Array.isArray(r)||(r=[r]),r&&r.length&&this.settings&&this.settings.where&&this.settings.where.rules&&this.settings.where.rules.length&&(this.filterHelper.setValue(this.settings.where),r=r.filter((e=>this.filterHelper.isValid(e))));let o=[];switch(s.key){case"calculate":r.forEach((e=>{o.push(parseFloat(s.format(e)||0))}));break;case"number":o=r.map((e=>e[s.columnName]||0))}let l=0;const c=s.getDecimalSize();switch(this.settings.type){case"sum":if(o.length>0){const e=Math.pow(10,c);let t=0;o.forEach((i=>{t+=i*e||0})),l=t/e}break;case"average":if(o.length>0){const e=Math.pow(10,c);let t=0;o.forEach((i=>{t+=i*e||0})),l=t/e/o.length}break;case"max":l=Math.max(...o)||0;break;case"min":l=Math.min(...o)||0;break;case"count":l=o.length}return e[this.columnName]=l,"calculate"==s.key?l:n(l)}fieldBase(){return this.object.fieldByID(this.settings.field)}get fieldLink(){const e=this.AB.objectByID(this.settings.object);if(!e)return null;return e.fieldByID(this.settings.fieldLink)||null}get filterHelper(){return null==this._rowFilter&&(this._rowFilter=this.AB.filterComplexNew(`${this.id}_filterComplex`),this.fieldLink&&this.fieldLink.object&&(this._rowFilter.fieldsLoad(this.fieldLink.object.fields()),this._rowFilter.setValue(this.settings.where))),this._rowFilter}}},93355:(e,t,i)=>{const s=i(34117),n={key:"image",description:"Attach an image to this object.",icon:"file-image-o",isFilterable:!1,isSortable:!1,menuName:"Image Attachment",supportRequire:!1,supportUnique:!1,useAsLabel:!1,compatibleOrmTypes:["string"],compatibleMysqlTypes:["char","varchar","tinytext"]},a={useWidth:0,imageWidth:"",useHeight:0,imageHeight:"",removeExistingData:0,useDefaultImage:!1,defaultImageUrl:""};e.exports=class extends s{constructor(e,t){super(e,t,n)}static defaults(){return n}static defaultValues(){return a}fromValues(e){super.fromValues(e),this.settings.useWidth=parseInt(this.settings.useWidth),this.settings.useHeight=parseInt(this.settings.useHeight),this.settings.imageWidth=parseInt(this.settings.imageWidth),this.settings.imageHeight=parseInt(this.settings.imageHeight),this.settings.useDefaultImage=parseInt(this.settings.useDefaultImage),this.settings.removeExistingData=parseInt(this.settings.removeExistingData)}isValidData(e,t){super.isValidData(e,t)}}},97972:(e,t,i)=>{const s=i(34117),n={key:"json",description:"JSON value",icon:"font",isFilterable:!1,isSortable:!1,menuName:"JSON",supportRequire:!1,supportUnique:!1,useAsLabel:!0,compatibleOrmTypes:["json"],compatibleMysqlTypes:["json"]},a={};e.exports=class extends s{constructor(e,t){super(e,t,n)}static defaults(){return n}static defaultValues(){return a}defaultValue(e){}}},86430:(e,t,i)=>{const s=i(34117),n={key:"list",description:"Select list allows you to select predefined options below from a dropdown.",icon:"th-list",isFilterable:e=>!e.settings.isMultiple,isSortable:e=>!e.settings.isMultiple,menuName:"Select list",supportRequire:!0,supportUnique:!1,useAsLabel:!0,compatibleOrmTypes:["string"],compatibleMysqlTypes:["char","varchar","tinytext"],hasColors:e=>!!e.settings.hasColors},a={isMultiple:0,hasColors:0,options:[],default:"none",multipleDefault:[]};e.exports=class extends s{constructor(e,t){super(e,t,n),this.pendingDeletions=[]}static defaults(){return n}static defaultValues(){return a}fromValues(e){super.fromValues(e),this.settings.options&&this.settings.options.length>0&&this.settings.options.forEach((e=>{this.translate(e,e,["text"])})),this.settings.isMultiple=parseInt(this.settings.isMultiple),this.settings.hasColors=parseInt(this.settings.hasColors)}toObj(){const e=super.toObj();return e.settings.options.forEach((e=>{this.unTranslate(e,e,["text"])})),e}defaultValue(e){if(1==this.settings.isMultiple){let t=[];this.settings.multipleDefault.forEach((e=>{this.settings.options.forEach((i=>{i.id==e.text&&t.push(i)}))})),e[this.columnName]=t||[]}else this.settings.default&&""!=this.settings.default&&(e[this.columnName]=this.settings.default)}isValidData(e,t){super.isValidData(e,t)}options(){return this.settings.options.map((e=>({id:e.id,text:e.text,hex:e.hex?e.hex:"",translations:e.translations?e.translations:""})))}format(e,t={}){let i=this.dataValue(e)||[];if("string"==typeof i)try{i=JSON.parse(i)}catch(e){}return Array.isArray(i)||(i=[i]),this.settings.options.filter((e=>i.filter((t=>(t.id||t)==e.id)).length>0)).map((e=>{let i=e.text;const s=t.languageCode||"en",n=(e.translations||[]).filter((e=>e.language_code==s))[0];return n&&(i=n.text),i})).join(", ")}}},81213:(e,t,i)=>{const s=i(34117),n={key:"LongText",description:"Multiple lines of text",icon:"align-right",isFilterable:!0,isSortable:!1,menuName:"Long text",supportRequire:!0,supportUnique:!1,useAsLabel:!0,compatibleOrmTypes:["longtext","mediumtext","text"],compatibleMysqlTypes:["text","mediumtext","longtext"],MAX_CHAR_LENGTH:5e3},a={default:"",supportMultilingual:0};e.exports=class extends s{constructor(e,t){super(e,t,n)}static defaults(){return n}static defaultValues(){return a}fromValues(e){super.fromValues(e),this.settings.default=e.settings.default||"",this.settings.supportMultilingual=e.settings.supportMultilingual+""||a.supportMultilingual,this.settings.supportMultilingual=parseInt(this.settings.supportMultilingual),this.settings.supportMultilingual?this.object&&this.object.translate(this.settings,this.settings,["default"]):this.settings.default=e.settings.default||""}toObj(){const e=super.toObj();return this.settings.supportMultilingual&&(this.object?this.object.unTranslate(e.settings,e.settings,["default"]):e.settings.default=this.settings.default),e}get isMultilingual(){return 1==this.settings.supportMultilingual}defaultValue(e){null==e[this.columnName]&&("string"==typeof this.settings.default?e[this.columnName]=this.settings.default:e[this.columnName]="")}isValidData(e,t){super.isValidData(e,t),e&&e[this.columnName]&&e[this.columnName].length>5e3&&t.addError(this.columnName,"should NOT be longer than 5000 characters")}}},42686:(e,t,i)=>{const s=i(34117),n={key:"number",description:"A Float or Integer Value",icon:"hashtag",isFilterable:!0,isSortable:!0,menuName:"Number",supportRequire:!0,supportUnique:!0,useAsLabel:!0,compatibleOrmTypes:["number"],compatibleMysqlTypes:["tinyint","smallint","mediumint","int","integer","bigint","decimal","dec","numeric","fixed","float","real"]},a={default:"",typeFormat:"none",typeDecimals:"none",typeDecimalPlaces:0,typeRounding:"none",typeThousands:"none",validation:0,validateMinimum:"",validateMaximum:""};let r=null;e.exports=class extends s{constructor(e,t){super(e,t,n),r||(r=this.AB.Label())}static defaults(){return n}static defaultValues(){return a}static formatList(e){return e&&!r&&(r=e),[{id:"none",value:r("None")},{id:"dollar",value:r("$"),sign:"$",position:"prefix"},{id:"yen",value:r(""),sign:"",position:"prefix"},{id:"pound",value:r(""),sign:"",position:"prefix"},{id:"euroBefore",value:r(" (before)"),sign:"",position:"prefix"},{id:"euroAfter",value:r(" (after)"),sign:"",position:"postfix"},{id:"percent",value:r("%"),sign:"%",position:"postfix"}]}static delimiterList(){return[{id:"none",value:r("None")},{id:"comma",value:r("Comma"),sign:","},{id:"period",value:r("Period"),sign:"."},{id:"space",value:r("Space"),sign:" "}]}fromValues(e){super.fromValues(e),this.settings.validation=parseInt(this.settings.validation)}defaultValue(e){""!=this.settings.default&&(e[this.columnName]=this.settings.default)}isValidData(e,t){if(super.isValidData(e,t),null!=e[this.columnName]&&""!=e[this.columnName]){let s=e[this.columnName];if("none"==this.settings.typeDecimals)s=parseInt(s);else{const e=parseInt(this.settings.typeDecimalPlaces)||2;s=parseFloat(parseFloat(s).toFixed(e))}if(i=s,!Number.isNaN(parseFloat(i))&&Number.isFinite(i)||t.addError(this.columnName,r("invalid number")),1==this.settings.validation&&null!=this.settings.validateMinimum&&this.settings.validateMinimum>s){const e=r("should be greater than {0}",[this.settings.validateMinimum]);t.addError(this.columnName,e)}if(1==this.settings.validation&&null!=this.settings.validateMaximum&&this.settings.validateMaximum<s){const e=r("should be less than {0}",[this.settings.validateMaximum]);t.addError(this.columnName,e)}}var i}format(e){if(null==e?.[this.columnName]||0!=e[this.columnName]&&""==e[this.columnName])return"";let t=e[this.columnName]||0;"string"==typeof t&&(t=t.replace(/,/g,"")),isNaN(parseFloat(t))&&(t=0);const i=this.constructor.formatList().filter((e=>e.id==this.settings.typeFormat))[0],s="none"!=this.settings.typeDecimalPlaces?parseInt(this.settings.typeDecimalPlaces):0;let n=this.constructor.delimiterList().filter((e=>e.id==this.settings.typeThousands))[0],a=this.constructor.delimiterList().filter((e=>e.id==this.settings.typeDecimals))[0],r="",o="";if(i&&i.sign)switch(i.position){case"prefix":r=i.sign;break;case"postfix":o=i.sign}if(a=a.sign||"",n=n.sign||"","roundDown"==this.settings.typeRounding){const e=Math.pow(10,s);t=Math.floor(t*e)/e}return`${r} ${this.formatNumber(t,{groupDelimiter:n,groupSize:3,decimalDelimiter:a,decimalSize:s})} ${o}`}formatNumber(e,t={}){if(""===e||null==e)return e;const i=(e=parseFloat(e))<0?"-":"",s=(e=Math.abs(e)).toString(),n=s.split(".")[0],a=s.split(".")[1];let r="";if(t.groupDelimiter){const e=3;let i=n.length;do{i-=e,r=`${i>0?n.substr(i,e):n.substr(0,e+i)}${r?t.groupDelimiter+r:""}`}while(i>0)}else r=n;let o=`${i}${r}`;if(a&&t.decimalDelimiter&&t.decimalSize){const i=e.toFixed(t.decimalSize).split(".")[1];o+=`${t.decimalDelimiter}${i}`}return o}getDecimalSize(){return"none"!=this.settings.typeDecimalPlaces?parseInt(this.settings.typeDecimalPlaces):0}}},5254:(e,t,i)=>{const s=i(34117),n={key:"string",description:"short string value",icon:"font",isFilterable:!0,isSortable:!0,menuName:"Single line text",supportRequire:!0,supportUnique:!1,useAsLabel:!0,compatibleOrmTypes:["string"],compatibleMysqlTypes:["char","varchar","tinytext"],MAX_CHAR_LENGTH:255},a={default:"",supportMultilingual:0};e.exports=class extends s{constructor(e,t){super(e,t,n)}static defaults(){return n}static defaultValues(){return a}fromValues(e){super.fromValues(e),this.settings.default=e.settings.default||a.default,this.settings.supportMultilingual=e.settings.supportMultilingual+""||a.supportMultilingual,this.settings.supportMultilingual=parseInt(this.settings.supportMultilingual),this.settings.supportMultilingual?this.translate(this.settings,this.settings,["default"]):this.settings.default=e.settings.default||""}toObj(){const e=super.toObj();return this.settings.supportMultilingual?this.unTranslate(e.settings,e.settings,["default"]):e.settings.default=this.settings.default,e}defaultValue(e){e[this.columnName]||this.settings.default&&(this.settings.default.indexOf("{uuid}")>=0?e[this.columnName]=this.AB.uuid():e[this.columnName]=this.settings.default)}isValidData(e,t){if(super.isValidData(e,t),e?.[this.columnName]?.length>255){const e=this.AB.Label();t.addError(this.columnName,e("should NOT be longer than {0} characters",[255]))}}get isMultilingual(){return 1==this.settings.supportMultilingual}}},35756:(module,__unused_webpack_exports,__webpack_require__)=>{const ABField=__webpack_require__(34117);function L(e,t){return t}const ABFieldTextFormulaDefaults={key:"TextFormula",description:"Text Formula",icon:"question",isFilterable:!1,isSortable:!1,menuName:"Text Formula",supportRequire:!1,supportUnique:!1,useAsLabel:!0,compatibleOrmTypes:["string"],compatibleMysqlTypes:["text","mediumtext","longtext"]},defaultValues={textFormula:""};function setValueToFormula(object,formulaString,rowData){if(!formulaString)return;const fieldRegExp=/{[^{}]+}/gm,matches_field_array=formulaString.match(fieldRegExp);return matches_field_array.forEach((element=>{const columnName=element.replace(/{|}|"/g,"");object.fields().forEach((field=>{if(field.columnName==columnName)if("AutoIndex"==field.key){const e=field.format(rowData)||0;formulaString=formulaString.replace(element,e)}else if("calculate"==field.key){const calVal=`(${field.format(rowData)||0})`;formulaString=formulaString.replace(element,eval(calVal))}else formulaString="date"==field.key?formulaString.replace(element,rowData[columnName]?field.exportValue(rowData[columnName]):""):formulaString.replace(element,rowData[columnName]?field.format(rowData):"")}))})),formulaString}function setBuildinValueToFormula(e,t){const i=t.match(/\w+\(.*?\)/gm);if(i){const s=getBuildInFunction();i.forEach((i=>{const n=i.split(/\(|\)/),a=n.length>2&&""!=n[2],r=n[0],o=n[1].split(",");let l=!1;for(let n=0;n<s.length;n++){let c=i;if(r==s[n].id){if(o.length==s[n].parameter_size){switch(r){case"left":c=getLeft(o[0],o[1]);break;case"right":c=getRight(o[0],o[1]);break;case"mid":c=getMid(o[0],o[1],o[2]);break;case"trim":c=getTrim(o[0]);break;case"trimLeft":c=getTrimLeft(o[0]);break;case"trimRight":c=getTrimRight(o[0]);break;case"length":c=getLength(o[0]);break;case"regexReplace":c=getRegExpReplace(o[0],o[1].trimLeft(),o[2].trimLeft());break;case"extractRegex":c=getExtractRegex(o[0],o[1].trimLeft());break;case"replace":c=getReplace(o[0],o[1].trimLeft(),o[2].trimLeft());break;case"lower":c=getLower(o[0]);break;case"upper":c=getUpper(o[0]);break;case"capitalize":c=getCapitalize(o[0]);break;case"random":c=getRandom(o[0]);break;case"numberToWords":c=getNumberToWords(o[0]);break;case"getDateDayOfWeekName":a&&(i+=")"),c=getDateDayOfWeekName(e,o[0]);break;case"getDateMonthOfYearName":a&&(i+=")"),c=getDateMonthOfYearName(e,o[0]);break;case"formatDate":c=getFormatDate(o[0],o[1].trimLeft())}return l=!0,void(t=t.replace(i,c))}c=r+"(Bad Parameter)",t=t.replace(i,c)}}}))}return t}function getBuildInFunction(){return[{id:"left",value:"left({COLUMN_NAME}, 1)",type:"build-in",parameter_size:2},{id:"right",value:"right({COLUMN_NAME}, 1)",type:"build-in",parameter_size:2},{id:"mid",value:"mid({COLUMN_NAME}, 1, 1)",type:"build-in",parameter_size:3},{id:"trim",value:"trim({COLUMN_NAME})",type:"build-in",parameter_size:1},{id:"trimLeft",value:"trimLeft({COLUMN_NAME})",type:"build-in",parameter_size:1},{id:"trimRight",value:"trimRight({COLUMN_NAME})",type:"build-in",parameter_size:1},{id:"length",value:"length({COLUMN_NAME})",type:"build-in",parameter_size:1},{id:"regexReplace",value:"regexReplace({COLUMN_NAME}, [*], REPLACE_VALUE)",type:"build-in",parameter_size:3},{id:"extractRegex",value:"extractRegex({COLUMN_NAME}, [*])",type:"build-in",parameter_size:2},{id:"replace",value:"replace({COLUMN_NAME}, SEARCH_VALUE, REPLACE_VALUE)",type:"build-in",parameter_size:3},{id:"lower",value:"lower({COLUMN_NAME})",type:"build-in",parameter_size:1},{id:"upper",value:"upper({COLUMN_NAME})",type:"build-in",parameter_size:1},{id:"capitalize",value:"capitalize({COLUMN_NAME})",type:"build-in",parameter_size:1},{id:"random",value:"random(1)",type:"build-in",parameter_size:1},{id:"numberToWords",value:"numberToWords({NUMBER_COLUMN} or 012...)",type:"build-in",parameter_size:1},{id:"getDateDayOfWeekName",value:"getDateDayOfWeekName({DATE_COLUMN})",type:"build-in",parameter_size:1},{id:"getDateMonthOfYearName",value:"getDateMonthOfYearName({DATE_COLUMN})",type:"build-in",parameter_size:1},{id:"formatDate",value:"formatDate({DATE_COLUMN}, OUTPUT_FORMAT)",type:"build-in",parameter_size:2}]}function getLeft(e,t){return e.substring(0,parseInt(t))}function getRight(e,t){const i=reverseString(e).substring(0,parseInt(t));return reverseString(i)}function reverseString(e){return e.split(" ").reverse().join(" ")}function getMid(e,t,i){return e.length<t?"mid(Bad Parameter)":e.substring(parseInt(t),parseInt(t)+parseInt(i))}function getTrim(e){return e.trim()}function getTrimLeft(e){return e.trimLeft()}function getTrimRight(e){return e.trimRight()}function getLength(e){return e.length}function getRegExpReplace(e,t,i){return e.replace(t,i)}function getExtractRegex(e,t){const i=e.match(t);return Array.isArray(i)?i[0]:i}function getReplace(e,t,i){return e.replace(t,i)}function getLower(e){return e.toLowerCase()}function getUpper(e){return e.toUpperCase()}function getCapitalize(e){return e.toLowerCase().split(" ").map((e=>e.charAt(0).toUpperCase()+e.substring(1))).join(" ")}function getRandom(e){return Math.floor(Math.random()*(e+1))}function getNumberToWords(e){const t=e.trim(",").toString();let i,s,n,a,r,o,l,c,u,d,h,p;if(0===parseInt(t))return"zero";for(i=["","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],s=["","","twenty","thirty","forty","fifty","sixty","seventy","eighty","ninety"],n=["","thousand","million","billion","trillion","quadrillion","quintillion","sextillion","septillion","octillion","nonillion","decillion","undecillion","duodecillion","tredecillion","quatttuor-decillion","quindecillion","sexdecillion","septen-decillion","octodecillion","novemdecillion","vigintillion","centillion"],a=t.length,o=[];a>0;)r=a,o.push(t.slice(a=Math.max(0,a-3),r));if(l=o.length,l>n.length)return"";for(p=[],d=0;d<l;d++)c=parseInt(o[d]),c&&(u=o[d].split("").reverse().map(parseFloat),1===u[1]&&(u[0]+=10),(h=n[d])&&p.push(h),(h=i[u[0]])&&p.push(h),(h=s[u[1]])&&p.push(h),(u[0]||u[1])&&(u[2]||!d&&l)&&p.push(""),(h=i[u[2]])&&p.push(h+" hundred"));return p.reverse().join(" ")}function getDateDayOfWeekName(e,t){return e.rules.toDateFormat(t,{format:"dddd",localeCode:e.Account.language()})}function getDateMonthOfYearName(e,t){return e.rules.toDateFormat(t,{format:"MMMM",localeCode:e.Account.language()})}function getFormatDate(e,t){return new Date(e).toString(t)}module.exports=class extends ABField{constructor(e,t){super(e,t,ABFieldTextFormulaDefaults)}static defaults(){return ABFieldTextFormulaDefaults}static defaultValues(){return defaultValues}static getBuildInFunction(){return getBuildInFunction()}defaultValue(e){e[this.columnName]}isValidData(e,t){return super.isValid()}get isMultilingual(){return!1}format(e){try{if(!this.settings.textFormula)return"";let t=this.settings.textFormula;return t=setValueToFormula(this.object,t,e),t=setBuildinValueToFormula(this.AB,t),t}catch(e){return""}}}},8514:(e,t,i)=>{const s=i(53317),n={key:"tree",description:"Data tree allows you to build a hierarchical set of selectable data. (ex: Categories and sub-categories)",icon:"sitemap",isFilterable:!1,isSortable:!1,menuName:"Data Tree",supportRequire:!1,supportUnique:!1,useAsLabel:!1,compatibleOrmTypes:["string"],compatibleMysqlTypes:["text","mediumtext","longtext"]},a={options:[]};e.exports=class extends s{constructor(e,t){super(e,t,n)}static defaults(){return n}static defaultValues(){return a}fromValues(e){super.fromValues(e),this.settings.options&&this.settings.options.length>0&&this.settings.options.forEach((e=>{this.translate(e,e,["text"])}))}toObj(){const e=super.toObj();return e.settings.options&&e.settings.options.length>0&&e.settings.options.forEach((e=>{this.unTranslate(e,e,["text"])})),e}defaultValue(e){}isValidData(e,t){super.isValidData(e,t)}}},58706:(e,t,i)=>{const s=i(89981),n={key:"user",description:"Add users to a record.",icon:"user-o",isFilterable:!0,isSortable:e=>!e.settings.isMultiple,menuName:"User",supportRequire:!1,supportUnique:!1,useAsLabel:!0,compatibleOrmTypes:["string"],compatibleMysqlTypes:["char","varchar","tinytext"],USERNAME_FIELD_ID:"5760560b-c078-47ca-98bf-e18ac492a561"},a={editable:1,isMultiple:0,isCurrentUser:0,isShowProfileImage:0,isShowUsername:1};e.exports=class extends s{constructor(e,t){super(e,t,n)}static defaults(){return n}static defaultValues(){return a}fromValues(e){super.fromValues(e),this.settings.editable=parseInt(this.settings.editable),this.settings.isMultiple=parseInt(this.settings.isMultiple),this.settings.isCurrentUser=parseInt(this.settings.isCurrentUser),this.settings.isShowProfileImage=parseInt(this.settings.isShowProfileImage),this.settings.isShowUsername=parseInt(this.settings.isShowUsername)}format(e){let t=this.dataValue(e)||[];return t&&!Array.isArray(t)&&(t=[t]),t||(t=[]),t.map((e=>e.username||e)).join(", ")}}},73134:(e,t,i)=>{const s=i(94197),n={key:"mobile-page",icon:"file"},a={type:"page",defaultPage:0,hideTitle:0,hideTabs:0};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||n),this.parent=null}static common(){return n}static defaultValues(){return a}toObj(){var e=super.toObj();return e.name=this.name,e.route=this.route,e.myAppID=this.myAppID,e.menuType=this.menuType,e.defaultPage=this.defaultPage,"popup"==this.settings.type&&(e.icon="clone"),this.label&&"?label?"!=this.label||(e.label=e.name),e.pageIDs=(this._pages||[]).map((e=>e.id)),e}fromValues(e){super.fromValues(e);const t=a;this.route=e.route||(this.name||this.label).replaceAll(" ","_"),"popup"==e.settings.type&&(this.icon="clone"),this.label&&"?label?"!=this.label||(this.label=this.name),this.myAppID=e.myAppID,!this.myAppID&&this.application&&(this.myAppID=this.application.id),this.menuType=e.menuType||"menu",this.defaultPage=e.defaultPage||0,this.settings.hideTitle=parseInt(e.settings.hideTitle??t.hideTitle),this.settings.hideTabs=parseInt(e.settings.hideTabs??t.hideTabs);var i=[];(e.pageIDs||[]).forEach((e=>{var t=this.AB.definitionByID(e);t?i.push(this.pageNew(t)):this.emit("warning",`App[${this.application.name}][${this.application.id}]->Page[${this.name}][${this.id}] referenced an unknown Page[${e}]`,{appID:this.application.id,pageID:this.id,missingPageID:e})})),this._pages=i}destroy(){return Promise.resolve().then((()=>{var e=[],t=this.pages();return this._pages=[],t.forEach((t=>{e.push(t.destroy())})),Promise.all(e)})).then((()=>(this.parent||this.application).pageRemove(this))).then((()=>super.destroy()))}save(){return Promise.resolve().then((()=>super.save())).then((()=>(this.parent||this.application).pageInsert(this))).then((()=>{if(this.defaultPage)return this.application.setPageDefault(this)})).then((()=>this))}refreshInstance(){return console.warn("This version of ABMobilePage hasn't updated it's refreshInstance()",this),this}pages(e=(()=>!0),t=!1){return e&&t?this.application._searchDeep(this,"_pages",e):this._pages.filter(e)}pageInsert(e){return this.pages((t=>t.id===e.id)).length>0?Promise.resolve():(this._pages.push(e),this.save())}pageNew(e){e.key=n.key;var t=this.application.viewNew(e,this.application,null);return t.parent=this,t}pageRemove(e){var t=this._pages.length;return this._pages=this.pages((t=>t.id!=e.id)),this._pages.length<t?this.save():Promise.resolve()}updateIcon(e){return"popup"==e.settings.type?e.icon="clone":e.icon=n.icon,e}clone(e,t){if(null==e){e={};let t=i=>{e[i.id]||(e[i.id]=this.AB.uuid()),i.pages&&i.pages().forEach((e=>t(e))),i.views&&i.views().forEach((e=>t(e)))};t(this)}let i=super.clone(e,t);return i.name=null,i}copy(e,t,i){if(null==e){e={};let t=i=>{e[i.id]||(e[i.id]=this.AB.uuid()),i.pages&&i.pages().forEach((e=>t(e))),i.views&&i.views().forEach((e=>t(e)))};t(this)}return super.copy(e,t,i)}}},86501:(e,t,i)=>{var s=i(70504);const n={key:"mobile-view",icon:"window-maximize",labelKey:"view",tabicon:""},a={label:""};e.exports=class extends s{constructor(e,t,i,s){super(["label"],t.AB),this.__events=[],this.defaults=s||n,this.application=t,this.parent=i||null,this.warningsSilent=!1,this.__missingViews=[],this.fromValues(e)}static common(){return n}static defaultValues(){return a}static newInstance(e,t){return e.viewNew({key:this.common().key},e,t)}viewKey(){return this.defaults.key}viewIcon(){return this.defaults.icon}tabIcon(){return this.defaults.tabicon}toObj(){var e=super.toObj(),t={id:this.id,type:this.type||this.viewKey(),key:this.key,icon:this.icon,tabicon:this.tabicon,name:this.name,settings:this.AB.cloneDeep(this.settings||{}),translations:e.translations};return t.viewIDs=(this._views||[]).map((e=>e.id)).filter((e=>e)),t.viewIDs=t.viewIDs.concat(this.__missingViews),this.position&&(t.position=this.position),t.isRoot=this.isRoot(),t}fromValues(e){if(this.id=e.id,this.type=e.type||this.viewKey(),this.key=e.key||this.viewKey(),this.icon=e.icon||this.viewIcon(),this.tabicon=e.tabicon||this.tabIcon(),this.name=e.name,e.settings=e.settings||{},this.label=e.label||e.settings.label||"?label?",this.settings=e.settings||{},this.settings.height=parseInt(this.settings.height||0),super.fromValues(e),!this.name&&Array.isArray(this.translations))for(var t=0;t<this.translations.length;t++)if(0==t&&(this.name=this.translations[t].label),"en"==this.translations[t].language_code){this.name=this.translations[t].label;break}"?label?"==this.label&&this.parent&&(this.label=this.parent.label+"."+(this.field?.()?.columnName??this.defaults.key));var i=[];this.__missingViews=this.__missingViews||[],(e.viewIDs||[]).forEach((e=>{var t=this.AB.definitionByID(e);t?i.push(this.application.viewNew(t,this.application,this)):this.__missingViews.push(e)})),this._views=i,this.position=e.position||{},null!=this.position.x&&(this.position.x=parseInt(this.position.x)),null!=this.position.y&&(this.position.y=parseInt(this.position.y)),this.position.dx=parseInt(this.position.dx||1),this.position.dy=parseInt(this.position.dy||1)}isRoot(){return null==this.parent||this.parent==this.application}allParents(){var e=[],t=this;for(e.unshift(t);!t.isRoot()&&t.parent;)e.unshift(t.parent),t=t.parent;return e}parentFormComponent(){for(var e=null,t=this;"mobile-form"!=t.key&&!t.isRoot()&&t.parent;)t=t.parent;return"mobile-form"==t.key&&(e=t),e}parentDetailComponent(){for(var e=null,t=this;"mobile-detail"!=t.key&&!t.isRoot()&&t.parent;)t=t.parent;return"mobile-detail"==t.key&&(e=t),e}pageParent(e){if(null==e&&(e=()=>!0),this.isRoot())return this;for(var t=this.parent;t&&("mobile-page"!=t.key||!e(t));)t=t.parent;return t}pageRoot(){for(var e=this.pageParent();!e.isRoot();)e=e.pageParent();return e}get datacollection(){let e=(this.settings||{}).dataviewID;if(!e){if(["mobile-form","grid","line","area","bar","gantt","kanban"].indexOf(this.key)>-1){if("mobile-form"==this.key&&this._currentObject)return null;if(this.warningsSilent)return null;var t=new Error(`ABViewCore:get datacollection(): View[${this.key}] didn't define a dataviewID.`);this.AB.notify.builder(t,{view:this,settings:this.settings})}else-1==["button","label","mobile-page","tab","viewcontainer"].indexOf(this.key)&&console.warn(`TODO: figure out which ABView* require a .dataviewID: ${this.key}?`);return null}var i=this.AB.datacollectionByID(e);if(!i){var s=new Error(`MobileView[${this.label}][${this.id}] is unable to find associated DataCollection`);this.AB.notify.builder(s,{view:this,dataviewID:e})}return i}views(e=(()=>!0),t=!1){var i=[];return!this._views||this._views.length<1?i:i=e&&t?this.application._searchDeep(this,"_views",e):this._views.filter(e)}viewByID(e){return this.views((t=>t.id==e),!0)[0]}viewNew(e,t,i){return this.application.viewNew(e,t||this.application,i||this)}viewRemove(e){var t=this._views.length;return this._views=this.views((function(t){return t.id!=e.id})),this._views.length<t?this.save():Promise.resolve()}viewInsert(e){return this.views((function(t){return t.id==e.id})).length>0?Promise.resolve():(this._views.push(e),this.save())}viewReorder(e,t){var i=this._views.findIndex((t=>t.id==e));if(!(i<0))return this._views.splice(t,0,this._views.splice(i,1)[0]),this.save(!0)}destroy(){return this.eventClear(!0),Promise.resolve().then((()=>{var e=[],t=this.views();return this._views=[],t.forEach((t=>{e.push(t.destroy())})),Promise.all(e)})).then((()=>{if(this.parent&&!this.pages)return this.parent.viewRemove(this)})).then((()=>super.destroy())).then((()=>{this.emit("destroyed")}))}save(){return Promise.resolve().then((()=>super.save())).then((()=>{if(this.parent&&!this.pages)return this.parent.viewInsert(this)})).then((()=>this))}get wantsAdd(){return!1}eventAdd(e){if(e&&e.emitter&&e.listener){var t=this.__events.find((t=>t.emitter==e.emitter&&t.eventName==e.eventName));(!t||t.length<1)&&(this.__events.push({emitter:e.emitter,eventName:e.eventName,listener:e.listener}),e.emitter.on(e.eventName,e.listener))}}eventClear(e){e&&this.views().forEach((t=>{t.eventClear(e)})),this.__events&&this.__events.length>0&&this.__events.forEach((e=>{e.emitter.removeListener(e.eventName,e.listener)}))}clone(e,t,i={}){e=e||{};let s=this.toObj();["pages","views"].forEach((e=>{delete s[e]})),this.copyUpdateProperyList&&(this.copyUpdateProperyList()||[]).forEach((t=>{s&&s.settings&&(s.settings[t]=e[s.settings[t]])}));let n=this.viewNew(s,this.application,t);return n.id=null==t?null:e[n.id]||this.AB.uuid(),this.pages&&!i.ignoreSubPages&&(n._pages=[],this.pages().forEach((t=>{let s=t.clone(e,n,i);s.parent=n,n._pages.push(s)}))),this.views&&!i.ignoreSubViews&&(n._views=[],this.views().forEach((t=>{let s=t.clone(e,n,i);n._views.push(s)}))),n}copy(e,t,i={}){e=e||{};let s=this.toObj();["pageIDs","viewIDs"].forEach((e=>{delete s[e]})),this.copyUpdateProperyList&&(this.copyUpdateProperyList()||[]).forEach((t=>{s&&s.settings&&(s.settings[t]=e[s.settings[t]])}));let n=this.application.viewNew(s,this.application,t);return n.parent=t||this.parent,n.id=null==t?null:e[n.id]||this.AB.uuid(),"mobile-page"==this.key&&(n.name=i?.newName||`${n.name}_copied_${this.AB.uuid().slice(0,3)}`,n.label=i?.newName||`${n.label} (copied)`),Promise.resolve().then((()=>{var t=[];return this._pages&&!i.ignoreSubPages&&(n._pages=[],this.pages().forEach((s=>{s.isRoot()&&this.application._pages.push({id:e[s.id]}),t.push(s.copy(e,n,i).then((t=>{t.parent=n,this.application._pages=this.application._pages.filter((t=>t.id!=e[s.id])),n._pages.push(t)})))}))),Promise.all(t)})).then((()=>{var t=[];return this._views&&!i.ignoreSubViews&&(n._views=[],this.views().forEach((s=>{t.push(s.copy(e,n,i).then((e=>{n._views.filter((t=>t.id==e.id)).length<1&&n._views.push(e)})))}))),Promise.all(t)})).then((()=>n.save())).then((()=>n))}}},75864:(e,t,i)=>{const s=i(94197),n={includeSave:!0,saveLabel:"",includeCancel:!1,cancelLabel:"",includeReset:!1,resetLabel:"",afterCancel:null,alignment:"right",isDefault:!1},a={key:"mobile-button",icon:"square",labelKey:"button"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}toObj(){let e=[];return this.settings.saveLabel&&e.push("saveLabel"),this.settings.cancelLabel&&e.push("cancelLabel"),this.settings.resetLabel&&e.push("resetLabel"),this.unTranslate(this.settings,this.settings,e),super.toObj()}get datacollection(){return null}fromValues(e){super.fromValues(e);let t=[];this.settings.saveLabel&&t.push("saveLabel"),this.settings.cancelLabel&&t.push("cancelLabel"),this.settings.resetLabel&&t.push("resetLabel"),this.unTranslate(this.settings,this.settings,t),Object.keys(n).forEach((e=>{let t=this.settings[e]??n[e];try{t=JSON.parse(t)}catch(e){}this.settings[e]=t}))}}},95493:(e,t,i)=>{const s=i(21579),n={},a={key:"mobile-checkbox",icon:"check-square-o",labelKey:"checkbox"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}}},27140:(e,t,i)=>{const s=i(21579),n={formView:"",filterConditions:{glue:"and",rules:[]},sortFields:[],popupWidth:700,popupHeight:450},a={key:"mobile-connect",icon:"list-ul",labelKey:"Connect"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}fromValues(e){super.fromValues(e),this.settings.filterConditions=this.settings.filterConditions||n.filterConditions}}},11408:(e,t,i)=>{const s=i(94197),n=i(95652),a=i(17004),r={key:"mobile-form",icon:"list-alt",labelKey:"Form"},o={dataviewID:null,showLabel:!0,labelPosition:"left",labelWidth:120,height:200,clearOnLoad:!1,clearOnSave:!1,displayRules:[],editForm:"none",recordRules:[],submitRules:[]};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||r)}static common(){return r}static defaultValues(){return o}fromValues(e){super.fromValues(e),this.settings.labelPosition=this.settings.labelPosition||o.labelPosition,this.settings.showLabel=JSON.parse(null!=this.settings.showLabel?this.settings.showLabel:o.showLabel),this.settings.clearOnLoad=JSON.parse(null!=this.settings.clearOnLoad?this.settings.clearOnLoad:o.clearOnLoad),this.settings.clearOnSave=JSON.parse(null!=this.settings.clearOnSave?this.settings.clearOnSave:o.clearOnSave),this.settings.labelWidth=parseInt(null==this.settings.labelWidth?o.labelWidth:this.settings.labelWidth),this.settings.height=parseInt(null==this.settings.height?o.height:this.settings.height)}objectLoad(e){this._currentObject=e}componentList(){var e=["mobile-label","mobile-button","mobile-text"];return this.application.viewAll().filter((t=>e.indexOf(t.common().key)>-1))}fieldComponents(e){const t=e=>{let i=[];return e.forEach((e=>{null!=e&&(i.push(e),e._views?.length&&(i=i.concat(t(e._views))))})),i};return this._views?.length?(null==e&&(e=e=>e instanceof this.AB.Class.ABMobileViewFormItem),t(this._views).filter(e)):[]}addFieldToForm(e,t){if(null!=e){var i=e.formComponentMobile();if(null!=i){var s=i.newInstance(this.application,this);if(null!=s)return s.settings=s.settings||{},s.settings.fieldId=e.id,null!=t&&(s.position.y=t),this._views.push(s),s}}}get RecordRule(){let e=this.datacollection.datasource;return null==this._recordRule&&(this._recordRule=new n),this._recordRule.formLoad(this),this._recordRule.fromSettings(this.settings.recordRules),this._recordRule.objectLoad(e),this._recordRule}async recordRulesReady(){return this.RecordRule.rulesReady()}doRecordRulesPre(e){return this.RecordRule.processPre({data:e,form:this})}doRecordRules(e){return e&&!this.datacollection.datasource.isValidData(e).pass()?(console.error("Updated data is invalid.",{rowData:e}),Promise.reject(new Error("Updated data is invalid."))):this.RecordRule.process({data:e,form:this})}doSubmitRules(e){var t=this.datacollection.datasource,i=new a;return i.formLoad(this),i.fromSettings(this.settings.submitRules),i.objectLoad(t),i.process({data:e,form:this})}}},26720:(e,t,i)=>{const s=i(21579),n={},a={key:"mobile-fieldcustom",icon:"object-group",labelKey:"custom"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}}},382:(e,t,i)=>{const s=i(21579),n={timepicker:!1},a={key:"mobile-date",icon:"calendar",labelKey:"datepicker"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}}},26854:(e,t,i)=>{const s=i(21579),n={timepicker:!1},a={key:"mobile-datetime",icon:"calendar",labelKey:"Date and Time"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}}},73630:(e,t,i)=>{const s=i(21579),n={timepicker:!1},a={key:"mobile-email",icon:"envelope",labelKey:"Email"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}}},96453:(e,t,i)=>{const s=i(21579),n={},a={key:"mobile-file",icon:"file",labelKey:"file"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}}},21754:(e,t,i)=>{const s=i(21579),n={},a={key:"mobile-formula",icon:"circle-o-notch",labelKey:"Formula"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}}},33397:(e,t,i)=>{const s=i(57078),n={},a={key:"mobile-image",icon:"file-image-o",labelKey:"Image"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}}},62591:(e,t,i)=>{const s=i(94197),n={required:0,disable:0};e.exports=class extends s{static defaultValues(){return n}get datacollection(){let e=this.parentFormComponent();if(null==e)return null;let t=e.datacollection;return null==t?null:t}field(){if(this.settings.objectId){let e=this.AB.objectByID(this.settings.objectId);return e?e.fieldByID(this.settings.fieldId):null}{let e,t=this.parentFormComponent();if(null==t)return null;if(t._currentObject)e=t._currentObject;else{let i=t.datacollection;if(null==i)return null;e=i.datasource}return null==e?null:e.fieldByID(this.settings.fieldId)}}}},65407:(e,t,i)=>{const s=i(21579),n={isStepper:0},a={key:"mobile-numberbox",icon:"hashtag",labelKey:"number"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}toObj(){this.unTranslate(this,this,["label","formLabel"]);var e=super.toObj();return e.views=[],e}fromValues(e){super.fromValues(e),this.settings.isStepper=this.settings.isStepper||n.isStepper,this.settings.isStepper=parseInt(this.settings.isStepper)}}},42847:(e,t,i)=>{const s=i(54111),n={},a={key:"mobile-fieldreadonly",icon:"calculator",labelKey:"readonly"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}}},98438:(e,t,i)=>{const s=i(28131),n={type:"richselect"},a={key:"mobile-selectmultiple",icon:"list-ul",labelKey:"selectmultiple"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}}},61882:(e,t,i)=>{const s=i(21579),n={type:"richselect"},a={key:"mobile-selectsingle",icon:"list-ul",labelKey:"selectsingle"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}}},27200:(e,t,i)=>{const s=i(21579),n={type:"single",placeholder:""},a={key:"mobile-textbox",icon:"i-cursor",labelKey:"textbox"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}toObj(){return this.unTranslate(this.settings,this.settings,["placeholder"]),super.toObj()}fromValues(e){super.fromValues(e),this.unTranslate(this.settings,this.settings,["placeholder"])}}},52999:(e,t,i)=>{const s=i(94197),n={text:"",format:0,alignment:"left"},a={key:"mobile-label",icon:"font",labelKey:"Label"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}toObj(){this.unTranslate(this,this,["label","text"]);var e=super.toObj();return e.viewIDs=[],e}fromValues(e){super.fromValues(e),this.text=e.text||e.settings.text||"*text",this.settings.format=this.settings.format||n.format,this.settings.alignment=this.settings.alignment||n.alignment,this._views=[],this.settings.format=parseInt(this.settings.format),this.translate(this,this,["label","text"])}formatNormal(){this.settings.format=0}formatTitle(){this.settings.format=1}formatDescription(){this.settings.format=2}}},45334:(e,t,i)=>{const s=i(94197),n={dataviewID:null,field:null,height:0,hideTitle:0,hideTabs:0},a={key:"mobile-list",icon:"list-ul",labelKey:"List"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}componentList(){return[]}field(){var e=this.datacollection;if(!e)return null;var t=e.datasource;return t?t.fieldByID(this.settings.field):null}get wantsAdd(){return""!=this.settings.linkPageAdd}}},71506:(e,t,i)=>{const s=i(98618),n={type:"process.lane"};e.exports=class extends s{constructor(e,t,i){super(e,t,i)}static defaults(){return n}fromValues(e){super.fromValues(e),this.type=e.type||n.type}}},21500:(e,t,i)=>{const s=i(70504),n={type:"process.participant"};e.exports=class extends s{constructor(e,t,i){super(["label"],i),this.process=t,this.processID||(this.processID=t.id),this.fromValues(e)}static defaults(){return n}fromValues(e){function t(e){return void 0!==e&&null!=e}this.id=e.id,this.name=e.name||"",this.type=e.type||n.type,this.key=e.key||n.type,this.processID=e.processID||null,this.diagramID=e.diagramID||"?diagramID?",this.laneIDs=e.laneIDs||[],this.stashed=!1,e.stashed&&""!=e.stashed&&(this.stashed=e.stashed),this.useRole=0,t(e.useRole)&&(this.useRole=parseInt(e.useRole)),this.role=0,t(e.role)&&(this.role=e.role),this.useAccount=0,t(e.useAccount)&&(this.useAccount=parseInt(e.useAccount)),this.account=0,t(e.account)&&(this.account=e.account),this.useField=0,t(e.useField)&&(this.useField=parseInt(e.useField)),this.userField=[],t(e.userField)&&(this.userField=e.userField),this.fields=[],t(e.fields)&&(this.fields=e.fields),super.fromValues(e),this.label||(this.label=this.name)}toObj(){!this.label&&this.name&&""!=this.name&&(this.label=this.name);var e=super.toObj();return["id","name","type","processID","diagramID","laneIDs","where","useRole","role","useAccount","account","useField","userField","fields","stashed"].forEach((t=>{e[t]=this[t]})),e}onProcessReady(){}}},78949:(e,t,i)=>{var s={},n={},a=[i(39864),i(15372),i(93563),i(2353),i(97915),i(10727),i(3746),i(69305),i(21374),i(94417),i(17378),i(78320),i(39966),i(46146),i(31063),i(60986),i(19010),i(16642),i(39009)];a.forEach((e=>{switch(s[e.defaults().key]=e,e.defaults().category){case"start":case"end":n[e.DiagramReplace().target.eventDefinitionType]=e.defaults();break;case"gateway":case"task":n[e.DiagramReplace().target.type]=e.defaults()}})),e.exports={allTasks:function(){var e=[];for(var t in s)e.push(s[t]);return e},newTask:function(e,t,i){if(e.key)return new s[e.key](e,t,i)},DiagramReplaceDefinitionsForType:function(e){return a.filter((t=>t.defaults().category==e)).map((e=>e.DiagramReplace()))},StartEvents:function(){return this.DiagramReplaceDefinitionsForType("start")},Gateways:function(){return this.DiagramReplaceDefinitionsForType("gateway")},Tasks:function(){return this.DiagramReplaceDefinitionsForType("task")},EndEvents:function(){return this.DiagramReplaceDefinitionsForType("end")},definitionForElement:function(e){var t=null;if(e.businessObject.eventDefinitions){var i=e.businessObject.eventDefinitions[0];i&&(t=i.$type)}return t||(t=e.type),n[t]}}},43409:(e,t,i)=>{var s=i(70504);e.exports=class extends s{constructor(e,t,i,s){super(["label"],i),this.defaults=s||{key:"core",icon:"core"},this.fromValues(e),this.process=t,this.processID||(this.processID=t.id),this.state=null}fromValues(e){this.id=e.id,this.name=e.name||"",this.type=e.type||"process.task.unknown",this.key=e.key||this.defaults.key||"?key?",this.processID=e.processID||null,this.diagramID=e.diagramID||"?diagramID?",this.laneDiagramID=e.laneDiagramID||"?laneID?",this.defaults&&this.defaults.settings&&this.defaults.settings.forEach((t=>{void 0===e[t]?this[t]=null:this[t]=e[t]})),super.fromValues(e),this.label||(this.label=this.name)}toObj(){!this.label&&this.name&&""!=this.name&&(this.label=this.name);var e=super.toObj();return["id","name","type","processID","diagramID","laneDiagramID","key"].forEach((t=>{e[t]=this[t]})),this.defaults&&this.defaults.settings&&this.defaults.settings.forEach((t=>{e[t]=this[t]})),e}errorConfig(e,t,i=[]){this.log(e,t);var s=new Error(`${this.type}: ${t}`),n={task:this};return Array.isArray(i)||(i=[i]),i.forEach((e=>{n[e]=this[e]})),this.AB.notify.builder(s,n),Promise.reject(s)}initState(e,t,i){if(t=t||{},i||(i=t,t={},this.defaults&&this.defaults.instanceValues&&this.defaults.instanceValues.forEach((e=>{t[e]=null}))),e.taskState=e.taskState||{},!e.taskState[this.diagramID]){for(var s in e.taskState[this.diagramID]={initialized:!0,status:"initialized"},t)e.taskState[this.diagramID][s]=t[s];for(var n in i)e.taskState[this.diagramID][n]=i[n]}}isEndTask(){return!1}log(e,...t){var i=`${this.diagramID} : ${this.name?this.name:this.key} : ${t.join(" ")}`;e.log.push(i)}myLane(){return this.process.elementForDiagramID(this.laneDiagramID)}myState(e){return e.context.taskState[this.diagramID]}nextTasks(e){var t=[],i=e.hashDiagramObjects[this.diagramID];if(!i){let t=new Error(`Configuration Error: Did not find my definition for dID[${this.diagramID}]`);return this.onError(e,t),null}var s=i["bpmn2:outgoing"];if(!s){let t=new Error(`Configuration Error: Did not find any outgoing flows for dID[${this.diagramID}]`);return this.AB.notify.builder(t,{task:this}),this.onError(e,t),null}Array.isArray(s)||(s=[s]);var n=i=>{var s=e.hashDiagramObjects[i._text];if(s){var n=s._attributes.targetRef;n&&(Array.isArray(n)||(n=[n]),n.forEach((i=>{var s=this.process.elementForDiagramID(i);if(s)t&&t.push(s);else{let s=new Error(`Configuration Error: No ProcessTask instance for diagramID[${i}]`);this.AB.notify.builder(s,{task:this}),this.onError(e,s),t=null}})))}};return s.forEach((e=>{n(e)})),t}onError(e,t){if(t){var i=`${t.toString()}`;this.log(e,i)}this.myState(e).status="error"}processDataFields(){return null}processData(e,t){return null}processDataObjects(){return null}hashProcessDataValues(e){var t=this.process.processDataFields(this),i={};return t.forEach((t=>{i[t.key]=this.process.processData(this,[e,t.key])})),i}reset(e){var t=this.myState(e);t?"completed"!=t.status&&"error"!=t.status||(delete e.context.taskState[this.diagramID],this.initState(e.context),this.myState(e)._prevState=t,this.log(e," Reset() called. Running again. ")):this.initState(e.context)}stateCompleted(e){this.myState(e).status="completed"}stateUpdate(e,t){t=t||{};var i=this.myState(e);for(var s in t)i[s]=t[s]}wantToDoSomething(e){var t=this.myState(e);return t?"completed"!=t.status&&"error"!=t.status:(console.warn("ABProcessTaskCore:wantToDoSomething(): called without having initialized our state first.",e),this.initState(e.context),this.wantToDoSomething(e))}onProcessReady(){}get startElements(){return this.process.elements((e=>e&&e.defaults&&"start"===e.defaults.category))||[]}get previousElements(){return this.process.connectionPreviousTask(this)}get objectOfStartElement(){const e=this.startElements[0];return e?this.AB.objectByID(e.objectID):null}get objectOfPrevElement(){let e,t=this.previousElements[0];return t?(e="process.task.service.query"===t.type?t.qlObj?t.qlObj.objectID:null:t.objectID,this.AB.objectByID(e)):null}}},69569:(e,t,i)=>{const s=i(25330);var n={category:"end",fields:[],icon:"stop",key:"End"};e.exports=class extends s{constructor(e,t,i){e.type=e.type||"process.task.end",super(e,t,i,n)}static defaults(){return n}static DiagramReplace(){return{label:"Terminate End Event",actionName:"replace-with-terminate-end",className:"bpmn-icon-end-event-terminate",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:TerminateEventDefinition"}}}initState(e,t){super.initState(e,{triggered:!1},t)}isEndTask(){return!0}nextTasks(e){return[]}}},2406:(e,t,i)=>{const s=i(25330);var n={category:"gateway",icon:"check-circle",instanceValues:[],key:"GatewayExclusive",settings:["conditions"]};e.exports=class extends s{constructor(e,t,i){e.type=e.type||"process.gateway.exclusive",super(e,t,i,n)}static defaults(){return n}static DiagramReplace(){return{label:"Exclusive Gateway",actionName:"replace-with-exclusive-gateway",className:"bpmn-icon-gateway-xor",target:{type:"bpmn:ExclusiveGateway"}}}fromValues(e){super.fromValues(e),this.conditions=this.conditions||{}}}},85772:(e,t,i)=>{const s=i(25330);var n={category:"task",fields:["to","from","subject","message","toCustom","fromCustom","toUsers","fromUsers","toCustomFields","fromCustomFields"],icon:"email",key:"Email"};e.exports=class extends s{constructor(e,t,i){e.type=e.type||"process.task.email",super(e,t,i,n)}static defaults(){return n}static DiagramReplace(){return{label:"Send Task",actionName:"replace-with-send-task",className:"bpmn-icon-send",target:{type:"bpmn:SendTask"}}}fromValues(e){super.fromValues(e),n.fields.forEach((t=>{this[t]=e[t]}))}toObj(){var e=super.toObj();return n.fields.forEach((t=>{e[t]=this[t]})),e}initState(e,t){var i={to:[],from:[],subject:this.subject,message:this.message};super.initState(e,i,t)}}},39163:(e,t,i)=>{const s=i(25330);var n={category:null,icon:"check-circle",instanceValues:[],key:"AccountingBatchProcessing",settings:["objectBatch","processBatchValue","fieldBatchEntries","fieldBatchFinancialPeriod","objectJE","fieldJEAccount","fieldJERC","fieldJEStatus","fieldJEStatusComplete","objectBR","fieldBRFinancialPeriod","fieldBRAccount","fieldBRRC","fieldBREntries"]};e.exports=class extends s{constructor(e,t,i){e.type=e.type||"process.task.service.accounting.batchProcessing",super(e,t,i,n)}static defaults(){return n}static DiagramReplace(){return null}}},25144:(e,t,i)=>{const s=i(25330);var n={category:null,icon:"check-circle",instanceValues:[],key:"AccountingFPClose",settings:["processFPValue","objectFP","objectGL","objectAcc","fieldFPStart","fieldFPOpen","fieldFPStatus","fieldFPActive","fieldGLStarting","fieldGLRunning","fieldGLAccount","fieldGLRc","fieldGLDebit","fieldGLCredit","fieldAccType","fieldAccAsset","fieldAccExpense","fieldAccLiabilities","fieldAccEquity","fieldAccIncome"]};e.exports=class extends s{constructor(e,t,i){e.type=e.type||"process.task.service.accounting.fpClose",super(e,t,i,n)}static defaults(){return n}static DiagramReplace(){return null}}},93071:(e,t,i)=>{const s=i(25330);var n={category:null,icon:"check-circle",instanceValues:[],key:"AccountingFPYearClose",settings:["processFPYearValue","objectFPYear","objectFPMonth","objectGL","objectAccount","valueFundBalances","valueNetIncome","fieldFPYearStart","fieldFPYearEnd","fieldFPYearStatus","fieldFPYearActive","fieldFPMonthStart","fieldFPMonthEnd","fieldGLStartBalance","fieldGLRunningBalance","fieldGLrc","fieldAccNumber","fieldAccType","fieldAccTypeIncome","fieldAccTypeExpense","fieldAccTypeEquity"]};e.exports=class extends s{constructor(e,t,i){e.type=e.type||"process.task.service.accounting.fpYearClose",super(e,t,i,n)}static defaults(){return n}static DiagramReplace(){return null}}},308:(e,t,i)=>{const s=i(25330);let n={category:null,icon:"archive",instanceValues:[],key:"AccountingJEArchive",settings:["processBatchValue","objectBatch","objectBalance","objectJE","objectJEArchive","fieldBatchFiscalMonth","fieldJeAccount","fieldJeRC","fieldJeArchiveBalance","fieldBrFiscalMonth","fieldBrAccount","fieldBrRC","fieldsMatch"]};e.exports=class extends s{constructor(e,t,i){e.type=e.type||"process.task.service.accounting.jeArchive",super(e,t,i,n)}static defaults(){return n}static DiagramReplace(){return null}}},4070:(e,t,i)=>{const s=i(25330);let n={category:null,icon:"calculator",instanceValues:[],key:"Calculate",settings:["formulaText"]};e.exports=class extends s{constructor(e,t,i){e.type=e.type||"process.task.service.calculate",super(e,t,i,n)}static defaults(){return n}static DiagramReplace(){return null}processDataFields(){const e=`${this.label}->Value`;return this._fakeNum||(this._fakeObj=this.AB.objectNew({}),this._fakeNum=this.AB.fieldNew({key:"number",name:e,label:e},this._fakeObj)),{key:`${this.id}.value`,label:e,field:this._fakeNum}}}},95824:(e,t,i)=>{const s=i(25330);var n={category:"task",icon:"check-circle",instanceValues:[],key:"TaskService",settings:[]};e.exports=class extends s{constructor(e,t,i){e.type=e.type||"process.task.service",super(e,t,i,n)}static defaults(){return n}static DiagramReplace(){return{label:"Service Task",actionName:"replace-with-service-task",className:"bpmn-icon-service",target:{type:"bpmn:ServiceTask"}}}}},13925:(e,t,i)=>{const s=i(25330),n={category:null,icon:"plus-circle",instanceValues:[],key:"GetResetPasswordUrl",settings:["email"]};e.exports=class extends s{constructor(e,t,i){e.type=e.type||"process.task.service.getResetPasswordUrl",super(e,t,i,n)}static defaults(){return n}static DiagramReplace(){return null}processDataFields(){return{key:`${this.id}.url`,label:`${this.label}->URL`}}}},7739:(e,t,i)=>{const s=i(25330);let n={category:null,icon:"plus-circle",instanceValues:[],key:"InsertRecord",settings:["objectID","fieldValues","isRepeat","repeatMode","repeatColumn"]};e.exports=class extends s{constructor(e,t,i){e.type=e.type||"process.task.service.insertRecord",super(e,t,i,n),this.results=[]}static defaults(){return n}static DiagramReplace(){return null}fromValues(e){super.fromValues(e),this.isRepeat=JSON.parse(e.isRepeat||!1)}get startElement(){let e=null,t=this.process;for(;!e&&t;)e=t.elements((e=>"start"==e?.defaults?.category))[0],t=t.process;return e}get previousElement(){return this.process.connectionPreviousTask(this)[0]}get objectOfStartElement(){let e=this.startElement;return e?this.AB.objectByID(e.objectID):null}get objectOfPrevElement(){let e,t=this.previousElement;return t?(e="process.task.service.query"===t.type?t.qlObj?t.qlObj.objectID:null:t.objectID,this.AB.objectByID(e)):null}get fieldRepeat(){let e=this.objectOfStartElement;return e?e.fields((e=>e.id==this.repeatColumn))[0]:null}processDataFields(){return[{key:`${this.id}.[PK]`,label:`${this.label}-> Inserted record [PK]`,field:{id:this.id,object:{id:this.objectID},key:"InsertedRecord",columnName:"uuid"},object:this.objectID,set:!0}]}}},84224:(e,t,i)=>{const s=i(25330),n=i(25433),a={category:null,icon:"check-circle",instanceValues:[],key:"TaskServiceQuery",settings:["qlObj"]};e.exports=class extends s{constructor(e,t,i){e.type=e.type||"process.task.service.query",super(e,t,i,a)}static defaults(){return a}static DiagramReplace(){return null}fromValues(e){super.fromValues(e),this._datasources=[],this.qlObj&&(this.qlObj=n.fromAttributes(this.qlObj,this,this.AB))}toObj(){const e=super.toObj();return this.qlObj&&(e.qlObj=this.qlObj.toObj()),e}registerDatasource(e){this._datasources.push(e)}processDataFields(){let e=null;return this._datasources.length>0&&(e=[],this._datasources.forEach((t=>{const i=t.processDataField(this.id,this.label);i&&e.push(i)}))),e}processData(e,t){const i=t.split(".");return i[0]===this.id?this.myState(e)[i[1]]:null}}},12307:(e,t,i)=>{const s=i(25330);let n={category:"task",icon:"object-group",instanceValues:[],key:"SubProcess",settings:["isEnable","parameterId","connectionAttrs","elementIDs","loopType"]};const a={};e.exports=class extends s{constructor(e,t,i){e.type=e.type||"process.task.service.subProcess",super(e,t,i,n)}static defaults(){return n}static DiagramReplace(){return{label:"Sub Process",actionName:"replace-with-subprocess",className:"bpmn-icon-subprocess-expanded",target:{type:"bpmn:SubProcess",isExpanded:!0}}}fromValues(e){super.fromValues(e),this.isEnable=null==this.isEnable||JSON.parse(this.isEnable);let t=this._elements||{};this._unknownElementIDs=[],this._elements={},(e.elementIDs||[]).forEach((e=>{let i=this.AB.processElementNew(e,this);i?this._elements[e]=i:t[e]?this._elements[e]=t[e]:this._unknownElementIDs.push(e)})),this._unknownElementIDs.forEach((e=>{let t=`Process[${this.processID}] Task[${this.label}] is referencing an unknown element id:[${e}]`;if(!a[t]){let i=new Error(t);this.AB.notify.builder(i,{processTask:this.id,eID:e}),a[t]=!0}})),this._connections=e.connectionAttrs||{}}toObj(){let e=super.toObj();e.elementIDs=[];for(let t in this._elements)e.elementIDs.push(this._elements[t].id);return e.connectionAttrs=this._connections,e}processDataFields(e){if(null==this.parameterId)return[];let t=this.process.processDataFields(this)||[],i=t.filter((e=>e.key===this.parameterId))[0],s=t.filter((e=>"InsertedRecord"===(e?.field?.key??e?.field)));if(null==i)return[];let n=[];i.field&&"connectObject"==i.field.key&&i.field.datasourceLink&&i.field.datasourceLink.fields?(n.push({key:`${this.id}.uuid`,label:`${this.label}->Repeat Data.ID`,object:i.field.datasourceLink}),i.field.datasourceLink.fields().forEach((e=>{n.push({key:`${this.id}.${e.id}`,label:`${this.label}->Repeat Data.${e.label}`,field:e,object:e.object})}))):n.push({key:i.field?`${this.id}.${i.field.id}`:`${this.id}.subProcess`,label:`${this.label}->Repeat Data`,field:i.field,object:i.object}),s.forEach((e=>{n.push({key:`${e.key||e.id}`,label:`Parent Process Data->${e.label}`,field:e.field,object:e.object})}));let a=this.process.processDataFields.call(this,e);return a&&a.length>0&&(n=n.concat(a)),n}processData(e,t){let i,s=t[0],n=t[1];if(s&&n?.startsWith?.(this.id)){let e=n.split(".")[1],t=this.myState(s),a=t?t.data:null;if(i=a,a&&e){let t=(this.process.processDataFields(this)||[]).filter((e=>e.key==this.parameterId))[0];"connectObject"==t?.field?.key&&(Array.isArray(a)||(a=[a]),i=a.map((i=>{if("uuid"==e||"id"==e)return i.uuid||i.id||i;if(t.field.datasourceLink){let s=t.field.datasourceLink.fields((t=>t.id==e))[0];return s?i[s.columnName]:i}})))}}return Array.isArray(i)&&(i=i.filter((e=>null!=e))),null!=i&&i.length||(i=this.process.processData.call(this,e,t)),null!=i&&i.length||(i=this.process.processData(this,t)),i}allPreviousTasks(...e){return this.process.allPreviousTasks.call(this,...e)}allPreviousConnectionsForElement(...e){return this.process.allPreviousConnectionsForElement.call(this,...e)}allPreviousConnectionsForConnection(...e){return this.process.allPreviousConnectionsForConnection.call(this,...e)}connections(e){return this.process.connections.call(this,e)}connectionForDiagramID(e){if(e)return this.process.connectionForDiagramID.call(this,e)}connectionsIncoming(e){if(e)return this.process.connectionsIncoming.call(this,e)}connectionsOutgoing(e){if(e)return this.process.connectionsOutgoing.call(this,e)}connectionRemove(e){e&&this.process.connectionRemove.call(this,e)}connectionSimplyElement(e){if(e)return this.process.connectionSimplyElement.call(this,e)}connectionUpsert(e){e&&this.process.connectionUpsert.call(this,e)}connectionPreviousTask(e){if(e)return this.process.connectionPreviousTask.call(this,e)}elements(e=(()=>!0)){return this.process.elements.call(this,e)}elementAdd(e){e&&this.process.elementAdd.call(this,e)}elementForDiagramID(e){return e?this.process.elementForDiagramID.call(this,e):null}elementRemove(e){e&&this.process.elementRemove.call(this,e)}}},92940:(e,t,i)=>{const s=i(25330),n=i(34963);var a={category:null,icon:"check-circle",instanceValues:["userFormID","userFormResponse"],key:"Approval",settings:["who","toUsers","formBuilder"]};e.exports=class extends s{constructor(e,t,i){e.type=e.type||"process.task.user.approval",super(e,t,i,a)}static defaults(){return a}static DiagramReplace(){return null}fromValues(e){super.fromValues(e),function e(t){t&&Object.keys(t).forEach((i=>{"false"==t[i]?t[i]=!1:"true"==t[i]?t[i]=!0:"object"==typeof t[i]&&e(t[i])}))}(this.formBuilder)}preProcessFormIOComponents(){var e=this.process.processDataFields(this);return e&&this.formBuilder&&this.formBuilder.components&&this.formBuilder.components.forEach((t=>{t.abFieldID?e.filter((e=>{if(e.field?.id==t.abFieldID&&(t.label=e.field.label,t.key=e.key,t.data?.values&&e.field.settings.options)){var i=[];e.field.settings.options.forEach((e=>{i.push({label:e.text,value:e.id})})),t.data.values=i}})):t.components&&t.components.length&&(t.key=t.path,t.components.forEach((i=>{if(i.abFieldID){var s=e.filter((e=>e.key==t.path))[0];if(!s)return;s.object.fields().filter((e=>{if(e?.id==i.abFieldID&&(i.label=e.label,i.key=e.columnName,i.data?.values&&e.settings.options)){var t=[];e.settings.options.forEach((e=>{t.push({label:e.text,value:e.id})})),i.data.values=t}}))}})))})),this.formBuilder}processDataFields(){var e=[];this.formBuilder.components.forEach((t=>{"button"==t.type&&"event"==t.action&&t.event&&e.push({id:t.event,text:t.label})}));var t=this.diagramID,i=this.AB.objectNew({}),s=new n({id:`${t}.userFormResponse`,label:`${this.label}->Response`,columnName:`${t}.userFormResponse`,settings:{options:e}},i);return s.columnName=`${t}.userFormResponse`,[{key:`${t}.userFormResponse`,label:`${this.label}->Response`,field:s,object:null}]}processData(e,t){if(t){var i=t.split(".");if(i[0]==this.diagramID)return this.myState(e)[i[1]]}return null}}},50271:(e,t,i)=>{const s=i(25330);var n={category:"task",icon:"user",instanceValues:[],key:"TaskUser",settings:[]};e.exports=class extends s{constructor(e,t,i){e.type=e.type||"process.task.user",super(e,t,i,n)}static defaults(){return n}static DiagramReplace(){return{label:"User Task",actionName:"replace-with-user-task",className:"bpmn-icon-user",target:{type:"bpmn:UserTask"}}}initState(e,t){super.initState(e,{roles:[],ui:null},t)}}},10153:(e,t,i)=>{const s=i(25330),n={category:null,icon:"plus-circle",instanceValues:["userFormID","userFormResponse"],key:"External",settings:["who","toUsers","url"]},a={who:0,toUsers:null,url:""};e.exports=class extends s{constructor(e,t,i){for(const t in a)e[t]=e[t]??a[t];super(Object.assign({type:"process.task.service.external"},e),t,i,n)}static defaults(){return n}static DiagramReplace(){return null}processDataFields(){return[{key:`${this.id}.userFormResponse`,label:`${this.label}->Response`}]}}},44310:(e,t,i)=>{const s=i(25330);var n={category:"start",fields:[],icon:"key",key:"Trigger"};e.exports=class extends s{constructor(e,t,i){e.type=e.type||"trigger",super(e,t,i,n)}static defaults(){return n}static DiagramReplace(){return{label:"Signal Start Event",actionName:"replace-with-signal-start",className:"bpmn-icon-start-event-signal",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}}}fromValues(e){super.fromValues(e),this.triggerKey=e.triggerKey||"triggerKey.??"}toObj(){var e=super.toObj();return e.triggerKey=this.triggerKey,e}}},86555:(e,t,i)=>{const s=i(19010);var n={category:"start",fields:["objectID","lifecycleKey"],icon:"key",key:"TriggerLifecycle"};e.exports=class extends s{constructor(e,t,i){e.type=e.type||"trigger",super(e,t,i,n)}static defaults(){return n}static DiagramReplace(){return{label:"Object Lifecycle Trigger",actionName:"replace-with-signal-lifecycle-start",className:"bpmn-icon-start-event-signal",target:{type:"bpmn:StartEvent",eventDefinitionType:"ab:SignalLifecycle"}}}fromValues(e){super.fromValues(e),this.objectID=e.objectID||"objID.??",this.lifecycleKey=e.lifecycleKey||"lifecycle.key??"}toObj(){var e=super.toObj();return e.objectID=this.objectID,e.lifecycleKey=this.lifecycleKey,e}processDataFields(){var e=null;if(this.objectID){e=[];var t=this.AB.objectByID(this.objectID);if(t){var i=this.diagramID;t.fields().forEach((s=>{e.push({key:`${i}.${s.id}`,label:`${this.label}->${t.label}->${s.label}`,field:s,object:t})})),e.push({key:`${i}.uuid`,label:`${this.label}->${t.label}`,field:null,object:t})}else{var s=new Error(`ABProcessTriggerLifecycleCore.processDataFields():TaskID[${this.id}]: could not find referenced object by ID [${this.objectID}]`);this.AB.notify.builder(s,{task:this.id,objID:this.objectID})}}return e}processData(e,t){var i=t.split(".");if(i[0]==this.diagramID){var s=this.myState(e);if(s.data){var n=this.AB.objectByID(this.objectID).fields((e=>e.id==i[1]))[0];if(n)return i[2]?n[i[2]].call(n,s.data):-1!=["calculate","TextFormula"].indexOf(n.key)?n.format(s.data):("connectObject"==n.key||"user"==n.key)&&s.data[n.relationName()]||s.data[n.columnName];if("uuid"==i[1])return s.data.uuid}}return null}processDataObjects(){var e=null;return this.objectID&&(e=[this.AB.objectByID(this.objectID)]),e}}},47843:(e,t,i)=>{const s=i(19010);var n={category:"start",fields:["repeatEvery","repeatTime","repeatDaily","repeatWeekly","repeatMonthly","isEnabled"],icon:"clock-o",key:"TimerStartEvent",repeatEvery:"daily",repeatTime:"01:00",repeatDaily:"day",repeatWeekly:"FRI",repeatMonthly:"last",isEnabled:!0};e.exports=class extends s{constructor(e,t,i){e.type=e.type||"trigger",super(e,t,i,n)}static defaults(){return n}static DiagramReplace(){return{label:"Timer Start Event",actionName:"replace-with-signal-timer-start",className:"bpmn-icon-start-event-timer",target:{type:"bpmn:StartEvent",eventDefinitionType:"ab:SignalTriggerTimer"}}}fromValues(e){if(super.fromValues(e),this.repeatEvery=e.repeatEvery||n.repeatEvery,this.repeatDaily=e.repeatDaily||n.repeatDaily,this.repeatWeekly=e.repeatWeekly||n.repeatWeekly,this.repeatMonthly=e.repeatMonthly||n.repeatMonthly,e.repeatTime){let t=e.repeatTime.split(":"),i=new Date;i.setUTCHours(t[0]),i.setUTCMinutes(t[1]),this.repeatTime=`${i.getHours()}:${i.getMinutes()}`}else this.repeatTime=n.repeatTime;void 0!==e.isEnabled?this.isEnabled=JSON.parse(e.isEnabled):this.isEnabled=n.isEnabled}toObj(){var e=super.toObj();return e.repeatEvery=this.repeatEvery,e.repeatDaily=this.repeatDaily,e.repeatWeekly=this.repeatWeekly,e.repeatMonthly=this.repeatMonthly,e.repeatTime=this.repeatTime,e.repeatTime&&e.repeatTime instanceof Date&&(e.repeatTime=`${e.repeatTime.getUTCHours()}:${e.repeatTime.getMinutes()}`),e.isEnabled=this.isEnabled,e}getCronExpression(){let e,t,i,s=this.repeatTime.split(":"),n=s[1],a=s[0];switch(this.repeatEvery){case"daily":e="*",t="*",i="weekday"==this.repeatDaily?"1-5":"*";break;case"weekly":e="*",t="*",i=this.repeatWeekly;break;case"monthly":e=this.repeatMonthly,t="*",i="*"}return`* ${n} ${a} ${e} ${t} ${i} *`}}},61614:(e,t,i)=>{var s=i(26263);e.exports=class extends s{constructor(e,t,i,s,n){super(),Array.isArray(t)||(t=[t]),this.parameterDefinitions=t,this.object=i?i.object:null,i&&i.objectOut&&(this.object=i.objectOut),this.prevOP=i,this.task=s,this.AB=n,this.next=null,this.fromAttributes(e)}initObject(e){}fromAttributes(e){if(this.key=this.constructor.key??null,this.params=e.params??{},this.objectID=e.objectID||null,this.objectID&&(this.object=this.objectLookup(this.objectID)),this.initObject(e),this.objectID&&!this.object&&this.AB.notify.developer(new Error(`ABQLCore.fromAttributes(): unable to initialize ABObject [${this.objectID}]`),{attributes:e,objectID:this.objectID}),e.next){let t=null;if((this.NextQLOps??this.constructor.NextQLOps).forEach((i=>{i.key===e.next.key&&(t=i)})),t){const i=new t(e.next,this,this.task,this.AB);this.next=i}}}objectLookup(e){return this.AB.objects((t=>{const i=`"${t.label}"`;return t.id===e||0===i.indexOf(e)}))[0]}availableProcessDataFieldsHash(){const e=this.task.process.processDataFields(this.task)??[],t={};return e.forEach((e=>{e.field?t[e.field.id]=e:t[e.key]=e})),t}paramChanged(e){}toObj(){const e={key:this.constructor.key,params:this.params,objectID:this.object?.id??null};return this.next&&(e.next=this.next.toObj()),e}}},64732:(e,t,i)=>{const s=i(15544),n=i(49830),a=[{type:"objectConditions",name:"cond"}];class r extends s{constructor(e,t,i,s){super(e,a,t,i,s)}}r.key="find",r.label="find",r.NextQLOps=n,e.exports=r},45430:(e,t,i)=>{const s={fromAttributes:function(e,t,i){if(!e)return null;const n=[];return s.QLOps.forEach((t=>{t.key===e.key&&n.push(t)})),1===n.length?new n[0](e,t,i):null},QLOps:[i(39700)]};e.exports=s},45655:(e,t,i)=>{const s=i(15544),n=[i(88484)],a=[{type:"objectName",name:"name"}];class r extends s{constructor(e,t,i){super(e,a,null,t,i)}initObject(){if(!this.object&&this.params){const e=this.parameterDefinitions.find((e=>"objectName"===e.type));e&&(this.objectID=this.params[e.name],this.object=this.objectLookup(this.objectID)),this.object||this.warningMessage?.("has no object set.",{objectID:this.objectID})}}toObj(){const e=super.toObj();if(!e.objectID&&this.params){const t=this.parameterDefinitions.find((e=>"objectName"===e.type));t&&(e.objectID=this.params[t.name])}return e}}r.key="object",r.label="object",r.NextQLOps=n,e.exports=r},2321:(e,t,i)=>{const s=i(19602),n=i(63622),a=i(93725);e.exports=[s,n,a]},38109:(e,t,i)=>{const s=i(6517),n=i(19602),a=i(63622);class r extends s{get NextQLOps(){let e=[];const t=this.field??this.object.fieldByID(this.fieldID)??null;switch(t?.key){case"connectObject":if("many"===t.settings.linkType){e=i(49830);break}e=this.prevOP.constructor.NextQLOps.filter((e=>e.key===this.constructor.key||e.key===n.key));break;case"user":if("many"===t.settings.linkType||t.settings.isMultiple){e=i(49830);break}e=this.prevOP.constructor.NextQLOps.filter((e=>e.key===this.constructor.key||e.key===n.key||e.key===a.key));break;default:e=this.prevOP.constructor.NextQLOps.filter((e=>e.key===a.key))}return e}}r.key="row_pluck",r.label="Read the value from the field",r.NextQLOps=[],e.exports=r},39580:(e,t,i)=>{const s=i(23698);class n extends s{}n.key="row_save",n.label="Save the value as",n.NextQLOps=[],e.exports=n},47947:(e,t,i)=>{const s=i(15544),n=[{type:"objectValues",name:"values"}];class a extends s{constructor(e,t,i,s){super(e,n,t,i,s),this.constructor.NextQLOps=t.constructor.NextQLOps}}a.key="update",a.label="Update this record",a.NextQLOps=[],e.exports=a},49830:(e,t,i)=>{e.exports=[i(21790),i(6517),i(23698)]},1947:(e,t,i)=>{const s=i(15544),n=i(2321);class a extends s{constructor(e,t,i,s){super(e,[],t,i,s)}}a.key="first",a.label="Select the first record",a.NextQLOps=n,e.exports=a},93740:(e,t,i)=>{const s=i(15544),n=[{type:"objectFields",name:"fieldID"}];class a extends s{constructor(e,t,i,s){super(e,n,t,i,s)}fromAttributes(e){this.constructor.NextQLOps=this.prevOP.constructor.NextQLOps,this.fieldID=e.fieldID,this.field=this.object?.fieldByID(this.fieldID),e.objectOutID&&(this.objectOut=this.objectLookup(e.objectOutID)),super.fromAttributes(e)}toObj(){const e=super.toObj();if(this.fieldID)e.fieldID=this.fieldID,this.objectOut&&(e.objectOutID=this.objectOut.id);else{e.fieldID=this.params.field||null;const t=this.object.fieldByID(e.fieldID);t?.isConnection&&(e.objectOutID=t.datasourceLink.id)}return e}}a.key="set_pluck",a.label="Read the value from the field",a.NextQLOps=[],e.exports=a},86918:(e,t,i)=>{const s=i(15544),n=[{type:"taskParam",name:"task_param"}];class a extends s{constructor(e,t,i,s){super(e,n,t,i,s),this.taskParam&&(i.registerDatasource(this),this.registered=!0)}fromAttributes(e){this.constructor.NextQLOps=this.prevOP.constructor.NextQLOps,super.fromAttributes(e),this.taskParam=e.taskParam||this.params.task_param}toObj(){const e=super.toObj();return e.taskParam=this.taskParam||this.params.task_param,e}processDataField(e,t){let i=null;return"connectObject"!==this.prevOP?.field?.key&&(i=this?.prevOP?.field),{key:`${e}.${this.taskParam||this.params.task_param}`,label:`${t}->${this.taskParam||this.params.task_param}`,field:i,object:this.object,set:!0}}}a.key="set_save",a.label="Save the value as",a.NextQLOps=[],e.exports=a},88076:(e,t,i)=>{const s=i(4814),n={key:"csvExporter",icon:"download",labelKey:"CSV Exporter"},a={dataviewID:null,where:null,buttonLabel:"Export CSV",filename:"exportCSV",hasHeader:!0,width:150};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||n)}static common(){return n}static defaultValues(){return a}fromValues(e){super.fromValues(e),"string"==typeof e.settings.hasHeader&&(this.settings.hasHeader=JSON.parse(e.settings.hasHeader)),null==this.settings.hasHeader&&(this.settings.hasHeader=a.hasHeader),this.settings.width=parseInt(e.settings.width||a.width)}}},22152:(e,t,i)=>{const s=i(4814),n=i(95652),a={key:"csvImporter",icon:"upload",labelKey:"CSV Importer"},r={dataviewID:null,availableFieldIds:[],buttonLabel:"Upload CSV",width:0,recordRules:[]};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return r}fromValues(e){super.fromValues(e),this.settings.width=parseInt(this.settings.width||r.width)}get RecordRule(){let e=this.datacollection?.datasource;return e?(null==this._recordRule&&(this._recordRule=new n),this._recordRule.formLoad(this),this._recordRule.fromSettings(this.settings.recordRules),this._recordRule.objectLoad(e),this._recordRule):null}doRecordRulesPre(e){e&&!Array.isArray(e)&&(e=[e]),e.forEach((e=>{this.RecordRule?.processPre({data:e.data||e,form:this})}))}doRecordRules(e){if(e&&!Array.isArray(e)&&(e=[e]),!this.RecordRule)return Promise.resolve();let t=[];return e.forEach((e=>{t.push(this.RecordRule.process({data:e.data||e,form:this}))})),Promise.all(t)}}},474:(e,t,i)=>{const s=i(4814),n={dataviewID:null,field:null,width:460,height:275,showLabel:!0,hideItem:!1,hideButton:!1,navigationType:"corner",filterByCursor:!1,detailsPage:null,detailsTab:null,editPage:null,editTab:null},a={key:"carousel",icon:"clone",labelKey:"Carousel"};function r(e,t){void 0!==e.settings[t]?e.settings[t]=parseInt(e.settings[t]):e.settings[t]=n[t]}function o(e,t){try{e.settings[t]=JSON.parse(e.settings[t])}catch(i){e.settings[t]=n[t]}}e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}fromValues(e){super.fromValues(e),r(this,"width"),r(this,"height"),o(this,"showLabel"),o(this,"hideItem"),o(this,"hideButton"),this.settings.navigationType=this.settings.navigationType||n.navigationType,o(this,"filterByCursor")}componentList(){return[]}get imageField(){let e=this.datacollection;if(!e)return null;let t=e.datasource;return t?t.fieldByID(this.settings.field):null}}},47493:(e,t,i)=>{const s=i(55988),n={areaType:"area",isLegend:1,chartHeight:200,labelFontSize:12,stepValue:20,maxValue:100},a={key:"area",icon:"area-chart",labelKey:"Area"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}fromValues(e){super.fromValues(e),this.settings.areaType=this.settings.areaType||n.areaType,this.settings.isLegend=parseInt(this.settings.isLegend??n.isLegend),this.settings.chartHeight=parseInt(this.settings.chartHeight??n.chartHeight),this.settings.labelFontSize=parseInt(this.settings.labelFontSize??n.labelFontSize),this.settings.stepValue=parseInt(this.settings.stepValue??n.stepValue),this.settings.maxValue=parseInt(this.settings.maxValue??n.maxValue),this.translate(this,this,["areaLabel"])}componentList(){return[]}}},5163:(e,t,i)=>{const s=i(55988),n={barType:"bar",barPreset:"column",isLegend:1,height:200,labelFontSize:12,stepValue:20,maxValue:100},a={key:"bar",icon:"bar-chart",labelKey:"Bar"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}fromValues(e){super.fromValues(e),this.settings.barType=this.settings.barType||n.barType,this.settings.barPreset=this.settings.barPreset||n.barPreset,this.settings.isLegend=parseInt(this.settings.isLegend??n.isLegend),this.settings.height=parseInt(this.settings.height??n.height),this.settings.labelFontSize=parseInt(this.settings.labelFontSize??n.labelFontSize),this.settings.stepValue=parseInt(this.settings.stepValue??n.stepValue),this.settings.maxValue=parseInt(this.settings.maxValue??n.maxValue),this.translate(this,this,["barLabel"])}componentList(){return[]}}},34263:(e,t,i)=>{const s=i(35798),n={dataviewID:"",columnValue:"",columnLabel:"",columnValue2:"",isPercentage:1,showLabel:1,labelPosition:"left",labelWidth:120,height:200,multipleSeries:0},a={key:"chart",icon:"bar-chart",labelKey:"Chart"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}fromValues(e){super.fromValues(e),this.settings.dataviewID=this.settings.dataviewID??n.dataviewID,this.settings.columnValue=this.settings.columnValue??n.columnValue,this.settings.columnLabel=this.settings.columnLabel??n.columnLabel,this.settings.columnValue2=this.settings.columnValue2??n.columnValue2,this.settings.isPercentage=parseInt(this.settings.isPercentage??n.isPercentage),this.settings.showLabel=parseInt(this.settings.showLabel??n.showLabel),this.settings.labelPosition=this.settings.labelPosition||n.labelPosition,this.settings.labelWidth=parseInt(this.settings.labelWidth??n.labelWidth),this.settings.height=parseInt(this.settings.height??n.height),this.settings.multipleSeries=parseInt(this.settings.multipleSeries??n.multipleSeries),this.translate(this,this,["chartLabel"])}componentList(){const e=["label","pie","bar","line","area"];return this.application.viewAll((t=>e.indexOf(t.common().key)>-1))}labelField(){const e=this.datacollection;if(!e)return null;const t=e.datasource;return t?t.fieldByID(this.settings.columnLabel):null}valueField(){const e=this.datacollection;if(!e)return null;const t=e.datasource;return t?t.fieldByID(this.settings.columnValue):null}valueField2(){const e=this.datacollection;if(!e)return null;const t=e.datasource;return t?t.fieldByID(this.settings.columnValue2):null}}},86094:(e,t,i)=>{const s=i(55988),n={lineType:"line",linePreset:"plot",isLegend:1,chartHeight:200,labelFontSize:12,stepValue:20,maxValue:100},a={key:"line",icon:"line-chart",labelKey:"Line"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}fromValues(e){super.fromValues(e),this.settings.lineType=this.settings.lineType||n.lineType,this.settings.linePreset=this.settings.linePreset||n.linePreset,this.settings.isLegend=parseInt(this.settings.isLegend??n.isLegend),this.settings.chartHeight=parseInt(this.settings.chartHeight??n.chartHeight),this.settings.labelFontSize=parseInt(this.settings.labelFontSize??n.labelFontSize),this.settings.stepValue=parseInt(this.settings.stepValue??n.stepValue),this.settings.maxValue=parseInt(this.settings.maxValue??n.maxValue),this.translate(this,this,["lineLabel"])}componentList(){return[]}}},92835:(e,t,i)=>{const s=i(55988),n={pieType:"pie",isLegend:1,height:200,innerFontSize:12,labelFontSize:12},a={key:"pie",icon:"pie-chart",labelKey:"Pie"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}fromValues(e){super.fromValues(e),this.settings.pieType=this.settings.pieType||n.pieType,this.settings.isLegend=parseInt(this.settings.isLegend??n.isLegend),this.settings.height=parseInt(this.settings.height??n.height),this.settings.innerFontSize=parseInt(this.settings.innerFontSize??n.innerFontSize),this.settings.labelFontSize=parseInt(this.settings.labelFontSize??n.labelFontSize),this.translate(this,this,["pieLabel"])}componentList(){return[]}}},46767:(e,t,i)=>{const s=i(4814),n={dataviewID:null,columnUser:null,columnComment:null,columnDate:null,height:300,label:""},a={key:"comment",icon:"comments",labelKey:"Comment"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}fromValues(e){super.fromValues(e),this.settings.height=parseInt(this.settings.height||0)}componentList(){return[]}getCurrentUserId(){const e=this.getUsers(),t=this.AB.Account.username();if(e)return e.findIndex((e=>e.value===t))+1}getUsers(){return this.AB.Account.userList().map((e=>({id:e.username,value:e.username,image:e.image_id})))}getUserField(){var e=this.datacollection;if(!e)return null;var t=e.datasource;return t?t.fieldByID(this.settings.columnUser):null}getCommentField(){var e=this.datacollection;if(!e)return null;var t=e.datasource;return t?t.fieldByID(this.settings.columnComment):null}getDateField(){var e=this.datacollection;if(!e)return null;var t=e.datasource;return t?t.fieldByID(this.settings.columnDate):null}getUserData(){let e=this.AB.objectUser().fieldByID("6383ce19-b344-44ee-87e6-decced7361f8");var t=this.getUsers(),i=[];if(t)return t.forEach(((t,s)=>{var n="";t.image&&(n=e.urlImage(t.image));var a={id:s+1,value:t.value,image:n};i.push(a)})),i}model(){let e=this.datacollection;return e&&e.model||null}}},14534:(e,t,i)=>{const s=i(35798),n={dataviewID:null,filterConditions:{}},a={key:"conditionalcontainer",icon:"shield",labelKey:"Conditional Container"};e.exports=class extends s{constructor(e,t,i,n){super(e,t,i,n||a);const r=(...e)=>this.AB.Multilingual.label(...e);if(this.views((e=>e instanceof s)).length<2){this._views=[];const e=t.viewNew({key:s.common().key,label:r("If"),name:"If",settings:{removable:!1}},t,this);this._views.push(e);const i=t.viewNew({key:s.common().key,label:r("Else"),name:"Else",settings:{removable:!1}},t,this);this._views.push(i)}}static common(){return a}static defaultValues(){return n}componentList(){return[]}}},51828:(e,t,i)=>{const s=i(4814),n={dataviewID:null,field:null},a={key:"connect-data-filter",icon:"filter",labelKey:"Connected Data Filter"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s??a)}static common(){return a}static defaultValues(){return n}componentList(){return[]}}},67070:(e,t,i)=>{const s=i(94784),n={key:"viewcontainer",icon:"braille",labelKey:"Container"},a={columns:1,gravity:1,movable:!0,removable:!0};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||n)}static common(){return n}static defaultValues(){return a}fromValues(e){super.fromValues(e),this.settings.columns=parseInt(this.settings.columns||a.columns),void 0!==this.settings.gravity&&this.settings.gravity.map((function(e){return parseInt(e)})),null!=this.settings.removable?this.settings.removable=JSON.parse(this.settings.removable):this.settings.removable=a.removable,null!=this.settings.movable?this.settings.movable=JSON.parse(this.settings.movable):this.settings.movable=a.movable}viewsSortByPosition(){return this.views().sort(((e,t)=>e.position.y==t.position.y?e.position.x-t.position.x:e.position.y-t.position.y))}}},2063:(e,t,i)=>{var s=i(70504);const n={key:"view",icon:"window-maximize",labelKey:"ab.components.view",tabicon:""},a={label:""};e.exports=class extends s{constructor(e,t,i,s){super(["label"],t.AB),this.__events=[],this.defaults=s||n,this.application=t,this.parent=i||null,this.warningsSilent=!1,this.__missingViews=[],this.fromValues(e)}static common(){return n}static defaultValues(){return a}static newInstance(e,t){return e.viewNew({key:this.common().key},e,t)}viewKey(){return this.defaults.key}viewIcon(){return this.defaults.icon}tabIcon(){return this.defaults.tabicon}toObj(){var e=super.toObj(),t={id:this.id,type:this.type||"view",key:this.key,icon:this.icon,tabicon:this.tabicon,name:this.name,settings:this.AB.cloneDeep(this.settings||{}),accessLevels:this.accessLevels,translations:e.translations};return t.viewIDs=(this._views||[]).map((e=>e.id)).filter((e=>e)),t.viewIDs=t.viewIDs.concat(this.__missingViews),this.position&&(t.position=this.position),t.isRoot=this.isRoot(),t}fromValues(e){if(this.id=e.id,this.type=e.type||"view",this.key=e.key||this.viewKey(),this.icon=e.icon||this.viewIcon(),this.tabicon=e.tabicon||this.tabIcon(),this.name=e.name,e.settings=e.settings||{},this.label=e.label||e.settings.label||"?label?",this.settings=e.settings||{},this.settings.height=parseInt(this.settings.height||0),this.accessLevels=e.accessLevels||{},super.fromValues(e),!this.name&&Array.isArray(this.translations))for(var t=0;t<this.translations.length;t++)if(0==t&&(this.name=this.translations[t].label),"en"==this.translations[t].language_code){this.name=this.translations[t].label;break}"?label?"==this.label&&this.parent&&(this.label=this.parent.label+"."+this.defaults.key);var i=[];this.__missingViews=this.__missingViews||[],(e.viewIDs||[]).forEach((e=>{var t=this.AB.definitionByID(e);t?i.push(this.application.viewNew(t,this.application,this)):this.__missingViews.push(e)})),this._views=i,this.position=e.position||{},null!=this.position.x&&(this.position.x=parseInt(this.position.x)),null!=this.position.y&&(this.position.y=parseInt(this.position.y)),this.position.dx=parseInt(this.position.dx||1),this.position.dy=parseInt(this.position.dy||1)}isRoot(){return null==this.parent||this.parent==this.application}allParents(){var e=[],t=this;for(e.unshift(t);!t.isRoot()&&t.parent;)e.unshift(t.parent),t=t.parent;return e}isAccessibleForRoles(e){var t=!1,i=Object.keys(this.accessLevels)||[];return(e||[]).forEach((e=>{i.indexOf(e.uuid||e)>-1&&(t=!0)})),t}getUserAccess(){var e=0;if(this.application.isAccessManaged){var t=!1;1==parseInt(this.application.accessManagers.useRole)&&this.AB.Account.roles().forEach((i=>{this.application.accessManagers.role.indexOf(i.id||i.uuid)>-1&&(t=!0,e=2)})),t||1!=parseInt(this.application.accessManagers.useAccount)||this.application.accessManagers.account.indexOf(this.AB.Account.uuid()+"")>-1&&(t=!0,e=2),this.accessLevels&&Object.keys(this.accessLevels).length>0&&!t&&this.AB.Account.roles().forEach((t=>{var i=this.accessLevels[t.id||t.uuid];i&&parseInt(i)>e&&(e=parseInt(i))}))}else e=2;return e}parentFormComponent(){for(var e=null,t=this;"form"!=t.key&&!t.isRoot()&&t.parent;)t=t.parent;return"form"==t.key&&(e=t),e}parentDetailComponent(){for(var e=null,t=this;"detail"!=t.key&&!t.isRoot()&&t.parent;)t=t.parent;return"detail"==t.key&&(e=t),e}pageParent(e){if(null==e&&(e=()=>!0),this.isRoot())return this;for(var t=this.parent;t&&("page"!=t.key||!e(t));)t=t.parent;return t}pageRoot(){for(var e=this.pageParent();!e.isRoot();)e=e.pageParent();return e}urlPointer(){return this.parent?this.parent.urlView()+this.id:this.application.urlPage()+this.id}urlView(){return this.urlPointer()+"/_views/"}get datacollection(){let e=(this.settings||{}).dataviewID;if(!e){if(["form","grid","line","area","bar","gantt","kanban"].indexOf(this.key)>-1){if("form"==this.key&&this._currentObject)return null;if(this.warningsSilent)return null;var t=new Error(`ABViewCore:get datacollection(): View[${this.key}] didn't define a dataviewID.`);this.AB.notify.builder(t,{view:this,settings:this.settings})}else-1==["button","label","page","tab","viewcontainer"].indexOf(this.key)&&console.warn(`TODO: figure out which ABView* require a .dataviewID: ${this.key}?`);return null}var i=this.AB.datacollectionByID(e);if(!i){var s=new Error(`View[${this.label}][${this.id}] is unable to find associated DataCollection`);this.AB.notify.builder(s,{view:this,dataviewID:e})}return i}updateAccessLevels(e,t){return 0==parseInt(t)?this.accessLevels[e]&&delete this.accessLevels[e]:this.accessLevels[e]=t,this.save(!1,!1)}views(e=(()=>!0),t=!1){var i=[];return!this._views||this._views.length<1||(e&&t?(i=i.concat(this._views.filter(e)),this._views.forEach((s=>{var n=s.views(e,t);n&&n.length>0&&(i=i.concat(n))}))):i=this._views.filter(e)),i}viewNew(e,t,i){return this.application.viewNew(e,t||this.application,i||this)}viewDestroy(e){return console.error("DEPRECIATED: where is this called?"),this.viewRemove(e)}viewRemove(e){var t=this._views.length;return this._views=this.views((function(t){return t.id!=e.id})),this._views.length<t?this.save():Promise.resolve()}viewInsert(e){return this.views((function(t){return t.id==e.id})).length>0?Promise.resolve():(this._views.push(e),this.save())}viewReorder(e,t){var i=this._views.findIndex((t=>t.id==e));if(!(i<0))return this._views.splice(t,0,this._views.splice(i,1)[0]),this.save(!0)}destroy(){return this.eventClear(!0),Promise.resolve().then((()=>{var e=[],t=this.views();return this._views=[],t.forEach((t=>{e.push(t.destroy())})),Promise.all(e)})).then((()=>{if(this.parent&&!this.pages)return this.parent.viewRemove(this)})).then((()=>super.destroy())).then((()=>{this.emit("destroyed")}))}save(){return Promise.resolve().then((()=>super.save())).then((()=>{if(this.parent&&!this.pages)return this.parent.viewInsert(this)})).then((()=>this))}eventAdd(e){if(e&&e.emitter&&e.listener){var t=this.__events.find((t=>t.emitter==e.emitter&&t.eventName==e.eventName));(!t||t.length<1)&&(this.__events.push({emitter:e.emitter,eventName:e.eventName,listener:e.listener}),e.emitter.on(e.eventName,e.listener))}}eventClear(e){e&&this.views().forEach((t=>{t.eventClear(e)})),this.__events&&this.__events.length>0&&this.__events.forEach((e=>{e.emitter.removeListener(e.eventName,e.listener)}))}clone(e,t,i={}){e=e||{};let s=this.toObj();["pages","views"].forEach((e=>{delete s[e]})),this.copyUpdateProperyList&&(this.copyUpdateProperyList()||[]).forEach((t=>{s&&s.settings&&(s.settings[t]=e[s.settings[t]])}));let n=this.viewNew(s,this.application,t);return n.id=null==t?null:e[n.id]||this.AB.uuid(),this.pages&&!i.ignoreSubPages&&(n._pages=[],this.pages().forEach((t=>{let s=t.clone(e,n,i);s.parent=n,n._pages.push(s)}))),this.views&&!i.ignoreSubViews&&(n._views=[],this.views().forEach((t=>{let s=t.clone(e,n,i);n._views.push(s)}))),n}copy(e,t,i={}){e=e||{};let s=this.toObj();["pageIDs","viewIDs"].forEach((e=>{delete s[e]})),this.copyUpdateProperyList&&(this.copyUpdateProperyList()||[]).forEach((t=>{s&&s.settings&&(s.settings[t]=e[s.settings[t]])}));let n=this.application.viewNew(s,this.application,t);return n.parent=t||this.parent,n.id=null==t?null:e[n.id]||this.AB.uuid(),"page"==this.key&&(n.name=i?.newName||`${n.name}_copied_${this.AB.uuid().slice(0,3)}`,n.label=i?.newName||`${n.label} (copied)`),Promise.resolve().then((()=>{var t=[];return this._pages&&!i.ignoreSubPages&&(n._pages=[],this.pages().forEach((s=>{s.isRoot()&&this.application._pages.push({id:e[s.id]}),t.push(s.copy(e,n,i).then((t=>{t.parent=n,this.application._pages=this.application._pages.filter((t=>t.id!=e[s.id])),n._pages.push(t)})))}))),Promise.all(t)})).then((()=>{var t=[];return this._views&&!i.ignoreSubViews&&(n._views=[],this.views().forEach((s=>{t.push(s.copy(e,n,i).then((e=>{n._views.filter((t=>t.id==e.id)).length<1&&n._views.push(e)})))}))),Promise.all(t)})).then((()=>n.save())).then((()=>n))}}},23108:(e,t,i)=>{const s=i(4814),n={dataviewID:null,field:null,viewType:"advanced",showFilter:1,showSort:1},a={key:"data-filter",icon:"filter",labelKey:"Data Filter"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s??a)}static common(){return a}static defaultValues(){return n}fromValues(e){super.fromValues(e)}componentList(){return[]}}},43786:(e,t,i)=>{const s=i(65862),n={xCount:1,detailsPage:"",detailsTab:"",editPage:"",editTab:""},a={key:"dataview",icon:"th",labelKey:"Data view"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}fromValues(e){super.fromValues(e),this.settings.xCount=parseInt(this.settings.xCount||n.xCount),this.settings.detailsPage=this.settings.detailsPage||n.detailsPage,this.settings.editPage=this.settings.editPage||n.editPage,this.settings.detailsTab=this.settings.detailsTab||n.detailsTab,this.settings.editTab=this.settings.editTab||n.editTab}parentDetailComponent(){let e=null,t=this;for(;"dataview"!=t.key&&!t.isRoot()&&t.parent;)t=t.parent;return"dataview"==t.key&&(e=t),e}}},90065:(e,t,i)=>{const s=i(54325),n={},a={key:"detailcheckbox",icon:"check-square-o",labelKey:"ab.components.detail.checkbox"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s??a)}static common(){return a}static defaultValues(){return n}}},12126:(e,t,i)=>{const s=i(54325),n={formView:""},a={key:"detailconnect",icon:"list-ul",labelKey:"ab.components.detail.connect"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s??a)}static common(){return a}static defaultValues(){return n}}},89799:(e,t,i)=>{const s=i(35798),n={key:"detail",icon:"file-text-o",labelKey:"Detail"},a={dataviewID:null,showLabel:!0,labelPosition:"left",labelWidth:120,height:0};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s??n)}static common(){return n}static defaultValues(){return a}fromValues(e){super.fromValues(e),this.settings.labelPosition=this.settings.labelPosition||a.labelPosition,this.settings.showLabel=JSON.parse(null!=this.settings.showLabel?this.settings.showLabel:a.showLabel),this.settings.labelWidth=parseInt(this.settings.labelWidth||a.labelWidth),this.settings.height=parseInt(this.settings.height??a.height)}componentList(){let e=["label","text"];return this.application.viewAll().filter((t=>e.indexOf(t.common().key)>-1))}addFieldToDetail(e,t){if(null==e)return;let i=e.detailComponent().newInstance(this.application,this);return null!=i?(i.settings=i.settings??{},i.settings.fieldId=e.id,i.settings.labelWidth=this.settings.labelWidth||a.labelWidth,i.settings.alias=e.alias,i.position.y=t,this._views.push(i),i):void 0}}},57839:(e,t,i)=>{const s=i(54325),n={},a={key:"detailcustom",icon:"dot-circle-o",labelKey:"ab.components.detail.custom"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s??a)}static common(){return a}static defaultValues(){return n}}},30825:(e,t,i)=>{const s=i(54325),n={height:80,width:120},a={key:"detailimage",icon:"image",labelKey:"ab.components.detail.image"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s??a)}static common(){return a}static defaultValues(){return n}fromValues(e){super.fromValues(e),this.settings.height=parseInt(this.settings.height||n.height),this.settings.width=parseInt(this.settings.width??n.width)}}},68488:(e,t,i)=>{const s=i(4814);e.exports=class extends s{detailComponent(){let e=null,t=this;for(;!t.isRoot()&&t.parent&&"detail"!=t.key&&"dataview"!=t.key;)t=t.parent;return"detail"!=t.key&&"dataview"!=t.key||(e=t),e}field(){let e=this.detailComponent();if(null==e)return null;let t=e.datacollection;if(null==t)return null;let i=t.datasource;if(null==i)return null;let s=i.fields((e=>e.id==this.settings.fieldId))[0];return s&&this.settings.alias&&(s.alias=this.settings.alias),s}getCurrentData(){let e=this.detailComponent();if(!e)return null;let t=e.datacollection;if(!t)return null;let i=this.field();if(!i)return null;let s=t.getCursor();return s?s[i.columnName]:null}componentList(){return[]}get datacollection(){return null}}},38208:(e,t,i)=>{const s=i(54325),n={height:0},a={key:"detailtext",icon:"etsy",labelKey:"ab.components.detail.text"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s??a)}static common(){return a}static defaultValues(){return n}fromValues(e){super.fromValues(e),this.settings.height=parseInt(this.settings.height||n.height)}}},80796:(e,t,i)=>{const s=i(54325),n={},a={key:"detailtree",icon:"sitemap",labelKey:"ab.components.detail.tree"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s??a)}static common(){return a}static defaultValues(){return n}}},26736:(e,t,i)=>{const s=i(4814),n={buttonlabel:"Download DOCX",dataviewID:null,width:0,filename:"",filelabel:"output.docx",language:"en",toolbarBackground:"ab-background-default",buttonPosition:"left"},a={key:"docxBuilder",icon:"file-word-o",labelKey:"DOCX Builder"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}toObj(){this.unTranslate(this,this,["filelabel","buttonlabel"]);let e=super.toObj();return e.viewIDs=[],e}fromValues(e){super.fromValues(e),this.settings.width=parseInt(this.settings.width||n.width),this.translate(this,this,["filelabel","buttonlabel"])}uploadUrl(){const e=this.datacollection.datasource,t=e?e.fields()[0]:null;return`/file/upload/${e?.id}/${t?.id}/1`}downloadUrl(){return`/file/${this.settings.filename}`}get languageCode(){return this.settings.language||n.language}get datacollections(){let e=(this.settings||{}).dataviewID;if(!e)return[];let t=e.split(",")||[];return this.AB.datacollections((e=>t.indexOf(e.id)>-1))||[]}}},46816:(e,t,i)=>{const s=i(94784),n={includeSave:!0,saveLabel:"",includeCancel:!1,cancelLabel:"",includeReset:!1,resetLabel:"",includeDelete:!1,deleteLabel:"",afterCancel:null,alignment:"right",isDefault:!1},a={key:"button",icon:"square",labelKey:"ab.components.button"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}toObj(){let e=[];return this.settings.saveLabel&&e.push("saveLabel"),this.settings.cancelLabel&&e.push("cancelLabel"),this.settings.resetLabel&&e.push("resetLabel"),this.settings.deleteLabel&&e.push("deleteLabel"),this.unTranslate(this.settings,this.settings,e),super.toObj()}get datacollection(){return null}fromValues(e){super.fromValues(e);let t=[];this.settings.saveLabel&&t.push("saveLabel"),this.settings.cancelLabel&&t.push("cancelLabel"),this.settings.resetLabel&&t.push("resetLabel"),this.settings.deleteLabel&&t.push("deleteLabel"),this.unTranslate(this.settings,this.settings,t),this.settings.includeSave=JSON.parse((this.settings?.includeSave??!0)&&n.includeSave),this.settings.includeCancel=JSON.parse(this.settings.includeCancel||n.includeCancel),this.settings.includeReset=JSON.parse(this.settings.includeReset||n.includeReset),this.settings.includeDelete=JSON.parse(this.settings.includeDelete||n.includeDelete),this.settings.isDefault=JSON.parse(this.settings.isDefault||n.isDefault)}componentList(){return[]}}},49947:(e,t,i)=>{const s=i(48933),n={},a={key:"checkbox",icon:"check-square-o",labelKey:"ab.components.checkbox"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}componentList(){return[]}}},91623:(e,t,i)=>{const s=i(48933),n={formView:"",filterConditions:{glue:"and",rules:[]},sortFields:[],popupWidth:700,popupHeight:450},a={key:"connect",icon:"list-ul",labelKey:"Connect"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}fromValues(e){super.fromValues(e),this.settings.filterConditions=this.settings.filterConditions||n.filterConditions}componentList(){return[]}}},31089:(e,t,i)=>{const s=i(35798),n=i(48933),a=i(95652),r=i(17004),o={key:"form",icon:"list-alt",labelKey:"Form"},l={dataviewID:null,showLabel:!0,labelPosition:"left",labelWidth:120,height:200,clearOnLoad:!1,clearOnSave:!1,displayRules:[],editForm:"none",recordRules:[],submitRules:[]};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||o)}static common(){return o}static defaultValues(){return l}fromValues(e){super.fromValues(e),this.settings.labelPosition=this.settings.labelPosition||l.labelPosition,this.settings.showLabel=JSON.parse(null!=this.settings.showLabel?this.settings.showLabel:l.showLabel),this.settings.clearOnLoad=JSON.parse(null!=this.settings.clearOnLoad?this.settings.clearOnLoad:l.clearOnLoad),this.settings.clearOnSave=JSON.parse(null!=this.settings.clearOnSave?this.settings.clearOnSave:l.clearOnSave),this.settings.labelWidth=parseInt(null==this.settings.labelWidth?l.labelWidth:this.settings.labelWidth),this.settings.height=parseInt(null==this.settings.height?l.height:this.settings.height)}objectLoad(e){this._currentObject=e}componentList(){var e=["label","layout","button","text"];return this.application.viewAll().filter((t=>e.indexOf(t.common().key)>-1))}fieldComponents(e){const t=e=>{let i=[];return e.forEach((e=>{null!=e&&(i.push(e),e._views?.length&&(i=i.concat(t(e._views))))})),i};return this._views?.length?(null==e&&(e=e=>e instanceof n),t(this._views).filter(e)):[]}addFieldToForm(e,t){if(null!=e){var i=e.formComponent();if(null!=i){var s=i.newInstance(this.application,this);if(null!=s)return s.settings=s.settings||{},s.settings.fieldId=e.id,null!=t&&(s.position.y=t),this._views.push(s),s}}}get RecordRule(){let e=this.datacollection.datasource;return null==this._recordRule&&(this._recordRule=new a),this._recordRule.formLoad(this),this._recordRule.fromSettings(this.settings.recordRules),this._recordRule.objectLoad(e),this._recordRule}doRecordRulesPre(e){return this.RecordRule.processPre({data:e,form:this})}doRecordRules(e){return e&&!this.datacollection.datasource.isValidData(e).pass()?(console.error("Updated data is invalid.",{rowData:e}),Promise.reject(new Error("Updated data is invalid."))):this.RecordRule.process({data:e,form:this})}doSubmitRules(e){var t=this.datacollection.datasource,i=new r;return i.formLoad(this),i.fromSettings(this.settings.submitRules),i.objectLoad(t),i.process({data:e,form:this})}}},88356:(e,t,i)=>{const s=i(48933),n={},a={key:"fieldcustom",icon:"object-group",labelKey:"ab.components.custom"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}componentList(){return[]}}},28476:(e,t,i)=>{const s=i(48933),n={timepicker:!1},a={key:"datepicker",icon:"calendar",labelKey:"ab.components.datepicker"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}componentList(){return[]}}},68181:(e,t,i)=>{const s=i(94784),n={required:0,disable:0};e.exports=class extends s{static defaultValues(){return n}get datacollection(){let e=this.parentFormComponent();if(null==e)return null;let t=e.datacollection;return null==t?null:t}field(){if(this.settings.objectId){let e=this.AB.objectByID(this.settings.objectId);return e?e.fieldByID(this.settings.fieldId):null}{let e,t=this.parentFormComponent();if(null==t)return null;if(t._currentObject)e=t._currentObject;else{let i=t.datacollection;if(null==i)return null;e=i.datasource}return null==e?null:e.fieldByID(this.settings.fieldId)}}}},88612:(e,t,i)=>{const s=i(48933),n={type:"string"},a={key:"json",icon:"brackets-curly",labelKey:"ab.components.json"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}componentList(){return[]}}},5880:(e,t,i)=>{const s=i(48933),n={isStepper:0},a={key:"numberbox",icon:"hashtag",labelKey:"ab.components.number"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}toObj(){this.unTranslate(this,this,["label","formLabel"]);var e=super.toObj();return e.views=[],e}fromValues(e){super.fromValues(e),this.settings.isStepper=this.settings.isStepper||n.isStepper,this.settings.isStepper=parseInt(this.settings.isStepper)}componentList(){return[]}}},87771:(e,t,i)=>{const s=i(36365),n={},a={key:"fieldreadonly",icon:"calculator",labelKey:"ab.components.readonly"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}componentList(){return[]}}},15934:(e,t,i)=>{const s=i(48933),n={type:"multicombo"},a={key:"selectmultiple",icon:"list-ul",labelKey:"ab.components.selectmultiple"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}componentList(){return[]}}},97241:(e,t,i)=>{const s=i(48933),n={type:"richselect"},a={key:"selectsingle",icon:"list-ul",labelKey:"ab.components.selectsingle"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}componentList(){return[]}}},94782:(e,t,i)=>{const s=i(48933),n={type:"single"},a={key:"textbox",icon:"i-cursor",labelKey:"ab.components.textbox"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}componentList(){return[]}}},68272:(e,t,i)=>{const s=i(36365),n={},a={key:"formtree",icon:"sitemap",labelKey:"ab.components.tree"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}componentList(){return[]}}},28181:(e,t,i)=>{const s=i(4814),n={dataviewID:"",titleFieldID:"",startDateFieldID:"",endDateFieldID:"",durationFieldID:"",progressFieldID:"",notesFieldID:""},a={key:"gantt",icon:"tasks",labelKey:"Gantt"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}fromValues(e){super.fromValues(e),Object.keys(n).forEach((e=>{this.settings[e]=this.settings[e]||n[e]}))}componentList(){return[]}}},1063:(e,t,i)=>{const s=i(4814),n={label:"",dataviewID:"",padding:17,showToolbar:1,isEditable:0,massUpdate:0,allowDelete:0,isSortable:1,isExportable:0,detailsPage:"",detailsTab:"",editPage:"",editTab:"",trackView:0,frozenColumnID:"",hiddenFields:[],summaryColumns:[],countColumns:[],objectWorkspace:{frozenColumnID:"",hiddenFields:[],summaryColumns:[],countColumns:[]},gridFilter:{filterOption:1,userFilterPosition:"toolbar",isGlobalToolbar:1},height:0,hideHeader:0,labelAsField:0,hideButtons:0,groupBy:"",columnConfig:[],saveLocal:1},a={key:"grid",icon:"table",labelKey:"Grid"};function r(e,t){void 0!==e[t]?e[t]=e[t]||n[t]:e[t]=n[t]}function o(e,t){try{e[t]=JSON.parse(e[t])}catch(i){e[t]=n[t]}}e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}fromValues(e){super.fromValues(e),r(this.settings,"dataviewID"),o(this.settings,"padding"),o(this.settings,"showToolbar"),o(this.settings,"isEditable"),o(this.settings,"massUpdate"),o(this.settings,"allowDelete"),o(this.settings,"isSortable"),o(this.settings,"isExportable"),o(this.settings,"hideHeader"),o(this.settings,"labelAsField"),o(this.settings,"hideButtons"),o(this.settings,"columnConfig"),o(this.settings,"saveLocal"),this.settings.gridFilter=this.settings.gridFilter||n.gridFilter;try{this.settings.gridFilter.filterOption=JSON.parse(this.settings.gridFilter.filterOption)}catch(e){this.settings.gridFilter.filterOption=n.gridFilter.filterOption}try{this.settings.gridFilter.isGlobalToolbar=JSON.parse(this.settings.gridFilter.isGlobalToolbar)}catch(e){this.settings.gridFilter.isGlobalToolbar=n.gridFilter.isGlobalToolbar}r(this.settings,"detailsPage"),r(this.settings,"editPage"),r(this.settings,"detailsTab"),r(this.settings,"editTab"),o(this.settings,"trackView");var t=["sortFields","filterConditions","frozenColumnID","hiddenFields","summaryColumns","countColumns"];this.settings.objectWorkspace&&t.forEach((e=>{null==this.settings[e]&&(this.settings[e]=this.settings.objectWorkspace[e])})),t.forEach((e=>{r(this.settings,e)})),this._views=[]}componentList(){return[]}removeField(e,t){let i=!1;if(this.settings?.frozenColumnID==e.columnName&&(this.settings.frozenColumnID="",i=!0),this.settings.hiddenFields?.length){let t=this.settings.hiddenFields.indexOf(e.columnName);t>-1&&(this.settings.hiddenFields.splice(t,1),i=!0)}if(this.settings.summaryColumns?.length){let t=this.settings.summaryColumns.indexOf(e.id);t>-1&&(this.settings.summaryColumns.splice(t,1),i=!0)}if(this.settings.countColumns?.length){let t=this.settings.countColumns.indexOf(e.id);t>-1&&(this.settings.countColumns.splice(t,1),i=!0)}t(null,i)}copyUpdateProperyList(){return["detailsPage","detailsTab","editPage","editTab"]}}},94606:(e,t,i)=>{const s=i(4814),n={filename:"",width:200,height:100},a={key:"image",icon:"picture-o",labelKey:"Image"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}componentList(){return[]}get datacollection(){return null}fromValues(e){super.fromValues(e),this.settings.width=parseInt(this.settings.width||n.width),this.settings.height=parseInt(this.settings.height||n.height)}}},42928:(e,t,i)=>{const s=i(4814),n={dataviewID:null,editFields:[],verticalGroupingField:"",horizontalGroupingField:"",ownerField:"",template:""},a={key:"kanban",icon:"columns",labelKey:"Kanban"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}fromValues(e){super.fromValues(e),this.settings.template||(this.settings.template={id:`${this.id}_template`,key:"text"},this.settings.template.text=this.settings.textTemplate),this.TextTemplate=this.AB.viewNewDetatched(this.settings.template)}toObj(){var e=super.toObj();return e.settings.template=this.TextTemplate.toObj(),e.settings.template.id=`${this.id}_template`,e}static common(){return a}static defaultValues(){return n}}},29247:(e,t,i)=>{const s=i(4814),n={text:"",format:0,alignment:"left"},a={key:"label",icon:"font",labelKey:"Label"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}toObj(){this.unTranslate(this,this,["label","text"]);var e=super.toObj();return e.viewIDs=[],e}fromValues(e){super.fromValues(e),this.text=e.text||e.settings.text||"*text",this.settings.format=this.settings.format||n.format,this.settings.alignment=this.settings.alignment||n.alignment,this._views=[],this.settings.format=parseInt(this.settings.format),this.translate(this,this,["label","text"])}componentList(){return[]}formatNormal(){this.settings.format=0}formatTitle(){this.settings.format=1}formatDescription(){this.settings.format=2}}},79361:(e,t,i)=>{const s=i(35798),n=i(4814),a={label:"",numColumns:1},r={key:"layout",icon:"columns",labelKey:"Layout"};e.exports=class extends n{constructor(e,t,i,s){super(e,t,i,s||r)}static common(){return r}static defaultValues(){return a}addColumn(){this._views.push(this.application.viewNew({key:s.common().key},this.application,this))}componentList(e){return e?[]:this.parent?this.parent.componentList(!1):[]}get datacollection(){return null}}},17145:(e,t,i)=>{const s=i(4814),n={dataviewID:null,field:null,height:0},a={key:"list",icon:"list-ul",labelKey:"List"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}componentList(){return[]}field(){var e=this.datacollection;if(!e)return null;var t=e.datasource;return t?t.fieldByID(this.settings.field):null}}},57888:(e,t,i)=>{const s=i(4814),n={orientation:"x",buttonStyle:"ab-menu-default",menuAlignment:"ab-menu-left",menuInToolbar:1,menuPadding:10,menuTheme:"bg_gray",menuPosition:"left",menuTextLeft:"",menuTextRight:"",menuTextCenter:"",pages:[],order:[]},a={key:"menu",icon:"th-large",labelKey:"Menu"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}toObj(){this.unTranslate(this,this,["menuTextLeft","menuTextCenter","menuTextRight"]),this.settings.pages&&this.settings.pages.forEach((e=>{this.unTranslate(e,e,["aliasname"])}));var e=super.toObj();return e.viewIDs=[],e}fromValues(e){super.fromValues(e),this.translate(this,this,["menuTextLeft","menuTextCenter","menuTextRight"]),this.settings.pages=this.settings.pages||n.pages;for(var t=0;t<this.settings.pages.length;t++){var i=this.settings.pages[t];i instanceof Object?(i.isChecked=JSON.parse(i.isChecked||!1),this.translate(i,i,["aliasname"])):"string"==typeof i&&(this.settings.pages[t]={pageId:i,isChecked:!0})}}componentList(){return[]}ClearPagesInView(e){e&&e.count()>1&&e.find({}).forEach((t=>{e.remove(t.id)}))}get datacollection(){return null}AddPagesToView(e,t){e&&t&&(t||[]).forEach((t=>{if(t.isChecked){let s=this.application.pages((e=>e.id==t.pageId),!0)[0];if(!s)return;if(0==s.getUserAccess())return;if(t.tabId){let e=this.application.views((e=>e.id==t.tabId),!0)[0];if(!e)return;if(0==e.getUserAccess())return}let n=this.getAliasname(t);var i;if(null==(i=t.parent&&"0"!=t.parent?e.getSubMenu(t.parent):e)&&(e.getMenuItem(t.parent).submenu=[],e.refresh(t.parent),i=e.getSubMenu(t.parent)),i.exists(t.tabId||t.pageId))return;i.add({id:t.tabId||t.pageId,value:n,type:t.type,pageId:t.pageId,icon:t.icon?"fa fa-fw fa-"+t.icon:""},t.position?parseInt(t.position):0)}}))}getAliasname(e){var t=this.AB.Multilingual.currentLanguage(),i=e.translations.filter((e=>e.language_code==t)),s="";if(i.length&&(i[0].aliasname?s=i[0].aliasname:i[0].label&&(s=i[0].label)),!s&&e.aliasname&&(s=e.aliasname),!s||!s.replace(/\[.{2,}\]/g,"")){var n;n=e.pageId?e.pageId:this.getParentPageId(e);var a=this.application.pages((e=>e.id==n),!0)[0];if(a)if("tab"==e.type||"viewcontainer"==e.key){var r=a.views((t=>t.id==e.tabId||t.id==e.id),!0)[0];r&&(s=r.label)}else s=a.label}return s}getParentPageId(e){return"page"!=e.key?this.getParentPageId(e.parent):e.id}copy(e,t){return super.copy(e,t).then((t=>((t.settings.pages||[]).forEach(((i,s)=>{let n=t.settings.pages[s];"string"==typeof n?t.settings.pages[s]=e[n]:(n.pageId=e[n.pageId],n.tabId=e[n.tabId])})),t.save().then((()=>t)))))}}},47497:(e,t,i)=>{const s=i(4814),n=i(17004),a={dataviewID:null,fieldID:null,submitRules:[]},r={key:"pdfImporter",icon:"file-pdf-o",labelKey:"PDF Importer"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||r)}static common(){return r}static defaultValues(){return a}fromValues(e){super.fromValues(e),this.settings.dataviewID=this.settings.dataviewID??a.dataviewID,this.settings.fieldID=this.settings.fieldID??a.fieldID}toObj(){var e=super.toObj();return e.settings=e.settings??{},e}componentList(){return[]}doSubmitRules(e){const t=this.datacollection.datasource,i=new n;i.formLoad(this),i.fromSettings(this.settings.submitRules),i.objectLoad(t),e&&!Array.isArray(e)&&(e=[e]),e?.forEach((e=>{i.process({data:e,form:this})}))}}},28326:(e,t,i)=>{const s=i(35798),n={key:"page",icon:"file"},a={type:"page",popupWidth:700,popupHeight:450,pageWidth:null,fixedPageWidth:0,pageBackground:"ab-background-default"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||n),this.parent=null}static common(){return n}static defaultValues(){return a}static getPageActionKey(e){return["opstools","AB_"+String(e.application.name).replace(/[^a-z0-9]/gi,""),String(e.name).replace(/[^a-z0-9]/gi,"").toLowerCase(),"view"].join(".")}toObj(){var e=super.toObj();return e.name=this.name,e.myAppID=this.myAppID,"popup"==this.settings.type&&(e.icon="clone"),this.label&&"?label?"!=this.label||(e.label=e.name),e.pageIDs=(this._pages||[]).map((e=>e.id)),e}fromValues(e){super.fromValues(e),"popup"==e.settings.type&&(this.icon="clone"),this.label&&"?label?"!=this.label||(this.label=this.name),this.myAppID=e.myAppID,!this.myAppID&&this.application&&(this.myAppID=this.application.id);var t=[];(e.pageIDs||[]).forEach((e=>{var i=this.AB.definitionByID(e);i?t.push(this.pageNew(i)):this.AB.error(`App[${this.application.name}][${this.application.id}]->Page[${this.name}][${this.id}] referenced an unknown Page[${e}]`)})),this._pages=t,this.settings.columns=this.settings.columns||1,this.settings.gravity=this.settings.gravity||[1]}destroy(){return Promise.resolve().then((()=>{var e=[],t=this.pages();return this._pages=[],t.forEach((t=>{e.push(t.destroy())})),Promise.all(e)})).then((()=>(this.parent||this.application).pageRemove(this))).then((()=>super.destroy()))}save(){return Promise.resolve().then((()=>super.save())).then((()=>(this.parent||this.application).pageInsert(this))).then((()=>this))}refreshInstance(){return console.warn("This version of ABViewPage hasn't updated it's refreshInstance()",this),this}pages(e=(()=>!0),t=!1){var i=[];return e&&t?this._pages&&this._pages.length>0&&(i=this._pages.filter(e)).length<1&&this._pages.forEach((s=>{var n=s.pages(e,t);n&&n.length>0&&(i=n)})):i=this._pages.filter(e),i}pageInsert(e){return this.pages((t=>t.id===e.id)).length>0?Promise.resolve():(this._pages.push(e),this.save())}pageNew(e){e.key=n.key;var t=this.application.viewNew(e,this.application,null);return t.parent=this,t}pageRemove(e){var t=this._pages.length;return this._pages=this.pages((function(t){return t.id!=e.id})),this._pages.length<t?this.save():Promise.resolve()}urlPage(){return this.urlPointer()+"/_pages/"}urlPointer(){return this.parent?this.parent.urlPage()+this.id:this.application.urlPage()+this.id}updateIcon(e){return"popup"==e.settings.type?e.icon="clone":e.icon=n.icon,e}clone(e,t){if(null==e){e={};let t=i=>{e[i.id]||(e[i.id]=this.AB.uuid()),i.pages&&i.pages().forEach((e=>t(e))),i.views&&i.views().forEach((e=>t(e)))};t(this)}let i=super.clone(e,t);return i.name=null,i}copy(e,t,i){if(null==e){e={};let t=i=>{e[i.id]||(e[i.id]=this.AB.uuid()),i.pages&&i.pages().forEach((e=>t(e))),i.views&&i.views().forEach((e=>t(e)))};t(this)}return super.copy(e,t,i)}}},89062:(e,t,i)=>{const s=i(4814),n={dataviewID:null,removeMissed:0,totalColumn:0,separateLabel:0,min:0,max:0,height:0},a={key:"pivot",icon:"cube",labelKey:"Pivot"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}fromValues(e){super.fromValues(e),this.settings.removeMissed=JSON.parse(this.settings.removeMissed||n.removeMissed),this.settings.totalColumn=JSON.parse(this.settings.totalColumn||n.totalColumn),this.settings.separateLabel=JSON.parse(this.settings.separateLabel||n.separateLabel),this.settings.min=JSON.parse(this.settings.min||n.min),this.settings.max=JSON.parse(this.settings.max||n.max),this.settings.structure&&"string"==typeof this.settings.structure&&(this.settings.structure=JSON.parse(this.settings.structure)),this.settings.height=parseInt(this.settings.height||n.height)}toObj(){var e=super.toObj();return e.views=[],e.settings=e.settings||{},this.settings.structure&&(e.settings.structure=JSON.stringify(this.settings.structure)),e}componentList(){return[]}}},78379:(e,t,i)=>{const s=i(4814),n={dataviewID:"",dataviewFields:{name:"",text:"",queries:""},datacollectionIDs:[],editMode:0,hideCommonTab:0,hideDataTab:0,hideViewTab:0},a={key:"reportsManager",icon:"wpforms",labelKey:"Reports Manager"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a)}static common(){return a}static defaultValues(){return n}fromValues(e){super.fromValues(e);const t={};Object.keys(n).forEach((e=>{if("object"==typeof n[e]&&!Array.isArray(n[e]))return t[e]={},void Object.keys(n[e]).forEach((i=>{t[e][i]=this.settings[e]?.[i]??n[e][i]}));t[e]=this.settings[e]??n[e]})),this.settings=t}toObj(){var e=super.toObj();return e.settings=e.settings||{},e}componentList(){return[]}}},47385:(e,t,i)=>{const s=i(4814),n={readonly:0,dataviewID:"",dataviewFields:{name:"",start:"",end:"",allDay:"",repeat:"",calendar:"",color:"",sectionID:"",unitID:"",notes:"",originID:""},calendarDataviewID:"",calendarDataviewFields:{title:"",color:"",active:""},timeline:{day:1,week:1,month:1,year:1,agenda:1,timeline:1,units:1},timelineSectionList:"",unitList:"",export:{excel:0,csv:0,pdf:0}},a={key:"scheduler",icon:"calendar",labelKey:"Scheduler"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a),this._object=null}static common(){return a}static defaultValues(){return n}toObj(){this.unTranslate(this,this,["scheduler"]);const e=super.toObj();return e.views=[],e}fromValues(e){super.fromValues(e),this.settings=this.settings||{},this.settings.dataviewFields=this.settings.dataviewFields||{},this.settings.calendarDataviewFields=this.settings.calendarDataviewFields||{},this.settings.timeline=this.settings.timeline||{},this.settings.export=this.settings.export||{};const t={};Object.keys(n).forEach((e=>{if("object"==typeof n[e])return t[e]={},void Object.keys(n[e]).forEach((i=>{t[e][i]=this.settings[e][i]??n[e][i]}));t[e]=this.settings[e]??n[e]})),this.settings=t,this.scheduler=e.scheduler||n.scheduler,this.translate(this,this,["scheduler"])}componentList(){return[]}}},39646:(e,t,i)=>{const s=i(4814),n=i(35798),a={height:0,minWidth:0,stackTabs:0,darkTheme:0,sidebarWidth:200,sidebarPos:"left",iconOnTop:0,hintID:null},r={key:"tab",icon:"window-maximize",labelKey:"Tab"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||r)}static common(){return r}static defaultValues(){return a}fromValues(e){super.fromValues(e),this.settings.height=parseInt(this.settings.height),this.settings.minWidth=parseInt(this.settings.minWidth||0),this.settings.stackTabs=parseInt(this.settings.stackTabs),this.settings.darkTheme=parseInt(this.settings.darkTheme),this.settings.sidebarWidth=parseInt(this.settings.sidebarWidth),this.settings.iconOnTop=parseInt(this.settings.iconOnTop)}addTab(e,t){return this.application.viewNew({key:n.common().key,label:e,tabicon:t},this.application,this).save()}componentList(){return[]}}},63527:(e,t,i)=>{const s=i(4814),n={text:"",height:0,dataviewID:null},a={key:"text",icon:"font",labelKey:"Text"};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||a),this._object=null}static common(){return a}static defaultValues(){return n}toObj(){this.unTranslate(this,this,["text"]);var e=super.toObj();return e.views=[],e}fromValues(e){super.fromValues(e),this.settings=this.settings||{},this.settings.height=parseInt(this.settings.height||n.height),this.text=e.text||n.text,this.translate(this,this,["text"])}componentList(){return[]}get datacollection(){return"dataview"==this.parent?.key?this.AB.datacollectionByID(this.parent.settings.dataviewID):this.AB.datacollectionByID(this.settings.dataviewID)}fieldKey(e){let t=e.label||"";return t=t.replace(/\(/g,"\\("),t=t.replace(/\)/g,"\\)"),t}displayText(e,t){var i=this.text,s=this.datacollection,n=s?.datasource??this._object;if(!n)return(e=>e.replace(/{(.*?)}/g,""))(i);const a=e||s.getCursor()||{};return n.fields().forEach((e=>{let t=this.fieldKey(e);var s=new RegExp("{"+t+"}","g"),n=e.format(a);if("image"==e.key){var r=n;n=e.urlImage(r),!r&&e.settings.defaultImageUrl&&e.settings.useDefaultImage?n=e.urlImage(e.settings.defaultImageUrl):i=i.replace("img","img onerror='this.parentNode.removeChild(this);' ")}i=i.replace(s,n)})),i=i.replace(/{PK}/g,a[n.PK()])}objectLoad(e){this._object=e}}},8846:(e,t,i)=>{const s=i(94784),n={key:"viewwidget",icon:"circle-o-notch ",labelKey:"ab.components.widget"},a={columnSpan:1,rowSpan:1};e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s||n)}static common(){return n}static defaultValues(){return a}fromValues(e){super.fromValues(e),this.settings.columnSpan=parseInt(this.settings.columnSpan||a.columnSpan),this.settings.rowSpan=parseInt(this.settings.rowSpan||a.rowSpan)}}},95995:(e,t,i)=>{i(53059);const s=i(45434),n=i(2983);i(96649),e.exports=class extends s{constructor(e,t){super(e,t),this._handler_page_updated=e=>{var t=[];this.pages().forEach((i=>{i.id!==e.id?t.push(i):t.push(i.refreshInstance(this))})),this._pages=t},this._pages.forEach((e=>{e.on("definition.updated",this._handler_page_updated)}))}static applications(){return console.error("ABApplication.applicationForID(): Depreciated. Who is doing this?"),null}static applicationForID(){var e=new Error("ABApplication.applicationForID(): Depreciated. Who is doing this?");return console.error(e),null}static definitionForID(){var e=new Error("ABApplication.definitionForID(): Depreciated. Who is doing this?");return console.error(e),null}areaKey(){return this.AB.kebabCase(`ab-${this.name}`)}refreshInstance(){var e=this.AB.applicationByID(this.id);return this._pages.forEach((e=>{e.removeListener("definition.updated",this._handler_page_updated)})),e}async _listInsert(e,t){-1!=this[t].indexOf(e.id)||(this[t].push(e.id),await this.save())}async _listRemove(e,t){var i=this[t].length;this[t]=this[t].filter((t=>t!=e.id)),i!=this[t].length&&await this.save()}datacollectionInsert(e){return this._listInsert(e,"datacollectionIDs")}datacollectionRemove(e){return this._listRemove(e,"datacollectionIDs")}objectInsert(e){return this._listInsert(e,"objectIDs")}objectRemove(e){return this._listRemove(e,"objectIDs")}processInsert(e){return this._listInsert(e,"processIDs")}processRemove(e){return this._listRemove(e,"processIDs")}queryInsert(e){return this._listInsert(e,"queryIDs")}queryRemove(e){return this._listRemove(e,"queryIDs")}exportIDs(e){if(!(e.indexOf(this.id)>-1)){e.push(this.id),this.objectsIncluded().forEach((t=>{t.exportIDs(e)})),this.hintsIncluded().forEach((t=>{t.exportIDs(e)})),this.queriesIncluded().forEach((t=>{t.exportIDs(e)})),this.datacollectionIDs.forEach((t=>{if(!(e.indexOf(t)>-1)){var i=this.AB.definitionByID(t);if(i&&(e.push(t),i.settings.datasourceID)){var s=this.AB.objectByID(i.settings.datasourceID);s&&s.exportIDs(e)}}})),this.processes().forEach((t=>{t.exportIDs(e)}));var t=i=>{e.indexOf(i.id)>-1||(e.push(i.id),(i.pageIDs||[]).forEach((e=>{var i=this.AB.definitionByID(e);i&&t(i)})),(i.viewIDs||[]).forEach((e=>{var i=this.AB.definitionByID(e);i&&t(i)})))};(this._pages.map((e=>e.id))||[]).forEach((e=>{var i=this.AB.definitionByID(e);i&&t(i)})),e=this.AB.uniq(e)}}pageNew(e){return new n(e,this)}async pageInsert(e){if(!this._pages.filter((t=>t.id==e.id))[0])return this._pages.push(e),this.save()}async pageRemove(e){var t=this._pages.length;if(this._pages=this.pages((function(t){return t.id!=e.id})),this._pages.length<t)return this.save()}save(){return this.name!=this.label&&(this.name=this.label),super.save()}warningsEval(){super.warningsEval();var e={objectIDs:"object",queryIDs:"query",datacollectionIDs:"datacollection"};Object.keys(e).forEach((t=>{this[t].forEach((i=>{this.AB.definitionByID(i)||this.warningsMessage(` is referencing a missing ${e[t]}`,{appID:this.id,id:i})}))})),0!=this.roleAccess.length||this.isAccessManaged||this.warningsMessage(" has no Role assigned, and is unaccessible.");var t=this.AB.Account.rolesAll().map((e=>e.id));this.roleAccess.forEach((e=>{-1==t.indexOf(e)&&this.warningsMessage(`Specified Role Access [${e}] does not exist in this system`,{role:e})})),this.pages().forEach((e=>{e.warningsEval()}))}warningsAll(){var e=[].concat(this._warnings);return["objectsIncluded","queriesIncluded","datacollectionsIncluded","processes","pages"].forEach((t=>{this[t]().forEach((t=>{e=e.concat(t.warningsAll())}))})),e}warningsMessage(e,t={}){let i=`Application[${this.label}]: ${e}`;this._warnings.push({message:i,data:t})}}},90804:(e,t,i)=>{i(53059);const s=i(50085),n=i(18315);i(96649),e.exports=class extends s{constructor(e,t){super(e,t)}pageNew(e){const t=new n(e,this);return t.parent=this,t}async setPageDefault(e){if(this.pageDefault!=e.id){let t=this.pageByID(this.pageDefault,!0);t&&(t.defaultPage=0,await t.save()),this.pageDefault=e.id,await this.save()}}}},52174:(e,t,i)=>{const s=i(26263),n=i(60427);let a=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{constructor(e,t,i){super(),this.AB=i,!i&&e?.AB&&(this.AB=e.AB),e||(this.AB._App?e=this.AB._App:(e={uuid:this.AB.Webix.uid(),AB:this.AB,actions:{},config:this.AB.UISettings.config(),custom:null,icons:this.AB.UISettings.icons,Label:a,labels:{add:a("Add"),create:a("Create"),delete:a("Delete"),edit:a("Edit"),export:a("Export"),formName:a("Name"),import:a("Import"),rename:a("Rename"),ok:a("Ok"),cancel:a("Cancel"),save:a("Save"),yes:a("Yes"),no:a("No"),none:a("None"),close:a("Close"),default:a("Default"),defaultPlaceholder:a("Enter default value"),disable:a("Disable"),required:a("Required"),unique:a("Unique"),invalidMessage:{required:a("This field is required")},createErrorMessage:a("System could not create <b>{0}</b>."),createSuccessMessage:a("<b>{0}</b> is created."),updateErrorMessage:a("System could not update <b>{0}</b>."),updateSucessMessage:a("<b>{0}</b> is updated."),deleteErrorMessage:a("System could not delete <b>{0}</b>."),deleteSuccessMessage:a("<b>{0}</b> is deleted."),renameErrorMessage:a("System could not rename <b>{0}</b>."),renameSuccessMessage:a("<b>{0}</b> is renamed."),dataFieldHeaderLabel:a("Section Title"),dataFieldHeaderLabelPlaceholder:a("Section Name"),dataFieldLabel:a("Label"),dataFieldLabelPlaceholder:a("Label"),dataFieldColumnName:a("Field Name"),dataFieldColumnNamePlaceholder:a("Database field name"),dataFieldShowIcon:a("show icon?"),componentDropZone:a("add widgets here")},unique:function(e){return`${e}${this.uuid}`}},this.AB._App=e)),e.custom||(this.AB.custom?e.custom=this.AB.custom:(new n).initComponents(e)),this.App=e,this.idBase=t||"?idbase?"}actions(e){if(console.error("!!! REFACTOR out .actions()"),e)for(var t in e)this.App.actions[t]=e[t]}Label(){return(...e)=>this.AB.Multilingual.label(...e)}unique(e){return this.App.unique(`${this.idBase}_${e}`)}}},35122:(e,t,i)=>{const s=i(76500),n=i(5179);e.exports=class extends n{constructor(e,t){super(e,t),this.setMaxListeners(0)}async save(){return this.id||(this.label=this.label||this.name),await super.save(),this.AB.emit("ab.datacollection.update",{datacollectionId:this.id}),this}isValid(){var e=this.AB.Validation.validator(),t=this.AB.Label();return 0==this.AB.datacollections((e=>e.id!=this.id&&e.name.toLowerCase()==this.name.toLowerCase())).length||e.addError("name",t('Name must be unique ("{0}" already in use)',[this.name])),e}currentUserUsername(){return this.AB.Account.username()}init(){this.initialized||(super.init(),["ab.datacollection.create","ab.datacollection.update","ab.datacollection.stale","ab.datacollection.delete"].forEach((e=>{this.AB.on(e,(t=>{this.emit(e,t)}))})),this.bindParentDc())}bindParentDc(){let e=this.datacollectionLink,t=this.fieldLink;if(!this.settings.loadAll&&e&&t){let i=this.__dataCollection;i.bind(e.__dataCollection,t.id),i.define("dataFeed",((e,t)=>{let s=!1;i.__prevLinkDcCursor!=e&&(s=!0),i.__prevLinkDcCursor=this?.datacollectionLink?.getCursor()?.id,this.datacollectionLink&&null==e&&null==i.__prevLinkDcCursor?this.clearAll():s&&this.reloadData(0,20)}))}}loadData(e,t=20){return super.loadData(e,t).catch((e=>{if(this.hideProgressOfComponents(),this.emit("loadData",{}),e)throw e}))}processIncomingData(e){return e.data&&!Array.isArray(e.data)&&(e.data=[e.data]),super.processIncomingData(e).then((()=>{this.hideProgressOfComponents()}))}attachFlexlayout(e){this.__dataCollection,this.__flexComponentIds.indexOf(e.config.id)>-1||this.__flexComponentIds.push(e.config.id)}bind(e){var t=this.__dataCollection;-1===this.__bindComponentIds.indexOf(e.config.id)&&this.__bindComponentIds.push(e.config.id),$$(e.config.id).data?.find?.({}).length>0||("datatable"==e.config.view||"dataview"==e.config.view||"treetable"==e.config.view||"kanban"==e.config.view?t?(0!=t.count()||this._dataStatus!=this.dataStatusFlag.notInitial&&this._dataStatus!=this.dataStatusFlag.initializing||!e.showProgress||e.showProgress({type:"icon"}),e.define("datafetch",20),e.define("datathrottle",500),"treetable"==e.config.view?this.datasource&&this.datasource.isGroup&&this.__treeCollection?(e.define("data",this.__treeCollection),e.refresh()):(e.define("data",[]),e.parse(t.find({}))):e.data.sync(t),this.settings.loadAll||(e.___AD=e.___AD||{},e.___AD.onDataRequestEvent||(e.___AD.onDataRequestEvent=e.attachEvent("onDataRequest",((i,s)=>(e.showProgress&&e.showProgress({type:"icon"}),t.loadNext(s,i),!1)))))):e.data.unsync():e.bind&&(t?e.bind(t):e.unbind(),e.refresh&&e.refresh()))}unbind(e){e&&(e.detachEvent("onDataRequest"),e.___AD&&(e.___AD.onDataRequestEvent&&delete e.___AD.onDataRequestEvent,e.___AD.onDcLoadData&&(this.off&&this.off("loadData",e.___AD.onDcLoadData),delete e.___AD.onDcLoadData)),e.data&&e.data.unsync&&(e.data.unsync(),e.define("data",[])),e.unbind&&e.unbind(),e.refresh&&e.refresh(),this.__bindComponentIds=(this.__bindComponentIds||[]).filter((t=>t!=e.config.id)))}hideProgressOfComponents(){this.__bindComponentIds.forEach((e=>{$$(e)&&$$(e).hideProgress&&$$(e).hideProgress()}))}_dataCollectionNew(e){let t=new webix.DataCollection({data:e||[]});return this._extendCollection(t),t}_treeCollectionNew(){let e=new webix.TreeCollection;return this._extendCollection(e),e}_extendCollection(e){webix.extend(e,webix.SelectionModel),e.___AD=e.___AD||{},this.settings.loadAll||(e.___AD.onDataRequestEvent||(e.___AD.onDataRequestEvent=e.attachEvent("onDataRequest",((e,t)=>(e<0&&(e=0),this.loadData(e,t),!1)))),e.___AD.onAfterLoadEvent||(e.___AD.onAfterLoadEvent=e.attachEvent("onAfterLoad",(()=>{this.emit("loadData",{})})))),e.addCss=function(){},e.removeCss=function(){},e.render=function(){},e.___AD.onAfterLoad||(e.___AD.onAfterLoad=e.attachEvent("onAfterLoad",(()=>{this.hideProgressOfComponents()})))}parseTreeCollection(e={}){if(!(this.__datasource instanceof s&&this.__datasource.isGroup&&this.__treeCollection))return;let t=(i={},s=null)=>{let n=i.alias;(e.data||[]).forEach((e=>{let t=e[`${n}.uuid`]||e[`${n}.id`];if(!t)return;let i=[],a=e[`${s}.uuid`]||e[`${s}.id`];if(a&&(i=this.__treeCollection.find((e=>e._alias==s&&e._dataId==a)).map((e=>e.id))),this.__treeCollection.find((e=>e._alias==n&&e._dataId==t&&(0==i.length||i.indexOf(e.$parent)>-1)),!0))return;let r={};r._alias=n,r._dataId=t,r._itemId=e.id,Object.keys(e).forEach((t=>{0==t.indexOf(`${n}.`)&&(r[t]=e[t])})),e.translations&&(r.translations=e.translations),i.length>0?i.forEach((e=>{this.__treeCollection.add(r,null,e)})):this.__treeCollection.add(r,null)})),(i.links||[]).forEach((e=>{t(e,n)}))};(this.__bindComponentIds||[]).forEach((e=>{let t=$$(e);t&&t.showProgress&&t.showProgress({type:"icon"}),t.data&&t.data.unsync&&t.data.unsync()})),t(this.__datasource.joins()),(this.__bindComponentIds||[]).forEach((e=>{let t=$$(e);t&&t.hideProgress&&t.hideProgress(),t.define("data",this.__treeCollection)}))}warningsEval(){super.warningsEval(),this.datasource?this.linkDatacollectionID&&(this.AB.datacollectionById(this.linkDatacollectionID)||this.warningsMessage(`can't resolve linkDatacollectionID[${this.linkDatacollectionID}]`)):this.warningsMessage("doesn't have a datasource.")}warningsMessage(e,t={}){let i=`Datacollection[${this.label}]: ${e}`;this._warnings.push({message:i,data:t})}get userScopes(){return this.AB.Account.scopes()}}},84650:(e,t,i)=>{var s=i(32877);e.exports=class extends s{}},26263:(e,t,i)=>{var s=i(5939).EventEmitter;e.exports=class extends s{constructor(){super()}}},17063:(e,t,i)=>{const s=i(43472);let n=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{constructor(e,t){super(e,t)}destroy(e){var t=this.steps(),i=[];t.forEach((e=>{i.push(e.destroy())}));let s=e.hintIDs.indexOf(this.id);s>-1&&(e.hintIDs.splice(s,1),e.save());let a=e.views((e=>e.id==this.settings.view))[0];return a&&(delete a.settings.hintID,a.save()),Promise.all(i).then((()=>new Promise(((e,t)=>{this.toDefinition().destroy().then((()=>{webix.message({text:n("Tutorial Deleted"),type:"success",expire:3e3}),e()})).catch((e=>{t(e)}))}))))}save(){return this.toDefinition().save().then((e=>(this.id||(this.id=e.id),this)))}isValid(){return!0}warningsAll(){}createHintUI(){if($$(this.id))return;let e=[],t=0;if(webix.storage.cookie.get(this.id)?.hide)return;let i=`<label class="dontShow">\n                        <input onclick="webix.storage.cookie.put(this.dataset.hintId, {'hide': this.checked});" data-hint-id="${this.id}" type="checkbox">\n                        ${n("Don't show this again.")}\n                     </label>`;this.stepIDs.forEach((s=>{t++;let n={};n.id=this._steps[s].id,n.el=this._steps[s].settings.el,n.event=this._steps[s].settings.event,n.title=this._steps[s].name,n.text=this._steps[s].text+i,this.stepIDs[t]&&(n.nextEl=this._steps[this.stepIDs[t]].settings.el,n.nextEl&&(n.hintId=this.id,n.eventEl="button",n.next=function(e){let t=this.nextEl,i=document.querySelector(t);return i&&i.checkVisibility()||document.querySelector(this.el).click(),!1})),n.el&&e.push(n)}));let s={view:"hint",id:this.id,steps:e,on:{onNext:e=>{setTimeout((()=>{const e=document.querySelectorAll("input[data-hint-id='"+this.id+"']");let t=webix.storage.cookie.get(this.id);e.forEach((e=>{e.checked=t?.hide||!1}))}),100)},onPrevious:e=>{setTimeout((()=>{const e=document.querySelectorAll("input[data-hint-id='"+this.id+"']");let t=webix.storage.cookie.get(this.id);e.forEach((e=>{e.checked=t?.hide||!1}))}),100)}}};webix.delay((()=>{try{webix.ui(s).start()}catch(e){this.AB.notify.developer(e,{context:"ABHint.createUIHint() error calling webix.ui(ui).start()",ui:s})}}),null,null,2e3)}}},97938:(e,t,i)=>{const s=i(12796);e.exports=class extends s{save(){return super.save().then((()=>this.object.indexSave(this))).then((()=>this.migrateCreate()))}destroy(){return new Promise(((e,t)=>{this.id?this.migrateDrop().then((()=>super.destroy())).then((()=>this.object.indexRemove(this))).then(e).catch(t):e()}))}warningsEval(){super.warningsEval(),(this._unknownFieldIDs||[]).forEach((e=>{this.warningsMessage(`is referencing an unknown field id[${e}]`)})),0==this.fields.length&&this.warningsMessage("is not referencing any fields")}warningsMessage(e,t={}){let i=`Index[${this.label}]: ${e}`;this._warnings.push({message:i,data:t})}migrateCreate(){return this.AB.Network.post({url:`/definition/migrate/object/${this.object.id}/index/${this.id}`})}migrateDrop(){return this.AB.Network.delete({url:`/definition/migrate/object/${this.object.id}/index/${this.id}`})}}},70504:(e,t,i)=>{var s=i(21177);e.exports=class extends s{constructor(e,t){super(e,t),this._warnings=[]}warnings(){return this._warnings}warningsEval(){this._warnings=[]}warningsAll(){return this.warnings()}languageDefault(){return this.AB.Account.language()||"en"}async destroy(){var e=this.toDefinition();return e.id?e.destroy().catch((t=>{if(t.toString().indexOf("No record found")>-1)return console.log(`ABMLClass.destroy(): could not find record for id[${e.id}]`),void console.log(e);throw t})):Promise.resolve()}async save(){var e=this.toDefinition();e.name=e.name||this.name||this.label||"name";var t=await e.save();this.id||(this.id=t.id)}}},58174:(e,t,i)=>{const s=i(69410);function n(e){e&&e.data&&"READONLY"==e.data.error&&webix.alert({title:"Your action is blocked",ok:"Ok",text:e.data.message||"",type:"alert-warning"})}function a(e,t,i){"socket"!=e.AB.Network.type()&&e.AB.emit(t,{objectId:e.object.id,data:i})}e.exports=class extends s{constructor(e){super(e),this.handler_create=(...e)=>{this.handler_common("ab.datacollection.create",...e)},this.handler_delete=(...e)=>{this.handler_common("ab.datacollection.delete",...e)},this.handler_findAll=(...e)=>{this.handler_common(null,...e)},this.handler_logs=(e,t,i)=>{t?e.reject?.(t):e.resolve?.(i)},this.handler_update=(...e)=>{this.handler_common("ab.datacollection.update",...e)},this.handler_common=(e,t,i,s)=>{i?t.reject?.(i):(e?-1==e.indexOf("delete")&&this.normalizeData(s):this.normalizeData(s.data),t.resolve?.(s))}}prepareMultilingualData(e){var t=this.object.multilingualFields(),i=!1;t.length&&t.forEach((function(t){null!=e[t]&&(i=!0)})),i&&(null!=e.translations&&void 0!==e.translations&&""!=e.translations||(e.translations=[]),this.object.unTranslate(e,e,t))}request(e,t){return this.AB.Network[e](t)}batchCreate(e){return e.batch.map((e=>this.prepareMultilingualData(e.data))),new Promise(((t,i)=>{var s=this.AB.jobID();this.AB.Network.once(s,((e,s,n)=>{s?i(s):(this.normalizeData(n),t(n))})),this.AB.Network.post({url:this.object.urlRestBatch(),params:e},{key:s,context:{}}).catch(i)}))}create(e){return this.prepareMultilingualData(e),this.object.fields().forEach((t=>{void 0===e[t.columnName]&&t.defaultValue(e)})),new Promise(((t,i)=>{var s=this.AB.jobID();this.AB.Network.once(s,this.handler_create),this.AB.Network.post({url:this.object.urlRest(),params:e},{key:s,context:{resolve:t,reject:i}}).then((e=>{})).catch((e=>{n(e),i(e)}))})).then((e=>(a(this,"ab.datacollection.create",e),e)))}delete(e){return new Promise(((t,i)=>{var s=this.AB.jobID();this.AB.Network.once(s,this.handler_delete),this.AB.Network.delete({url:this.object.urlRestItem(e)},{key:s,id:e,context:{resolve:t,reject:i}}).catch((e=>{n(e),i(e)}))})).then((t=>(a(this,"ab.datacollection.delete",e),t)))}async findAll(e){return e=e||{},new Promise(((t,i)=>{var s=this.AB.jobID();this.AB.Network.once(s,this.handler_findAll),this.AB.Network.get({url:this.object.urlRest(),params:e},{key:s,context:{resolve:t,reject:i}}).catch((t=>{t&&t.code&&("ER_PARSE_ERROR"===t.code?this.AB.notify.developer(t,{message:"AppBuilder:ABModel:findAll(): Parse Error with provided condition",condition:e}):this.AB.notify.developer(t,{message:"AppBuilder:ABModel:findAll(): Unknown Error with provided condition",condition:e})),i(t)}))}))}loadInto(e){this._limit&&(e.define("datafetch",this._limit),e.define("datathrottle",250),e.___AD=e.___AD||{},e.___AD.onDataRequestEvent&&e.detachEvent(e.___AD.onDataRequestEvent),e.___AD.onDataRequestEvent=e.attachEvent("onDataRequest",((t,i)=>{var s={where:this._where,sort:this._sort,limit:i,skip:t};return e.showProgress&&e.showProgress({type:"icon"}),this.findAll(s).then((t=>{e.parse(t),e.hideProgress&&e.hideProgress()})),!1})),e.refresh());var t={};this._where&&(t.where=this._where),this._sort&&(t.sort=this._sort),null!=this._limit&&(t.limit=this._limit),null!=this._skip&&(t.skip=this._skip),e.showProgress&&e.showProgress({type:"icon"}),this.findAll(t).then((t=>{e.parse(t),e.hideProgress&&e.hideProgress()})).catch((e=>{console.error("!!!!!",e)}))}logs(e){return new Promise(((t,i)=>{var s=this.AB.jobID();this.AB.Network.once(s,this.handler_logs),this.AB.Network.get({url:this.object.urlRestLog(),params:e},{key:s,context:{resolve:t,reject:i}}).catch((t=>{t&&t.code&&this.AB.notify.developer(t,{context:"AppBuilder:ABModel:logs(): Error",options:e}),i(t)}))}))}limit(e){return this._limit=e,this}skip(e){return this._skip=e,this}update(e,t){for(var i in this.prepareMultilingualData(t),t)null==t[i]&&delete t[i];return new Promise(((i,s)=>{var a=this.AB.jobID();this.AB.Network.once(a,this.handler_update),this.AB.Network.put({url:this.object.urlRestItem(e),params:t},{key:a,context:{resolve:i,reject:s}}).catch((e=>{n(e),s(e)}))})).then((e=>(a(this,"ab.datacollection.update",e),e)))}batchUpdate({rowIds:e,values:t}){return new Promise(((i,s)=>{var n=this.AB.jobID();this.AB.Network.once(n,((e,t)=>{t?s(t):i(!0)})),this.AB.Network.put({url:this.object.urlRestBatch(),params:{rowIds:e,values:t}},{key:n,context:{}}).catch(s)}))}}},34697:(e,t,i)=>{const s=i(58174);e.exports=class extends s{async findAll(e={}){return e.isAPI=!0,e.url=this.object?.request?.url,super.findAll(e)}batchCreate(e){const t=new Error("ABObjectApi.ABModelAPI.batchCreate() does not be implemented.");return Promise.reject(t)}async create(e){const t=new Error("ABObjectApi.ABModelAPI.create() does not be implemented.");return Promise.reject(t)}delete(e){const t=new Error("ABObjectApi.ABModelAPI.delete() does not be implemented.");return Promise.reject(t)}update(e,t){const i=new Error("ABObjectApi.ABModelAPI.update() does not be implemented.");return Promise.reject(i)}batchUpdate({rowIds:e,values:t}){const i=new Error("ABObjectApi.ABModelAPI.batchUpdate() does not be implemented.");return Promise.reject(i)}}},63549:(e,t,i)=>{const s=i(58174);e.exports=class extends s{batchCreate(e){var t=new Error("ABObjectQuery.ABModelQuery.batchCreate() should not be called.");return Promise.reject(t)}create(e){var t=new Error("ABObjectQuery.ABModelQuery.create() should not be called.");return Promise.reject(t)}delete(e){var t=new Error("ABObjectQuery.ABModelQuery.delete() should not be called.");return Promise.reject(t)}update(e,t){var i=new Error("ABObjectQuery.ABModelQuery.update() should not be called.");return Promise.reject(i)}batchUpdate({rowIds:e,values:t}){var i=new Error("ABObjectQuery.ABModelQuery.batchUpdate() should not be called.");return Promise.reject(i)}}},24869:(e,t,i)=>{const s=i(83899);let n=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{constructor(e,t){super(e,t),this.fields().forEach((e=>{e.on("definition.updated",(e=>{var t=this.AB.definitionByID(e.id);if(t){var i=this.AB.fieldNew(t,this),s=[];this.fields().forEach((t=>{t.id!==e.id?s.push(t):s.push(i)})),this._fields=s}}))})),this._pendingNetworkRequests={},this._handler_object_migrate=(e,t,i)=>{var s=this._pendingNetworkRequests?.[e.uuid];t?s?.reject(t):s?.resolve(i)},this.AB.Network.on("object.migrate",this._handler_object_migrate)}refreshInstance(){var e=this.AB.objectByID(this.id);return this._pendingNetworkRequests&&(this.AB.Network.removeListener("object.migrate",this._handler_object_migrate),e._pendingNetworkRequests=this._pendingNetworkRequests,this._pendingNetworkRequests=null),e}fromValues(e){super.fromValues(e),this.workspaceViews&&this.workspaceViews.fromObj(e)}isValid(){var e=this.AB.Validation.validator();return 0==this.AB.objects((e=>e.id!=this.id&&e.name.toLowerCase()==this.name.toLowerCase())).length||e.addError("name",n('Object name must be unique ("{0}" already in use)',[this.name])),e}isValidData(e){var t=this.AB.Validation.validator();return this.fields().forEach((i=>{e.hasOwnProperty(i.columnName)&&i.isValidData(e,t)})),t}async destroy(){try{if(await(()=>{var e=[];return this.AB.applications().forEach((t=>{e.push(t.objectRemove(this))})),Promise.all(e)})(),await(()=>new Promise((e=>{this.AB.queries((e=>e.objects((e=>e.id==this.id)).length>0)).forEach((e=>{e.disabled=!0})),e()})))(),this.isImported)return Promise.resolve();await this.migrateDrop();var e=[];if("object"==this.type){var t=this.fields();this._fields=[],t.forEach((t=>{e.push(t.destroy())}))}await Promise.all(e),await super.destroy(),this.emit("destroyed")}catch(e){this.AB.notify.developer(e,{context:"ABObject.destroy(): error destroying object."})}}async save(e=!1){var t=!1;this.id||(this.label=this.label||this.name,t=!0);try{return await super.save(),t&&!e&&await this.migrateCreate(),this}catch(e){throw this.AB.notify.developer(e,{context:"ABObject.save()",obj:this.toObj()}),e}}toObj(){var e=super.toObj();return e.objectWorkspaceViews=this.workspaceViews?.toObj(),e}migrateCreate(){return new Promise(((e,t)=>{var i=this.AB.uuid();this._pendingNetworkRequests[i]={resolve:e,reject:t};var s={key:"object.migrate",context:{uuid:i,id:this.id}};this.AB.Network.post({url:`/definition/migrate/object/${this.id}`},s)}))}migrateDrop(){return new Promise(((e,t)=>{var i=this.AB.uuid();this._pendingNetworkRequests[i]={resolve:e,reject:t};var s={key:"object.migrate",context:{uuid:i,id:this.id}};this.AB.Network.delete({url:`/definition/migrate/object/${this.id}`},s)}))}columnResize(e,t){for(var i=null,s=0;s<this._fields.length;s++)if(this._fields[s].columnName==e){i=this._fields[s].id;break}var n=this.AB.localSettings(i);return(n=n||{}).width=t,this.AB.localSettings(i,n)}columnHeaders(e,t,i,s,n){i=i||[],s=s||[];var a=[];return this.fields().forEach((n=>{var r=n.columnHeader({isObjectWorkspace:e,editable:t});t&&(r.validationRules=n.settings.validationRules),r.alias=n.alias||void 0,r.fieldID=n.id,0!=n.settings.width&&(r.width=n.settings.width);var o=this.AB.localSettings(n.id);o&&o.width&&(!r.width||o.width>r.width)&&(r.width=o.width),r.width||(r.adjust=!0),i.indexOf(n.id)>-1?"calculate"==n.key||"formula"==n.key?r.footer={content:"totalColumn",field:n}:r.footer={content:"summColumn"}:s.indexOf(n.id)>-1&&(r.footer={content:"countColumn"}),a.push(r)})),a}customDisplays(e,t,i,s,n){if(!e||!e.getFirstId)return;let a=[];if(i.eachColumn((e=>{let t=this.fields((t=>t.columnName==e))[0];t&&a.push(t)})),null!=s)s.forEach((s=>{let r=e.getItem(s);r&&a.forEach((e=>{let s=i.getItemNode({row:r.id,column:e.columnName});e.customDisplay(r,t,s,{editable:n})}))}));else{let s=e.getFirstId();for(;s;){var r=e.getItem(s);r&&a.forEach((e=>{var s=i.getItemNode({row:r.id,column:e.columnName});e.customDisplay(r,t,s,{editable:n})})),s=e.getNextId(s)}}}displayData(e){if(null==e)return"";var t=this.multilingualFields();this.translate(e,e,t);var i=this.labelFormat||"";if(!i&&this.fields().length>0){var s=this.fields((e=>e.fieldUseAsLabel()))[0];i=s?`{${s.id}}`:`${this.AB.isUUID(e.id)?"ID: ":""}${e.id}`}var a=i.match(/\{[^}]+\}/g);if(a&&a.forEach&&a.forEach((t=>{var s=t.replace("{","").replace("}",""),n=this.fieldByID(s);null!=n&&(i=i.replace(t,n.format(e)||""))})),!i.trim()){let t=this.labelSettings||{};i=t&&t.isNoLabelDisplay?n(t.noLabelText||"[No Label]"):`${this.AB.isUUID(e.id)?"ID: ":""}${e.id}`}return i}currentView(){return this.workspaceViews.getCurrentView()}warningsAll(){var e=super.warningsAll();return this.fields().forEach((t=>{t&&(e=e.concat(t?.warnings()))})),this.indexes().forEach((t=>{t&&(e=e.concat(t?.warnings()))})),e.filter((e=>e))}warningsEval(){super.warningsEval();let e=this.fields();0==e.length&&this.warningsMessage("has no fields"),(this._unknownFieldIDs||[]).forEach((e=>{this.warningsMessage(`is referencing an unknown field id[${e}]`)})),(this._unknownIndex||[]).forEach((e=>{this.warningsMessage(`is referencing an unknown index id[${e}]`)})),e.forEach((e=>{e?.warningsEval()})),this.indexes().forEach((e=>{e?.warningsEval()}))}warningsMessage(e,t={}){let i=`Object[${this.label}]: ${e}`;this._warnings.push({message:i,data:t})}isUuid(e){return console.error("ABObject.isUuid(): is depreciated.  directly reference AB.Rules.isUUID() instead."),this.AB.isUUID(e)}async getDbInfo(){return this.AB.Network.get({url:`/definition/info/object/${this.id}`})}formCleanValues(e){this.fields().forEach((t=>{t.formCleanData(e)}))}}},34532:(e,t,i)=>{const s=i(9853),n=i(84227);e.exports=class extends n{constructor(e,t){super(e,t)}async fetchData(e=20){if(this.isFetched)return;const t=this.headers,i=await s(this.request.url,{method:this.request.verb,headers:t,data:{},timeout:null,withCredentials:!1});let n=this.dataFromKey(i);const a=this.model();if(null==n.length||0===n.length){const e={};return this.response.fields.forEach((t=>{e[t.columnName]=n[t.columnName]})),void await a.create(e)}let r=[];for(let t=0;t<n.length;t++){const i={};this.response.fields.forEach((e=>{i[e.columnName]=n[t][e.columnName]})),r.push(a.create(i)),r%e==0&&await Promise.all(r)}r.length>0&&await Promise.all(r),this.isFetched=!0,await this.save()}async save(){return await super.save(!0)}}},2550:(e,t,i)=>{const s=i(24869);e.exports=class extends s{}},38968:(e,t,i)=>{const s=i(24869);e.exports=class extends s{}},76500:(e,t,i)=>{const s=i(2732);var n=null;"undefined"!=typeof io?io.socket.on("ab.query.update",(function(e){n?n.emit("ab.query.update",{queryId:e.queryId,data:e.data}):(console.error("ABObjectQuery:: received io.socket msg before ABFactory is defined"),console.error("TODO: move this to ABFactory!"))})):console.error("TODO: install socket.io client for sails updates."),e.exports=class extends s{constructor(e,t){super(e,t),n||(n=t),this.AB.on("ab.query.update",(e=>{this.id==e.queryId&&this.fromValues(e.data)})),this.conditionScan(this.where)}importFields(e){super.importFields(e),this._fields.forEach((e=>{e.field.columnName=`${e.alias}.${e.field.columnName}`}))}columnResize(e,t,i){let s=this.fields((t=>t.columnName==e))[0];return s?(s.settings.width=t,this.save()):Promise.resolve()}columnHeaders(e,t,i,s,n){var a=super.columnHeaders(e,t,i,s,n);return a.forEach((e=>{let t=this.objectByAlias(e.alias);if(!t)return;let i=t.fieldByID(e.fieldID);if(!i)return;let s="";if(s=Array.isArray(this.joins())?i.object.name:e.alias,e.id=`${s}.${i.columnName}`,this.settings&&this.settings.hidePrefix?e.header=`${i.label||""}`:e.header=`${i.object.label||""}.${i.label||""}`,i.settings&&i.settings.showIcon&&(e.header=`<span class="webix_icon fa fa-${i.fieldIcon()}"></span>${e.header}`),this.isGroup){let t=e.template;e.template=(i,s)=>i[e.id]?s.icon(i,s)+(t?t(i,s,i[e.id]):i[e.id]):""}e.adjust=!0,e.minWidth=220})),a}conditionScan(e){e&&(e.glue?(e.rules||[]).forEach((e=>{this.conditionScan(e)})):(this.fieldByID(e.key)||"this_object"==e.key||this.warningsMessage("condition does not reference one of our fields",{rule:e}),this._conditionCheck||(this._conditionCheck=this.AB.filterComplexNew(`${this.id}_conditionCheck`)),this._conditionCheck.isConditionComplete(e)||this.warningsMessage("incomplete condition definition",{rule:e})))}warningsEval(){super.warningsEval(),this.conditionScan(this.where),this.__missingObject.forEach((e=>{this.warningsMessage(`IMPORT FIELDS: could not resolve object[${e.objectID}] for fieldSetting ${JSON.stringify(e)}`,{fieldInfo:e})})),this.__missingFields.forEach((e=>{this.warningsMessage(`IMPORT FIELDS: Object[${e.objID}] could not find field[${e.fieldID}] for fieldSetting ${JSON.stringify(e.fieldInfo)}`,{object:e.objID,fieldInfo:e.fieldInfo})})),this.__cantFilter.forEach((e=>{this.warningsMessage(`Field[${e.field.id}] referenced in fieldSetting[${JSON.stringify(e.fieldInfo)}] did not pass .canFilterField`,{field:e.field.toObj(),fieldInfo:e.fieldInfo})})),this.__duplicateFields.forEach((e=>{this.warningsMessage(`Field[${e.fieldInfo.fieldID}] referenced in fieldSetting[${JSON.stringify(e.fieldInfo)}] is a duplicate`,{fieldInfo:e.fieldInfo})})),this.__linkProblems.forEach((e=>{this.warningsMessage(e.message,e.data)}))}warningsMessage(e,t={}){let i=`Query[${this.label}]: ${e}`;this._warnings.push({message:i,data:t})}isUuid(e){return console.error("ABObject.isUuid(): is depreciated.  directly reference AB.Rules.isUUID() instead."),this.AB.isUUID(e)}}},63509:(e,t,i)=>{const s=i(42260);e.exports=class extends s{constructor(e,t){super(e,t),this._unknownShapes=[],this.AB.on("ab.abprocess.update",(e=>{this.id==e.objectId&&this.fromValues(e.data)}))}destroy(){var e=this.elements(),t=[];return e.forEach((e=>{t.push(e.destroy())})),Promise.all(t).then((()=>new Promise(((e,t)=>{this.toDefinition().destroy().then((()=>{e()})).then((()=>{console.error("TODO: ABProcess.destroy(): refactor to .emit('destroyed') and let containing Apps self remove.");var e=this.AB.applications().find((e=>e.hasProcess(this)));e.length>0&&e.forEach((e=>{e.processRemove(this)}))})).catch((e=>{t(e)}))}))))}save(){var e=[];return this.elements().forEach((t=>{e.push(t.save())})),Promise.all(e).then((()=>this.toDefinition().save().then((e=>{this.id||(this.id=e.id);var t={};let i=this._elements;Object.keys(this._elements).forEach((e=>{t[this._elements[e].id]=this._elements[e]})),this._elements=t;let s=!1;if(Object.keys(t).forEach((e=>{i[e]||(s=!0)})),s)return this.save()}))))}isValid(){var e=this.AB.Validation.validator();return 0==this.AB.processes((e=>e.name.toLowerCase()==this.name.toLowerCase())).length||e.addError("name",((...e)=>AB.Multilingual.label(...e))('Process name must be unique ("{0}" already in use)',[this.name])),e}elementNewForModelDefinition(e){var t=this.AB.processElementNewForModelDefinition(e,this);return t&&this.elementAdd(t),t}unknownShape(e){this.unknownShapeRemove(e),this._unknownShapes.push(e)}unknownShapeRemove(e){this._unknownShapes=this._unknownShapes.filter((t=>t.id!=e.id))}warningsAll(){var e=[].concat(this._warnings);if(this.elements().forEach((t=>{t.warningsEval(),e=e.concat(t.warnings())})),0==this.elements().length&&e.push({message:"No process Tasks defined.",data:{}}),!this._DOMParser)if(window.DOMParser)this._DOMParser=function(e){return(new window.DOMParser).parseFromString(e,"text/xml")};else{if(void 0===window.ActiveXObject||!new window.ActiveXObject("Microsoft.XMLDOM"))throw new Error("No XML parser found");this._DOMParser=function(e){var t=new window.ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(e),t}}let t=this._DOMParser(this.xmlDefinition);return["bpmn2:startEvent","bpmn2:task","bpmn2:endEvent"].forEach((e=>{let i=t.getElementsByTagName(e);for(let e=0;e<i.length;e++)i[e],this.elementForDiagramID(i[e].id)||this.unknownShape(i[e])})),this._unknownShapes.length&&e.push({message:"Generic Tasks still undefined.",data:{}}),e}}},21002:(e,t,i)=>{const s=i(73323);e.exports=class extends s{constructor(e,t){super(e,t)}destroy(){return new Promise(((e,t)=>{this.toDefinition().destroy().then((()=>{e()})).catch((e=>{t(e)}))}))}save(){return this.toDefinition().save().then((e=>(this.id||(this.id=e.id),this)))}isValid(){return!0}warningsAll(){}}},96649:(e,t,i)=>{const s=i(60979);e.exports=class extends s{}},69155:(e,t,i)=>{const s=i(42428);e.exports=class extends s{}},88708:e=>{var t=null;e.exports=class{constructor(e){t||(t=e,e.Label&&(t=e.Label))}getSeparateItems(){return[{id:",",value:t("Comma (,)")},{id:"\t",value:t("Tab (&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)")},{id:";",value:t("Semicolon (;)")},{id:"s",value:t("Space ( )")}]}validateFile(e){if(!e||!e.file||!e.file.type)return!1;let t=e.file.type.toLowerCase();return"text/csv"==t||"application/vnd.ms-excel"==t}getDataRows(e,t){return this.validateFile(e)?new Promise(((i,s)=>{let n=new window.FileReader;n.onload=e=>{let s=[];(n.result.split(/\r\n|\n|\r/).filter((e=>e&&e.length>0))||[]).forEach((e=>{let i=[];i=","==t?(e=e.replace(/,,/g,", ,")).match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g):e.split(t),s.push(i.map((e=>this.reformat(e))))})),i(s)},n.readAsText(e.file)})):Promise.reject()}getGuessDataType(e,t){for(var i,s=1;s<=10;s++){var n=e[s];if(!n)break;if(null!=(i=n[t])&&i.length>0)break}return null==i||""==i?"string":0==i||1==i||1==i||0==i||"checked"==i||"unchecked"==i?"boolean":isNaN(i)?Date.parse(i)?"date":i.length>100?"LongText":"string":"number"}reformat(e){return e?e.trim().replace(/"/g,"").replace(/'/g,""):""}}},67483:(e,t,i)=>{const s=i(78260);let n=(...e)=>AB.Multilingual.label(...e);function a(e,t=[]){if(e){if(e.key){const i=t.filter((t=>t.id==e.key))[0];e.field=i?.id,e.condition={type:e.rule,filter:e.value},Array.isArray(e.value)?e.includes=e.value:e.includes=e.value?.split?.(",")??[],"date"!=i?.key&&"datetime"!=i?.key||(e.condition.filter=e.condition.filter?AB.rules.toDate(e.condition.filter):null,e.includes=e.includes.map((e=>AB.rules.toDate(e)))),delete e.key,delete e.rule,delete e.value}e.rules&&e.rules.length&&(e.rules??[]).forEach((e=>{a(e,t)}))}}function r(e,t=[]){if(e){if(e.field){let i=t.filter((t=>t.id==e.field))[0];e.key=i?.id??e.field,e.condition=e.condition??{},e.rule=e.condition.type;let s=e.includes.map((e=>e instanceof Date?e.toISOString():e))??[];e.condition.filter&&(e.condition.filter instanceof Date?s.indexOf(e.condition.filter.toISOString())<0&&s.push(e.condition.filter):s.indexOf(e.condition.filter)<0&&s.push(e.condition.filter)),e.value=s.map((e=>!i||"date"!=i.key&&"datetime"!=i.key?e:i.exportValue(new Date(e)))).join(","),delete e.field,delete e.type,delete e.includes,delete e.condition}e.rules&&e.rules.length&&(e.rules??[]).forEach((e=>{r(e,t)}))}}e.exports=class extends s{constructor(e,t,i={}){super(e=e??"ab_filterComplex",t),this._options=i??{},this._initComplete=!1,this.observing=!1,this.labels={common:(t._App??{}).labels,component:{and:n("And"),or:n("Or"),thisObject:n("This Object"),inQuery:n("In Query"),notInQuery:n("Not In Query"),inQueryField:n("By Query Field"),notInQueryField:n("Not By Query Field"),inQueryFieldQueryPlaceholder:n("Choose a Query"),inQueryFieldFieldPlaceholder:n("Choose a Field"),sameAsUser:n("Same As User"),notSameAsUser:n("Not Same As User"),sameAsField:n("Same As Field"),notSameAsField:n("Not Field"),inDataCollection:n("In Data Collection"),notInDataCollection:n("Not In Data Collection"),containsCondition:n("contains"),notContainsCondition:n("doesn't contain"),isCondition:n("is"),isNotCondition:n("is not"),isEmpty:n("is empty"),isNotEmpty:n("is not empty"),beforeCondition:n("is before"),afterCondition:n("is after"),onOrBeforeCondition:n("is on or before"),onOrAfterCondition:n("is on or after"),beforeCurrentCondition:n("is before current date"),afterCurrentCondition:n("is after current date"),onOrBeforeCurrentCondition:n("is on or before current date"),onOrAfterCurrentCondition:n("is on or after current date"),onLastDaysCondition:n("last ... days"),onNextDaysCondition:n("next ... days"),equalCondition:n(":"),notEqualCondition:n(""),lessThanCondition:n("<"),moreThanCondition:n(">"),lessThanOrEqualCondition:n(""),moreThanOrEqualCondition:n(""),equalListCondition:n("equals"),notEqualListCondition:n("does not equal"),checkedCondition:n("is checked"),notCheckedCondition:n("is unchecked"),isCurrentUserCondition:n("is current user"),isNotCurrentUserCondition:n("is not current user"),containsCurrentUserCondition:n("contains current user"),notContainsCurrentUserCondition:n("does not contain current user"),contextDefaultOption:n("choose option"),equalsProcessValue:n("equals process value"),notEqualsProcessValueCondition:n("not equals process value"),inProcessValueCondition:n("in process value"),notInProcessValueCondition:n("not in process value")}};let s=this.ids={popup:this.unique(`${e}_popup`),querybuilder:this.unique(`${e}_querybuilder`),save:this.unique(`${e}_save`)};this.Account.username=this.AB.Account.username(),this._settings.recordRuleFieldOptions=[],this.ui={rows:[{view:"layout",type:"clean",borderless:this._options.borderless??!0,rows:[{id:s.querybuilder,view:"query",data:()=>[],fields:[],disabled:!0,height:this._options.height}]},{id:s.save,view:"button",css:"webix_primary",value:n("Save"),hidden:this._options.isSaveHidden??!1,click:()=>{this.myPopup&&this.myPopup.hide(),this.emit("save",this.getValue())}}]}}init(e){if(this._initComplete)return;super.init(e);const t=$$(this.ids.querybuilder);if(t){if(!this.observing){this.__blockOnChange=!0,t.getState().$observe("value",(e=>{if(this.__blockOnChange)return!1;this.emit("changed",this.getValue())})),this.__blockOnChange=!1;let e=this.condition;this.condition=e,this.observing=!0}this._initComplete=!0}}isValid(e,t=this.condition){let i=()=>!0,s=$$(this.ids.querybuilder);return s?(i=s.getFilterFunction(),i(e)):super.isValid(e,t)}isConditionComplete(e){if(!e)return!1;let t=!0;if(e.glue)(e.rules??[]).forEach((e=>{t=t&&this.isConditionComplete(e)}));else if(e.key&&""!=e.key||(t=!1),e.rule&&""!=e.rule||(t=!1),t)switch(e.rule){case"is_current_user":case"is_not_current_user":case"contain_current_user":case"not_contain_current_user":case"same_as_user":case"not_same_as_user":case"less_current":case"greater_current":case"less_or_equal_current":case"greater_or_equal_current":case"is_empty":case"is_not_empty":case"checked":case"unchecked":break;default:e.value&&""!=e.value||(t=!1)}return t}setValue(e){super.setValue(e),this.condition=e;const t=$$(this.ids.querybuilder);if(t){if(!e)return void t.define("value",{glue:"and",rules:[]});let i=this.AB.cloneDeep(e);a(i,this._Fields),this.__blockOnChange=!0,t.define("value",i),this.__blockOnChange=!1}}getValue(){if($$(this.ids.querybuilder)){let e=this.AB.cloneDeep($$(this.ids.querybuilder).getState().value??{});r(e,this._Fields),this.condition=e}return super.getValue()}fieldsLoad(e=[],t=null){super.fieldsLoad(e,t),this.uiInit()}toShortHand(){return"Add Filters"}uiInit(){this.uiQueryCustomValue();let e=$$(this.ids.querybuilder);if(e){for(;e.config.fields.length>0;)e.config.fields.pop();(this.fieldsToQB()??[]).forEach((t=>{e.config.fields.push(t)})),e.config.fields.length?e.enable():(this.setValue(""),e.disable())}}uiQueryCustomValue(){const e=$$(this.ids.querybuilder);e&&(e.$app.require("jet-views","filter").prototype.CreateFilter=(e,t,i,s,n)=>{let a=this.uiValue(e),r={id:n.config.id,view:"filter",localId:"filter",conditions:s,field:e,mode:t,template:function(s){let n=s[e],a=i??("date"==t?webix.i18n.dateFormatStr:null);return a&&(n=a(n)),n},inputs:a,margin:6};return webix.ui(r,n)})}uiValue(e){let t;if("this_object"==e)return[].concat(this.uiQueryValue("this_object")).concat(this.uiDataCollectionValue("this_object")).concat(this.uiCustomValue("this_object")).concat(this.uiContextValue("this_object","uuid"));let i=(this._Fields??[]).filter((t=>t.id==e))[0];switch(i?.key){case"boolean":t=this.uiNoneValue(i);break;case"connectObject":t=[].concat(this.uiQueryValue(i)).concat(this.uiUserValue(i)).concat(this.uiDataCollectionValue(i)).concat(this.uiContextValue(i)).concat(this.uiNoneValue());break;case"date":case"datetime":t=["datepicker","daterangepicker"];break;case"list":t=this.uiListValue(i);break;case"user":t=[].concat(this.uiNoneValue()).concat(this.uiUserValue(i));break;case"string":case"LongText":case"email":t=this.uiNoneValue()}const s=`${i?.settings?.linkType}:${i?.settings?.linkViaType}`;return i?.settings?.isCustomFK&&("one:many"==s||"one:one"==s&&i?.settings?.isSource)?t=(t??[]).concat(this.uiTextValue(i)):"connectObject"!=i?.key?t=(t??[]).concat(this.uiTextValue(i)).concat(this.uiQueryFieldValue(i)).concat(this.uiContextValue(i)):e.indexOf("uuid")>-1&&(t=this.uiContextValue(null,e)),this._settings.isRecordRule&&(t=(t??[]).concat(this.uiRecordRuleValue(i))),t=(t??[]).concat(this.uiCustomValue(i)),t}uiNoneValue(){return[{batch:"none",borderless:!0,view:"template",template:""}]}uiBooleanValue(e){return[{batch:"boolean",view:"checkbox"}]}uiTextValue(e){return[{batch:"text",view:"text",on:{onAfterRender:function(){(this.queryView((function(e){return!e.getParentView()}),"parent")??this).$view.style.zIndex=202}}}]}uiQueryValue(e){let t=[],i=this._QueryFields?.filter((t=>t.id==e.id)).length>0;return"this_object"==e&&this._Object?t=this.queries((e=>e.canFilterObject(this._Object))):i&&(t=this.queries((t=>(this._Object?this._Object.id:"")!=t.id&&t.canFilterObject(e.datasourceLink)))),t?.forEach((e=>{t.push({id:e.id,value:e.label})})),[{batch:"query",view:"combo",options:t??[]}]}uiListValue(e){return[{batch:"list",view:"combo",options:e?.settings?.options?.map((function(e){return{id:e.id,value:e.text}}))}]}uiUserValue(e){return[{batch:"user",view:"combo",options:this.AB.Account.userList().map((e=>({id:e.username,value:e.username})))}]}uiDataCollectionValue(e){let t;return t="this_object"==e&&this._Object?this._Object.id:e?.settings?.linkObject,[{batch:"datacollection",view:"combo",options:t?this.AB.datacollections((e=>e?.datasource?.id==t)).map((e=>({id:e.id,value:e.label}))):[]}]}uiQueryFieldValue(e){return[{batch:"queryField",view:"combo",placeholder:this.labels.component.inQueryFieldQueryPlaceholder,options:this.queries((e=>null==this._Object||e.id!=this._Object.id)).map((e=>({id:e.id,value:e.label})))}]}uiRecordRuleValue(e){return[{batch:"recordRule",view:"select",options:this._settings.recordRuleFieldOptions??[]}]}uiContextValue(e,t=null){const i=(this._ProcessFields??[]).filter((i=>{if(!i)return!1;let s=!1;if("this_object"===e)s=this._Object.id===i.object?.id&&!i.field;else switch(e.key){case"boolean":s=["boolean"].includes(i.field?.key);break;case"connectObject":if(s=e.settings.linkObject===(i.field?.object.id??i.object.id),!e.settings.isCustomFK){s=s&&!i.field;break}s=s&&(e.settings.indexField||e.settings.indexField2)===i.field?.id;break;case"date":case"datetime":s=["date","datetime"].includes(i.field?.key);break;case"calculate":case"formula":case"number":s=["calculate","formula","number"].includes(i.field?.key);break;case"string":case"LongText":case"email":case"AutoIndex":case"list":s=["string","LongText","email","AutoIndex","list"].includes(i.field?.key);break;case"user":s=["user"].includes(i.field?.key);break;default:if(i.key){const n=i.key.split(".").pop();s=n===e.id||n===e.key||n===t||i.key===t}}return s})).map((e=>({id:e.key,value:n("context({0})",[e.label])})));return i?[{batch:"context",view:"select",options:[{id:"empty",value:this.labels.component.contextDefaultOption},...i]}]:[]}uiCustomValue(e){return e?((this._customOptions??{})[e.id??e]??{}).values??[]:[]}popUp(...e){const t=Object.assign({},this.condition);if(this.myPopup)this.myPopup.show(...e);else{let i={id:this.ids.popup,view:"popup",height:400,width:800,body:this.ui};$$(this.ids.popup)?$$(this.ids.popup).show(...e):(this.myPopup=webix.ui(i),this.init(this._settings),this._Fields&&this.fieldsLoad(this._Fields,this._Object),t&&this.setValue(t),this.myPopup.show(...e))}}addCustomOption(e,t={}){this._customOptions=this._customOptions??{},this._customOptions[e]=t}}},12416:(e,t,i)=>{const s=i(87674);let n=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{constructor(e,t,i){super(e,t,i),console.error("TODO: Switch RowFilter => FilterComplex");let s=this.ids={component:this.unique(`${t}_rowFilter`),filterForm:this.unique(`${t}_rowFilter_form`),addNewFilter:this.unique(`${t}_rowFilter_addNewFilter`),glue:this.unique(`${t}_rowFilter_glue`),field:this.unique(`${t}_rowFilter_field`),rule:this.unique(`${t}_rowFilter_rule`),inputValue:this.unique(`${t}_rowFilter_inputValue`),queryCombo:this.unique(`${t}_rowFilter_queryCombo`),queryFieldCombo:this.unique(`${t}_rowFilter_queryFieldCombo`),queryFieldComboQuery:this.unique(`${t}_rowFilter_queryFieldComboQuery`),queryFieldComboField:this.unique(`${t}_rowFilter_queryFieldComboField`),fieldMatch:this.unique(`${t}_rowFilter_fieldMatchCombo`),dataCollection:this.unique(`${t}_rowFilter_dataCollection`),listOptions:this.unique(`${t}_rowFilter_listOptions`),datePicker:this.unique(`${t}_rowFilter_datePicker`)};var a;this.queryFieldOptions=[{value:n("By Query Field"),id:"in_query_field"},{value:n("Not In Query"),id:"not_in_query_field"}],this.recordRuleOptions=[],this.recordRuleFieldOptions=[];let r=this._logic||{};r.getFieldList=()=>(this._Fields||[]).map((e=>{let t=e.label;return this._settings.showObjectName&&e.object&&(t=e.object.label+"."+e.label),{id:e.id,value:t,alias:e.alias||void 0}})),r.getFilterUI=()=>{let e=this,t=this.config_settings||{};return{id:"f"+webix.uid(),isolate:!0,cols:[{view:"combo",id:s.glue,width:80,value:t.glue||"and",options:[{value:n("And"),id:"and"},{value:n("Or"),id:"or"}],on:{onChange:function(e,t){r.selectCombineCondition(e)}}},{view:"combo",id:s.field,suggest:{on:{onBeforeShow:function(){this.define("width",400),this.resize()}},data:r.getFieldList()},on:{onChange:function(e){var t=this.getParentView();r.selectField(e,t)}}},{id:s.rule,width:220,cells:[{},{batch:"query",view:"combo",value:"in_query",options:[{value:n("In Query"),id:"in_query"},{value:n("Not In Query"),id:"not_in_query"},{value:n("contains"),id:"contains"},{value:n("doesn't contain"),id:"not_contains"},{value:n("is"),id:"equals"},{value:n("is not"),id:"not_equal"},{value:n("is empty"),id:"is_empty"},{value:n("is not empty"),id:"is_not_empty"},{value:n("Same As User"),id:"same_as_user"},{value:n("Not Same As User"),id:"not_same_as_user"},{value:n("In Data Collection"),id:"in_data_collection"},{value:n("Not In Data Collection"),id:"not_in_data_collection"}].concat(e.recordRuleOptions),on:{onChange:function(e,t){var i=this.getParentView().getParentView();r.onChangeRule(e,i),r.onChange()}}},{batch:"date",view:"combo",value:"less",options:[{value:n("equals"),id:"equals"},{value:n("does not equal"),id:"not_equal"},{value:n("is before"),id:"less"},{value:n("is after"),id:"greater"},{value:n("is on or before"),id:"less_or_equal"},{value:n("is on or after"),id:"greater_or_equal"},{value:n("is before current date"),id:"less_current"},{value:n("is after current date"),id:"greater_current"},{value:n("is on or before current date"),id:"less_or_equal_current"},{value:n("is on or after current date"),id:"greater_or_equal_current"},{value:n("last ... days"),id:"last_days"},{value:n("next ... days"),id:"next_days"}].concat(e.queryFieldOptions).concat(e.recordRuleOptions),on:{onChange:function(e){var t=this.getParentView().getParentView();r.onChangeRule(e,t),r.onChange()}}},{batch:"number",view:"combo",value:"equals",options:[{value:n(":"),id:"equals"},{value:n(""),id:"not_equal"},{value:n("<"),id:"less"},{value:n(">"),id:"greater"},{value:n(""),id:"less_or_equal"},{value:n(""),id:"greater_or_equal"}].concat(e.queryFieldOptions).concat(e.recordRuleOptions),on:{onChange:function(e){var t=this.getParentView().getParentView();r.onChangeRule(e,t),r.onChange()}}},{batch:"list",view:"combo",value:"equals",options:[{value:n("equals"),id:"equals"},{value:n("does not equal"),id:"not_equal"},{value:n("Same As User"),id:"same_as_user"},{value:n("Not Same As User"),id:"not_same_as_user"}].concat(e.queryFieldOptions).concat(e.recordRuleOptions),on:{onChange:function(e,t){var i=this.getParentView().getParentView();r.onChangeRule(e,i),r.onChange()}}},{batch:"boolean",view:"combo",value:"equals",options:[{value:n("equals"),id:"equals"},{value:n("does not equal"),id:"not_equal"}].concat(e.queryFieldOptions).concat(e.recordRuleOptions),on:{onChange:function(e){var t=this.getParentView().getParentView();r.onChangeRule(e,t),r.onChange()}}},{batch:"user",view:"combo",value:"is_current_user",options:[{value:n("is current user"),id:"is_current_user"},{value:n("is not current user"),id:"is_not_current_user"},{value:n("contains current user"),id:"contain_current_user"},{value:n("does not contain current user"),id:"not_contain_current_user"},{value:n("equals"),id:"equals"},{value:n("does not equal"),id:"not_equal"}].concat(e.queryFieldOptions).concat(e.recordRuleOptions),on:{onChange:function(e){var t=this.getParentView().getParentView();r.onChangeRule(e,t),r.onChange()}}},{batch:"string",view:"combo",value:"contains",options:[{value:n("contains"),id:"contains"},{value:n("doesn't contain"),id:"not_contains"},{value:n("is"),id:"equals"},{value:n("is not"),id:"not_equal"}].concat(e.queryFieldOptions).concat(e.recordRuleOptions),on:{onChange:function(e){var t=this.getParentView().getParentView();r.onChangeRule(e,t),r.onChange()}}},{batch:"email",view:"combo",value:"contains",options:[{value:n("contains"),id:"contains"},{value:n("doesn't contain"),id:"not_contains"},{value:n("is"),id:"equals"},{value:n("is not"),id:"not_equal"}].concat(e.queryFieldOptions).concat(e.recordRuleOptions),on:{onChange:function(e){var t=this.getParentView().getParentView();r.onChangeRule(e,t),r.onChange()}}}]},{id:s.inputValue,isolate:!0,cells:[{batch:"empty"},{id:s.queryCombo,batch:"query",view:"combo",options:[],on:{onChange:r.onChange}},{id:s.queryFieldCombo,batch:"queryField",rows:[{id:s.queryFieldComboQuery,view:"combo",options:[],placeholder:n("Choose a Query"),on:{onChange:function(e){var t=this.getParentView().getParentView().getParentView();r.onChangeQueryFieldCombo(e,t),r.onChange()}}},{id:s.queryFieldComboField,view:"combo",options:[],placeholder:n("Choose a Field"),on:{onChange:r.onChange}}]},{id:s.fieldMatch,batch:"fieldMatch",view:"combo",options:[],on:{onChange:r.onChange}},{id:s.dataCollection,batch:"dataCollection",view:"richselect",options:[],on:{onChange:r.onChange}},{batch:"date",id:s.datePicker,view:"datepicker",on:{onChange:function(){r.onChange()}}},{batch:"number",view:"text",validate:webix.rules.isNumber,on:{onTimedKeyPress:function(){this.validate()&&r.onChange()}}},{batch:"list",id:s.listOptions,view:"combo",options:[],on:{onChange:function(){r.onChange()}}},{batch:"boolean",view:"checkbox",on:{onChange:function(){r.onChange()}}},{batch:"user",view:"combo",options:this.AB.Account.userList().map((e=>({id:e.username,value:e.username}))),on:{onChange:function(){r.onChange()}}},{batch:"string",view:"text",on:{onTimedKeyPress:function(){r.onChange()}}},{batch:"email",view:"text",on:{onTimedKeyPress:function(){r.onChange()}}}]},{view:"button",css:"webix_primary",icon:"fa fa-plus",type:"icon",autowidth:!0,click:function(){var e=this.getFormView().index(this.getParentView());r.addNewFilter(e+1)}},{view:"button",css:"webix_danger",icon:"fa fa-trash",type:"icon",autowidth:!0,click:function(){var e=this.getParentView();r.removeNewFilter(e)}}]}},r.getAddButtonUI=()=>({view:"button",id:s.addNewFilter,css:"webix_primary",type:"form",label:n("Add a filter"),click:()=>{r.addNewFilter()}}),r.addNewFilter=(e,t)=>{var i,n=r.getFilterUI(),a=$$(s.filterForm);return a&&(i=a.addView(n,e),r.toggleAddNewButton(),t&&r.selectField(t,$$(i),!0)),i},r.removeNewFilter=function(e){$$(s.filterForm).removeView(e),r.toggleAddNewButton(),r.onChange()},r.toggleAddNewButton=function(){$$(s.filterForm)&&($$(s.filterForm).getChildViews().length<1?($$(s.filterForm).hide(),$$(s.addNewFilter).show()):($$(s.filterForm).show(),$$(s.addNewFilter).hide()))},r.selectCombineCondition=(e,t)=>{this.config_settings.glue=e,$$(s.filterForm).getChildViews().forEach((t=>{t.$$&&t.$$(s.glue)&&t.$$(s.glue).setValue(e)})),t||r.onChange()},r.selectField=(e,t,i)=>{if(!this._Fields)return;var n=this._Fields.filter((t=>t.id==e))[0];if(!n)return;a=n.key,"this_object"==n.id?a="query":"LongText"==a||"combined"==a?a="string":"formula"==n.key&&(a="number");var o=this._QueryFields.filter((e=>e.id==n.id)).length>0;o&&(a="query"),t.$$(s.rule).showBatch(a),t.$$(s.inputValue).showBatch(a);let l=[],c=[];if("this_object"==n.id&&this._Object?c=this.queries((e=>e.canFilterObject(this._Object))):o&&(c=this.queries((e=>(this._Object?this._Object.id:"")!=e.id&&e.canFilterObject(n.datasourceLink)))),c.forEach((e=>{l.push({id:e.id,value:e.label})})),t.$$(s.inputValue).$$(s.queryCombo).define("options",l),t.$$(s.inputValue).$$(s.queryCombo).refresh(),"list"==n.key){let e=n.settings.options.map((function(e){return{id:e.id,value:e.text}}));t.$$(s.inputValue).$$(s.listOptions).define("options",e),t.$$(s.inputValue).$$(s.listOptions).refresh()}else"date"==n.key&&(t.$$(s.inputValue).$$(s.datePicker).define("format",n.getFormat()),t.$$(s.inputValue).$$(s.datePicker).refresh());var u=t.$$(s.rule).getActiveId(),d=t.$$(s.rule).queryView({id:u});if(d&&d.getList){let e=(d.getList().config.data||[])[0];e&&d.setValue(e.id)}i||r.onChange()},r.onChangeRule=(e,t,i=!1)=>{switch(e){case"contains":case"not_contains":case"equals":case"not_equal":"query"==a&&t.$$(s.inputValue).showBatch("string");break;case"is_current_user":case"is_not_current_user":case"contain_current_user":case"not_contain_current_user":case"same_as_user":case"not_same_as_user":case"less_current":case"greater_current":case"less_or_equal_current":case"greater_or_equal_current":case"is_empty":case"is_not_empty":t.$$(s.inputValue).showBatch("empty"),r.onChange();break;case"last_days":case"next_days":t.$$(s.inputValue).showBatch("number");break;case"in_query_field":case"not_in_query_field":var n=[];this.queries((e=>null==this._Object||e.id!=this._Object.id)).forEach((e=>{n.push({id:e.id,value:e.label})})),t.$$(s.inputValue).$$(s.queryFieldComboQuery).define("options",n),t.$$(s.inputValue).$$(s.queryFieldComboQuery).refresh(),t.$$(s.inputValue).showBatch("queryField");break;case"same_as_field":case"not_same_as_field":t.$$(s.inputValue).$$(s.fieldMatch).define("options",this.recordRuleFieldOptions),t.$$(s.inputValue).$$(s.fieldMatch).refresh(),t.$$(s.inputValue).showBatch("fieldMatch");break;case"in_data_collection":case"not_in_data_collection":{let e,i=[],n=t.$$(s.field).getValue();if("this_object"==n&&this._Object)e=this._Object.id;else{let t=this._Fields.filter((e=>e.id==n))[0];t&&(e=t.settings.linkObject)}this._Application&&e&&this._Application.datacollections((t=>t.datasource&&t.datasource.id==e)).forEach((e=>{i.push({id:e.id,value:e.label})})),t.$$(s.inputValue).$$(s.dataCollection).define("options",i),t.$$(s.inputValue).$$(s.dataCollection).refresh(),t.$$(s.inputValue).showBatch("dataCollection");break}default:t.$$(s.inputValue).showBatch(a),i&&r.onChange()}},r.onChangeQueryFieldCombo=(e,t)=>{let i=[],n=this.queries((t=>t.id==e))[0];n&&(n.fields((e=>!e.isConnection)).forEach((e=>{i.push({id:e.id,value:e.object.label+"."+e.label})})),t.$$(s.inputValue).$$(s.queryFieldComboField).define("options",i),t.$$(s.inputValue).$$(s.queryFieldComboField).refresh())},r.onChange=()=>(this.__blockOnChange||(r.getValue(),console.warn("convert RowFilter.callback.onChange() to .emit()"),r.callbacks.onChange(),this.emit("change")),!1),r.blockOnChange=()=>{this.__blockOnChange=!0},r.unblockOnChange=()=>{this.__blockOnChange=!1},r.getValue=()=>{let e={glue:"and",rules:[]};var t=$$(s.filterForm);return t&&t.getChildViews().forEach(((t,i)=>{0==i&&(e.glue=t.$$(s.glue).getValue());var n=t.$$(s.field);if(n){var a=n.getValue();if(a){var r,o=t.$$(s.field).getPopup().config.body.data.filter((e=>e.id==a))[0];o&&(r=o.alias||void 0);var l=null,c=t.$$(s.rule).getActiveId(),u=t.$$(s.rule).queryView({id:c});u&&u.getValue&&(l=u.getValue());var d=null,h=t.$$(s.inputValue).getActiveId(),p=t.$$(s.inputValue).queryView({id:h});if(p&&p.getValue)d=p.getValue();else if(p&&p.getChildViews()){var f=[];p.getChildViews().forEach((e=>{f.push($$(e).getValue())})),d=f.join(":")}if(d instanceof Date){let e=this._Fields.filter((e=>e.id==a))[0];d=e?e.exportValue(d):d.toISOString()}e.rules.push({alias:r||void 0,key:a,rule:l,value:d})}}})),this.config_settings=e,this.config_settings},this.ui={id:s.component,rows:[{view:"form",id:s.filterForm,hidden:!0,elements:[]},r.getAddButtonUI()]}}init(e={}){for(var t in super.init(e),this._logic.callbacks)this._logic.callbacks[t]=e[t]||this._logic.callbacks[t];e.showObjectName&&(this._settings.showObjectName=e.showObjectName),e.isRecordRule&&(this.recordRuleOptions=[{value:n("Same As Field"),id:"same_as_field"},{value:n("Not Field"),id:"not_same_as_field"}],this.recordRuleFieldOptions=e.fieldOptions)}setValue(e){e=e||{},super.setValue(e);let t=this.ids,i=this._logic;i.blockOnChange();let s=this.AB.cloneDeep(e);s.rules=s.rules||[];var n=$$(t.filterForm);n&&webix.ui([],n),0==s.rules.length&&i.toggleAddNewButton(),s.rules.forEach((e=>{var n=i.addNewFilter(),a=$$(n);if(null!=a){var r=this._Fields.filter((t=>t.id==e.key))[0];a.$$(t.glue).define("value",s.glue),a.$$(t.glue).refresh(),a.$$(t.field).define("value",e.key),a.$$(t.field).refresh(),i.selectField(e.key,a,!0);var o=a.$$(t.rule).getActiveId(),l=a.$$(t.rule).queryView({id:o});l&&l.setValue&&(l.define("value",e.rule),l.refresh()),a.blockEvent(),i.onChangeRule(e.rule,a),a.unblockEvent();var c=a.$$(t.inputValue).getActiveId(),u=a.$$(t.inputValue).queryView({id:c});if(u&&u.setValue)r&&"date"==r.key&&e.value&&("less"==e.rule||"greater"==e.rule||"less_or_equal"==e.rule||"greater_or_equal"==e.rule)?u.define("value",new Date(e.value)):u.define("value",e.value),u.refresh();else if(u&&u.getChildViews()){let t=(e.value||"").split(":"),s=0;u.getChildViews().forEach((e=>{$$(e).blockEvent(),$$(e).setValue(t[s]),0==s&&i.onChangeQueryFieldCombo(t[s],a),$$(e).unblockEvent(),s++}))}r&&"user"==r.key&&(a.blockEvent(),i.onChangeRule(e.rule,a),a.blockEvent())}})),i.unblockOnChange()}isComplete(){return this._completeConditions||(this._completeConditions=this.AB.filterComplexNew(`${this.ids.component}_iscomplete`)),this._completeConditions.isConditionComplete(this.getValue())}}},9234:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var s=i(32019);const n=i(40194);let a=null;class r extends s.Z{constructor(e,t){super(e,{form:`${e}_rowUpdaterForm`,addNew:`${e}_rowUpdaterAddNew`,field:`${e}_rowUpdaterField`}),this.idBase=e,this._Object=null,this._mockFormWidget=null,this.AB=t,a||(a=(...e)=>this.AB.Multilingual.label(...e))}uiItem(){const e=this;return{rows:[{view:"layout",isolate:!0,cols:[{view:"label",width:40,label:a("Set")},{view:"combo",id:this.ids.field,options:this.getFieldList(!0),on:{onChange:async function(t){const i=this.getParentView();await e.selectField(t,i)}}},{view:"label",width:40,label:a("To")},{view:"segmented",value:"custom",height:40,maxWidth:160,options:[{id:"custom",value:a("Custom")},{id:"process",value:a("Process")}],hidden:null==this._extendedOptions||!this._extendedOptions.length,on:{onChange:function(t){const i=this.getParentView();e.toggleCustomProcessOption(i,"process"==t)}}},{},{hidden:!0},{view:"button",css:"webix_danger",icon:"fa fa-trash",type:"icon",autowidth:!0,click:function(){const t=this.getParentView().getParentView();e.removeItem(t)}}]}]}}ui(){return{rows:[{view:"form",id:this.ids.form,hidden:!0,borderless:!0,elements:[]},{view:"button",id:this.ids.addNew,icon:"fa fa-plus",type:"iconButton",label:a("Add field to edit"),click:()=>{this.addItem()}}]}}init(e){const t=$$(this.ids.form);return t&&e.Webix.extend(t,e.Webix.ProgressBar),Promise.resolve()}addItem(e){const t=$$(this.ids.form);if(this.getFieldList(!0).length<1)return;const i=this.uiItem(),s=t.addView(i,e);return this.toggleForm(),s}getFieldList(e){let t=(this._Object.fields()||[]).map((e=>({id:e.id,value:e.label})));return e&&$$(this.ids.form).getChildViews().forEach((e=>{if(!e||!e.$$)return;const i=e.$$(this.ids.field);if(!i)return;const s=i.getValue();s&&(t=t.filter((e=>e.id!=s)))})),t}getValue(){const e=[],t=$$(this.ids.form);return t&&t.getChildViews().forEach((t=>{const i=t.getChildViews()[0];if(!i||!i.$$)return;const s=i.$$(this.ids.field);if(!s)return;const n=s.getValue();if(!n)return;let a=i.getChildViews()[4];a=this._pullInputElement(a);const r=i.getChildViews()[5];if(!a&&!r)return;const o=this._Object.fieldByID(n),l={fieldId:n};if(a&&a.isVisible())if("connectObject"===o.key||"user"===o.key)l.value=o.getValue(a);else if("date"===o.key||"datetime"===o.key)if(1==(a.getChildViews()[0]??a).getValue())l.value="ab-current-date";else{const e=a.getChildViews()[1]??a;l.value=o.getValue(e)}else l.value=o.getValue(a);else r&&r.isVisible()&&(l.isProcessValue=!0,l.value=r.getValue());e.push(l)})),e}objectLoad(e){this._Object=e,this._mockApp=this.AB.applicationNew({}),this._mockFormWidget=new n({settings:{showLabel:!1,labelWidth:0}},this._mockApp),this._mockFormWidget.objectLoad(e),this.setValue(null)}removeItem(e){$$(this.ids.form).removeView(e),this.toggleForm()}async selectField(e,t){const i=this._Object.fieldByID(e);if(!i)return void this.AB.notify.builder(new Error(`could not find field for id[${e}]`),{context:"RowUpdater.selectField() could not find a field",fieldID:e});const s=i.formComponent().newInstance(this._mockApp,this._mockFormWidget).component(this.AB._App,this.idBase),n=t.getChildViews();let r="function"==typeof s.ui?s.ui():s.ui;switch(t.removeView(n[5]),this._extendedOptions?.length?t.addView({view:"richselect",options:this._extendedOptions,hidden:!0},5):t.addView({hidden:!0},5),await this.busy(),i.key){case"connectObject":case"user":r=r.rows[0].rows[0],r.suggest.body.data=(await i.getOptions()).map((e=>({id:i.getRelationValue(e),value:e.text})))??[],"user"===i.key&&r.suggest.body.data.unshift({id:"ab-current-user",value:"ab-current-user"});break;case"date":case"datetime":r={view:"layout",rows:[{view:"checkbox",labelWidth:0,labelRight:a("Current Date/Time"),on:{onChange:function(e){const t=this.getParentView();if(!t)return;const i=t.getChildViews()[1];i&&(e?i.hide():i.show())}}},r]}}t.removeView(n[4]),t.addView(r,4),s.init(),i.customDisplay&&i.customDisplay({},this.AB._App,n[4].$view),this.toggleCustomProcessOption(t,"process"===n[3].getValue()),$$(t).adjust(),t.getFormView().adjust(),this.ready()}setValue(e){const t=$$(this.ids.form);t&&(webix.ui([],t),(e=e||[]).length<1||(e.forEach((async e=>{const t=$$(this.addItem()).getChildViews()[0];t.queryView({view:"segmented"},"self").setValue(e.isProcessValue?"process":"custom");const i=t.$$(this.ids.field);i.define("value",e.fieldId),i.refresh(),await this.selectField(e.fieldId,t);const s=this._Object.fieldByID(e.fieldId);if(!s)return;if(e.isProcessValue)return void t.getChildViews()[5].setValue?.(e.value);let n=t.getChildViews()[4];n=this._pullInputElement(n);const a={};a[s.columnName]=e.value?.value??e.value,s.setValue(n,a),"date"!=s.key&&"datetime"!=s.key||"ab-current-date"!=a[s.columnName]||"checkbox"!=n.config.view||n.setValue(!0)})),this.toggleForm()))}toggleForm(){const e=$$(this.ids.form);if(e){const t=e.getChildViews();t&&t.length?e.show():e.hide(),e.adjust()}}setExtendedOptions(e){this._extendedOptions=e}toggleCustomProcessOption(e,t){const i=e.getChildViews()[4],s=e.getChildViews()[5];t?(i.hide(),s.show()):(i.show(),s.hide())}async busy(){$$(this.ids.addNew).disable();const e=$$(this.ids.form);e&&(e.showProgress||await this.init(this.AB),e.showProgress({type:"icon"}))}ready(){$$(this.ids.addNew).enable(),$$(this.ids.form).hideProgress()}_pullInputElement(e){return!e?.getValue&&e?.getChildViews?e.getChildViews().filter((e=>e.getValue))[0]??e:e}}const o=r},34117:(e,t,i)=>{const s=i(34493),n=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{constructor(e,t,i){super(e,t,i),this.AB.on("ab.abdefinition.update",(e=>{e.id==this.id&&this.emit("definition.updated",this)}))}static editorValues(e){const t={label:e.label,columnName:e.columnName,settings:e};return delete e.label,delete e.columnName,t}addValidation(e,t){this.object.application.App;const i=this.AB.filterComplexNew(`${this.id}_field_validation_rules`);$$(e.filterComplex).addView({view:"form",css:"abValidationForm",cols:[{rows:[{view:"text",name:"invalidMessage",labelWidth:this.AB.UISettings.config().labelWidthLarge,value:t&&t.invalidMessage?t.invalidMessage:"",label:n("Invalid Message")},i.ui]},{view:"button",css:"webix_danger",icon:"fa fa-trash",type:"icon",autowidth:!0,click:function(){const t=this.getParentView();$$(e.filterComplex).removeView(t)}}]}),$$(i.ids.save).hide(),i.fieldsLoad(this.object.fields()),t&&t.rules&&i.setValue(t.rules)}isValid(){const e=this.AB.Validation.validator();return 0==this.object.fields((e=>e.id!=this.id&&e.columnName.toLowerCase()==this.columnName.toLowerCase())).length||e.addError("columnName",n("Field columnName must be unique ({0} already used in this Object)",[this.columnName])),e}async destroy(){this.id&&(await this.migrateDrop(),await super.destroy(),await this.object.fieldRemove(this))}async save(e=!1){let t=!1;if(this.id||(t=!0),!t&&this.settings.required&&this.settings.default){const e=this.object.model(),t=await e.findAll({where:{glue:"and",rules:[{key:this.id,rule:"is_null"}]}}),i=[];t.data.forEach((t=>{t[this.columnName]||(t[this.columnName]=this.settings.default),i.push(e.update(t.id,t))})),await Promise.all(i)}if(await super.save(),await this.object.fieldAdd(this),!this.isConnection&&!e){const e=t?this.migrateCreate():this.migrateUpdate();await e}return this}migrateCreate(){return this.AB.Network.post({url:`/definition/migrate/object/${this.object.id}/field/${this.id}`})}migrateUpdate(){return this.AB.Network.put({url:`/definition/migrate/object/${this.object.id}/field/${this.id}`})}migrateDrop(){return this.AB.Network.delete({url:`/definition/migrate/object/${this.object.id}/field/${this.id}`})}columnHeader(e){e=e||{};const t={id:this.columnName,header:this.label};return e.isObjectWorkspace&&this.settings.showIcon&&(t.header=`<span class="webix_icon fa fa-${this.fieldIcon()}"></span>${t.header}`),t}customDisplay(e,t,i,s){}customEdit(e,t,i){return!0}getValue(e,t){return e.getValue()}setValue(e,t,i){if(!e)return;let s;s=null!=t&&null!=t[this.columnName]||null==i?t&&null!=t[this.columnName]?t[this.columnName]:t:i;try{e.setValue(s)}catch(e){}}formComponent(e){let t={common:()=>({key:e}),newInstance:(e,i)=>{e=e??this.AB._mockApp;const s=t.common();return s.settings=s.settings||{},s.settings.objectId=this.object.id,s.settings.fieldId=this.id,e.viewNew(s,e,i)}};return t}detailComponent(){return{common:()=>({icon:"square"}),newInstance:(e,t)=>{e=e??this.AB._mockApp;const i=this.detailComponent().common();return i.settings=i.settings||{},i.settings.objectId=this.object.id,i.settings.fieldId=this.id,e.viewNew(i,e,t)}}}getSettings(){return Object.assign({},this.settings)}warningsMessage(e,t={}){let i=`${this.fieldKey()}[${this.label}]: ${e}`;this._warnings.push({message:i,data:t})}async getDbInfo(){return this.AB.Network.get({url:`/definition/info/object/${this.object.id}/field/${this.id}`})}formCleanData(e){}}},44322:(e,t,i)=>{const s=i(374);e.exports=class extends s{isValid(){return super.isValid()}columnHeader(e){const t=super.columnHeader(e);return t.editor=null,t.css="textCell",t.template=e=>e.$group?"":this.format(e),t}formComponent(){return super.formComponent("fieldreadonly")}detailComponent(){const e=super.detailComponent();return e.common=()=>({key:"detailtext"}),e}}},9740:(e,t,i)=>{const s=i(85410);e.exports=class extends s{constructor(e,t){super(e,t)}isValid(){return super.isValid()}columnHeader(e){e=e||{};const t=super.columnHeader(e);return t.editor="template",t.css="center",t.template=(t,i,s,n)=>t.$group?t[this.columnName]:e.editable?'<div class="ab-boolean-display">'+i.checkbox(t,i,s,n)+"</div>":s?"<div class='webix_icon fa fa-check-square-o'></div>":"<div class='webix_icon fa fa-square-o'></div>",t}formComponent(){return super.formComponent("checkbox")}formComponentMobile(){return super.formComponent("mobile-checkbox")}detailComponent(){const e=super.detailComponent();return e.common=()=>({key:"detailcheckbox"}),e}}},59675:(e,t,i)=>{const s=i(88238);e.exports=class extends s{constructor(e,t){super(e,t)}isValid(){return super.isValid()}columnHeader(e){const t=super.columnHeader(e);return t.editor=null,t.css="textCell",t.template=e=>e.$group?e[this.columnName]:this.format(e),t}formComponent(){return super.formComponent("fieldreadonly")}formComponentMobile(){return super.formComponent("mobile-fieldreadonly")}detailComponent(){const e=super.detailComponent();return e.common=()=>({key:"detailtext"}),e}}},63048:(e,t,i)=>{const s=i(72131);e.exports=class extends s{constructor(e,t){super(e,t)}isValid(){return super.isValid()}columnHeader(e){const t=super.columnHeader(e);return t.editor=null,t.css="textCell",t.template=e=>e.$group?"":this.format(e),t}formComponent(){return super.formComponent("fieldreadonly")}formComponentMobile(){return super.formComponent("mobile-fieldreadonly")}detailComponent(){const e=super.detailComponent();return e.common=()=>({key:"detailtext"}),e}warningsEval(){super.warningsEval(),(this.settings.combinedFields.split(",")||[]).forEach((e=>{this.object.fieldByID(e)||this.warningsMessage(`dependent field[${e}] not found.`,{fieldID:e,combinedFields:this.settings.combinedFields})}))}}},89981:(e,t,i)=>{const s=i(63800);e.exports=class extends s{constructor(e,t,i){super(e,t,i)}async destroy(){if(!this.id)return Promise.resolve();if(await super.destroy(),!this.datasourceLink)return Promise.resolve();const e=this.fieldLink;return e?e.destroy():Promise.resolve()}pullRelationValues(e){let t=[];const i=super.pullRelationValues(e),s=this.datasourceLink;return i&&s&&(Array.isArray(i)?t=i.map((function(e){return e&&(e.text=e.text||s.displayData(e),e.value=e.text),e})):i.id||i.uuid?(t=i,t.text=t.text||s.displayData(t),t.value=t.text):"string"==typeof i&&(t={text:i})),t}columnHeader(e){e=e||{};const t=super.columnHeader(e),i=this;i.AB._App,null==e.filters&&(e.filters={});var s="many"==this.settings.linkType;return t.editor=s?"multiselect":"combo",t.editFormat=e=>this.editFormat(e),t.editParse=e=>this.editParse(e),t.template=t=>{var s=i.pullRelationValues(t),n=[];if(n.push('<div class="badgeContainer">'),s&&Array.isArray(s)&&s.length)s.forEach((e=>{n.push(`<div class='webix_multicombo_value'><span>${e.value}</span>\x3c!-- span data-uuid="${e.id}" class="webix_multicombo_delete" role="button" aria-label="Remove item"></span --\x3e</div>`)})),s.length>1&&n.push(`<span class="webix_badge selectivityBadge">${s.length}</span>`);else{if(!s.value)return"";{let t="";e.editable&&(t='<span class="webix_multicombo_delete clear-combo-value" role="button" aria-label="Remove item"></span>'),n.push(`<div class='webix_multicombo_value'>${t}<span class="ellip">${s.value}</span></div>`)}}return n.push("</div>"),n.join("")},t.suggest={on:{onBeforeShow:function(){i.openOptions(this)}},filter:({value:e},t)=>(e??"").toLowerCase().includes((t??"").toLowerCase())},s&&(t.suggest.view="checksuggest",t.suggest.button=!0),t}openOptions(e){const t=e.getList();"one"!=this.settings.linkViaType&&(t?.find({})??[]).length||(["create","update"].forEach((e=>{this[`_dc_${e}_event`]||(this[`_dc_${e}_event`]=this.AB.on(`ab.datacollection.${e}`,(e=>{this.datasourceLink.id==e.objectId&&t.clearAll()})))})),this.getAndPopulateOptions(e,null,this))}customEdit(e,t){}formComponent(){return super.formComponent("connect")}formComponentMobile(){return"many"==this.settings.linkType?super.formComponent("mobile-selectmultiple"):super.formComponent("mobile-selectsingle")}detailComponent(){const e=super.detailComponent();return e.common=()=>({key:"detailconnect"}),e}async getOptions(e,t,i,s){const n=s;if(!n||(n._getOptionsThrottle&&(clearTimeout(n._getOptionsThrottle),delete n._timeToPullData,delete n._getOptionsResolve),n._timeToPullData=await new Promise((e=>{n._getOptionsResolve=e,n._getOptionsThrottle=setTimeout((()=>{e(!0)}),100)})),n._timeToPullData))return new Promise(((a,r)=>{let o=!1;const l=e=>{e=e.filter((e=>{if(e.text.toLowerCase().includes(t.toLowerCase()))return!0})),o?this.emit("option.data",e):(o=!0,a(e))},c=this.AB.cloneDeep(e||{});if(i=i||[],c.glue||(c.glue="and"),c.rules||(c.rules=[]),t=t||"",!this.settings.linkObject)return[];const u=this.datasourceLink;if(null==u)throw new Error("No linked object");const d=this.fieldLink;if(null==d)throw new Error("No linked column");const h=u.model();"many"==this.settings.linkType&&"one"==this.settings.linkViaType&&1!=s?.config?.showAllOptions?c.rules.push({key:d.id,rule:"is_null"}):"one"==this.settings.linkType&&"one"==this.settings.linkViaType&&1!=s?.config?.showAllOptions&&(1==this.settings.isSource?c.rules.push({key:d.id,rule:"have_no_relation"}):c.rules.push({key:d.id,rule:"is_null"})),this.getStorageID(c),Promise.resolve().then((async()=>!1)).then((async e=>{if(e)return this._options=e,l(this._options);let t=function(){return new Promise(((e,t)=>{e({data:[]})}))};if("one"==this?.settings?.linkViaType&&(this?.linkViaOneValues||n?.config?.value)){let e="";"multicombo"!=n?.config?.view&&"combo"!=n?.config?.view||!this?.linkViaOneValues?n?.config?.value&&(e=Array.isArray(n.config.value)?n?.config?.value.join():n?.config?.value):e=this?.linkViaOneValues;let i={},s=[];i.glue="or",i.rules=[],e.split(",").forEach((e=>{i.rules.push({key:"uuid",rule:"equals",value:e})})),t=function(){return h.findAll({where:i,sort:s,populate:!1})}}try{const e=await Promise.all([h.findAll({where:c,sort:i,populate:!1}),t()]),s=e[1].data.concat(e[0].data);return this._options=s.data||s||[],(this._options||[]).forEach((e=>{e.text=u.displayData(e),e.value=e.text})),l(this._options)}catch(e){throw this.AB.notify.developer(e,{context:"ABFieldConnect:getOptions(): unable to retrieve options from server",field:this.toObj(),where:c}),o=!0,e}}))}))}getStorageID(e){return`${this.id}-${JSON.stringify(e)}`}async clearStorage(e){const t=this.getStorageID(e);await this.AB.Storage.set(t,null)}editFormat(e){if(!e)return"";let t=[];if(Array.isArray(e))e.forEach((e=>{if("object"==typeof e)t.push(e.id);else{let i=this.getItemFromVal(e);i&&i.id?t.push(i.id):t.push(e)}}));else if("object"==typeof e)t.push(e.id);else{let i=this.getItemFromVal(e);i&&i.id?t.push(i.id):t.push(e)}return t.join()}editParse(e){if("many"==this.settings.linkType){if(e){let t=[];return e.split(",").forEach((e=>{t.push(this.getItemFromVal(e))})),t}return[]}return this.getItemFromVal(e)}getAndPopulateOptions(e,t,i,s){if(!e)return Promise.resolve([]);const n=e;"one"==this?.settings?.linkViaType&&n.getValue()&&!i.linkViaOneValues&&(i.linkViaOneValues=n.getValue());const a=t?.filters?Object.assign({},t.filters):{glue:"and",rules:[]};if(t?.filterByConnectValues){const e=(t,n,a=0)=>{const r=n.filter((e=>e?.depth===a));return[...t.rules.map((t=>{if(t.glue)return{glue:t.glue,rules:e(t,n,a+1)};const o=r.filter((e=>e.key===t.key&&e.value===t.value))[0];if(!o)return t;const l=o?.filterValue?.config.id?$$(o.filterValue.config.id):null;if(!l)throw Error("Some parent field's view components don't exist");const c=o?.filterValue?l.getValue()??"":"";let u="";if(c)if(o.filterColumn){const e=i.object.fieldByID(o.filterValue.config.dataFieldId);let t;if(e._options?.length)t=e.getItemFromVal(c);else{const e=(s.datacollection.datasource?.fields((e=>e.id==o.value||e.columnName==o.value))??[])[0];if(e){const i=s.datacollection?.getCursor();t=i[e.relationName()]??i[o.value]}}u=t?t[o.filterColumn]:c}else u=c;return{key:t.key,rule:"equals",value:u}}))]};a.rules=e(a,t.filterByConnectValues)}return this.handlerOptionData||(this.handlerOptionData=e=>{n.$destructed?this.removeListener("option.data",this.handlerOptionData):this.populateOptions(n,e,i,s,!0)}),this.removeListener("option.data",this.handlerOptionData).once("option.data",this.handlerOptionData),new Promise(((e,r)=>{this.getOptions(a,"",t?.sort??"",n).then((t=>{this.populateOptions(n,t,i,s,!0),e(t)}))}))}populateOptions(e,t,i,s,n){if(null!=e&&!e.$destructed){if(e.blockEvent(),e.getList().clearAll(),e.getList().define("data",t),n&&this.populateOptionsDataCy(e,i,s),e.getValue?.()&&t?.length){let s=e.getValue();"many"==i.linkType()&&"string"==typeof s&&(s=s.split(",")),Array.isArray(s)||(s=[s]);let n=[];s.forEach((e=>{const s=t.some((t=>t.id==e));if(s&&n.push(e),!s&&i.isConnection&&(i.indexField||i.indexField2)){const s=t.filter((t=>t[i.indexField?.columnName??""]==e||t[i.indexField2?.columnName??""]==e))[0];s&&n.push(s.id)}})),e.setValue(n)}e.unblockEvent()}}populateOptionsDataCy(e,t,i){if(!e?.$destructed&&e?.getList){if(!e.getPopup)return;var s=e.getPopup();if(!s)return;e.getList().data.each((e=>{if(e){var n=s.$view.querySelector("[webix_l_id='"+e.id+"']");n&&n.setAttribute("data-cy",`${t.key} options ${e.id} ${t.id} ${i?.id}`)}}))}}getItemFromVal(e){let t,i=this._options||[];if(i.length>0){for(let s=0;s<i.length;s++){if(this.indexField&&i[s][this.indexField.object.PK()]==e){t=i[s];break}if(this.indexField2&&i[s][this.indexField2.object.PK()]==e){t=i[s];break}if(i[s].id==e||i[s].value==e||i[s][this.indexField?.columnName??""]==e||i[s][this.indexField2?.columnName??""]==e){t=i[s];break}}return t}return""}getValue(e){if("many"==this.settings.linkType){let t=[];return e.getValue()&&e.getValue().split(",").forEach((i=>{t.push(e.getList().getItem(i))})),t}return e.getValue()?e.getList().getItem(e.getValue()):""}setValue(e,t){if(!e)return;let i=this.pullRelationValues(t);if(e.getList&&0==e.getList().count()){"one"===this.settings.linkType||Array.isArray(i)||(i=[i]);const t=e.getList();t.define("data",i),t.refresh()}let s=e.getValue(),n=Array.isArray(i)?i.map((e=>this.getRelationValue(e,{forUpdate:!0})??e.id??e.uuid??e)).join(","):this.getRelationValue(i,{forUpdate:!0})??i.id??i.uuid??i;s!=n&&e.setValue(n)}pullRecordRelationValues(e){var t=[],i=e,s=this.datasourceLink;return i&&s&&(Array.isArray(i)?t=i.map((function(e){return e&&(e.text=e.text||s.displayData(e),e.value=e.text),e})):(i.id||i.uuid)&&((t=i).text=t.text||s.displayData(t),t.value=t.text)),t}warningsEval(){super.warningsEval(),this.fieldLink||this.warningsMessage(`is unable to find linked field[${this.settings.linkColumn}]`,{linkColumn:this.settings.linkColumn}),this.datasourceLink||this.warningsMessage(`is unable to find linked object[${this.settings.linkObject}]`,{linkObject:this.settings.linkObject})}}},4637:(e,t,i)=>{const s=i(36009);e.exports=class extends s{constructor(e,t){super(e,t)}isValid(){return super.isValid()}columnHeader(e){const t=super.columnHeader(e);return t.editor="th"==this.AB.Account?.language()?"thaidate":"date",t.editable=!0,t.template=e=>e.$group?e[this.columnName]:this.format(e),t.format=e=>{const t={};return t[this.columnName]=e,this.format(t)},t.editFormat=e=>""==e||null==e?"":this.AB.rules.toDate(e),t}formComponent(){const e=super.formComponent("datepicker");return e.common=()=>({key:"datepicker"}),e}formComponentMobile(){const e=super.formComponent("mobile-date");return e.common=()=>({key:"mobile-date"}),e}detailComponent(){const e=super.detailComponent();return e.common=()=>({key:"detailtext"}),e}dateToString(e,t){return webix.Date.dateToStr(e)(t)}format(e){if(!window.webixLocale)return super.format(e);const t=this.dataValue(e);if(""==t||null==t)return"";const i=this.AB.rules.toDate(t);return this.settings.dateFormat>=4?webix.i18n.longDateFormatStr(i):webix.i18n.dateFormatStr(i)}}},85690:(e,t,i)=>{const s=i(32965);e.exports=class extends s{constructor(e,t){super(e,t)}columnHeader(e){const t=super.columnHeader(e);return 1==this.settings.dateFormat?t.editor="time":t.editor="th"==this.AB.Account?._config?.languageCode?"thaidatetime":"datetime",t.editable=!0,t.template=e=>e.$group?e[this.columnName]:this.format(e),t.format=e=>{const t={};return t[this.columnName]=e,this.format(t)},t.editFormat=e=>""==e||null==e?"":this.AB.rules.toDate(e),t}formComponent(){const e=super.formComponent("datepicker");return e.common=()=>({key:"datepicker"}),e}formComponentMobile(){const e=super.formComponent("mobile-datetime");return e.common=()=>({key:"mobile-datetime"}),e}detailComponent(){const e=super.detailComponent();return e.common=()=>({key:"detailtext"}),e}format(e){if(!window.webixLocale)return super.format(e);const t=this.dataValue(e);if(""==t||null==t)return"";const i=this.AB.rules.toDate(t),s=this.settings.dateFormat,n=webix.Date.dateToStr(this.getTimeFormat());return s>=4?`${webix.i18n.longDateFormatStr(i)} ${n(i)}`:`${webix.i18n.dateFormatStr(i)} ${n(i)}`}}},75922:(e,t,i)=>{const s=i(95905);e.exports=class extends s{columnHeader(e){const t=super.columnHeader(e);return t.editor="text",t}formComponent(){const e=super.formComponent();return e.common=()=>({key:"textbox",settings:{type:"single"}}),e}formComponentMobile(){const e=super.formComponent();return e.common=()=>({key:"mobile-email",settings:{}}),e}detailComponent(){const e=super.detailComponent();return e.common=()=>({key:"detailtext"}),e}}},72408:(e,t,i)=>{const s=i(34921),n=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{constructor(e,t){super(e,t)}isValid(){return super.isValid()}async destroy(){return new Promise(((e,t)=>{this.id?webix.confirm({title:n("Keep Files?"),message:n("Do you want to keep the files referenced by {0}?",[this.label]),callback:async i=>{this.settings.removeExistingData=i?0:1;try{await this.save(),webix.alert({title:"!! TODO !!",text:"Tell a Developer to actually pay attention to this!"}),await super.destroy(),e()}catch(e){t(e)}}}):e()}))}columnHeader(e){e=e||{};const t=super.columnHeader(e);t.editor=!1;const i=e.editable;return t.template=e=>e.$group?this.dataValue(e):['<div class="ab-file-data-field" style="float: left;">','<div class="webix_view ab-file-holder">','<div class="webix_template">',this.fileTemplate(e,i),"</div>","</div>","</div>"].join(""),t}customDisplay(e,t,i,s){if(!i)return;s=s||{};let a=[],r=0;this.settings.limitFileType&&this.settings.fileType&&(a=this.settings.fileType.split(",")),this.settings.limitFileSize&&this.settings.fileSize&&(r=this.settings.fileSize);const o=i.querySelector(".ab-file-holder");if(o){o.innerHTML="";const t=webix.ui({view:"template",container:o,template:this.fileTemplate(e,s.editable),borderless:!0,width:160,height:60});if(webix.extend(t,webix.ProgressBar),!s.editable){const e=o.querySelector(".delete-image");return void(e&&(e.style.display="none"))}const l=this.urlUpload(!0),c=webix.ui({view:"uploader",apiOnly:!0,upload:l,inputName:"file",multiple:!1,on:{onBeforeFileAdd:function(e){i.classList.remove("webix_invalid"),i.classList.remove("webix_invalid_cell");const s=a;if(s&&""!=s){const t=e.type.toLowerCase();if(-1==s.indexOf(t))return webix.message(n("Only [{0}] files are supported",[s.join(", ")])),!1}if(r>0){const t=1e6*r;if(e.size>t)return webix.message(n("Maximum file size is {0}MB",[r])),!1}t.showProgress({type:"icon",delay:2e3})},onFileUpload:async(s,n)=>{t.hideProgress();const a={};if(a[this.columnName]={},a[this.columnName].uuid=n.data.uuid,a[this.columnName].filename=s.name,e.id)try{await this.object.model().update(e.id,a),$$(i)&&$$(i).updateItem&&$$(i).updateItem(e.id,a)}catch(t){i.classList.add("webix_invalid"),i.classList.add("webix_invalid_cell"),this.AB.notify.developer(t,{context:"ABFieldFile.onFileUpload(): Error updating our entry.",row:e,values:a})}this.setValue($$(i),a)},onFileUploadError:(e,i)=>{this.AB.notify.developer(new Error("Error loading file"),{message:"ABFieldFile:onFileUploadError(): Error loading file",response:i}),t.hideProgress()}}});c.addDropZone(t.$view),i.dataset.uploaderId=c.config.id,i.addEventListener("click",(e=>{e.target.className.indexOf("delete-image")>-1&&(this.deleteFile=!0)}))}}customEdit(e,t,i){if(1==this.deleteFile)delete this.deleteFile,webix.confirm({title:"",text:n("Are you sure you want to remove this file?"),callback:async t=>{if(!!t){const t={};if(t[this.columnName]={},e.id)try{await this.object.model().update(e.id,t),$$(i)&&$$(i).updateItem&&$$(i).updateItem(e.id,t)}catch(s){i.classList.add("webix_invalid"),i.classList.add("webix_invalid_cell"),this.AB.notify.developer(s,{message:"ABFieldFile:customEdit(): Error updating our entry.",row:e,values:t})}else this.setValue($$(i),t)}}});else{const t=this.dataValue(e);if(!t||!t.uuid){const t=i.dataset.uploaderId,s=$$(t);s&&s.fileDialog&&s.fileDialog({rowid:e.id})}}return!1}formComponent(){return super.formComponent("fieldcustom")}formComponentMobile(){return super.formComponent("mobile-file")}detailComponent(){const e=super.detailComponent();return e.common=()=>({key:"detailcustom"}),e}fileTemplate(e,t){let i="",s="display:none;",a="",r="",o="";const l=this.dataValue(e);return l&&(r=l.uuid,o=l.filename),r&&o&&(i="display:none;",s="",a="/file/"+r),[`<div class="file-data-field-icon" style="text-align: center; height: inherit; display: table-cell; vertical-align: middle; border: 2px dotted #CCC; background: #FFF; border-radius: 10px; font-size: 11px; line-height: 13px; padding: 0 10px; ${i}"><i class="fa fa-file fa-2x" style="opacity: 0.6; font-size: 32px; margin-top: 3px; margin-bottom: 5px;"></i>${t?`<br/>${n("Drag and drop or click here")}`:""}</div>`,`<div class="file-data-field-name" style=" width:100%; height:100%; position:relative; "><a target="_blank" href="${a}">${o||""}</a>${t?`<a style="${s}" class="ab-delete-photo" href="javascript:void(0);"><i class="fa fa-times delete-image"></i></a>`:""}</div>`].join("")}getValue(e,t){const i=e.$view.querySelector(".file-data-field-name"),s=i.querySelector("a");return{uuid:i.getAttribute("file-uuid"),filename:s.innerHTML}}setValue(e,t){if(!e)return;const i=e.$view;if(!i)return;let s=null;t&&(s=this.dataValue(t));const n=i.querySelector(".file-data-field-icon");n&&(n.style.display=s&&s.uuid?"none":"block");const a=i.querySelector(".file-data-field-name");if(a){const e=a.querySelector(".ab-delete-photo");e&&(e.style.display=s&&s.uuid?"block":"none"),a.style.display=s&&s.uuid?"block":"none",s&&s.uuid?a.setAttribute("file-uuid",s.uuid):a.removeAttribute("file-uuid");const t=a.querySelector("a"),i="/file/"+(s?s.uuid:"");t.href=i,t.innerHTML=s?s.filename:""}}urlUpload(e=!0){return`/file/upload/${this.object.id}/${this.id}/${e?"1":"0"}`}urlFile(e){return`/file/${e}`}}},37900:(e,t,i)=>{const s=i(75193);e.exports=class extends s{columnHeader(e){const t=super.columnHeader(e);return t.editor=null,t.css="textCell",t.template=e=>e.$group?e[this.columnName]:this.format(e),t}formComponent(){return super.formComponent("fieldreadonly")}formComponentMobile(){return super.formComponent("mobile-fieldreadonly")}detailComponent(){const e=super.detailComponent();return e.common=()=>({key:"detailtext"}),e}}},15884:(e,t,i)=>{const s=i(93355),n=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{constructor(e,t){super(e,t)}async destroy(){return new Promise(((e,t)=>{this.id?webix.confirm({title:n("Keep Images?"),message:n("Do you want to keep the images referenced by {0}?",[this.label]),callback:async i=>{this.settings.removeExistingData=i?0:1;try{await this.save(),webix.alert({title:"!! TODO !!",text:"ABFieldImage.destroy(): Tell a Developer to actually pay attention to this!"}),await super.destroy(),e()}catch(e){t(e)}}}):e()}))}idCustomContainer(e,t){return t?`${this.columnName.replace(/ /g,"_")}-${t}-image`:`${this.columnName.replace(/ /g,"_")}-${e.id}-image`}columnHeader(e){e=e||{};const t=super.columnHeader(e),i=this;t.editor=!1;let s="100%",n="100%",a="100%",r="100%";if(i.settings.useWidth){t.width=i.settings.imageWidth||100;const e=i.settings.useHeight&&i.settings.imageHeight?i.settings.imageHeight+20:80;s=`${e}px`,a=`${i.settings.imageWidth||100}px`,n=i.settings.useHeight&&i.settings.imageHeight?i.settings.imageHeight:80,n=`${n}px`,r=i.settings.useHeight&&i.settings.imageHeight?i.settings.imageHeight:60,r=`${r}px`}else e.width&&(t.width=e.width||100,a=`${e.width||100}px`,n=e.width,n=`${n}px`,r=e.width,r=`${r}px`);i.settings.useHeight&&i.settings.imageHeight&&"NaN"!=i.settings.imageHeight&&(t.height=i.settings.imageHeight||0,s=parseInt(t.height)+20,s=`${s}px`,n=parseInt(t.height),n=`${n}px`,r=parseInt(t.height),r=`${r}px`);const o=e.editable;return t.template=e=>e.$group?e[this.columnName]:[`<div class="ab-image-data-field" style="float: left; width: ${a}; height: ${s}">`,`<div class="webix_view ab-image-holder" style="width: ${a}; height: ${n}">`,'<div class="webix_template">',this.imageTemplate(e,{editable:o,height:r,width:a}),"</div>","</div>","</div>"].join(""),t}customDisplay(e,t,i,s){if(!i)return;s=s||{};const a=i.querySelector(".ab-image-holder");if(a){a.innerHTML="";let t=0;this.settings.useHeight&&(t=parseInt(this.settings.imageHeight)||t);let r=0;this.settings.useWidth&&(r=parseInt(this.settings.imageWidth)||r),s.height&&(t=s.height),s.width&&(r=s.width);const o=webix.ui({view:"template",css:"ab-image-holder",container:a,template:this.imageTemplate(e,{editable:s.editable,height:t?t+"px":0,width:r?r+"px":0}),borderless:!0,height:t,width:r});if(webix.extend(o,webix.ProgressBar),!s.editable){const e=a.querySelector(".delete-image");return void(e&&(e.style.display="none"))}const l=this.urlUpload(),c=webix.ui({view:"uploader",apiOnly:!0,upload:l,inputName:"file",multiple:!1,status:e=>{e.percent&&(o.hideProgress(),o.showProgress({type:"top",position:e.percent/100}))},on:{onBeforeFileAdd:e=>{i.classList.remove("webix_invalid"),i.classList.remove("webix_invalid_cell");const t=["jpg","jpeg","bmp","png","gif","webp"],s=e.type.toLowerCase();if(-1==t.indexOf(s))return webix.message(n("Only [{0}] images are supported",[t.join(", ")])),!1;this.uploadInProgress=!0;var a=new FileReader;a.onload=e=>{this.showImage(null,i,e.target.result),o.showProgress({type:"top",delay:2e3})},a.readAsDataURL(e.file)},onFileUpload:async(t,s)=>{o.hideProgress(),this.showImage(s.data.uuid,i),this.uploadInProgress=!1;const n={};if(n[this.columnName]=s.data.uuid,e.id)try{if(await this.object.model().update(e.id,n),$$(i)&&$$(i).getItem&&$$(i).getItem(e.id))$$(i).updateItem(e.id,n);else{const t=document.querySelector(".webix_dtable");$$(t)&&$$(t).getItem(e.id)&&$$(t).updateItem(e.id,n)}}catch(t){i.classList.add("webix_invalid"),i.classList.add("webix_invalid_cell"),this.AB.notify.developer(t,{context:"ABFieldImage.onFileUpload(): model.update(): error updating our entry",field:this.toObj(),row:e,values:n})}this.setValue($$(i),n)},onFileUploadError:(e,t)=>{this.AB.notify.developer(new Error("Error uploading image"),{context:"ABFieldImage. uploader. onFileUploadError():",field:this.toObj(),response:t}),o.hideProgress()}}});c.addDropZone(o.$view),i.dataset.uploaderId=c.config.id,"webix_cell"==i.className&&i.addEventListener("click",(e=>{e.target.className.indexOf("delete-image")>-1&&(this.deleteImage=!0)}))}}customEdit(e,t,i,s,a){if(a&&a.target.className.indexOf("delete-image")>-1||this.deleteImage)delete this.deleteImage,e.removeDefaultImage||(e.removeDefaultImage=[]),e.removeDefaultImage[this.columnName]=!0,webix.confirm({title:n("Are you sure you want to remove this image?"),callback:async t=>{if(!!t){const t={};t[this.columnName]="";try{await this.object.model().update(e.id,t),$$(i)&&$$(i).updateItem&&$$(i).updateItem(e.id,t),this.setValue($$(i),t)}catch(s){i.classList.add("webix_invalid"),i.classList.add("webix_invalid_cell"),this.AB.notify.developer(s,{context:"ABFieldImage: customEdit(): Error updating our entry",field:this.toObj(),row:e,values:t})}}}});else{const t=i.dataset.uploaderId,s=$$(t);s&&s.fileDialog&&s.fileDialog({rowid:e.id})}return!1}formComponent(){return super.formComponent("fieldcustom")}formComponentMobile(){return super.formComponent("mobile-image")}detailComponent(){const e=super.detailComponent();return e.common=()=>({key:"detailimage"}),e}imageTemplate(e,t){(t=t||{}).height=t.height||"100%",t.width=t.width||"100%";let i="",s="display:none;",a="",r="",o=!1;e[this.columnName]&&(r=e[this.columnName]),e.removeDefaultImage&&e.removeDefaultImage[this.columnName]&&(o=e.removeDefaultImage[this.columnName]),r?(i="display:none;",s="",a=`background-image:url('${this.urlImage(r)}');`):this.settings.useDefaultImage&&!o&&(i="display:none;",s="",a=`background-image:url('${this.urlImage(this.settings.defaultImageUrl)}');`);let l=[`<div class="image-data-field-icon" style="${i}">#drag#</div><div class="image-data-field-image" style="${s} height:${t.height}; ${a}">#remove#</div>`].join("");return l=l.replace("#drag#",t.editable?`<div>${n("Drag and drop or click here")}</div>`:""),l=l.replace("#remove#",t.editable?`<a style="${s}" class="ab-delete-photo" href="javascript:void(0);"><i class="fa fa-times delete-image"></i></a>`:""),l}showImage(e,t,i){const s=t.querySelector(".ab-image-holder");if(s){s.querySelector(".image-data-field-icon").style.display="none";const t=s.querySelector(".image-data-field-image");t.style.display="",t.style.backgroundImage=`url('${i??this.urlImage(e)}')`,t.setAttribute("image-uuid",e)}}getValue(e,t){return e.$view.querySelector(".image-data-field-image").getAttribute("image-uuid")}setValue(e,t){if(!e)return;const i=e.$view;if(!i)return;let s=null;t&&(s=this.dataValue(t));const n=i.querySelector(".image-data-field-icon");n&&(n.style.display=s?"none":"");const a=i.querySelector(".image-data-field-image");if(a){const e=a.querySelector(".ab-delete-photo");e&&(e.style.display=s?"block":"none"),a.style.display=s?"block":"none",s?(a.style.backgroundImage=`url('${this.urlImage(s)}')`,a.setAttribute("image-uuid",s)):a.removeAttribute("image-uuid")}}toBase64(e){return new Promise(((t,i)=>{if(!e[this.columnName])return t(null);const s=new Image;s.crossOrigin="Anonymous",s.onerror=function(e){i(e)},s.onload=function(){const e=document.createElement("canvas");e.width=s.width,e.height=s.height,e.getContext("2d").drawImage(s,0,0);const i={data:e.toDataURL(),width:s.width,height:s.height};t(i)},s.src=this.urlImage(e[this.columnName])}))}urlImage(e){return`/file/${e}`}urlUpload(e=!0){return`/file/upload/${this.object.id}/${this.id}/${e?"1":"0"}`}isValidData(e,t){super.isValidData(e,t),this.uploadInProgress&&t.addError(this.columnName,n("Image still uploading"))}rotateLeft(e){return this.AB.Network.put({url:`/image/rotate/${e}?direction=left`})}rotateRight(e){return this.AB.Network.put({url:`/image/rotate/${e}?direction=right`})}}},4213:(e,t,i)=>{const s=i(97972);e.exports=class extends s{columnHeader(e){const t=super.columnHeader(e);return t.editor="text",t.css="textCell",t.template=()=>"",t}formComponent(){const e=super.formComponent();return e.common=()=>({key:"json",settings:{type:"string"}}),e}formComponentMobile(){return super.formComponent("mobile-fieldreadonly")}detailComponent(){const e=super.detailComponent();return e.common=()=>({key:"detailtext"}),e}setValue(e,t){super.setValue(e,t,""),e.config.value=t[this.columnName]}formCleanData(e){""===e[this.columnName]&&delete e[this.columnName]}}},34963:(e,t,i)=>{const s=i(86430);e.exports=class extends s{constructor(e,t){super(e,t)}save(){return super.save().then((()=>{if(this.pendingDeletions.length){const e=this.object.model();if(1==this.settings.isMultiple)return new Promise(((t,i)=>{let s=0,n=0;e.findAll({}).then((i=>{(i=i.data||i).forEach((i=>{if(Array.isArray(i[this.columnName])){let a=i[this.columnName].filter((e=>-1==this.pendingDeletions.indexOf(e.id)));if(a.length!=i[this.columnName].length){n++,0==a.length&&(a="");const r={};r[this.columnName]=a,e.update(i.id,r).then((()=>{s++,s>=n&&t()}))}}})),0==n&&t()})).catch(i)}));{const t={};return t[this.columnName]=this.pendingDeletions,new Promise(((i,s)=>{let n=0;e.findAll(t).then((t=>{t=t.data||t;const s={};s[this.columnName]="",t.forEach((a=>{e.update(a.id,s).then((()=>{n++,n>=t.length&&i()}))})),0==t.length&&i()})).catch(s)}))}}}))}isValid(){return super.isValid()}columnHeader(e){e=e||{};const t=super.columnHeader(e);return this.AB._App,e.editable&&((...e)=>{AB.Multilingual.label(...e)})("Select item"),e.editable&&this.settings.required,t.editFormat=e=>this.editFormat(e),t.editParse=e=>this.editParse(e),t.template=t=>{let i=t[this.columnName];if(null==i)return"";this.settings.isMultiple&&(i=function(e,t={}){let i=[];return null!=t[e.columnName]&&(i=t[e.columnName],"string"==typeof i&&(i=JSON.parse(i)),e.settings&&(i=(e.settings.options||[]).filter((e=>(i||[]).filter((t=>(e.id||e)==(t.id||t))).length>0)))),i}(this,t));var s=[];s.push('<div class="badgeContainer">');let n="",a="";if(i&&Array.isArray(i)&&i.length)i.forEach((e=>{this.settings.hasColors&&e.hex&&(n="hascustomcolor",a=`background: ${e.hex};`),e.text&&s.push(`<div style="${a}" class='webix_multicombo_value ${n}'><span>${e.text}</span>\x3c!-- span data-uuid="${e.id}" class="webix_multicombo_delete" role="button" aria-label="Remove item"></span --\x3e</div>`)})),i.length>1&&s.push(`<span class="webix_badge selectivityBadge">${i.length}</span>`);else{if(!i)return"";{let t=i;if("string"==typeof i&&(t=this.getItemFromVal(i)),!t)return"";if(this.settings.hasColors&&t.hex&&(n="hascustomcolor",a=`background: ${t.hex};`),t.text){let i="";e.editable&&!this.settings.required&&(i='<span class="webix_multicombo_delete clear-combo-value" role="button" aria-label="Remove item"></span>'),s.push(`<div style="${a}" class='webix_multicombo_value ${n}'>${i}<span class="ellip">${t.text}</span></div>`)}}}return s.push("</div>"),s.join("")},t.editor=this.settings.isMultiple?"multiselect":"combo",t.suggest={button:!0,data:this.settings.options.map((function(e){return{id:e.id,value:e.text,hex:e.hex}}))},this.settings.isMultiple&&(t.suggest.view="checksuggest"),t}customDisplay(e,t,i,s){if(i&&(s=s||{},i.querySelector)){var n=i.querySelector(".selectivity-single-selected-item-remove");n&&n.addEventListener("click",(t=>{t.stopPropagation();var s={};s[this.columnName]="",this.object.model().update(e.id,s).then((()=>{$$(i)?.updateItem?.(e.id,s)})).catch((t=>{i.classList.add("webix_invalid"),i.classList.add("webix_invalid_cell"),this.AB.notify.developer(t,{message:"ABFieldList:customDisplay(): Error updating our entry.",row:e,values:"",field:this.toObj()})}))}))}}formComponent(){const e=super.formComponent();return e.common=()=>({key:this.settings.isMultiple?"selectmultiple":"selectsingle",settings:{options:this.settings.options.map((function(e){return{id:e.id,value:e.text,hex:e.hex}}))}}),e}formComponentMobile(){const e=super.formComponent();return e.common=()=>({key:this.settings.isMultiple?"mobile-selectmultiple":"mobile-selectsingle",settings:{options:this.settings.options.map((function(e){return{id:e.id,value:e.text,hex:e.hex}}))}}),e}detailComponent(){const e=super.detailComponent();return e.common=()=>({key:(this.settings.isMultiple,"detailtext")}),e}editFormat(e){if(!e)return"";let t=[];if(Array.isArray(e))e.forEach((e=>{if("object"==typeof e)t.push(e.id);else{let i=this.getItemFromVal(e);t.push(i.id)}}));else if("object"==typeof e)t.push(e.id);else{let i=this.getItemFromVal(e);i&&i.id&&t.push(i.id)}return t.join()}editParse(e){if(this.settings.isMultiple){let t=[];return e.split(",").forEach((e=>{t.push(this.getItemFromVal(e))})),t}return e}getItemFromVal(e){let t,i=this.options();return i.length>1?(i.forEach((i=>{if(i.id==e)return t=i,!1})),t):""}getValue(e,t){return this.editParse(e.getValue())}getSelectedOptions(e,t={}){let i=[];return null!=t[this.columnName]?i=t[this.columnName]:t&&(Array.isArray(t)?i=t:i.push(t)),i.length&&("string"==typeof i&&(i=JSON.parse(i)),this.settings&&(i=(this.settings.options||[]).filter((e=>(i||[]).filter((t=>(e.id||e)==(t.id||t))).length>0)))),i}setValue(e,t){e&&(this.settings.isMultiple||super.setValue(e,t))}}},26331:(e,t,i)=>{const s=i(81213);e.exports=class extends s{constructor(e,t){super(e,t)}isValid(){return super.isValid()}columnHeader(e){const t=super.columnHeader(e);return t.editor="text",t.template=(e,t,i,s,n)=>(i||"").toString().replace(/[<]/g,"&lt;"),t}formComponent(){const e=super.formComponent();return e.common=()=>({key:"textbox",settings:{type:"multiple"}}),e}formComponentMobile(){const e=super.formComponent();return e.common=()=>({key:"mobile-textbox",settings:{type:"multiple"}}),e}detailComponent(){const e=super.detailComponent();return e.common=()=>({key:"detailtext"}),e}setValue(e,t){super.setValue(e,t,"")}}},18799:(e,t,i)=>{const s=i(42686);let n=!1;e.exports=class extends s{constructor(e,t){n||(webix.editors.number=webix.extend({},webix.editors.text),n=!0),super(e,t)}columnHeader(e){const t=super.columnHeader(e);return t.editor="number",t.format=e=>{const t={};return t[this.columnName]=e,this.format(t)},t}formComponent(){return super.formComponent("numberbox")}formComponentMobile(){return super.formComponent("mobile-numberbox")}detailComponent(){const e=super.detailComponent();return e.common=()=>({key:"detailtext"}),e}}},53317:(e,t,i)=>{const s=i(34117),n={allowClear:!0,removeOnly:!1,readOnly:!1,showDropdown:!0,placeholder:"",multiple:!1},a={key:"selectivity"};e.exports=class extends s{constructor(e,t,i=a){super(e,t,i)}static defaults(){return{key:"selectivity",icon:"bars",menuName:"",description:""}}selectivityRender(e,t,i,s){if(null==e)return;const a=t.dataCy||"";e.setAttribute("data-cy",a),t=t||{};for(const e in n)null===t[e]?t[e]=null:t[e]=t[e]||n[e];if(t.multiple&&t.items&&t.data&&t.data.length?(t.data.forEach((function(e){t.items.map((function(t){t.id==e.id&&(e.hex=t.hex)}))})),t.data=this.prepareData(t.data,t.multiple)):null==t.data||""==t.data?t.data=this.prepareData([],t.multiple):t.data=this.prepareData(t.data,t.multiple),t.field=this.id,null!=e.selectivity)return void e.selectivity.setOptions(t);let r;if(t.element=e,t.multiple?(t.isUsers?t.templates={multipleSelectedItem:function(e){return`<span class="selectivity-multiple-selected-item ${e.highlighted?" highlighted":""}"\n\t\t\t\t\t\t\t\tstyle="background-color: #eee !important; color: #666 !important; box-shadow: inset 0px 1px 1px #333;"\n\t\t\t\t\t\t\t\tdata-item-id="${e.uuid}" data-field-id="${t.field}">\n\t\t\t\t\t\t\t\t<i class="fa fa-user" style="color: #666; opacity: 0.6;"></i> \n                        ${t.additionalText?t.additionalText(e):""}\n\t\t\t\t\t\t\t\t${t.isLabelHidden?"":e.text}\n\t\t\t\t\t\t\t\t${e.removable?' <a class="selectivity-multiple-selected-item-remove" style="color: #333;"><i class="fa fa-remove"></i></a>':""}\n\t\t\t\t\t\t\t</span>`}}:t.templates={multipleSelectedItem:function(e){return`<span class="selectivity-multiple-selected-item ${e.highlighted?" highlighted":""}"\n\t\t\t\t\t\t\t\tstyle="background-color: ${e.hex} !important;"\n\t\t\t\t\t\t\t\tdata-item-id="${e.uuid}" data-field-id="${t.field}">\n                        ${t.editPage?' <a class="selectivity-multiple-selected-item-edit"><i class="fa fa-edit"></i></a>':""}\n                        ${t.additionalText?t.additionalText(e):""}\n                        ${t.isLabelHidden?"":e.text}\n                        ${e.removable?' <a class="selectivity-multiple-selected-item-remove"><i class="fa fa-remove"></i></a>':""}\n\t\t\t\t\t\t\t</span>`}},r=new Selectivity.Inputs.Multiple(t),e.selectivity=r,this.selectivitySetBadge(e,i,s)):(t.templates={singleSelectedItem:function(e){return`<span class="selectivity-single-selected-item" data-item-id="${e.uuid}" data-field-id="${t.field}">\n\t\t\t\t\t\t\t${t.editPage?'<a class="selectivity-single-selected-item-edit"><i class="fa fa-edit"></i></a>':""}\n                     ${t.additionalText?t.additionalText(e):""}\n                     ${t.isLabelHidden?"":e.text}\n                     ${e.removable?'<a class="selectivity-single-selected-item-remove"><i class="fa fa-remove"></i></a>':""}\n\t\t\t\t\t\t</span>`}},r=new Selectivity.Inputs.Single(t),e.selectivity=r),t.editPage){const t=()=>{const e=this,t=document.querySelectorAll(".selectivity-single-selected-item-edit, .selectivity-multiple-selected-item-edit");for(let i=0;i<t.length;i++){const s=t[i];s&&!s.__hasClickEvent&&(s.addEventListener("click",(function(t){t.stopPropagation(),t.preventDefault();const i=this.parentElement;if(!i)return;const s=i.getAttribute("data-item-id");if(!s)return;const n=i.getAttribute("data-field-id");if(!n)return;const a=e.object.fieldByID(n);a&&a.emit("editPage",s)}),!0),s.__hasClickEvent=!0)}};setTimeout((()=>{t(),e.addEventListener("change",(()=>{t()}))}),500)}if(t.readOnly){const t=e.getElementsByClassName("selectivity-caret");for(let e=0;e<t.length;e++){const i=t[e];i&&i.parentNode.removeChild(i)}}this.selectivitySettings=t}selectivityGet(e){return e&&e.selectivity?this.selectivitySettings&&this.selectivitySettings.multiple?e.selectivity.getData()||[]:e.selectivity.getData()||null:this.selectivitySettings&&this.selectivitySettings.multiple?[]:null}selectivitySet(e,t){e&&e.selectivity&&(t=this.prepareData(t,e.selectivity.options.multiple),Array.isArray(t)&&t[0]||t&&t.id?e.selectivity.setData(t):e.selectivity.clear())}selectivityDestroy(e){e&&e.selectivity&&(e.selectivity.destroy(),delete e.selectivity)}prepareData(e,t=!0){if(!e&&t)return[];if(t&&e&&Array.isArray(e)&&0==e.length)return[];if(!t&&e&&Array.isArray(e)&&0==e.length)return null;if(!e&&!t)return null;if("string"==typeof e&&e.length>0)try{e=JSON.parse(e)}catch(t){e={id:e,text:e}}return!t&&Array.isArray(e)?e=e[0]:t&&!Array.isArray(e)&&(e=[e]),t?e.forEach((e=>{!e.id&&e.uuid&&(e.id=e.uuid)})):!e.id&&e.uuid&&(e.id=e.uuid),null==e&&t&&(e=[]),e}selectivitySetBadge(e){if(e.clientHeight&&e.clientHeight-e.parentElement.clientHeight>5){let t=0,i=[];if(e&&e.selectivity&&(i=e.selectivity.getValue()||[]),t=i.length,t>1){const i=e.querySelector(".webix_badge.selectivityBadge");if(null!=i)i.innerHTML=t;else{const i=document.createElement("A");i.href="javascript:void(0);";const s=document.createElement("SPAN"),n=document.createTextNode(t);s.classList.add("webix_badge","selectivityBadge"),s.appendChild(n),i.appendChild(s),e.appendChild(i)}}}}}},2163:(e,t,i)=>{const s=i(5254);e.exports=class extends s{columnHeader(e){const t=super.columnHeader(e);return t.editor="text",t.css="textCell",t.template=(e,t,i)=>e.$group?"":(i||"").toString().replace(/[<]/g,"&lt;"),t}defaultValue(e){e[this.columnName]||this.settings.default&&(this.settings.default.indexOf("{uuid}")>=0?e[this.columnName]=this.AB.uuid():e[this.columnName]=this.settings.default)}formComponent(){const e=super.formComponent();return e.common=()=>({key:"textbox",settings:{type:"single"}}),e}formComponentMobile(){const e=super.formComponent();return e.common=()=>({key:"mobile-textbox",settings:{type:"single"}}),e}formComponentMobile(){const e=super.formComponent();return e.common=()=>({key:"mobile-textbox",settings:{type:"single"}}),e}detailComponent(){const e=super.detailComponent();return e.common=()=>({key:"detailtext"}),e}setValue(e,t){super.setValue(e,t,"")}}},81961:(e,t,i)=>{const s=i(35756);e.exports=class extends s{columnHeader(e){const t=super.columnHeader(e);return t.editor=null,t.css="textCell",t.template=e=>e.$group?"":this.format(e),t}customDisplay(){}formComponent(){return null}detailComponent(){const e=super.detailComponent();return e.common=()=>({key:"detailtext"}),e}}},10567:(e,t,i)=>{const s=i(8514),n=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{idCustomContainer(e){return`${this.columnName.replace(/ /g,"_")}-${e.id}-tree`}columnHeader(e){e=e||{};const t=super.columnHeader(e),i=this;let s="",a="";e.isForm&&(s=" form-entry",a="<span style='color: #CCC; padding: 0 5px;'>"+n("Select items")+"</span>");const r=e.width;return t.template=e=>{if(e.$group)return e[i.columnName];const t=[];let n=this.AB.cloneDeep(i.settings.options);n=new webix.TreeCollection({data:n});let o=e;null!=e[i.columnName]&&(o=e[i.columnName]),n.data.each((function(e){if(void 0!==o.indexOf&&-1!=o.indexOf(e.id)){let i="",s=e.id;for(;this.getParentId(s);)n.data.each((function(e){n.data.getParentId(s)==e.id&&(i=e.text+": "+i)})),s=this.getParentId(s);i+=e.text,t.push(i)}}));let l="";return l+="<div class='list-data-values'>",0==t.length?l+=a:t.forEach((function(e){l+='<span class="selectivity-multiple-selected-item rendered" style="background-color:#4CAF50 !important;">'+e+"</span>"})),l+="</div>",r?'<div style="margin-left: '+r+'px;" class="list-data-values'+s+'">'+l+"</div>":'<div class="list-data-values'+s+'">'+l+"</div>"},t}customDisplay(e,t,i,s){if(!i)return;const a=this;if((s=s||{}).isForm){if(!e||0==e.length)return void(i.innerHTML="<div class='list-data-values form-entry'><span style='color: #CCC; padding: 0 5px;'>"+n("Select items")+"</span></div>");const t=[];s=this.AB.cloneDeep(a.settings.options),s=new webix.TreeCollection({data:s});let r=e;null!=e[a.columnName]&&(r=e[a.columnName]),s.data.each((function(e){if(void 0!==r.indexOf&&-1!=r.indexOf(e.id)){let i="",n=e.id;for(;this.getParentId(n);)s.data.each((function(e){s.data.getParentId(n)==e.id&&(i=e.text+": "+i)})),n=this.getParentId(n);i+=e.text,t.push(i)}}));const o="#4CAF50";let l="";l+="<div class='list-data-values form-entry'>",t.forEach((function(e){l+='<span class="selectivity-multiple-selected-item rendered" style="background-color:'+o+' !important;">'+e+"</span>"})),l+="</div>",i.innerHTML=l}a.setBadge(i,t,e)}customEdit(e,t,i,s){const n=t.unique(this.idCustomContainer(e)),a=`${n}-popup`,r=`${n}-tree`,o=$$(i),l=this,c=s;let u={},d=!0;function h(e,t){u=function(e,t){let i={};return void 0!==e&&void 0!==e.columnName&&void 0!==t[e.columnName]&&(i=t[e.columnName]),i}(e,t);const i=$$(r);i.blockEvent();const s=e.AB.cloneDeep(e.settings.options);i.clearAll(),i.parse(s),i.refresh(),i.uncheckAll(),i.openAll(),null!=u&&u.length&&u.forEach((function(e){i.exists(e)&&(i.checkItem(e),i.getItemNode(e).classList.add("selected"))})),i.unblockEvent()}return $$(a)?($$(a).show(),h(this,e)):webix.ui({id:a,view:"popup",width:500,height:400,on:{onShow:()=>{1==d&&h(this,e),d=!1}},body:{id:r,view:"tree",css:"ab-data-tree",template:function(e,t){return"<label>"+t.checkbox(e,t)+"&nbsp;"+e.text+"</label>"},on:{onItemCheck:async function(t,s,n){const a=this.getItemNode(t),u=this;if(1==s?a.classList.add("selected"):a.classList.remove("selected"),this.getParentId(t)){u.blockEvent();let e=t;for(;this.getParentId(e);)e=this.getParentId(e),e!=t&&u.uncheckItem(e);this.data.eachSubItem(e,(function(e){e.id!=t&&u.uncheckItem(e.id)})),u.unblockEvent()}else u.blockEvent(),this.data.eachSubItem(t,(function(e){e.id!=t&&u.uncheckItem(e.id)})),u.unblockEvent();const d={};if(d[l.columnName]=$$(r).getChecked(),e.id){0==d[l.columnName].length&&(d[l.columnName]="");try{await l.object.model().update(e.id,d),o&&o.updateItem&&o.updateItem(e.id,d)}catch(t){i.classList.add("webix_invalid"),i.classList.add("webix_invalid_cell"),this.AB.notify.developer(t,{message:"ABFieldTree:onItemClick(): Error updating our entry.",row:e,values:d})}}else{const e={};e[l.columnName]=$$(r).getChecked(),l.setValue($$(c.ui.id),e)}}}}}).show(i,{x:-7}),!1}setBadge(e,t){const i=this;if((e=e.querySelector(".list-data-values")).scrollHeight-e.parentElement.clientHeight>5){let s=0;if(s=t[i.columnName]&&t[i.columnName].length?t[i.columnName].length:0,s>1){const t=e.querySelector(".webix_badge.selectivityBadge");if(null!=t)t.innerHTML=s;else{const t=document.createElement("A");t.href="javascript:void(0);",t.addEventListener("click",(function(e){e.stopPropagation()}));const i=document.createElement("SPAN"),n=document.createTextNode(s);i.classList.add("webix_badge","selectivityBadge"),i.appendChild(n),t.appendChild(i),e.appendChild(t)}}}}formComponent(){return super.formComponent("formtree")}detailComponent(){const e=super.detailComponent();return e.common=()=>({key:"detailtree"}),e}getValue(e,t){let i={};return i=e.getValues(),i}setValue(e,t){if(!e)return!1;const i=t[this.columnName]||[];e.setValues(i);const s=e.$view.querySelector(".list-data-values");if(!s)return!1;this.customDisplay(i,this.App,s,{editable:!0,isForm:!0}),setTimeout((function(){let t=33;s.scrollHeight>33&&(t=s.scrollHeight),e.config.height=t+5,e.resize()}),200)}}},78025:(e,t,i)=>{const s=i(63800),n=i(58706);e.exports=class extends n{constructor(e,t,i){super(e,t,i)}async save(){if(null==this.id){const e=this.AB.objectUser(),t=n.defaults();this.settings.linkObject=e.id,this.settings.isCustomFK=1,this.settings.isMultiple?(this.settings.indexField2=t.USERNAME_FIELD_ID,this.settings.linkType="many",this.settings.linkViaType="many",this.settings.isSource=1):(this.settings.indexField=t.USERNAME_FIELD_ID,this.settings.linkType="one",this.settings.linkViaType="many",this.settings.isSource=1);const i=e.fieldNew({key:s.defaults().key,columnName:`${this.object.name}_${this.label}`,label:this.object.label,settings:{showIcon:this.settings.showIcon,linkObject:this.object.id,linkType:this.settings.linkViaType,linkViaType:this.settings.linkType,isCustomFK:this.settings.isCustomFK,indexField:this.settings.indexField,indexField2:this.settings.indexField2,isSource:0}});let a=await this.toDefinition().save();this.id=a.id,i.settings.linkColumn=this.id;let r=await i.toDefinition().save();return i.id=r.id,this.settings.linkColumn=i.id,await this.toDefinition().save(),await this.object.fieldAdd(this),await e.fieldAdd(i),await this.migrateCreate(),await i.migrateCreate(),this}return super.save()}columnHeader(e){return e=this.setDisplayOptions(e),super.columnHeader(e)}setDisplayOptions(e){return(e=e||{}).editable=null==this.settings.editable||this.settings.editable,e.isLabelHidden=null!=this.settings.isShowUsername&&!this.settings.isShowUsername,e.additionalText=e=>this.settings.isShowProfileImage?e.image_id?`<img src='/file/${e.image_id}' style='border-radius:100%; object-fit: cover; margin: 0 5px 0 -10px;' width='28' height='28' />`:'<i style="opacity: 0.6;" class="fa fa-user"></i> ':"",e}defaultValue(e){this.settings.isCurrentUser&&(this.settings.isMultiple?e[this.columnName]=[{id:this.AB.Account.username(),text:this.AB.Account.username()}]:e[this.columnName]=this.AB.Account.username())}getValue(e){let t=super.getValue(e);return t&&("string"==typeof t?t=t.replace(/ab-current-user/g,this.AB.Account.username()):Array.isArray(t)&&(t=t.map((e=>(e?.username??e?.uuid??e?.id??e)?.replace(/ab-current-user/g,this.AB.Account.username()))))),t}setValue(e,t){let i=t[this.columnName];if(""===i)return delete t[this.columnName],void super.setValue(e,t);"many"==this.linkType()?(Array.isArray(i)||(i=[i]),i=i.map((e=>"ab-current-user"==e?this.AB.Account.username():e))):"ab-current-user"==i&&(i=this.AB.Account.username()),t[this.columnName]=i,super.setValue(e,t)}getUsers(){return this.AB.Account.userList().map((e=>{const t={id:e.username,image:e.image_id};return this.settings.isMultiple?t.text=e.username:t.value=e.username,t}))}getOptions(...e){return super.getOptions(...e).then((e=>((e||[]).forEach((e=>{e.username&&(e.id=e.username)})),e)))}pullRelationValues(e){let t=super.pullRelationValues(e);return Array.isArray(t)?t=t.map((e=>(e.id=e.username||e.id,e))):t.id=t.username||t.id,t}pullRecordRelationValues(e){let t=super.pullRecordRelationValues(e);return Array.isArray(t)?t=t.map((e=>(e.id=e.username??e.id,e))):t.id=t.username||t.id,t}}},18315:(e,t,i)=>{const s=i(73134);e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s),this.__Handler_ABDEF_UPDATED=e=>{e.id==this.id&&(this.emit("definition.updated",this),this.AB.off("ab.abdefinition.update",this.__Handler_ABDEF_UPDATED))},this.AB.on("ab.abdefinition.update",this.__Handler_ABDEF_UPDATED),this.__Handler_DEF_UPDATED=e=>{var t=this.AB.definitionByID(e.id);if(t){var i=this.pageNew(t),s=[];this.pages().forEach((t=>{t.id!==e.id?s.push(t):s.push(i)})),this._pages=s,e.off("definition.updated",this.__Handler_DEF_UPDATED)}},this.pages().forEach((e=>{e.on("definition.updated",this.__Handler_DEF_UPDATED)}))}refreshInstance(e){var t=this.AB.definitionByID(this.id);if(t){var i=(e??this.parent)?.pageNew(t);try{this.AB.off("ab.abdefinition.update",this.__Handler_ABDEF_UPDATED),this.pages().forEach((e=>{e.removeAllListeners("definition.updated")}))}catch(e){console.error(e)}return i}}warningsEval(){super.warningsEval(),0==this.views().length&&this.warningsMessage("has no widgets"),(this.pages()||[]).forEach((e=>{e.warningsEval()}))}}},94197:(e,t,i)=>{const s=i(86501);e.exports=class extends s{componentList(e){var t=["mobile-view","mobile-page"];return this.application.viewAll().filter((e=>-1==t.indexOf(e.common().key)))}warningsAll(){var e=super.warningsAll();return this.views().forEach((t=>{e=e.concat(t.warningsAll())})),(this.pages?.()||[]).forEach((t=>{e=e.concat(t.warningsAll())})),e.filter((e=>e))}warningsEval(){super.warningsEval();let e=this.views();(this.__missingViews||[]).forEach((e=>{this.warningsMessage(`references unknown View[${e}]`)})),e.forEach((e=>{e.warningsEval()})),this.settings.dataviewID&&(this.datacollections||this.datacollection||this.warningsMessage(`references unknown dataviewID[${this.settings.dataviewID}]`))}warningsMessage(e,t={}){let i=`${this.key}[${this.name}]: ${e}`;this._warnings.push({message:i,data:t})}}},55957:(e,t,i)=>{const s=i(11408),n=i(85507);e.exports=class extends s{refreshDefaultButton(e){let t=this.views((e=>e instanceof n&&e.settings.isDefault))[0];null==t?(t=n.newInstance(this.application,this),t.settings.isDefault=!0):this._views=this.views((e=>e.id!=t.id));let i=this.views().map((e=>(e.position.y||0)+1));i.push(this._views.length||0),i.push($$(e.fields).length||0);let s=Math.max(...i);return t.position.y=s,this._views.push(t),t}warningsEval(){super.warningsEval(),this.settings.dataviewID?this.datacollection||this.warningsMessage(`references an unknown DataCollection [${this.settings.dataviewID}].`):this.warningsMessage("does not have a DataCollection assigned.")}}},85507:(e,t,i)=>{const s=i(75864);e.exports=class extends s{}},82097:(e,t,i)=>{const s=i(95493);e.exports=class extends s{}},89274:(e,t,i)=>{const s=i(27140);e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s),this.__filterComponent=this.AB.filterComplexNew(`${this.id}__filterComponent`),this.__filterComponent.fieldsLoad(this.datasource?this.datasource.fields():[],this.datasource?this.datasource:null),this.__filterComponent.setValue(this.settings.filterConditions??ABViewFormConnectPropertyComponentDefaults.filterConditions)}fromValues(e){super.fromValues(e)}}},54111:(e,t,i)=>{const s=i(26720);e.exports=class extends s{}},32747:(e,t,i)=>{const s=i(382);e.exports=class extends s{}},24207:(e,t,i)=>{const s=i(26854);e.exports=class extends s{}},81854:(e,t,i)=>{const s=i(73630);e.exports=class extends s{}},57078:(e,t,i)=>{const s=i(96453);e.exports=class extends s{}},11228:(e,t,i)=>{const s=i(21754);e.exports=class extends s{}},79880:(e,t,i)=>{const s=i(33397);e.exports=class extends s{}},21579:(e,t,i)=>{const s=i(62591);e.exports=class extends s{}},80585:(e,t,i)=>{const s=i(65407);e.exports=class extends s{}},12767:(e,t,i)=>{const s=i(42847);e.exports=class extends s{}},32763:(e,t,i)=>{const s=i(98438);e.exports=class extends s{}},28131:(e,t,i)=>{const s=i(61882);e.exports=class extends s{}},78310:(e,t,i)=>{const s=i(27200);e.exports=class extends s{}},98534:(e,t,i)=>{const s=i(52999);e.exports=class extends s{warningsEval(){super.warningsEval(),this.text||this.warningsMessage("has no text value set.")}}},76944:(e,t,i)=>{const s=i(45334);e.exports=class extends s{warningsEval(){super.warningsEval(),["linkPageAdd","linkPageDetail"].forEach((e=>{this.settings[e]&&(this.application.pageByID(this.settings[e],!0)||this.warningsMessage(`${e} references an unknown Page.`))}))}}},94410:(e,t,i)=>{var s=i(71506);e.exports=class extends s{transferParticipantWhereToMe(e){var t=this.process.elementForDiagramID(e);t&&!this.stashed&&t.stashed&&["stashed","useRole","role","useAccount","account"].forEach((e=>{var i=this[e];this[e]=t[e],t[e]=i}))}fromElement(e){this.diagramID=e.id||this.diagramID,e.children&&e.children.length>0?e.parent&&"bpmn:Participant"==e.parent.type&&this.transferParticipantWhereToMe(e.parent.id):e.parent&&e.parent.children&&e.parent.children.length>0&&e.parent.children.forEach((t=>{if("bpmn:Lane"!=t.type&&t.businessObject.lanes&&t.businessObject.lanes.length>0&&t.businessObject.lanes.find((e=>e.id==this.diagramID))){this.transferParticipantWhereToMe(e.parent.id);var i=this.process.elementForDiagramID(t.id);i&&i.setLane(this)}})),this.onChange(e)}onChange(e){e.businessObject.name&&""!=e.businessObject.name&&(this.label=e.businessObject.name)}}},98618:(e,t,i)=>{var s=i(21500);e.exports=class extends s{fromElement(e){this.diagramID=e.id||this.diagramID,this.onChange(e)}onChange(e){if(e.businessObject.name&&""!=e.businessObject.name&&(this.label=e.businessObject.name),e.children){var t=[];e.children.forEach((e=>{"bpmn:Lane"==e.type&&t.push(e.id)})),this.laneIDs=t}}diagramProperties(){return[{id:this.diagramID,def:{name:this.name}}]}}},25330:(e,t,i)=>{const s=i(43409);e.exports=class extends s{destroy(){return super.destroy().then((()=>this.process.elementRemove(this)))}isValid(){return!0}findLane(e,t){e?e.lanes&&e.lanes.length>0?t(null,e.lanes[0]):"bpmn:Participant"==e.$type?t(null,e):(e=e.$parent,this.findLane(e,t)):t(null,null)}setLane(e){this.laneDiagramID=e.diagramID}fromElement(e){this.diagramID=e.id||this.diagramID,this.onChange(e)}onChange(e){e.businessObject.name&&""!=e.businessObject.name&&(this.label=e.businessObject.name);var t=e.businessObject;this.findLane(t,((t,i)=>{i?this.laneDiagramID=i.id:e.parent&&"bpmn:Participant"==e.parent.type?this.laneDiagramID=e.parent.id:this.laneDiagramID=null}))}diagramProperties(){const e=this.warnings();return[{id:this.diagramID,def:{name:this.name},warn:e.length?e:null}]}propertiesShow(e){var t={id:e,view:"label",label:"this task has not implement properties yet..."};webix.ui(t,$$(e)),$$(e).show()}propertiesStash(e){}property(e){if($$(e))return $$(e).getValue()}switchTo(e,t){this.process.elementRemove(this),this.process.elementAdd(e),e.propertiesShow(t),this.emit("switchTo",e)}warningsEval(){super.warningsEval(),this.onProcessReady(),this.isEndTask()||this.process.connectionsOutgoing(this.diagramID).length<1&&this.warningMessage("should have another task after this one")}warningMessage(e,t={}){let i=`${this.defaults.key}[${this.label?this.label:this.name}]: ${e}`;this._warnings.push({message:i,data:t})}}},39864:(e,t,i)=>{const s=i(69569);e.exports=class extends s{}},15372:(e,t,i)=>{const s=i(2406);e.exports=class extends s{diagramProperties(){var e=super.diagramProperties();return this.process.connectionsOutgoing(this.diagramID).forEach((t=>{e.push({id:t.id,def:{name:this.conditions[t.id]?.label??""}})})),e}warningsEval(){super.warningsEval();const e=this.process.connectionsOutgoing(this.diagramID);e.length<2&&this.warningMessage("should have multiple outgoing connections");let t=0;e.forEach((e=>{0==(this.conditions[e.id]?.filterValue.rules?.length??0)&&t++})),t>1&&this.warningMessage("should not have more than 1 unfiltered connection.")}}},93563:(e,t,i)=>{const s=i(85772);e.exports=class extends s{warningsEval(){super.warningsEval(),this.subject||this.warningMessage("is missing a subject"),this.message||this.warningMessage("is missing a message"),this.verifySetting("to"),this.verifySetting("from"),this.verifyNextLane("to"),"0"==this.from&&(this.myLane()||this.warningMessage("can not resolve the lane participant for [.from] field.")),this.verifyRoleAccount("to","toUsers"),this.verifyRoleAccount("from","fromUsers")}verifySetting(e){""==this[e]&&this.warningMessage(`does not have a [${e}] setting.`)}verifyNextLane(e){if("0"===this[e]){let t=this.process.connectionNextTask(this),i=!0;t.forEach((e=>{e.myLane()||(i=!1)})),i&&0!=t.length||this.warningMessage(`can not resolve next lane participant for [${e}] field.`)}}verifyRoleAccount(e,t){"1"==this[e]&&this[t]&&(this[t].useRole&&0==this[t].role.length&&this.warningMessage(`can not resolve [${e}] Role setting.`),this[t].useAccount&&0==this[t].account.length&&this.warningMessage(`can not resolve [${e}] Account setting.`))}}},2353:(e,t,i)=>{const s=i(95824);e.exports=class extends s{}},97915:(e,t,i)=>{const s=i(39163);let n=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{propertyIDs(e){return{name:`${e}_name`,processBatchValue:`${e}_processBatchValue`,objectBatch:`${e}_objectBatch`,fieldBatchEntries:`${e}_fieldBatchEntries`,fieldBatchFinancialPeriod:`${e}_fieldBatchFinancialPeriod`,objectJE:`${e}_objectJE`,fieldJEAccount:`${e}_fieldJEAccount`,fieldJERC:`${e}_fieldJERC`,fieldJEStatus:`${e}_fieldJEStatus`,fieldJEStatusComplete:`${e}_fieldJEStatusComplete`,objectBR:`${e}_objectBR`,fieldBRFinancialPeriod:`${e}_fieldBRFinancialPeriod`,fieldBRAccount:`${e}_fieldBRAccount`,fieldBRRC:`${e}_fieldBRRC`,fieldBREntries:`${e}_fieldBREntries`}}propertiesShow(e){var t=this.propertyIDs(e),i=[{id:0,value:n("Select a Process Value")}];(this.process.processDataFields(this)||[]).forEach((e=>{i.push({id:e.key,value:e.label})}));var s=this.AB.objects().map((e=>({id:e.id,value:e.label||e.name,object:e})));s.unshift({id:0,value:n("Select an Object")});var a={id:0,value:n("Select a Field")};function r(e){var t=[a];if(e){var i=s.find((t=>t.id==e));i&&i.object&&i.object.fields().forEach((e=>{t.push({id:e.id,value:e.label,field:e})}))}return t}function o(e,t,i){e.forEach((e=>{var i=$$(e);i&&(i.define("options",t),i.refresh(),i.show())}))}var l=r(this.objectBatch),c=[t.fieldBatchEntries,t.fieldBatchFinancialPeriod],u=r(this.objectJE),d=[t.fieldJEAccount,t.fieldJERC,t.fieldJEStatus];function h(e){var t=[{id:0,value:n("Select the Complete Value")}];return e&&e.options&&e.options().forEach((e=>{t.push({id:e.id,value:e.text})})),t}function p(e){var i,n,a=$$(t.objectJE).getValue(),r=s.find((e=>e.id==a));if(r&&r.object){var o=r.object.fieldByID(e);o&&o.options&&(i=f=h(o),(n=$$(t.fieldJEStatusComplete))&&(n.define("options",i),n.refresh(),n.show()))}}var f=h(),m=r(this.objectBR),g=[t.fieldBRFinancialPeriod,t.fieldBRAccount,t.fieldBRRC,t.fieldBREntries],b={id:e,view:"form",elements:[{id:t.name,view:"text",label:n("Name"),name:"name",value:this.name},{id:t.processBatchValue,view:"select",label:n("Process Batch Value"),value:this.processBatchValue,name:"processBatchValue",options:i},{id:t.objectBatch,view:"select",label:n("Batch Object"),value:this.objectBatch,name:"objectBatch",options:s,on:{onChange(e,t){e!=t&&(l=r(e),o(c,l))}}},{id:t.fieldBatchEntries,view:"select",label:n("Batch->JE[]"),value:this.fieldBatchEntries,name:"fieldBatchEntries",options:l,hidden:!0},{id:t.fieldBatchFinancialPeriod,view:"select",label:n("Batch->FinancialPeriod"),value:this.fieldBatchFinancialPeriod,name:"fieldBatchFinancialPeriod",options:l,hidden:!0},{id:t.objectJE,view:"select",label:n("Journal Entry Object"),value:this.objectJE,name:"objectJE",options:s,on:{onChange(e,t){e!=t&&(u=r(e),o(d,u))}}},{id:t.fieldJEAccount,view:"select",label:n("JE->Account"),value:this.fieldJEAccount,name:"fieldJEAccount",options:u,hidden:!0},{id:t.fieldJERC,view:"select",label:n("JE->RC"),value:this.fieldJERC,name:"fieldJERC",options:u,hidden:!0},{id:t.fieldJEStatus,view:"select",label:n("JE->Status"),value:this.fieldJEStatus,name:"fieldJEStatus",options:u,hidden:!0,on:{onChange(e,t){e!=t&&p(e)}}},{id:t.fieldJEStatusComplete,view:"select",label:n("JE->Status->Complete"),value:this.fieldJEStatusComplete,name:"fieldJEStatusComplete",options:f,hidden:!0},{id:t.objectBR,view:"select",label:n("Balance Record"),value:this.objectBR,name:"objectBR",options:s,on:{onChange(e,t){e!=t&&(m=r(e),o(g,m))}}},{id:t.fieldBRFinancialPeriod,view:"select",label:n("BR->FP"),value:this.fieldBRFinancialPeriod,name:"fieldBRFinancialPeriod",options:m,hidden:!0},{id:t.fieldBRAccount,view:"select",label:n("BR->Account"),value:this.fieldBRAccount,name:"fieldBRAccount",options:m,hidden:!0},{id:t.fieldBRRC,view:"select",label:n("BR->RC"),value:this.fieldBRRC,name:"fieldBRRC",options:m,hidden:!0},{id:t.fieldBREntries,view:"select",label:n("BR->Entries"),value:this.fieldBREntries,name:"fieldBREntries",options:m,hidden:!0}]};webix.ui(b,$$(e)),this.objectBatch&&0!=this.objectBatch&&o(c,l),this.objectJE&&0!=this.objectJE&&o(d,u),this.fieldJEStatus&&p(this.fieldJEStatus),this.objectBR&&0!=this.objectBR&&o(g,m),$$(e).show()}propertiesStash(e){var t=this.propertyIDs(e);this.name=this.property(t.name),this.defaults.settings.forEach((e=>{this[e]=this.property(t[e])}))}}},10727:(e,t,i)=>{const s=i(25144);let n=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{propertyIDs(e){return{name:`${e}_name`,processFPValue:`${e}_processFPValue`,objectFP:`${e}_objectFP`,objectGL:`${e}_objectGL`,objectAcc:`${e}_objectAcc`,fieldFPStart:`${e}_fieldFPStart`,fieldFPOpen:`${e}_fieldFPOpen`,fieldFPStatus:`${e}_fieldFPStatus`,fieldFPActive:`${e}_fieldFPActive`,fieldGLStarting:`${e}_fieldGLStarting`,fieldGLRunning:`${e}_fieldGLRunning`,fieldGLAccount:`${e}_fieldGLAccount`,fieldGLRc:`${e}_fieldGLRc`,fieldGLDebit:`${e}fieldGLDebit`,fieldGLCredit:`${e}_fieldGLCredit`,fieldAccType:`${e}_fieldAccType`,fieldAccAsset:`${e}_fieldAccAsset`,fieldAccExpense:`${e}_fieldAccExpense`,fieldAccLiabilities:`${e}_fieldAccLiabilities`,fieldAccEquity:`${e}_fieldAccEquity`,fieldAccIncome:`${e}_fieldAccIncome`}}propertiesShow(e){var t=this.propertyIDs(e),i=[{id:0,value:n("Select a Process Value")}];(this.process.processDataFields(this)||[]).forEach((e=>{i.push({id:e.key,value:e.label})}));var s=this.AB.objects().map((e=>({id:e.id,value:e.label||e.name,object:e})));s.unshift({id:0,value:n("Select an Object")});let a=e=>{let t=[{id:0,value:n("Select a Field")}];if(e){var i=s.find((t=>t.id==e));i&&i.object&&i.object.fields().forEach((e=>{t.push({id:e.id,value:e.label,field:e})}))}return t},r=e=>{let t=[],i=this.AB.objectByID(this.objectFP);if(!i)return t;let s=i.fieldByID(e);return s&&s.settings&&s.settings.options?(t=(s.settings.options||[]).map((e=>({id:e.id,value:e.text}))),t):t},o=(e,t)=>{let i=[],s=this.AB.objectByID(e);if(!s)return i;let n=s.fieldByID(t);return n&&n.settings&&n.settings.options?(i=(n.settings.options||[]).map((e=>({id:e.id,value:e.text}))),i):i},l=a(this.objectFP),c=a(this.objectGL),u=a(this.objectAcc),d=r(this.fieldFPStatus),h=o(this.objectAcc,this.fieldAccType);var p={id:e,view:"form",elementsConfig:{labelWidth:200},elements:[{id:t.name,view:"text",label:n("Name"),name:"name",value:this.name},{id:t.processFPValue,view:"select",label:n("Process Fiscal Period Value"),value:this.processFPValue,name:"processFPValue",options:i},{id:t.objectFP,view:"select",label:n("FP Object"),value:this.objectFP,name:"objectFP",options:s,on:{onChange(e,i){e!=i&&(l=a(e),(e=>{[t.fieldFPStart,t.fieldFPOpen,t.fieldFPStatus].forEach((t=>{$$(t).define("options",e),$$(t).refresh()}))})(l))}}},{id:t.objectGL,view:"select",label:n("GL Object"),value:this.objectGL,name:"objectGL",options:s,on:{onChange(e,i){e!=i&&(c=a(e),(e=>{[t.fieldGLRunning,t.fieldGLAccount,t.fieldGLRc,t.fieldGLDebit,t.fieldGLCredit].forEach((t=>{$$(t).define("options",e),$$(t).refresh()}))})(c))}}},{id:t.objectAcc,view:"select",label:n("Account Object"),value:this.objectAcc,name:"objectAcc",options:s,on:{onChange(e,i){e!=i&&(u=a(e),(e=>{$$(t.fieldAccType).define("options",e),$$(t.fieldAccType).refresh()})(u))}}},{id:t.fieldFPStart,view:"select",label:n("FP -> Start"),value:this.fieldFPStart,name:"fieldFPStart",options:l},{id:t.fieldFPOpen,view:"select",label:n("FP -> Open"),value:this.fieldFPOpen,name:"fieldFPOpen",options:l},{id:t.fieldFPStatus,view:"select",label:n("FP -> Status"),value:this.fieldFPStatus,name:"fieldFPStatus",options:l,on:{onChange(e,i){var s;e!=i&&(d=r(e),s=d,$$(t.fieldFPActive).define("options",s),$$(t.fieldFPActive).refresh())}}},{id:t.fieldFPActive,view:"select",label:n("FP -> Active"),value:this.fieldFPActive,name:"fieldFPActive",options:d},{id:t.fieldGLStarting,view:"select",label:n("GL -> Starting BL"),value:this.fieldGLStarting,name:"fieldGLStarting",options:c},{id:t.fieldGLRunning,view:"select",label:n("GL -> Running BL"),value:this.fieldGLRunning,name:"fieldGLRunning",options:c},{id:t.fieldGLAccount,view:"select",label:n("GL -> Account"),value:this.fieldGLAccount,name:"fieldGLAccount",options:c},{id:t.fieldGLRc,view:"select",label:n("GL -> RC"),value:this.fieldGLRc,name:"fieldGLRc",options:c},{id:t.fieldGLDebit,view:"select",label:n("GL -> Debit"),value:this.fieldGLDebit,name:"fieldGLDebit",options:c},{id:t.fieldGLCredit,view:"select",label:n("GL -> Credit"),value:this.fieldGLCredit,name:"fieldGLCredit",options:c},{id:t.fieldAccType,view:"select",label:n("Acc -> Type"),value:this.fieldAccType,name:"fieldAccType",options:u,on:{onChange:(e,i)=>{e!=i&&(h=o(this.objectAcc||$$(t.objectAcc).getValue(),e),(e=>{[t.fieldAccAsset,t.fieldAccExpense,t.fieldAccLiabilities,t.fieldAccEquity,t.fieldAccIncome].forEach((t=>{$$(t).define("options",e),$$(t).refresh()}))})(h))}}},{id:t.fieldAccAsset,view:"select",label:n("Acc -> Asset"),value:this.fieldAccAsset,name:"fieldAccAsset",options:h},{id:t.fieldAccExpense,view:"select",label:n("Acc -> Expense"),value:this.fieldAccExpense,name:"fieldAccExpense",options:h},{id:t.fieldAccLiabilities,view:"select",label:n("Acc -> Liabilities"),value:this.fieldAccLiabilities,name:"fieldAccLiabilities",options:h},{id:t.fieldAccEquity,view:"select",label:n("Acc -> Equity"),value:this.fieldAccEquity,name:"fieldAccEquity",options:h},{id:t.fieldAccIncome,view:"select",label:n("Acc -> Income"),value:this.fieldAccIncome,name:"fieldAccIncome",options:h}]};webix.ui(p,$$(e)),$$(e).show()}propertiesStash(e){var t=this.propertyIDs(e);this.name=this.property(t.name),this.defaults.settings.forEach((e=>{this[e]=this.property(t[e])}))}}},3746:(e,t,i)=>{const s=i(93071);let n=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{propertyIDs(e){return{name:`${e}_name`,processFPYearValue:`${e}_processFPYearValue`,objectFPYear:`${e}_objectFPYear`,objectFPMonth:`${e}_objectFPMonth`,objectGL:`${e}_objectGL`,objectAccount:`${e}_objectAccount`,valueFundBalances:`${e}_valueFundBalances`,valueNetIncome:`${e}_valueNetIncome`,fieldFPYearStart:`${e}_fieldFPYearStart`,fieldFPYearEnd:`${e}_fieldFPYearEnd`,fieldFPYearStatus:`${e}_fieldFPYearStatus`,fieldFPYearActive:`${e}_fieldFPYearActive`,fieldFPMonthStart:`${e}_fieldFPMonthStart`,fieldFPMonthEnd:`${e}_fieldFPMonthEnd`,fieldGLStartBalance:`${e}_fieldGLStartBalance`,fieldGLRunningBalance:`${e}_fieldGLRunningBalance`,fieldGLrc:`${e}_fieldGLrc`,fieldAccNumber:`${e}_fieldAccNumber`,fieldAccType:`${e}_fieldAccType`,fieldAccTypeIncome:`${e}_fieldAccTypeIncome`,fieldAccTypeExpense:`${e}_fieldAccTypeExpense`,fieldAccTypeEquity:`${e}_fieldAccTypeEquity`}}propertiesShow(e){var t=this.propertyIDs(e),i=[{id:0,value:n("Select a Process Value")}];(this.process.processDataFields(this)||[]).forEach((e=>{i.push({id:e.key,value:e.label})}));var s=this.AB.objects().map((e=>({id:e.id,value:e.label||e.name,object:e})));s.unshift({id:0,value:n("Select an Object")});let a=(e,t)=>{let i=[{id:0,value:n("Select a Field")}];if(e){var a=s.find((t=>t.id==e));a&&a.object&&a.object.fields((e=>e.key==t)).forEach((e=>{i.push({id:e.id,value:e.label,field:e})}))}return i},r=(e,t)=>{let i=[],s=this.AB.objectByID(e);if(!s)return i;let n=s.fieldByID(t);return n&&n.settings&&n.settings.options?(i=(n.settings.options||[]).map((e=>({id:e.id,value:e.text}))),i):i},o=a(this.objectFPYear,"date"),l=a(this.objectFPYear,"list"),c=r(this.objectFPYear,this.fieldFPYearStatus),u=a(this.objectFPMonth,"date"),d=a(this.objectGL,"number"),h=a(this.objectGL,"connectObject"),p=a(this.objectAccount,"number"),f=a(this.objectAccount,"list"),m=r(this.objectAccount,this.fieldAccType);var g={id:e,view:"form",elementsConfig:{labelWidth:200},elements:[{id:t.name,view:"text",label:n("Name"),name:"name",value:this.name},{id:t.processFPYearValue,view:"select",label:n("Process Fiscal Period Year Value"),value:this.processFPYearValue,name:"processFPYearValue",options:i},{id:t.objectFPYear,view:"select",label:n("FP Year Object"),value:this.objectFPYear,name:"objectFPYear",options:s,on:{onChange:(e,i)=>{var s;e!=i&&(o=a(e,"date"),s=o,[t.fieldFPYearStart,t.fieldFPYearEnd].forEach((e=>{$$(e).define("options",s),$$(e).refresh()})),f=a(e,"list"),(e=>{$$(t.fieldFPYearStatus).define("options",e),$$(t.fieldFPYearStatus).refresh()})(f))}}},{id:t.objectFPMonth,view:"select",label:n("FP Month Object"),value:this.objectFPMonth,name:"objectFPMonth",options:s,on:{onChange:(e,i)=>{var s;e!=i&&(u=a(e,"date"),s=u,[t.fieldFPMonthStart,t.fieldFPMonthEnd].forEach((e=>{$$(e).define("options",s),$$(e).refresh()})))}}},{id:t.objectGL,view:"select",label:n("Balance Object"),value:this.objectGL,name:"objectGL",options:s,on:{onChange:(e,i)=>{var s,n;e!=i&&(d=a(e,"number"),n=d,[t.fieldGLStartBalance,t.fieldGLRunningBalance].forEach((e=>{$$(e).define("options",n),$$(e).refresh()})),h=a(e,"connectObject"),s=h,$$(t.fieldGLrc).define("options",s),$$(t.fieldGLrc).refresh())}}},{id:t.objectAccount,view:"select",label:n("Account Object"),value:this.objectAccount,name:"objectAccount",options:s,on:{onChange:(e,i)=>{var s;e!=i&&(f=a(e,"list"),s=f,$$(t.fieldAccType).define("options",s),$$(t.fieldAccType).refresh(),p=a(e,"number"),(e=>{$$(t.fieldAccNumber).define("options",e),$$(t.fieldAccNumber).refresh()})(p))}}},{id:t.valueFundBalances,view:"text",label:n("Fund Balances Code"),value:this.valueFundBalances,name:"valueFundBalances"},{id:t.valueNetIncome,view:"text",label:n("Net Income Code"),value:this.valueNetIncome,name:"valueNetIncome"},{id:t.fieldFPYearStart,view:"select",label:n("FP Year -> Start"),value:this.fieldFPYearStart,name:"fieldFPYearStart",options:o},{id:t.fieldFPYearEnd,view:"select",label:n("FP Year -> End"),value:this.fieldFPYearEnd,name:"fieldFPYearEnd",options:o},{id:t.fieldFPYearStatus,view:"select",label:n("FP Year -> Status"),value:this.fieldFPYearStatus,name:"fieldFPYearStatus",options:l,on:{onChange:(e,i)=>{e!=i&&(c=r(this.objectFPYear||$$(t.objectFPYear).getValue(),e),(e=>{$$(t.fieldFPYearActive).define("options",e),$$(t.fieldFPYearActive).refresh()})(c))}}},{id:t.fieldFPYearActive,view:"select",label:n("FP Year -> Active"),value:this.fieldFPYearActive,name:"fieldFPYearActive",options:c},{id:t.fieldFPMonthStart,view:"select",label:n("FP Month -> Start"),value:this.fieldFPMonthStart,name:"fieldFPMonthStart",options:u},{id:t.fieldFPMonthEnd,view:"select",label:n("FP Month -> End"),value:this.fieldFPMonthEnd,name:"fieldFPMonthEnd",options:u},{id:t.fieldGLStartBalance,view:"select",label:n("GL -> Start Balance"),value:this.fieldGLStartBalance,name:"fieldGLStartBalance",options:d},{id:t.fieldGLRunningBalance,view:"select",label:n("GL -> Running Balance"),value:this.fieldGLRunningBalance,name:"fieldGLRunningBalance",options:d},{id:t.fieldGLrc,view:"select",label:n("GL -> RC"),value:this.fieldGLrc,name:"fieldGLrc",options:h},{id:t.fieldAccNumber,view:"select",label:n("Acc -> Account Number"),value:this.fieldAccNumber,name:"fieldAccNumber",options:p},{id:t.fieldAccType,view:"select",label:n("Acc -> Type"),value:this.fieldAccType,name:"fieldAccType",options:f,on:{onChange:(e,i)=>{e!=i&&(m=r(this.objectAccount||$$(t.objectAccount).getValue(),e),(e=>{[t.fieldAccTypeIncome,t.fieldAccTypeExpense,t.fieldAccTypeEquity].forEach((t=>{$$(t).define("options",e),$$(t).refresh()}))})(m))}}},{id:t.fieldAccTypeIncome,view:"select",label:n("Acc -> Income"),value:this.fieldAccTypeIncome,name:"fieldAccTypeIncome",options:m},{id:t.fieldAccTypeExpense,view:"select",label:n("Acc -> Expense"),value:this.fieldAccTypeExpense,name:"fieldAccTypeExpense",options:m},{id:t.fieldAccTypeEquity,view:"select",label:n("Acc -> Equity"),value:this.fieldAccTypeEquity,name:"fieldAccTypeEquity",options:m}]};webix.ui(g,$$(e)),$$(e).show()}propertiesStash(e){var t=this.propertyIDs(e);this.name=this.property(t.name),this.defaults.settings.forEach((e=>{this[e]=this.property(t[e])}))}}},69305:(e,t,i)=>{const s=i(308);let n=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{propertyIDs(e){return{name:`${e}_name`,processBatchValue:`${e}_processBatchValue`,objectBatch:`${e}_objectBatch`,objectBalance:`${e}_objectBalance`,objectJE:`${e}_objectJE`,objectJEArchive:`${e}_objectJEArchive`,fieldBatchFiscalMonth:`${e}_fieldBatchFiscalMonth`,fieldJeAccount:`${e}_fieldJeAccount`,fieldJeRC:`${e}_fieldJeRC`,fieldJeArchiveBalance:`${e}_fieldJeArchiveBalance`,fieldBrFiscalMonth:`${e}_fieldBrFiscalMonth`,fieldBrAccount:`${e}_fieldBrAccount`,fieldBrRC:`${e}_fieldBrRC`,fieldsMatch:`${e}_fieldsMatch`}}propertiesShow(e){let t=this.propertyIDs(e),i=[{id:0,value:n("Select a Process Value")}];(this.process.processDataFields(this)||[]).forEach((e=>{i.push({id:e.key,value:e.label})}));let s=this.AB.objects().map((e=>({id:e.id,value:e.label||e.name,object:e})));s.unshift({id:0,value:n("Select an Object")});let a=e=>{let t=this.AB.objectByID(e);if(!t)return[];let i=t.fields((e=>e.isConnection)).map((e=>({id:e.id,value:e.label})));return i.unshift({id:0,value:n("Select a Field")}),i},r=(e,t)=>{e.forEach((e=>{var i=$$(e);i&&(i.define("options",t),i.refresh(),i.show())}))},o=()=>{let e=$$(t.fieldsMatch);if(!e)return;webix.ui([],e);let i=this.AB.objectByID(this.objectJE);if(!i)return;let s=this.AB.objectByID(this.objectJEArchive);s&&(s.fields().forEach((t=>{let s=[];s=t.isConnection?i.fields((e=>e.isConnection&&e.settings&&t.settings&&e.settings.linkObject==t.settings.linkObject&&e.settings.linkType==t.settings.linkType&&e.settings.linkViaType==t.settings.linkViaType&&e.settings.isCustomFK==t.settings.isCustomFK)):i.fields((e=>e.key==t.key)),s=s.map((e=>({id:e.id,value:e.label}))),e.addView({view:"select",name:t.id,label:t.label,options:s})})),e.setValues(this.fieldsMatch||{}))},l=a(this.objectBatch),c=a(this.objectBalance),u=a(this.objectJE),d=a(this.objectJEArchive),h={id:e,view:"form",elementsConfig:{labelWidth:180},elements:[{id:t.name,view:"text",label:n("Name"),name:"name",value:this.name},{id:t.processBatchValue,view:"select",label:n("Process Batch Value"),value:this.processBatchValue,name:"processBatchValue",options:i},{id:t.objectBatch,view:"select",label:n("Batch Object"),value:this.objectBatch,name:"objectBatch",options:s,on:{onChange:e=>{this.objectBatch=e,(e=>{let i=a(e);r([t.fieldBatchFiscalMonth],i)})(e)}}},{id:t.fieldBatchFiscalMonth,view:"select",label:n("Batch -> Fiscal Month"),value:this.fieldBatchFiscalMonth,name:"fieldBatchFiscalMonth",options:l},{id:t.objectBalance,view:"select",label:n("BR Object"),value:this.objectBalance,name:"objectBalance",options:s,on:{onChange:e=>{this.objectBalance=e,(e=>{let i=a(e);r([t.fieldBrAccount,t.fieldBrFiscalMonth,t.fieldBrRC],i)})(e)}}},{id:t.fieldBrFiscalMonth,view:"select",label:n("BR -> Fiscal Month"),value:this.fieldBrFiscalMonth,name:"fieldBrFiscalMonth",options:c},{id:t.fieldBrAccount,view:"select",label:n("BR -> Account"),value:this.fieldBrAccount,name:"fieldBrAccount",options:c},{id:t.fieldBrRC,view:"select",label:n("BR -> RC"),value:this.fieldBrRC,name:"fieldBrRC",options:c},{id:t.objectJE,view:"select",label:n("JE Object"),value:this.objectJE,name:"objectJE",options:s,on:{onChange:e=>{this.objectJE=e,(e=>{let i=a(e);r([t.fieldJeAccount,t.fieldJeRC],i)})(e),o()}}},{id:t.fieldJeAccount,view:"select",label:n("JE -> Account"),value:this.fieldJeAccount,name:"fieldJeAccount",options:u},{id:t.fieldJeRC,view:"select",label:n("JE -> RC"),value:this.fieldJeRC,name:"fieldJeRC",options:u},{id:t.objectJEArchive,view:"select",label:n("JE Archive Object"),value:this.objectJEArchive,name:"objectJEArchive",options:s,on:{onChange:e=>{this.objectJEArchive=e,(e=>{let i=a(e);r([t.fieldJeArchiveBalance],i)})(e),o()}}},{id:t.fieldJeArchiveBalance,view:"select",label:n("JE Archive -> BR"),value:this.fieldJeArchiveBalance,name:"fieldJeArchiveBalance",options:d},{view:"fieldset",label:"Fields Matching",body:{id:t.fieldsMatch,view:"form",borderless:!0,elements:[]}}]};webix.ui(h,$$(e)),$$(e).show(),o()}propertiesStash(e){let t=this.propertyIDs(e);this.name=this.property(t.name),this.defaults.settings.forEach((e=>{this[e]="fieldsMatch"===e?$$(t.fieldsMatch).getValues():this.property(t[e])}))}}},21374:(e,t,i)=>{const s=i(4070);e.exports=class extends s{warningsEval(){if(super.warningsEval(),this.formulaText||this.warningMessage("is missing a formula."),this.formulaText){const e={};(this.process.processDataFields(this)||[]).forEach((t=>{e[`{${t.label}}`]=t}));let t=new RegExp("{[^}]*}","g");(this.formulaText.match(t)||[]).forEach((t=>{e[t]||this.warningMessage(`could not resolve process value [${t}]`)}))}}}},78320:(e,t,i)=>{const s=i(13925);e.exports=class extends s{warningsEval(){super.warningsEval(),this.email||this.warningMessage("is missing the email address."),0==(this.process.processDataFields(this)??[]).filter((e=>"email"==e.field?.key)).map((e=>({id:e.key,value:e.label}))).length&&this.warningMessage("has no previous tasks exporting email fields.")}}},94417:(e,t,i)=>{const s=i(7739);e.exports=class extends s{warningsEval(){super.warningsEval(),this.objectID||this.warningMessage("has no Object set.");const e=Object.keys(this.fieldValues||{})||[];if(0==e.length)this.warningMessage("has no fields set");else{let t=!1;e.forEach((e=>{"0"!=this.fieldValues[e]?.set&&null!=this.fieldValues[e]?.value&&(t=!0)})),t||this.warningMessage("has no fields set")}}}},17378:(e,t,i)=>{const s=i(84224),n=i(25433);e.exports=class extends s{constructor(e,t,i){super(e,t,i),this.attributes=e}ABQLManager(){return n}warnings(){let e=[];return this.qlObj&&(e=e.concat(this.qlObj.warnings())),e.forEach((e=>{e?.message&&this.warningMessage(e.message)})),super.warnings().filter((e=>e))}warningsEval(){super.warningsEval(),this.qlObj?this.qlObj.warningsEval():this.warningMessage("has no Query defined."),this.name||this.warningMessage("does not have a name.",{attributes:this.attributes});let e=!1,t=this.qlObj;for(;t;)"row_save"===t.key||"set_save"===t.key?(e=!0,t=null):t=t.next;e||this.warningMessage("requires at least one Save operation.")}}},39966:(e,t,i)=>{const s=i(12307);e.exports=class extends s{diagramProperties(e){let t=super.diagramProperties();return t=t||[{}],t[0].def=t[0].def||{},null!=this.parameterId&&(t[0].def=t[0].def||{},t[0].def.loopCharacteristics=e.get("moddle").create("bpmn:MultiInstanceLoopCharacteristics"),t[0].def.loopCharacteristics.isSequential=!0),t}onChange(e){let t=e.loopCharacteristics||e.businessObject.loopCharacteristics||{};switch(t.$type){case"bpmn:MultiInstanceLoopCharacteristics":this.loopType=t.isSequential?"sequential":"parallel";break;case"bpmn:StandardLoopCharacteristics":this.loopType="looping"}}destroy(){return this.process.destroy.call(this)}save(){return this.process.save.call(this)}elementNewForModelDefinition(e){let t=this.AB.processElementNewForModelDefinition(e,this);return t&&this.elementAdd(t),t}warningsEval(){super.warningsEval(),(this._unknownElementIDs||[]).forEach((e=>{this.warningMessage(`is referencing an unknown process element id[${e}]`,{process:this.id,eID:e})}))}}},46146:(e,t,i)=>{const s=i(50271);e.exports=class extends s{}},31063:(e,t,i)=>{const s=i(92940);e.exports=class extends s{}},60986:(e,t,i)=>{const s=i(10153);e.exports=class extends s{}},19010:(e,t,i)=>{const s=i(44310);e.exports=class extends s{}},16642:(e,t,i)=>{const s=i(86555);e.exports=class extends s{}},39009:(e,t,i)=>{const s=i(47843);e.exports=class extends s{save(){return Promise.resolve().then((()=>super.save())).then((e=>this.AB.Network.put({url:(this.isEnabled?"/process/timer/#id#/start":"/process/timer/#id#/stop").replace("#id#",this.id)})))}}},15544:(e,t,i)=>{const s=i(61614),n=i(9234).Z,a=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{constructor(e,t,i,s,n){super(e,t,i,s,n),this.on("warning",((e,t)=>{this._warnings.push({message:e,data:t})}))}parseRow(e,t){this.parameterDefinitions.forEach((e=>{const i=this.uiID(t);this.ids=this.toIDs(i),this.params=this.params??{};let s=null;switch(e.type){case"objectFields":this.params[e.name]=$$(this.ids.objectfields).getValue();break;case"objectName":this.params[e.name]=$$(this.ids.objectname).getValue();break;case"objectConditions":case"objectValues":if(s=$$(this.ids.condition),s){const t=s.getValue();t&&""!==t&&(this.params[e.name]=JSON.parse(t))}break;case"taskParam":this.params[e.name]=$$(this.ids.taskparam).getValue()}}))}toIDs(e){return{condition:`${e}_condition`,objectfields:`${e}_objectfields`,objectname:`${e}_objname`,popup:`${e}_popup`,select:`${e}_select`,shorthand:`${e}_shorthand`,taskparam:`${e}_taskparam`,spacer:`${e}_spacer`}}uiAddParamForDef(e,t,i){if(!i.cols){if(!i.rows)throw new Error("provided ui is not able to add a parameter!");for(let s=0;s<i.rows.length;s++)if(i.rows[s].cols){this.uiAddParamForDef(e,t,i.rows[s]);break}return}const s=this.uiParamUI(e,t);s&&(1===this.parameterDefinitions.length?(i.cols.pop(),i.cols.push(s)):i.cols.length<3?i.cols.push({rows:[s]}):i.cols[2].rows.push(s))}uiAddNext(e,t){const i=this.uiNextRow(e);this.next?(this.next.uiAddParams(e,i),t.rows.push(i),this.next.uiAddNext(e,t)):t.rows.push(i)}uiAddParams(e,t){this.parameterDefinitions.forEach((i=>{this.uiAddParamForDef(i,e,t)}))}uiID(e){return this.prevOP?`${this.prevOP.uiID(e)}_${this.constructor.key}`:`${e}_${this.constructor.key}`}uiNextRow(e){const t=this.constructor.NextQLOps.map((e=>({id:e.key,value:e.label})));t.unshift({id:0,value:a("choose next operation")});const i=this.uiID(e),s=this.toIDs(i);return{cols:[{id:s.select,view:"select",value:this.next?this.next.constructor.key:0,options:t,on:{onChange:(t,i)=>{const n=()=>{const e=$$(s.select);e.blockEvent(),e.setValue(i),e.unblockEvent()};if(t===i)return;const r=this.constructor.NextQLOps.find((e=>e.key===t));if(!r)return void n();const o=$$(s.select).getParentView(),l=o.getParentView(),c=()=>{if(r){const t=new r({},this,this.task,this.AB);this.next=t,t.viewAddParams(e,o),t.viewAddNext(e,l)}},u=l.getChildViews();u.length-1>u.indexOf(o)?webix.confirm({title:a("continue?"),text:a("changing this rule will reset any following rules."),ok:a("Yes"),cancel:a("No"),callback:e=>{if(e){let e=u.length-1;for(;u[e].config.id!==o.config.id;)l.removeView(u[e]),e--;const t=o.getChildViews();let i=t.length;for(;i>1;)o.removeView(t[i-1]),i--;c()}else n()}}):c()}}},{id:s.spacer}]}}uiNextRowSelectorRefresh(e){const t=$$(this.ids.select);if(!t)return;const i=this.uiNextRow(e),s=i.cols.filter((e=>e.id==t.config.id))[0]??i.cols[1];s&&AB.Webix.ui(s,t)}uiParamUI(e,t){const i=AB.Config.uiSettings();let s=this.uiID(t);this.ids=this.toIDs(s);let r=null,o=null,l=null,c=null,u=null,d=null,h=null,p=null,f=null;switch(e.type){case"objectFields":this.object&&(o=this.object.fields().map((e=>({id:e.id,value:e.label,icon:`fa fa-${e.icon}`})))),o.unshift({id:"_PK",value:"[PK]"}),!this.fieldID&&o.length>0&&(this.params[e.name]=o[0].id,this.paramChanged(e,t)),r={id:this.ids.objectfields,view:"richselect",label:a("Field"),labelWidth:70,value:this.fieldID,options:o,on:{onChange:(i,s)=>{i!==this.params[e.name]&&(this.params[e.name]=i,this.paramChanged(e,t))}}};break;case"objectName":o=this.AB.objects().map((e=>({id:e.id,value:e.label}))),!this.objectID&&o.length>0&&(this.objectID=o[0].id,this.params[e.name]=this.objectID,this.paramChanged(e)),r={id:this.ids.objectname,view:"select",label:a("Data Source"),labelWidth:i.labelWidthLarge,value:this.objectID,options:o,on:{onChange:t=>{this.params=this.params??{},t!==this.params[e.name]&&(this.params[e.name]=t,this.paramChanged(e))}}};break;case"objectConditions":if(l=this.AB.filterComplexNew(t),c=this.availableProcessDataFieldsHash(),this.object){l.fieldsLoad(this.object.fields(),this.object);const e=Object.keys(c).map((e=>c[e]));l.processFieldsLoad(e)}l.on("save",(t=>{this.params=this.params??{},this.params[e.name]=t;const i=$$(this.ids.shorthand);i.define({label:l.toShortHand()}),i.refresh();const s=$$(this.ids.condition);s.define({value:JSON.stringify(this.params[e.name])}),s.refresh()})),u="",this.params&&this.params[e.name]?(l.setValue(this.params[e.name]),u=JSON.stringify(this.params[e.name])):l.setValue(null),d=l.toShortHand(),r={rows:[{id:this.ids.shorthand,view:"button",label:d,on:{onItemClick:()=>{l.popUp($$(this.ids.shorthand),null,{pos:"center"})}}},{id:this.ids.condition,view:"text",value:u,hidden:!0}]};break;case"objectValues":h="",p=new n(s,this.AB),this.object&&p.objectLoad(this.object),p.setExtendedOptions((this.task.process.processDataFields(this.task)??[]).map((e=>({id:e.key,value:e.label})))),this.params&&this.params[e.name]&&(p.setValue(this.params[e.name]),h=JSON.stringify(this.params[e.name])),f=()=>{const t={id:this.ids.popup,view:"popup",position:"center",minWidth:700,modal:!0,resize:!0,body:{rows:[{height:30,borderless:!0,cols:[{fillspace:!0},{view:"button",value:"X",width:30,click:()=>{$$(this.ids.popup).hide()}}]},p.ui(),{view:"button",value:a("Save"),css:"webix_primary",click:()=>{this.params=this.params??{},this.params[e.name]=p.getValue();const t=$$(this.ids.shorthand);t.define({badge:this.params[e.name].length}),t.refresh();const i=$$(this.ids.condition);i.define({value:JSON.stringify(this.params[e.name])}),i.refresh(),$$(this.ids.popup).hide()}}]}};this._myPopup=webix.ui(t),this._myPopup.show(),this.params&&this.params[e.name]&&p.setValue(this.params[e.name])},r={rows:[{id:this.ids.shorthand,view:"button",label:a("Update Popout"),badge:this.params[e.name]?.length,on:{onItemClick:()=>{f()}}},{id:this.ids.condition,view:"text",value:h,hidden:!0}]};break;case"taskParam":r={id:this.ids.taskparam,view:"text",label:a("Variable"),labelWidth:70,value:this.params[e.name],placeholder:a("Enter parameter name"),on:{onChange:(i,s)=>{i!==this.params[e.name]&&(this.params[e.name]=i,this.paramChanged(e,t))}}}}return r}viewAddNext(e,t){const i=this.uiNextRow(e);t.addView(i)}viewAddParams(e,t){const i=[];this.parameterDefinitions.forEach((t=>{i.push(this.uiParamUI(t,e))}));let s=null;s=i.length>1?{rows:i}:i.pop(),s&&(t.removeView(t.getChildViews()[1]),t.addView(s))}warnings(){let e=this._warnings||[];return this.next&&(e=e.concat(this.next.warnings()).filter((e=>e))),this.AB.uniq(e)}warningsEval(){this._warnings=[],this.next&&this.next.warningsEval()}warningMessage(e){this._warnings=this._warnings||[],this._warnings.push({message:`${this.key}: ${e}`})}}},88484:(e,t,i)=>{const s=i(64732);e.exports=class extends s{}},25433:(e,t,i)=>{const s=i(45430),n=i(39700),a={fromAttributes:s.fromAttributes,ids:e=>({root:`${e}_root`,select:`${e}_root_select`,options:`${e}_root_options`}),builder:(e,t,i)=>({ui:s=>{e=e??new n({},t,i);const r={rows:[{id:a.ids(s).root,cols:[]}]};return e.uiAddParams(s,r),e.uiAddNext(s,r),r},init:e=>{}}),parse:(e,t,i)=>{const r=a.ids(e),o=$$(r.root);if(!o)return void console.warn("ABQLManager.parse(): unable to find root element");const l=o.getParentView().getChildViews(),c=(s,a,r)=>{if(0===s.length)return null;const o=s.shift(),l=o.getChildViews();let u=l.shift();for(;!u?.getValue;)u=l.shift();const d=u.getValue(),h=a.find((e=>e.key===d||e.key===n.key));if(h){let n=null;n=r?new h({},r,t,i):new h({},t,i),n.parseRow(o,e),!n.object&&r&&(n.object=r.object,n.objectID=n.object?.id??null);const a=c(s,n.constructor.NextQLOps,n);return n.next=a,n}return null};return c(l,s.QLOps,null)}};e.exports=a},39700:(e,t,i)=>{const s=i(45655);e.exports=class extends s{paramChanged(e){"name"===e.name&&(this.objectID=this.params[e.name],this.object=this.objectLookup(this.objectID),this.next&&(this.next.object=this.object))}parseRow(e,t){super.parseRow(e,t),this.params.name&&(this.objectID=this.params.name,this.object=this.objectLookup(this.params.name))}warningsEval(){super.warningsEval(),this.object||this.warningMessage("has no object set.",{objectID:this.objectID})}}},93725:(e,t,i)=>{const s=i(38109);e.exports=class extends s{paramChanged(e,t){super.paramChanged(e),"fieldID"===e.name&&this.uiNextRowSelectorRefresh(t)}}},63622:(e,t,i)=>{const s=i(39580);e.exports=class extends s{paramChanged(e,t){super.paramChanged(e)}}},19602:(e,t,i)=>{const s=i(47947);e.exports=class extends s{}},21790:(e,t,i)=>{const s=i(1947);e.exports=class extends s{}},6517:(e,t,i)=>{const s=i(93740);e.exports=class extends s{paramChanged(e){"fieldID"===e.name&&(this.fieldID=this.params[e.name],this.field=this.object.fieldByID(this.fieldID),this.field&&"connectObject"===this.field.key&&(this.objectOut=this.field.datasourceLink,this.objectOutID=this.objectOut.id,this.next&&(this.next.object=this.objectOut)))}parseRow(e,t){super.parseRow(e,t),this.fieldID=this.params.fieldID,this.AB.objects((e=>{if(!this.field){const t=e.fieldByID(this.fieldID);t&&(this.field=t)}})),this.field&&(this.object=this.field.object,this.field&&"connectObject"===this.field.key&&(this.objectOut=this.field.datasourceLink,this.objectOutID=this.objectOut.id))}}},23698:(e,t,i)=>{const s=i(86918);e.exports=class extends s{paramChanged(e){"task_param"===e.name&&(this.taskParam=this.params[e.name])}parseRow(e,t){super.parseRow(e,t),this.taskParam=this.params.task_param,this.registered||(this.task.registerDatasource(this),this.registered=!0)}warningsEval(){super.warningsEval(),this.taskParam&&""!==this.taskParam||this.warningMessage("requires a name to save our data as.")}}},94784:(e,t,i)=>{const s=i(2063),n=i(44363).Z;e.exports=class extends s{component(){return new n(this)}componentList(e){var t=["view","page","formpanel","viewcontainer","detailcheckbox","detailcustom","detailconnect","detailimage","detailselectivity","detailtext","detailtree","button","checkbox","connect","datepicker","fieldcustom","textbox","numberbox","selectsingle","selectmultiple","formtree","fieldreadonly","pie","bar","line","area","report","reportPage","reportPanel"];return this.application.viewAll().filter((e=>-1==t.indexOf(e.common().key)))}changePage(e){this.emit("changePage",e)}warningsAll(){var e=super.warningsAll();return this.views().forEach((t=>{e=e.concat(t.warningsAll())})),(this.pages?.()||[]).forEach((t=>{e=e.concat(t.warningsAll())})),e.filter((e=>e))}warningsEval(){super.warningsEval();let e=this.views();(this.__missingViews||[]).forEach((e=>{this.warningsMessage(`references unknown View[${e}]`)})),e.forEach((e=>{e.warningsEval()})),this.settings.dataviewID&&(this.datacollections||this.datacollection||this.warningsMessage(`references unknown dataviewID[${this.settings.dataviewID}]`))}warningsMessage(e,t={}){let i=`${this.key}[${this.name}]: ${e}`;this._warnings.push({message:i,data:t})}}},11200:(e,t,i)=>{const s=i(88076),n=i(26822);e.exports=class extends s{component(){return new n(this)}warningsEval(){super.warningsEval(),this.datacollection||this.warningsMessage(`can't resolve it's datacollection[${this.settings.dataviewID}]`)}}},74841:(e,t,i)=>{const s=i(22152),n=i(67090);e.exports=class extends s{component(e){return new n(this,e)}warningsEval(){super.warningsEval(),this.datacollection||this.warningsMessage(`can't resolve it's datacollection[${this.settings.dataviewID}]`),this.settings.availableFieldIds?.length||this.warningsMessage("has no fields set for matching import data")}}},68732:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>l});var s=i(44363);class n extends s.Z{constructor(e,t,i){super(e,t||`ABViewCarousel_${e.id}`,Object.assign({carousel:""},i)),this._handler_doOnShow=()=>{this.onShow()},this._handler_doReload=()=>{},this._handler_doFilter=(e,t)=>{const i=this.datacollection;i&&(i.filterCondition(t),i.reloadData())},this._handler_busy=()=>{this.busy()},this._handler_ready=()=>{this.ready()}}ui(){const e=this.ids,t=this.view;this.filterUI=t.filterHelper,this.linkPage=t.linkPageHelper.component();const i={},s=this.settings;0===s.width&&Object.assign(i,{width:1});const n=super.ui([{borderless:!0,cols:[i,{borderless:!0,rows:[this.filterUI.ui(),{id:e.carousel,view:"carousel",cols:[],width:s.width,height:s.height,navigation:{items:!s.hideItem,buttons:!s.hideButton,type:s.navigationType},on:{onShow:()=>{const t=$$(e.carousel).getActiveIndex();this.switchImage(t)}}}]},i]}]);return delete n.type,n}async init(e){await super.init(e);const t=this.datacollection;if(!t)return void e.notify.builder(`Datacollection is ${t}`,{message:"This is an invalid datacollection"});const i=t.datasource;if(!i)return void e.notify.developer(`Object is ${t}`,{message:"This is an invalid object"});t.removeListener("loadData",this._handler_doOnShow),t.on("loadData",this._handler_doOnShow),t.removeListener("update",this._handler_doReload),t.on("update",this._handler_doReload),t.removeListener("delete",this._handler_doReload),t.on("delete",this._handler_doReload),t.removeListener("create",this._handler_doReload),t.on("create",this._handler_doReload),t.removeListener("initializingData",this._handler_busy),t.on("initializingData",this._handler_busy),t.removeListener("initializedData",this._handler_ready),t.on("initializedData",this._handler_ready),this.settings.filterByCursor&&["changeCursor","cursorStale"].forEach((e=>{t.removeListener(e,this._handler_doOnShow),t.on(e,this._handler_doOnShow)}));const s=this.view;s.filterHelper.objectLoad(i),s.filterHelper.viewLoad(this),this.filterUI.init(this.AB),this.filterUI.removeListener("filter.data",this._handler_doFilter),this.filterUI.on("filter.data",this._handler_doFilter),this.linkPage.init({view:s,datacollection:t});const n=$$(this.ids.carousel)?.$view;n&&(n.setAttribute("data-cy",`${s.key} ${s.id}`),n.querySelector(".webix_nav_button_prev")?.firstElementChild?.setAttribute("data-cy",`${s.key} button previous ${s.id}`),n.querySelector(".webix_nav_button_next")?.firstElementChild?.setAttribute("data-cy",`${s.key} button next ${s.id}`))}detatch(){const e=this.datacollection;e&&(e.removeListener("loadData",this._handler_doOnShow),this._handler_doReload&&(e.removeListener("update",this._handler_doReload),e.removeListener("delete",this._handler_doReload),e.removeListener("create",this._handler_doReload)),e.removeListener("initializingData",this._handler_busy),e.removeListener("initializedData",this._handler_ready),this.settings.filterByCursor&&["changeCursor","cursorStale"].forEach((t=>{e.removeListener(t,this._handler_doOnShow)})),this.filterUI.removeListener("filter.data",this._handler_doOnShow))}myTemplate(e){if(e?.src){const t=this.settings;return`<div class="ab-carousel-image-container">\n            <link rel="preload" href="${e.src}" as="image" fetchpriotity="low"/>\n            <img id="${this.ids.component}-${e.id}" src="${e.src}" class="content" ondragstart="return false" loading="lazy" />\n            ${t.showLabel?`<div class="ab-carousel-image-title">${e.label||""}</div>`:""}\n            <div class="ab-carousel-image-icon">\n            ${t.detailsPage||t.detailsTab?`<span ab-row-id="${e.id}" class="ab-carousel-detail webix_icon fa fa-eye"></span>`:""}\n            ${t.editPage||t.editTab?`<span ab-row-id="${e.id}" class="ab-carousel-edit webix_icon fa fa-pencil"></span>`:""}\n            <span class="webix_icon ab-carousel-zoom-in fa fa-search-plus"></span>\n            <span class="webix_icon ab-carousel-zoom-out fa fa-search-minus"></span>\n                  <span ab-row-id="${e.id}" ab-img-file="${e.imgFile}" class="webix_icon ab-carousel-rotate-left fa fa-rotate-left"></span>\n               <span ab-row-id="${e.id}" ab-img-file="${e.imgFile}" class="webix_icon ab-carousel-rotate-right fa fa-rotate-right"></span>\n               <span class="webix_icon ab-carousel-fullscreen fa fa-arrows-alt"></span>\n               <span style="display: none;" class="webix_icon ab-carousel-exit-fullscreen fa fa-times"></span>\n            </div>\n         </div>`}return""}busy(){const e=$$(this.ids.carousel);e?.disable(),e?.showProgress?.({type:"icon"})}ready(){const e=$$(this.ids.carousel);e?.enable(),e?.hideProgress?.()}async switchImage(e){const t=this.datacollection;if(t&&e>=this._imageCount-1&&t.totalCount>this._rowCount){this.busy();try{await t.loadData(this._rowCount||0)}catch(e){this.AB.notify.developer(e,{message:"ABViewCarousel:switchImage():Error when load data from a Data collection"})}this.ready()}}onShow(e=this.filterUI.getFilter()){const t=this.ids,i=this.datacollection;if(!i)return;const s=i.datasource;if(!s)return;const n=this.view.imageField;if(!n)return;if(i.dataStatus==i.dataStatusFlag.notInitial)return void i.loadData();const a=this.settings;let r=i.getData(e);if(a.filterByCursor){const e=i.getCursor();e&&(r=r.filter((t=>(t[s.PK()]||t.id||t)===(e[s.PK()]||e.id||e))))}const o=[];r.forEach((e=>{const t=e[n.columnName];if(t){const i={id:e.id,src:`/file/${t}`,imgFile:t};a.showLabel&&(i.label=s.displayData(e)),o.push({css:"image",borderless:!0,template:(...e)=>this.myTemplate(...e),data:i})}}));const l=this.AB;n.settings.defaultImageUrl&&o.unshift({css:"image",template:(...e)=>this.myTemplate(...e),data:{id:l.uuid(),src:`/file/${n.settings.defaultImageUrl}`,label:this.label("Default image")}}),o.length<1&&o.push({rows:[{view:"label",align:"center",height:a.height,label:"<div style='display: block; font-size: 180px; background-color: #666; color: transparent; text-shadow: 0px 1px 1px rgba(255,255,255,0.5); -webkit-background-clip: text; -moz-background-clip: text; background-clip: text;' class='fa fa-picture-o'></div>"},{view:"label",align:"center",label:this.label("No image")}]}),this._rowCount=r.length,this._imageCount=o.length;const c=$$(t.carousel),u=l.Webix;if(c){u.ui(o,c),u.extend(c,u.ProgressBar);const e=a.editPage,i=a.detailsPage;c.$view.onclick=async s=>{if(s.target.className)if(s.target.className.indexOf("ab-carousel-edit")>-1){u.html.removeCss(c.getNode(),"fullscreen"),u.fullscreen.exit();let t=s.target.getAttribute("ab-row-id");this.linkPage.changePage(e,t)}else if(s.target.className.indexOf("ab-carousel-detail")>-1){u.html.removeCss(c.getNode(),"fullscreen"),u.fullscreen.exit();let e=s.target.getAttribute("ab-row-id");this.linkPage.changePage(i,e)}else if(s.target.className.indexOf("ab-carousel-fullscreen")>-1)c.define("css","fullscreen"),u.fullscreen.set(t.carousel,{head:{view:"toolbar",css:"webix_dark",elements:[{},{view:"icon",icon:"fa fa-times",click:function(){u.html.removeCss(c.getNode(),"fullscreen"),u.fullscreen.exit()}}]}});else if(s.target.className.indexOf("ab-carousel-rotate-left")>-1){const e=s.target.getAttribute("ab-row-id"),t=s.target.getAttribute("ab-img-file");this.rotateImage(e,t,n,"left")}else if(s.target.className.indexOf("ab-carousel-rotate-right")>-1){const e=s.target.getAttribute("ab-row-id"),t=s.target.getAttribute("ab-img-file");this.rotateImage(e,t,n,"right")}else s.target.className.indexOf("ab-carousel-zoom-in")>-1?this.zoom("in"):s.target.className.indexOf("ab-carousel-zoom-out")>-1&&this.zoom("out")}}}showFilterPopup(e){this.filterUI.showPopup(e)}async rotateImage(e,t,i,s="right"){this.busy(),"left"==s?await i.rotateLeft(t):await i.rotateRight(t);const n=document.getElementById(`${this.ids.component}-${e}`);n&&(await fetch(n.src,{cache:"reload",mode:"no-cors"}),n.src=`${n.src}#${(new Date).getTime()}`),this.ready()}zoom(e="in"){const t=document.getElementsByClassName("ab-carousel-image-container")[0];if(!t)return;const i=t.getElementsByTagName("img")[0];if(!i)return;const s=parseInt((i.style.height||100).toString().replace("%","")),n="in"==e?s+15:s-15;i.style.height=`${n}%`,t.style.overflow=n>100?"auto":""}}var a=i(43348),r=i(25733);const o=i(474);class l extends o{constructor(e,t,i,s){super(e,t,i,s)}fromValues(e){super.fromValues(e),this.filterHelper.fromSettings(this.settings.filter)}component(){var e=this.datacollection;return e&&(this.filterHelper.objectLoad(e.datasource),this.filterHelper.fromSettings(this.settings.filter)),new n(this)}get idBase(){return`ABViewCarousel_${this.id}`}get filterHelper(){return null==this.__filterHelper&&(this.__filterHelper=new a.Z(this.AB,this.idBase)),this.__filterHelper}get linkPageHelper(){return null==this.__linkPageHelper&&(this.__linkPageHelper=new r.Z),this.__linkPageHelper}warningsEval(){super.warningsEval(),this.imageField||this.warningsMessage(`can't resolve image field[${this.settings.field}]`)}}},73936:(e,t,i)=>{const s=i(34263),n=i(26869);e.exports=class extends s{component(){return new n(this)}fromValues(e){super.fromValues(e),this.refreshData()}getDCChart(){return this._dcChart||(this._dcChart=new webix.DataCollection),this._dcChart}refreshData(){const e=this.datacollection;if(null==e)return this.dcChart;const t=this.labelField(),i=this.valueField(),s=this.valueField2();if(!t||!i)return this.dcChart;const n=i.columnName;let a="";this.settings.multipleSeries&&s&&(a=s.columnName);const r=["#ee4339","#ee9336","#eed236","#d3ee36","#a7ee70","#58dccd","#36abee","#476cee","#a244ea","#e33fc7"],o=e.getData();let l=[],c={},u=0,d=0,h=o.length;o.forEach((e=>{const s=t.format(e)||e.id;let r=parseFloat(e[n]||0),o=null;switch(this.settings.multipleSeries&&(o=parseFloat(e[a])||0),i.key){case"formula":r=i.format(e);break;case"calculate":r=parseFloat(i.constructor.convertToJs(i.object,i.settings.formula,e,i.settings.decimalPlaces))}if(null==c[s]){let i=s;if(t.isConnection){let s=t.pullRelationValues(e);null!=s&&(i=Array.isArray(s)?s.map((e=>e.text||"")).join(", "):s.text)}this.settings.multipleSeries?c[s]={label:i||e.id,value:0,value2:0}:c[s]={label:i||e.id,value:0}}c[s].value+=r,u+=r,this.settings.multipleSeries&&(c[s].value2+=o,d+=o)}));let p=0;for(const e in c){let t=c[e].value;if(!(t<=0)){if(this.settings.isPercentage&&(t=t/u*100,t=Math.round(100*t)/100,t+=" %"),this.settings.multipleSeries){let i=c[e].value2;if(i<=0)continue;this.settings.isPercentage&&(i=i/d*100,i=Math.round(100*i)/100,i+=" %"),l.push({label:c[e].label,value:t,value2:i,color:r[p%r.length],count:h})}else l.push({label:c[e].label,value:t,color:r[p%r.length],count:h});p+=1}}const f=this.getDCChart();f.clearAll(),f.parse(l)}warningsEval(){super.warningsEval(),this.labelField()||this.warningsMessage(`can't resolve label field[${this.settings.columnLabel}]`),this.valueField()||this.warningsMessage(`can't resolve value field[${this.settings.columnValue}]`)}}},2909:(e,t,i)=>{const s=i(47493),n=i(80651);e.exports=class extends s{component(){return new n(this)}}},69623:(e,t,i)=>{const s=i(5163),n=i(87139);e.exports=class extends s{component(){return new n(this)}}},55988:(e,t,i)=>{const s=i(4814),n=i(71233);e.exports=class extends s{component(){return new n(this)}get datacollection(){return this.parent.datacollection}}},6765:(e,t,i)=>{const s=i(86094),n=i(52564);e.exports=class extends s{component(){return new n(this)}}},28280:(e,t,i)=>{const s=i(92835),n=i(48370);e.exports=class extends s{component(){return new n(this)}}},39058:(e,t,i)=>{const s=i(46767),n=i(29405);e.exports=class extends s{component(){return new n(this)}warningsEval(){super.warningsEval();let e=this.getUserField();e||this.warningsMessage(`can't resolve user field[${this.settings.columnUser}]`),e=this.getCommentField(),e||this.warningsMessage(`can't resolve comment field[${this.settings.columnComment}]`),e=this.getDateField(),e||this.warningsMessage(`can't resolve date field[${this.settings.columnDate}]`)}}},45025:(e,t,i)=>{const s=i(14534),n=i(54112);e.exports=class extends s{component(){return new n(this)}async save(){const e=this.views().find((e=>"If"===e.name)),t=this.views().find((e=>"Else"===e.name)),i=[];e&&i.push(e.save()),t&&i.push(t.save()),await Promise.all(i),await super.save()}warningsEval(){super.warningsEval(),this.datacollection||this.warningsMessage(`can't resolve it's datacollection[${this.settings.dataviewID}]`),this.settings.filterConditions&&0!=this.settings.filterConditions?.rules?.length||this.warningsMessage("has no filter conditions set")}}},87821:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var s=i(51828),n=i.n(s),a=i(44363);class r extends a.Z{constructor(e,t,i){super(e,t||`ABViewConnectDataFilter_${e.id}`,Object.assign({filter:"",reset:""},i)),this.field=null}ui(){const e=this.ids,t=super.ui([{type:"space",borderless:!0,cols:[{view:"icon",icon:"fa fa-filter",align:"left",disabled:!0},{view:"combo",id:e.filter,labelWidth:this.AB.UISettings.config().labelWidthXLarge,disabled:!0,on:{onChange:e=>this.applyConnectFilter(e)}},{view:"icon",id:e.reset,icon:"fa fa-times",align:"left",disabled:!0,tooltip:this.label("Renmove this filter"),on:{onItemClick:()=>this.resetConnectFilter()}}]}]);return delete t.type,t}async init(e){await super.init(e);const t=this.datacollection;if(!t)return;const i=t.datasource;if(!i)return;const[s]=i.fields((e=>e.columnName===this.settings.field));if(!s)return void this.AB.notify.developer(`Cannot find field "${this.settings.field}" in ${i.name}`,{context:"ABViewConnectDataFilterComponent.init()",data:{settings:this.settings}});this.field=s;const n=this.ids,a=webix.ui({view:"suggest",filter:({value:e},t)=>e.toLowerCase().includes(t.toLowerCase()),on:{onShow:()=>{s.populateOptionsDataCy($$(n.filter),s,{})}}});s.getAndPopulateOptions(a,null,s);const r=$$(n.filter);r.define("suggest",a),r.define("label",`${this.label("Filter by")} ${s.label}`),r.enable(),r.refresh()}resetConnectFilter(){const e=this.ids,t=this.datacollection;t.filterCondition({glue:"and",rules:[]}),t.reloadData();const i=$$(e.filter);i.blockEvent(),i.setValue(),i.unblockEvent(),$$(e.reset).disable()}applyConnectFilter(e){const t={key:this.field.id,rule:"equals",value:e},i=this.datacollection;i.filterCondition({glue:"and",rules:[t]}),i.reloadData(),$$(this.ids.reset).enable()}}class o extends(n()){component(){return new r(this)}}},35798:(e,t,i)=>{const s=i(67070),n=i(91219);e.exports=class extends s{component(){return new n(this)}warningsEval(){super.warningsEval(),0==this.views().length&&this.warningsMessage("has no content")}}},54013:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>d});var s=i(23108),n=i.n(s),a=i(44363),r=i(83595),o=i(43348),l=i(53059),c=i.n(l);class u extends a.Z{constructor(e,t,i){super(e,t||`ABViewDataFilter_${e.id}`,Object.assign({filter:"",reset:"",sortButton:"",filterButton:"",globalSearchToolbar:""},i)),this._handler_filterData=(e,t)=>{this.callbackFilterData(e,t)},this.field=null;const s=this.AB;this.PopupSortComponent=new r.Z(`ABViewDataFilter_Sort_Popup_${this.settings.dataviewID}`),this.PopupSortComponent.init(s),this.PopupSortComponent.on("changed",(e=>{this.callbackSortData(e)})),this.filterHelper=new o.Z(this.AB,`ABViewDataFilter_Filter_Popup_${this.settings.dataviewID}`),this.filterHelper.settings={filterOption:1,userFilterPosition:"toolbar",isGlobalToolbar:1},this.filterHelper.init(s),this.detatch(),this.filterHelper.on("filter.data",this._handler_filterData)}advancedUI(){const e=this.ids.component;return[{css:"bg_gray",maxHeight:60,rows:[{},{cols:[{width:18},{view:"button",type:"icon",icon:"fa fa-filter",width:40,id:this.ids.filterButton,css:`webix_primary abFilterButton${this.settings.dataviewID}`,click:(e,t)=>{this.toolbarFilter($$(this.ids.filterButton).$view)},on:{onAfterRender:function(){this.getInputNode().setAttribute("data-cy",`${e} filter button`)}}},{view:"button",type:"icon",icon:"fa fa-sort",width:40,id:this.ids.sortButton,css:`webix_primary abSortButton${this.settings.dataviewID}`,click:(e,t)=>{this.openSort($$(this.ids.sortButton).$view)},on:{onAfterRender:function(){this.getInputNode().setAttribute("data-cy",`${e} sort button`)}}},{id:this.ids.globalSearchToolbar,view:"search",placeholder:this.label("Search.."),css:`abGlobalSearchField${this.settings.dataviewID}`,width:0,attributes:{"data-cy":`${this.ids.component} global search`,datacollection:this.settings.dataviewID},on:{onTimedKeyPress:()=>{const e=$$(this.ids.globalSearchToolbar).getValue();this.datacollection.settings.objectWorkspace.searchText=e,this.filterHelper.externalSearchText(e)}}},{width:18}]},{}]}]}connectedFieldUI(){return[{css:"bg_gray",maxHeight:60,cols:[{width:18},{rows:[{},{view:"abslayout",cells:[{css:"bg_gray",view:"combo",id:this.ids.filter,labelWidth:0,relative:!0,disabled:!0,on:{onChange:e=>this.applyConnectFilter(e)}},{view:"icon",id:this.ids.reset,icon:"fa fa-times",right:24,top:7,width:24,height:24,hidden:!0,tooltip:this.label("Remove this filter"),on:{onItemClick:()=>$$(this.ids.filter).setValue()}}]},{}]},{width:18}]}]}ui(){if("advanced"==this.settings.viewType){if(!this?.settings?.dataviewID)return{height:1}}else if(!this?.settings?.dataviewID||!this?.settings?.field)return{height:1};const e="advanced"==this.settings.viewType?this.advancedUI():this.connectedFieldUI(),t=super.ui(e);return delete t.type,t}async init(e){await super.init(e);const t=this.datacollection;if(!t)return;const i=t.datasource;if(i)if("advanced"==this.settings.viewType)this.settings.showSort?(this.PopupSortComponent.objectLoad(i),this.PopupSortComponent.setSettings(t?.settings?.objectWorkspace?.sortFields)):$$(this.ids.sortButton).hide(),this.settings.showFilter?this.filterHelper.objectLoad(i):$$(this.ids.filterButton).hide();else if("connected"==this.settings.viewType){const[e]=i.fields((e=>e.columnName===this.settings.field));if(!e)return void this.AB.notify.developer(`Cannot find field "${this.settings.field}" in ${i.name}`,{context:"ABViewDataFilterComponent.init()",data:{settings:this.settings}});this.field=e;const t=this.ids,s=webix.ui({view:"suggest",filter:({value:e},t)=>e.toLowerCase().includes(t.toLowerCase()),on:{onShow:()=>{e.populateOptionsDataCy($$(t.filter),e,{})}},showAllOptions:!0});e.getAndPopulateOptions(s,null,e);const n=$$(t.filter);n.define("suggest",s),n.define("placeholder",`${this.label("Filter by")} ${e.label}`),n.enable(),n.refresh()}}onShow(){super.onShow(),this.updateUI()}applyConnectFilter(e){let t=[];e?($$(this.ids.reset).show(),t=[{key:this.field.id,rule:"equals",value:e}]):$$(this.ids.reset).hide();const i=this.datacollection;i.filterCondition({glue:"and",rules:t}),i.reloadData()}openSort(e){this.PopupSortComponent.show(e)}async callbackSortData(e=[]){const t=this.datacollection;c().isEqual(t?.settings?.objectWorkspace?.sortFields,e)||(t.settings.objectWorkspace.sortFields=e,await this.datacollection.reloadData()),this.updateUI()}callbackFilterData(e,t=[]){const i=this.datacollection;c().isEqual(i?.__filterCond,t)||(i.filterCondition(t),i.reloadData(),this.updateUI())}toolbarFilter(e){this.filterHelper.showPopup(e)}updateUI(){const e=this.datacollection;if(!e)return;var t=document.getElementsByClassName(`abFilterButton${this.settings.dataviewID}`);const i=this.filterHelper.filterRules();let s=i?.rules?.length>0?i?.rules?.length:null;for(let e of t)$$(e).define("badge",s),$$(e).refresh();var n=document.getElementsByClassName(`abSortButton${this.settings.dataviewID}`);const a=e.settings.objectWorkspace.sortFields;let r=a?.length>0?a?.length:null;for(let e of n)$$(e).define("badge",r),$$(e).refresh();var o=document.getElementsByClassName(`abGlobalSearchField${this.settings.dataviewID}`);const l=e.settings.objectWorkspace.searchText;if(null!=l)for(let e of o){var c=document.activeElement;c?.attributes?.datacollection?.value==this.settings.dataviewID&&c==e.getElementsByTagName("input")[0]||$$(e).setValue(l)}}detatch(){this.filterHelper.removeListener("filter.data",this._handler_filterData)}}class d extends(n()){component(){return new u(this)}warningsEval(){super.warningsEval();let e=this.datacollection;if(e){if("connected"==this.settings.viewType){const t=e.datasource,[i]=t.fields((e=>e.columnName===this.settings.field));i||this.warningsMessage("can't resolve field reference")}}else this.warningsMessage(`can't resolve it's datacollection[${this.settings.dataviewID}]`)}}},24216:(e,t,i)=>{const s=i(43786),n=i(93349),a=s.defaultValues();e.exports=class extends s{fromValues(e){super.fromValues(e),this.settings.detailsPage=this.settings.detailsPage??a.detailsPage,this.settings.editPage=this.settings.editPage??a.editPage,this.settings.detailsTab=this.settings.detailsTab??a.detailsTab,this.settings.editTab=this.settings.editTab??a.editTab}component(){return new n(this)}}},65862:(e,t,i)=>{const s=i(89799),n=i(97346);e.exports=class extends s{component(){return new n(this)}warningsEval(){super.warningsEval(),this.datacollection||this.warningsMessage(`can't resolve it's datacollection[${this.settings.dataviewID}]`)}}},11865:(e,t,i)=>{const s=i(90065),n=i(78781);e.exports=class extends s{component(){return new n(this)}}},6101:(e,t,i)=>{const s=i(12126),n=i(71695).Z,a=i(84704);e.exports=class extends s{fromValues(e){super.fromValues(e),this.addPageTool.fromSettings(this.settings)}component(){return new a(this)}get addPageTool(){return null==this.__addPageTool&&(this.__addPageTool=new n),this.__addPageTool}}},52378:(e,t,i)=>{const s=i(57839),n=i(99484);e.exports=class extends s{component(){return new n(this)}}},71951:(e,t,i)=>{const s=i(30825),n=i(28805);e.exports=class extends s{component(){return new n(this)}}},54325:(e,t,i)=>{const s=i(68488),n=i(57076);e.exports=class extends s{component(){return new n(this)}}},97654:(e,t,i)=>{const s=i(38208),n=i(53676);e.exports=class extends s{component(){return new n(this)}}},18745:(e,t,i)=>{const s=i(80796),n=i(72666);e.exports=class extends s{component(){return new n(this)}}},84648:(e,t,i)=>{const s=i(26736),n=i(19454);e.exports=class extends s{component(){return new n(this)}letUserDownload(e,t){const i=window.URL.createObjectURL(e),s=document.createElement("a");s.href=i,s.download=t,document.body.appendChild(s),s.click(),s.remove(),window.URL.revokeObjectURL(i)}warningsEval(){super.warningsEval(),this.datacollections||this.datacollection||this.warningsMessage(`can't resolve it's datacollection[${this.settings.dataviewID}]`),this.settings.filename||this.warningsMessage("is missing a DOCX template file")}}},40194:(e,t,i)=>{const s=i(31089),n=i(68759),a=i(44388),r=i(36365),o=i(55030),l=i(31223),c=i(87262),u=(i(83743),i(51533)),d=(...e)=>AB.Multilingual.label(...e),h=s.defaultValues();e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s),this._callbacks={onBeforeSaveData:()=>!0}}superComponent(){return null==this._superComponent&&(this._superComponent=super.component()),this._superComponent}component(){return new n(this)}refreshDefaultButton(e){let t=this.views((e=>e instanceof a&&e.settings.isDefault))[0];null==t?(t=a.newInstance(this.application,this),t.settings.isDefault=!0):this._views=this.views((e=>e.id!=t.id));let i=this.views().map((e=>(e.position.y||0)+1));i.push(this._views.length||0),i.push($$(e.fields).length||0);let s=Math.max(...i);return t.position.y=s,this._views.push(t),t}getFormValues(e,t,i,s){const n=["id"];e.getValues((function(e){n.push(e.config.name)}));const a=e.getValues(),d={};n.forEach((e=>{d[e]=a[e]})),this.fieldComponents((e=>e instanceof r||e instanceof o||e instanceof l||e instanceof c||e instanceof u&&"filter"==e.settings.type)).forEach((e=>{const t=this.viewComponents[e.id];if(null==t)return;const i=e.field();if(i){const e=t.getValue??t.logic.getValue;e&&(d[i.columnName]=e.call(t,d))}})),t.connectFields().forEach((e=>{-1==n.indexOf(e.columnName)&&d[e.columnName]&&(delete d[e.columnName],delete d[e.relationName()])}));for(const e in d)null!=d[e]&&0!=d[e].length||(d[e]="");let h;if(s&&(h=s.getCursor()),h){const e=s.datasource;t.connectFields().forEach((t=>{const i=this.fieldComponents((e=>e?.field?.()?.id===t?.id));if(e.id==t.settings.linkObject&&i.length<1&&void 0===d[t.columnName]){const i=t.indexField?t.indexField.columnName:e.PK();d[t.columnName]={},d[t.columnName][i]=h[i]??h.id}}))}const p=Object.assign(i.getCursor()??{},d);return t.fields((e=>"calculate"==e.key||"formula"==e.key)).forEach((e=>{if(null==d[e.columnName]){let t=!0;"formula"==e.key&&e.settings?.where?.rules?.length>0&&(t=!1),d[e.columnName]=e.format(p,t)}})),a.translations?.length>0&&(d.translations=a.translations),t.formCleanValues(d),d}validateData(e,t,i){let s="";const n=this.fieldComponents((e=>1==e?.field?.().settings?.required||1==e?.settings?.required)).map((e=>e.field())),a=t.isValidData(i);let r=a.pass();e.validate();const o=t=>{const i=e.elements[t];if(!i)return;i.$height<56&&(i.define("height",60),i.resize());const s=i.$view.getElementsByClassName("webix_inp_bottom_label")[0];s?.style["margin-left"]||(s.style.marginLeft=`${this.settings.labelWidth??h.labelWidth}px`)};if(n.forEach((t=>{if(!t)return;const n=i[t.columnName];(""==n||null==n||n.length<1)&&(e.markInvalid(t.columnName,d("This is a required field.")),s+=`<li>${d("Missing Required Field")} ${t.columnName}</li>`,r=!1,o(t.columnName))})),!r){const t=e.queryView({view:"button",type:"form"});a?.errors?.length?(a.errors.forEach((t=>{e.markInvalid(t.name,t.message),s+=`<li>${t.name}: ${t.message}</li>`,o(t.name)})),t?.disable()):t?.enable()}return s&&webix.alert({type:"alert-error",title:d("Problems Saving"),width:400,text:`<ul style='text-align:left'>${s}</ul>`}),r}async recordRulesReady(){return this.RecordRule.rulesReady()}async saveData(e){if(!this._callbacks?.onBeforeSaveData?.())return;e.clearValidation();const t=this.datacollection;if(null==t)return;const i=t.datasource;if(null==i)return;const s=t.model;if(null==s)return;e.showProgress?.({type:"icon"});const n=this.getFormValues(e,i,t,t.datacollectionLink),a=t=>{const i=e.queryView({view:"button",type:"form"});if(t)if(t.invalidAttributes)for(const i in t.invalidAttributes){let s=t.invalidAttributes[i];s&&s[0]&&(s=s[0]),e.markInvalid(i,s.message)}else t.sqlMessage?webix.message({text:t.sqlMessage,type:"error"}):(webix.message({text:d("System could not save your data"),type:"error"}),this.AB.notify.developer(t,{message:"Could not save your data",view:this.toObj()}));i?.enable(),e?.hideProgress?.()};if(await this.loadDcDataOfRecordRules(),await this.recordRulesReady(),this.doRecordRulesPre(n),!this.validateData(e,i,n))return void e.hideProgress?.();let r;try{r=n.id?await s.update(n.id,n):await s.create(n)}catch(e){throw a(e.data),e}try{await this.doRecordRules(r)}catch(e){this.AB.notify.developer(e,{message:"Error processing Record Rules.",view:this.toObj(),newFormVals:r})}try{this.doSubmitRules(r)}catch(e){this.AB.notify.developer(e,{message:"Error processing Submit Rules.",view:this.toObj(),newFormVals:r})}return(i=>{t&&(this.settings.clearOnSave?(t.setCursor(null),e.clear()):i&&i.id&&t.setCursor(i.id)),e.hideProgress?.(),i&&this.emit("saved",i)})(r),r}focusOnFirst(){let e="";this.views().forEach((t=>{"textbox"!=t.key&&"numberbox"!=t.key||0==t.position.y&&(e=t.id)}));let t=this.viewComponents[e];t&&$$(t.ui.id)&&$$(t.ui.id).focus()}async loadDcDataOfRecordRules(){const e=[];return(this.settings?.recordRules??[]).forEach((t=>{(t?.actionSettings?.valueRules?.fieldOperations??[]).forEach((t=>{if("exist"!==t.valueType)return;const i=this.AB.datacollectionByID(t.value);i?.dataStatus===i.dataStatusFlag.notInitial&&e.push(i.loadData())}))})),await Promise.all(e),!0}get viewComponents(){return this.superComponent().viewComponents}warningsEval(){super.warningsEval(),this.datacollection||this.warningsMessage(`can't resolve it's datacollection[${this.settings.dataviewID}]`),this.settings.recordRules,this.settings.submitRules}async deleteData(e){const t=this.datacollection;if(null==t)return;if(null==t.datasource)return;const i=t.model;if(null==i)return;const s=e.getValues();if(s?.id){const n=await i.delete(s.id);return n&&(t.setCursor(null),e.clear()),n}}}},44388:(e,t,i)=>{const s=i(46816),n=i(5793);e.exports=class extends s{component(){return new n(this)}}},93452:(e,t,i)=>{const s=i(49947),n=i(90418);e.exports=class extends s{component(){return new n(this)}}},55030:(e,t,i)=>{const s=i(91623),n=i(40500),a=i(71695).Z,r=i(39747).Z,o=s.defaultValues();e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s),this.__filterComponent=this.AB.filterComplexNew(`${this.id}__filterComponent`),this.__filterComponent.fieldsLoad(this.datasource?this.datasource.fields():[],this.datasource?this.datasource:null),this.__filterComponent.setValue(this.settings.filterConditions??o.filterConditions)}fromValues(e){super.fromValues(e),this.addPageTool.fromSettings(this.settings),this.editPageTool.fromSettings(this.settings)}static get addPageProperty(){return a.propertyComponent(this.App,this.idBase)}static get editPageProperty(){return r.propertyComponent(this.App,this.idBase)}component(){return new n(this)}get addPageTool(){return null==this.__addPageTool&&(this.__addPageTool=new a),this.__addPageTool}get editPageTool(){return null==this.__editPageTool&&(this.__editPageTool=new r),this.__editPageTool}}},36365:(e,t,i)=>{const s=i(88356),n=i(12213);e.exports=class extends s{component(){return new n(this)}}},31223:(e,t,i)=>{const s=i(28476),n=i(37264);e.exports=class extends s{component(){return new n(this)}}},48933:(e,t,i)=>{const s=i(68181),n=i(13097);s.defaultValues(),e.exports=class extends s{static get componentUI(){return n}component(){return new n(this)}parentFormUniqueID(e){var t=this.parentFormComponent();return e+(t?t.uniqueInstanceID:webix.uid())}}},51533:(e,t,i)=>{const s=i(88612),n=i(35986);e.exports=class extends s{component(){return new n(this)}}},54045:(e,t,i)=>{const s=i(5880),n=i(14956);e.exports=class extends s{component(){return new n(this)}}},26314:(e,t,i)=>{const s=i(87771),n=i(26050);e.exports=class extends s{component(){return new n(this)}}},87262:(e,t,i)=>{const s=i(15934),n=i(70215);e.exports=class extends s{component(){return new n(this)}}},24215:(e,t,i)=>{const s=i(97241),n=i(35111);e.exports=class extends s{component(){return new n(this)}}},83743:(e,t,i)=>{const s=i(94782),n=i(96936);e.exports=class extends s{component(){return new n(this)}}},20297:(e,t,i)=>{const s=i(68272),n=i(72708);e.exports=class extends s{component(){return new n(this)}}},41161:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>r});var s=i(44363);class n extends s.Z{constructor(e,t,i){super(e,t||`ABViewGantt_${e.id}`,Object.assign({menu:"",gantt:""},i)),this._tempDC=null,this.TitleField=null,this.StartDateField=null,this.EndDateField=null,this.DurationField=null,this.ProgressField=null,this.NotesField=null,this.originalStartDate=null,this.originalEndDate=null,this.pendingAdds={};const s=this.ids.gantt;this.ganttElement={isExistsTask:e=>{const t=$$(s).getService("local");if(!t)return!1;const i=t.tasks();return!(!i||!i.exists)&&i.exists(e)},removeTask:e=>{if(!this.ganttElement.isExistsTask(e))return;const t=$$(s).getService("operations");return t?t.removeTask(e):void 0}}}ui(){const e=this.ids,t=this,{YEAR_SCALE:i,MONTH_SCALE:s,DAY_SCALE:n}=this.getConstantScales,a=super.ui([{cols:[{fillspace:!0},{view:"menu",id:e.menu,layout:"x",width:300,data:[{id:"day",value:this.label("Day")},{id:"week",value:this.label("Week")},{id:"month",value:this.label("Month")},{id:"year",value:this.label("Year")}],on:{onItemClick:e=>{this.setScale(e)}}}]},{id:e.gantt,view:"gantt",scales:[i,s,n],override:new Map([[gantt.services.Backend,class extends gantt.services.Backend{async tasks(){const e=t.CurrentDatacollection;return e?(e.getData()||[]).map(((e,i)=>t.convertFormat(e,i))):[]}links(){return Promise.resolve([])}async addTask(e,i,s){t.pendingAdds[e.id]||(t.pendingAdds[e.id]=t.taskAdd(e));const n=await t.pendingAdds[e.id];return delete t.pendingAdds[e.id],{id:(n||{}).id}}async updateTask(e,i){return await t.taskUpdate(i.id,i)}async removeTask(e){return await t.taskRemove(e)}}]])}]);return delete a.type,a}async init(e){await super.init(e);const t=$$(this.ids.menu);t&&t.showItem("day")}get CurrentDatacollection(){return super.CurrentDatacollection||this._tempDC}convertFormat(e={},t=null){const i={},s=this.StartDateField,n=this.EndDateField,a=this.DurationField;if(!s||!n&&!a)return i;const r=new Date;i.id=e.id||e.uuid,i.type="task",i.parent=0,i.open=!0;const o=this.TitleField,l=this.ProgressField,c=this.NotesField;return i.text=o?e[o.columnName]||"":this.CurrentObject.displayData(e),i.start_date=e[s.columnName]||r,i.progress=l?parseFloat(e[l.columnName]||0):0,c&&(i.details=e[c.columnName]||""),n&&(i.end_date=e[n.columnName]||r),a&&(i.duration=e[a.columnName]||1),i.end_date||i.duration||(i.end_date=r,i.duration=1),t&&(i.order=t),i}convertValues(e){const t={},i=this.TitleField,s=this.StartDateField,n=this.ProgressField,a=this.NotesField,r=this.EndDateField,o=this.DurationField;return i&&(t[i.columnName]=e.text||""),s&&(t[s.columnName]=e.start_date),n&&(t[n.columnName]=parseFloat(e.progress||0)),a&&(t[a.columnName]=e.details),r&&(t[r.columnName]=e.end_date),o&&(t[o.columnName]=e.duration),t}objectLoad(e){super.objectLoad(e);const t=this.settings;e&&(this.TitleField=e.fieldByID(t.titleFieldID),this.StartDateField=e.fieldByID(t.startDateFieldID),this.EndDateField=e.fieldByID(t.endDateFieldID),this.DurationField=e.fieldByID(t.durationFieldID),this.ProgressField=e.fieldByID(t.progressFieldID),this.NotesField=e.fieldByID(t.notesFieldID))}datacollectionLoad(e){super.datacollectionLoad(e);const t=this.CurrentDatacollection||e;t&&(this._tempDC=e,this.objectLoad(t.datasource),["create","update","delete","initializedData"].forEach((e=>{e in t._events&&-1!==this.__events.findIndex((t=>t.eventName===e))||("delete"===e?this.eventAdd({emitter:t,eventName:"delete",listener:e=>{this.ganttElement.isExistsTask(e)&&this.ganttElement.removeTask(e)}}):this.eventAdd({emitter:t,eventName:e,listener:()=>{this.initData()}}))})))}hide(){$$(this.ids.component)?.hide()}initData(){const e=$$(this.ids.gantt);if(!e)return;const t=e.getService("local");if(!t)return;const i=t.tasks();i&&setTimeout((()=>{i.clearAll();const e=this.CurrentDatacollection,s={data:e?(e.getData()||[]).map(((e,t)=>this.convertFormat(e,t))):[]};this.StartDateField&&(this.EndDateField||this.DurationField)&&i.parse(s);const n=t.getScales();this.originalStartDate=n.start,this.originalEndDate=n.end,this.sort()}),10)}get getConstantScales(){return{DAY_SCALE:{unit:"day",format:"%d"},WEEK_SCALE:{unit:"week",format:e=>{const t=webix.Date.dateToStr("%d %M"),i=webix.Date.weekStart(e),s=webix.Date.add(webix.Date.add(i,1,"week",!0),-1,"day",!0);return t(i)+" - "+t(s)}},MONTH_SCALE:{unit:"month",format:"%F"},YEAR_SCALE:{unit:"year",format:"%Y"}}}setScale(e){const t=$$(this.ids.gantt);if(!t)return;const i=t.getService("local");if(!i)return;const s=[],{YEAR_SCALE:n,MONTH_SCALE:a,WEEK_SCALE:r,DAY_SCALE:o}=this.getConstantScales;switch(e){case"day":s.push(n,a,o);break;case"week":s.push(n,a,r);break;case"month":s.push(n,a);break;case"year":s.push(n)}const l=this.AB.Webix,c=t.getService("local").getScales(),u=l.Date.add(this.originalStartDate,-1,e,!0),d=l.Date.add(this.originalEndDate,1,e,!0);i.setScales(u,d,c.precise,c.cellWidth,c.cellHeight,s),t.$app.refresh(),t.getState().$batch({top:0,left:0})}onShow(){super.onShow(),this.datacollectionLoad(this.datacollection),$$(this.ids.component)?.show()}sort(){}async taskAdd(e){const t=this.convertValues(e),i=this.AB;try{return await(this.CurrentObject?.model().create(t))}catch(e){throw i.Webix.alert({title:this.label("Error Saving Item"),ok:this.label("Okay"),text:this.label("Unable to save this item.")}),i.notify.developer(e,{context:"ABViewGantt:taskAdd(): Error Saving Item",patch:t}),e}}async taskRemove(e){const t=this.AB;try{return await this.CurrentObject.model().delete(e),{}}catch(i){throw t.Webix.alert({title:this.label("Error Removing Item"),ok:this.label("Okay"),text:this.label("Unable to remove this item.")}),t.notify.developer(i,{context:"ABViewGantt:taskRemove(): Error Removing Item",rowId:e}),i}}async taskUpdate(e,t){const i=this.convertValues(t),s=this.AB;try{return await this.CurrentObject.model().update(e,i),{}}catch(e){throw s.Webix.alert({title:this.label("Error Updating Item"),ok:this.label("Okay"),text:this.label("Unable to update this item.")}),s.notify.developer(e,{context:"ABViewGantt:taskUpdate(): Error Updating Item",patch:i}),e}}}const a=i(28181);class r extends a{constructor(e,t,i,s){super(e,t,i,s)}component(){return new n(this)}warningsEval(){super.warningsEval();let e=this.datacollection;if(e)if(this.settings.startDateFieldID){let t=e.datasource?.fieldByID(this.settings.startDateFieldID);t||this.warningsMessage(`can't lookup field: startDate[${this.settings.startDateFieldID}]`)}else this.warningsMessage("doesn't have a start date field set.");else this.warningsMessage(`can't resolve it's datacollection[${this.settings.dataviewID}]`)}}},25473:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>f});var s=i(44363),n=i(32019);class a extends n.Z{constructor(e){super({popupExport:`${e=e||"abviewgridpopupExport"}_popupExport`,list:`${e}_popupExport_list`}),this._currentObject=null,this._dataCollection=null,this._grid=null,this._filename=null,this._hiddenFields=[]}ui(){var e=this;return{view:"popup",id:this.ids.popupExport,width:160,height:0,select:!1,hidden:!0,body:{id:this.ids.list,view:"list",autoheight:!0,data:[{name:"CSV",icon:"file-excel-o"},{name:"Excel",icon:"file-excel-o"},{name:"PDF",icon:"file-pdf-o"},{name:"PNG",icon:"file-image-o"}],template:"<div><i class='fa fa-#icon# webix_icon_btn' aria-hidden='true'></i> #name#</div>",on:{onItemClick:function(t){var i=this.getItem(t);e.export(i.name)}}}}}async init(e){e&&(this.AB=e),webix.ui(this.ui()),$$(this.ids.popupExport).resize()}dataCollectionLoad(e){this._dataCollection=e}objectLoad(e){this._currentObject=e}setHiddenFields(e=[]){this._hiddenFields=e??[]}setFilename(e){this._filename=e}setGridComponent(e){this._grid=e}show(e){$$(this.ids.popupExport).show(e)}async export(e){let t,i={},s=this._dataCollection,n=this._currentObject,a=this._grid,r=this._filename;!s||s.settings.loadAll&&s.dataStatus!=s.dataStatusFlag.notInitial||(await s.reloadData(0,null),s.settings.loadAll=!0),n&&n.fields().forEach((e=>{this._hiddenFields.indexOf(e.columnName)>-1||(i[e.columnName]={template:t=>e.format(t)})}));const o=a.data.find({appbuilder_select_item:1}).length<1,l=e=>o||1==e?.appbuilder_select_item;switch(e){case"CSV":webix.csv.delimiter.cols=",",t=webix.toCSV(a,{filename:r||(n?n.label:null),columns:i,filter:l});break;case"Excel":t=webix.toExcel(a,{filename:r||(n?n.label:null),name:r||(n?n.label:null),columns:i,filterHTML:!0,filter:l});break;case"PDF":t=webix.toPDF(a,{filename:r||(n?n.label:null),filterHTML:!0,filter:l});break;case"PNG":t=webix.toPNG(a,{filename:r||(n?n.label:null)})}try{await t,$$(this.ids.popupExport).hide()}catch(t){this.AB.notify.developer(t,{message:`ABViewGridPopupExport:export(): System could not export: ${e}`,exportType:e,columns:i,fileName:r})}}}var r=i(9234),o=null;class l extends n.Z{constructor(e,t){super({component:`${t=t||"abviewgridpopupMassUpdate"}_popupMassUpdate`,submit:`${t}_submitMassUpdate`}),this.CurrentObject=null,this.GridComponent=e,this.AB=e.AB,this.rowUpdater=new r.Z(t,this.AB),o||(o=(...e)=>this.AB.Multilingual.label(...e))}ui(){var e=this.ids;return{view:"popup",id:e.component,body:{width:500,rows:[this.rowUpdater.ui(),{height:15},{cols:[{},{view:"button",value:o("Cancel"),width:100,click:()=>{this.hide()}},{id:e.submit,css:"webix_primary",view:"button",label:o("Update"),type:"form",width:120,click:()=>{this.submit()}}]}]},on:{onShow:()=>{this.onShow()}}}}async init(e){return webix.ui(this.ui()),this.rowUpdater.init(e),Promise.resolve()}hide(){$$(this.ids.component).hide()}objectLoad(e,t){this.CurrentObject=e,this.rowUpdater.objectLoad(e),this.DataTable=t}onShow(){}show(e,t=null){null!=t?$$(this.ids.component).show(e,t):$$(this.ids.component).show(e)}submit(){let e=$$(this.ids.submit),t=this.rowUpdater.getValue()||[];if(e.disable(),!this.GridComponent)return void e.enable();if(t.length<1)return void e.enable();let i=this.GridComponent.getDataTable(),s=[];i.data.each((function(e){e&&e.hasOwnProperty("appbuilder_select_item")&&1==e.appbuilder_select_item&&s.push(e.id)}));let n={};t.forEach((e=>{let t=this.CurrentObject.fieldByID(e.fieldId);t&&(n[t.columnName]=e.value)})),s.length>0?webix.confirm({title:o("Updating Multiple Records"),text:o("Are you sure you want to update the selected records?"),callback:t=>{t?(i&&i.showProgress&&i.showProgress({type:"icon"}),this.CurrentObject.model().batchUpdate({rowIds:s,values:n}).then((()=>{(s??[]).forEach((e=>{i.updateItem(e,n)})),e.enable(),this.hide(),i&&i.hideProgress&&i.hideProgress()})).catch((e=>{this.AB.notify.developer(e,{context:"ABViewGridPopupMassUpdate:submit(): Error during batchUpdate",rowIds:s,values:n})}))):e.enable()}}):(webix.alert({title:o("No Records Selected"),text:o("You need to select at least one record...did you drink your coffee today?")}),e.enable(),this.hide())}}var c=i(83595);class u extends s.Z{constructor(e,t,i){super(e,t||`ABViewGrid_${e.id}`,Object.assign({table:"",toolbar:"",buttonDeleteSelected:"",buttonFilter:"",buttonMassUpdate:"",buttonSort:"",buttonExport:"",globalSearchToolbar:"",datatable:""},i)),this._handler_filterData=(e,t)=>{this.callbackFilterData(e,t)},this.handler_select=(...e)=>{this.selectRow(...e)},this.detatch(),e.filterHelper.on("filter.data",this._handler_filterData),this.id=e.id,this.columnSplitLeft=0,this.columnSplitRight=0,this.validationError=!1,this.linkPage=e.linkPageHelper.component();const s=this.ids.table,n=this.AB;this.PopupExport=new a(s),this.PopupExport.init(n),this.PopupMassUpdateComponent=new l(this,s),this.PopupMassUpdateComponent.init(n),this.PopupSortDataTableComponent=new c.Z(s),this.PopupSortDataTableComponent.init(n),this.PopupSortDataTableComponent.on("changed",(e=>{this.callbackSortData(e)})),this.skippableColumns=["appbuilder_select_item","appbuilder_view_detail","appbuilder_view_track","appbuilder_view_edit","appbuilder_trash"],this.ignoreLocalSettings=!1,this._gridSettings=null,this._isDatacollectionLoaded=!1}get keyStorageSettings(){return"abviewgrid_settings"}detatch(){this.view.filterHelper.removeAllListeners("filter.data"),["changeCursor","cursorStale","cursorSelect"].forEach((e=>{this.datacollection?.removeListener(e,this.handler_select)}))}getColumnIndex(e){let t=this.getDataTable().getColumnIndex(e);return this.settings.massUpdate||t++,t}uiDatatable(){const e=this.ids,t=this.settings,i=this;let s="datatable";(t.isTreeDatable||t.groupBy)&&(s="treetable");let n="cell";return t.isEditable||!t.detailsPage&&!t.editPage||(n="row"),{view:s,id:e.datatable,resizeColumn:{size:10},resizeRow:{size:10},prerender:!1,editable:t.isEditable,fixedRowHeight:!1,height:t.height||0,editaction:"custom",select:n,footer:t.summaryColumns.length>0||t.countColumns.length>0,tooltip:!0,dragColumn:!0,on:{onBeforeSelect:function(e,s){if(-1!=i.skippableColumns.indexOf(e.column))return!1;if(t.isEditable){const t=i.datacollection.datasource.fields((t=>t.columnName===e.column))[0];if(null==t)return!0;const s=this.getItemNode({row:e.row,column:e.column}),n=this.getItem(e.row);return t.customEdit(n,null,s)}return!(!t.detailsPage&&!t.editPage)&&void 0},onAfterSelect:(e,t)=>{this.settings.isEditable&&this.onAfterSelect(e,t)},onBeforeEditStart:function(e){if("appbuilder_select_item"==!this.getItem(e))return!1},onCheck:function(e,s,n){if("appbuilder_select_item"==s)i.toggleUpdateDelete();else if(t.isEditable){const t={value:n},a={row:e,column:s,config:null};i.onAfterEditStop(t,a)}else{this.getItemNode({row:e,column:s}).querySelector('input[type="checkbox"]').checked=1!=n}},onBeforeEditStop:function(e,t){},onAfterEditStop:(e,t,i)=>{0==this.validationError&&this.onAfterEditStop(e,t,i)},onValidationError:function(){this.validationError=!0},onValidationSuccess:function(){this.validationError=!1},onColumnResize:function(e,t,s,n){if(-1!=["appbuilder_view_detail","appbuilder_view_track","appbuilder_view_edit","appbuilder_trash"].indexOf(e)){this.blockEvent(),this.setColumnWidth(e,s),this.unblockEvent();const n=i.getLastColumn();e=n.id,(t=t<s?n.width+40:n.width-(t-40))<50&&(t=50),n.minWidth=t,this.setColumnWidth(e,t)}n&&i.onColumnResize(e,t,s,n)},onRowResize:e=>{},onBeforeColumnDrag:(e,t)=>!(-1!==this.skippableColumns.indexOf(e)),onBeforeColumnDrop:(e,t,i)=>!(-1!==this.skippableColumns.indexOf(t)),onAfterColumnDrop:(e,t,i)=>this.onAfterColumnDrop(e,t,i),onHeaderClick:(e,t,i)=>{this.onHeaderClick(e,t,i)}}}}uiFilter(){return this.view.filterHelper.ui()}uiToolbar(){const e=this.ids,t=this;return{view:"toolbar",id:e.toolbar,hidden:!0,css:"ab-data-toolbar",cols:[{view:"button",id:e.buttonMassUpdate,css:"webix_transparent",label:this.label("Edit"),icon:"fa fa-pencil-square-o",type:"icon",disabled:!0,autowidth:!0,click:function(){t.toolbarMassUpdate(this.$view)}},{view:"button",id:e.buttonDeleteSelected,css:"webix_transparent",label:this.label("Delete"),icon:"fa fa-trash",type:"icon",disabled:!0,autowidth:!0,click:function(){t.toolbarDeleteSelected(this.$view)}},{view:"button",id:e.buttonFilter,css:"webix_transparent",label:this.label("Filters"),icon:"fa fa-filter",type:"icon",autowidth:!0,click:function(){t.toolbarFilter(this.$view)}},{view:"button",id:e.buttonSort,css:"webix_transparent",label:this.label("Sort"),icon:"fa fa-sort",type:"icon",autowidth:!0,click:function(){t.toolbarSort(this.$view)}},{view:"button",id:e.buttonExport,css:"webix_transparent",label:this.label("Export"),icon:"fa fa-print",type:"icon",autowidth:!0,click:function(){t.toolbarExport(this.$view)}},{},{id:e.globalSearchToolbar,view:"search",placeholder:this.label("Search..."),on:{onTimedKeyPress:()=>{const t=$$(e.globalSearchToolbar).getValue();this.view.filterHelper.externalSearchText(t)}}}]}}ui(){const e={id:this.ids.table,type:"space",borderless:!0,rows:[{},{view:"label",label:this.label("Select an object to load."),inputWidth:200,align:"center"},{}]},t=this.settings;(this.datacollection||""!==t.dataviewID)&&(e.padding=t.padding,e.rows=[],t.showToolbar&&e.rows.push(this.uiToolbar()),this.settings.gridFilter.filterOption&&e.rows.push(this.uiFilter()),e.rows.push(this.uiDatatable()));const i=super.ui([e]);return delete i.type,i}async init(e,t=2){e&&await super.init(e);const i=this,s=this.ids,n=e.Webix;n.codebase="",n.cdn="/js/webix";const a=this.getDataTable();let r=null,o=null;if(!a)return;n.extend(a,n.ProgressBar),a.config.accessLevel=t,t<2&&a.define("editable",!1);const l=this.settings,c=e=>{const t=this.datacollection?.datasource;if(!t||!a.data)return;const i=[],s=a.getScrollState().y,n=a.config.rowHeight,r=(a.$view.querySelector(".webix_ss_body").clientHeight,Math.floor(s/n)),o=r+a.getVisibleCount();let c=0;a.data.order.each((e=>{null!=e&&r<=c&&c<=o&&i.push(e),c++}));let u=l.isEditable;a.config.accessLevel<2&&(u=!1),t.customDisplays(e,this.AB._App,a,i,u)};a.attachEvent("onAfterRender",(function(t){a.resize(),r&&clearTimeout(r),r=setTimeout((()=>{o&&clearTimeout(o),c(this.data)}),350),e.ClassUI.CYPRESS_REF(a),Object.keys(s).forEach((t=>{const i=$$(s[t]);i&&e.ClassUI.CYPRESS_REF(i)}))})),a.attachEvent("onScroll",(function(){o&&clearTimeout(o),r&&clearTimeout(r),o=setTimeout((()=>{c(this.data)}),1500)})),a.attachEvent("onAfterScroll",(function(){r&&clearTimeout(r),r=setTimeout((()=>{o&&clearTimeout(o),c(this.data)}),350)})),a.attachEvent("onItemClick",(function(e,t,s){const r=i.datacollection,o=r?.datasource;if(o)if(0===l.isEditable&&a.getItem(e),"auto"===t||t.target.className.indexOf("eye")>-1)i.changePage(r,e,l.detailsPage),i.toggleTab(l.detailsTab,this);else if(t.target.className.indexOf("pencil")>-1)i.changePage(r,e,l.editPage),i.toggleTab(l.editTab,this);else if(t.target.className.indexOf("track")>-1)i.emit("object.track",o,e.row);else if(t.target.className.indexOf("clear-combo-value")>-1){const t={};t[e.column]="",(async()=>{try{await o.model().update(e.row,t)}catch(t){i.AB.notify.developer(t,{context:"ABViewGridComponent.onItemClick",message:"Error updating item",obj:o.toObj(),id:e.row})}})()}else t.target.className.indexOf("trash")>-1?this._deleteConfirmPopup||(this._deleteConfirmPopup=n.confirm({title:i.label("Delete data"),text:i.label("Do you want to delete this row?"),callback:t=>(delete this._deleteConfirmPopup,t&&(async()=>{try{(await o.model().delete(e.row)).numRows>0?(a.remove(e),a.clearSelection()):n.alert({text:i.label("No rows were effected.  This does not seem right.")})}catch(t){i.AB.notify.developer(t,{context:"ABViewGridComponent.onItemClick",message:"Error deleting item",obj:o.toObj(),id:e.row})}})(),a.clearSelection(),!0)})):l.detailsPage.length?(i.changePage(r,e,l.detailsPage),i.toggleTab(l.detailsTab,this)):l.editPage.length&&(i.changePage(r,e,l.editPage),i.toggleTab(l.editTab,this))})),l.showToolbar&&((l.massUpdate||l.isSortable||l.isExportable||l.gridFilter&&l.gridFilter.filterOption&&"toolbar"===l.gridFilter.userFilterPosition)&&$$(s.toolbar).show(),l.massUpdate||($$(s.buttonMassUpdate).hide(),$$(s.buttonDeleteSelected).hide()),l.allowDelete||$$(s.buttonDeleteSelected).hide(),l.gridFilter&&(1===l.gridFilter.filterOption&&"toolbar"===l.gridFilter.userFilterPosition||$$(s.buttonFilter).hide(),3===l.gridFilter.filterOption&&"single"===l.gridFilter.globalFilterPosition&&a.hide(),l.gridFilter.isGlobalToolbar?$$(s.globalSearchToolbar).show():$$(s.globalSearchToolbar).hide(),l.gridFilter.filterOption&&this.view.filterHelper.init(this.AB)),l.isSortable||$$(s.buttonSort).hide(),l.isExportable||$$(s.buttonExport).hide()),l.hideHeader&&this.hideHeader();const u=this.datacollection||this.AB.datacollectionByID(l.dataviewID);this._isDatacollectionLoaded||this.datacollectionLoad(u),this._gridSettings=this._gridSettings||await this.AB.Storage.get(this.keyStorageSettings)||{},u?.datasource&&(this.linkPage.init({view:this.view,datacollection:u}),this.refreshHeader())}busy(){this.getDataTable()?.showProgress?.({type:"icon"})}callbackFilterData(e,t=[]){const i=this.ids,s=$$(i.buttonFilter);if(s){const e=this.view.filterHelper.filterRules();s.define("badge",e?.rules?.length??0),s.refresh()}const n=this.datacollection;n.filterCondition(t),n.reloadData()}async callbackSortData(e=[]){const t=$$(this.ids.buttonSort);t.define("badge",e.length||null),t.refresh();const i=this.getDataTable();if(i.data.find({}).length<i.data.count())try{await this.datacollection.reloadData(0,0)}catch(e){this.AB.notify.developer(e,{context:"ABViewGrid:callbackSortData(): Error perform datacollection.reloadData()"})}setTimeout((()=>{i.sort(((e,t)=>this.PopupSortDataTableComponent.sort(e,t)))}),777)}changePage(e,t,i){const s=t?.row??null;e&&e.setCursor(s),this.linkPage?this.linkPage.changePage(i,s):super.changePage(i)}columnConfig(e=[]){this.settings.columnConfig=e}datacollectionLoad(e){const t=this.datacollection;this.datacollection=e;const i=e?.datasource,s=this.getDataTable();s&&(this.__handler_dc_busy||(this.__handler_dc_busy=()=>{this.busy()},this.__handler_dc_ready=()=>{this.ready(),this.populateGroupData()},this.__handler_dc_loadData=()=>{this.populateGroupData()}),t&&(t.removeListener("initializingData",this.__handler_dc_busy),t.removeListener("initializedData",this.__handler_dc_ready),t.removeListener("loadData",this.__handler_dc_loadData)),e?(e.datacollectionLink&&e.fieldLink?e.bind(s,e.datacollectionLink,e.fieldLink):e.bind(s),e.removeListener("initializingData",this.__handler_dc_busy),e.on("initializingData",this.__handler_dc_busy),e.removeListener("initializedData",this.__handler_dc_ready),e.on("initializedData",this.__handler_dc_ready),e.removeListener("loadData",this.__handler_dc_loadData),e.on("loadData",this.__handler_dc_loadData),this.grouping(),this._isDatacollectionLoad=!0):s.unbind(),i&&(this.view.filterHelper.objectLoad(i),this.PopupMassUpdateComponent.objectLoad(i,this.getDataTable()),this.PopupSortDataTableComponent.objectLoad(i),this.PopupExport.objectLoad(i),this.PopupExport.dataCollectionLoad(e),this.PopupExport.setGridComponent(this.getDataTable()),this.PopupExport.setHiddenFields(this.settings.hiddenFields),this.PopupExport.setFilename(this.view.label)))}disableUpdateDelete(){$$(this.ids.buttonMassUpdate)?.disable(),$$(this.ids.buttonDeleteSelected)?.disable(),this.emit("selection.cleared")}enableUpdateDelete(){$$(this.ids.buttonMassUpdate)?.enable(),$$(this.ids.buttonDeleteSelected)?.enable(),this.emit("selection")}freezeDeleteColumn(){return this.getDataTable().define("rightSplit",this.columnSplitRight)}getDataTable(){return $$(this.ids.datatable)}getLastColumn(){const e=this.getDataTable();let t={};return e.eachColumn((i=>{const s=e.getColumnConfig(i);1===s.split&&(t=s)})),t}grouping(){if(!this.settings.groupBy)return;const e=this.getDataTable(),t={};this.datacollection.datasource.fields().forEach((e=>{switch(e.key){case"number":t[e.columnName]=[e.columnName,"sum"];break;case"calculate":case"formula":t[e.columnName]=[e.columnName,(t,i)=>{if(!i)return 0;let s=0;if(i.forEach((t=>{s+=1*e.format(t,!1,!0)})),e.fieldLink&&"calculate"!==e.fieldLink.key){const t={};return t[e.fieldLink.columnName]=s,e.fieldLink.format(t)}return s}];break;case"connectObject":t[e.columnName]=[e.columnName,(t,i)=>{if(!i||!i.length)return 0;let s=0;return i.forEach((t=>{const i=t[e.relationName()];i?.length?s+=i.length:i&&(s+=1)})),s}];break;default:t[e.columnName]=[e.columnName,function(e,t){if(!t||!t.length)return 0;let i=0;return t.forEach((t=>{e(t)&&(i+=1)})),i}]}}));let i=(this.settings.groupBy||"").split(",").map((e=>e.trim()));i=i.reverse(),i.forEach(((s,n)=>{const a=this.AB.cloneDeep(t);let r;n===i.length-1?r=s:(r=e=>{let t=e[s];for(let s=n+1;s<i.length;s++)t=`${e[i[s]]} - ${t}`;return t},i.forEach((e=>{e!==s&&(a[e]=[e])}))),e.data.group({by:r,map:a})}))}hideHeader(){const e=this.getDataTable();e.define("header",!1),e.refresh()}async onAfterColumnDrop(e,t,i){this.getDataTable(),this.datacollection.datasource;const s=this.settings,n=this.localSettings();let a=null,r=0;for(let t=0;t<n.length;t++)if(n[t].id==e){a=n[t],n.splice(t,1),r=t;break}for(let e=0;e<n.length;e++)if(n[e].id==t){r<=e&&e++,n.splice(e,0,a);break}this.localSettings(n),s.saveLocal&&this.localSettingsSave(),this.emit("column.order",n.map((e=>e.fieldID))),this.refreshHeader()}async onAfterEditStop(e,t,i){const s=this.getDataTable();if(!e.old&&""===e.value||""===e.old&&""===e.value)return s.clearSelection(),!1;if(t.config)switch(t.config.editor){case"number":e.value=parseFloat(e.value);break;case"datetime":e.value=e.value.getTime(),e&&e.old&&e.old.getTime&&(e.old=e.old.getTime())}if(e.value!==e.old){const i=s.getItem(t.row);i[t.column]=e.value,s.removeCellCss(i.id,t.column,"webix_invalid"),s.removeCellCss(i.id,t.column,"webix_invalid_cell");const n=this.datacollection.datasource,a=n.isValidData(i);if(a.pass()){const a=this.AB;try{await n.model().update(i.id,i),s.exists(t.row)&&(s.updateItem(t.row,i),s.clearSelection(),s.refresh(t.row))}catch(r){a.notify.developer(r,{context:"ABViewGrid:onAfterEditStop(): Error saving item",item:i,editor:t,state:e,object:n.toObj()}),s.clearSelection(),a.Validation.isGridValidationError(r,t.row,s)}}else a.updateGrid(t.row,s)}else s.clearSelection();return!1}onAfterSelect(e){this.getDataTable()?.editCell(e.row,e.column)}async onColumnResize(e,t,i,s){let n=!1;const a=this.AB;t<30&&(t=30,n=!0,a.Webix.message({type:"info",text:this.label("minimum column width is {0}",[30]),expire:1e3}));const r=this.localSettings();if(r){const i=r.find((t=>t.id==e));i&&(i.width=t,delete i.adjust)}this.localSettings(r),this.settings.saveLocal&&await this.localSettingsSave(),n&&this.refreshHeader(),this.freezeDeleteColumn(),this.emit("column.resize",e,t,i)}onHeaderClick(e,t,i){if(-1!==this.skippableColumns.indexOf(e.column))return!1;const s=this.datacollection.datasource.fields((t=>t.columnName===e.column))[0];return this.emit("column.header.clicked",i,s),!1}onShow(){super.onShow(),this.getDataTable()?.adjust();const e=this.datacollection;e&&["changeCursor","cursorStale","cursorSelect"].forEach((t=>{this.eventAdd({emitter:e,eventName:t,listener:this.handler_select.bind(this)})}))}ready(){const e=this.datacollection;this.isCustomGroup&&e?.dataStatus!=e?.dataStatusFlag.initialized||this.getDataTable()?.hideProgress?.()}refreshHeader(e=this.ignoreLocal){const t=this.datacollection.datasource;if(!t)return;const i=this.ids,s=$$(i.datatable);if(!s)return;const n=s.config.accessLevel;s.define("leftSplit",0),s.define("rightSplit",0);let a=0;t.imageFields().forEach((e=>{const t=e.getSettings();t.useHeight&&t.imageHeight>a&&(a=t.imageHeight)})),a&&s.define("rowHeight",a);const r=this.settings;let o=r.isEditable;s.config.accessLevel<2&&(o=!1);const l=t.columnHeaders(!0,o,[],[],[]);let c=this.localSettings();const u=this.AB;c&&!e||(c=u.cloneDeep(this.settings.columnConfig)),0===c.length&&(c=l);const d=l.map((e=>e.fieldID));c=c.filter((e=>d.indexOf(e.fieldID)>-1)),c.forEach((e=>{const i=l.find((t=>t.fieldID===e.fieldID));Object.keys(i).forEach((t=>{"function"!=typeof i[t]&&"suggest"!==t||(e[t]=i[t])}));const s=t.fieldByID(e.fieldID);s&&(r.hiddenFields.indexOf(s.columnName)>-1&&(e.hidden=!0),r.summaryColumns.indexOf(s.id)>-1?"calculate"==s.key||"formula"==s.key?e.footer={content:"totalColumn",field:s}:e.footer={content:"summColumn"}:r.countColumns.indexOf(s.id)>-1&&(e.footer={content:"countColumn"}))}));let h=this.localSettings();h&&!e||(this.localSettings(c),h=c),c=u.cloneDeep(h);const p=[],f=[];if(c.forEach((e=>{if(e.fillspace=!1,e.validationRules&&("string"==typeof e.validationRules&&(e.validationRules=JSON.parse(e.validationRules)),e.validationRules.length)){const t=[];e.validationRules.forEach((i=>{const s=u.filterComplexNew(e.id);t.push(s.ui),p.push({filter:s,view:s.ids.querybuilder,columnName:e.id,validationRules:i.rules,invalidMessage:i.invalidMessage})}));const s=i.rules+"_"+e.id;f.push(s),u.Webix.ui({view:"popup",css:"ab-rules-popup",id:s,body:{rows:t}})}if(r.groupBy&&(r.groupBy||"").indexOf(e.id)>-1){const i=t.fieldByID(e.fieldID);i&&(e.template=(e,t)=>{if(e.$group){const s=u.cloneDeep(e);return s[i.columnName]=s.value,t.treetable(e,t)+i.format(s)}return i.format(e)})}})),p.length){const e=[];p.forEach((i=>{i.filter.fieldsLoad(t.fields()),i.filter.setValue(i.validationRules),Array.isArray(e[i.columnName])||(e[i.columnName]=[]),e[i.columnName].push({filters:$$(i.view).getFilterHelper(),values:s.getSelectedItem(),invalidMessage:i.invalidMessage})}));const i={};s.$view.complexValidations=e,Object.keys(e).forEach((e=>{i[e]=(i,n)=>{let a=!0,r="";return s.$view.complexValidations[e].forEach((e=>{const i={};(t.fields()||[]).forEach((e=>{i[e.id]=n[e.columnName]})),n.uuid&&(i.this_object=n.uuid),e.filters(i)||(a=!1,r=e.invalidMessage)})),a||u.Webix.message({type:"error",text:r}),a}})),s.define("rules",i),s.config.rulePops=f,s.refresh()}else s.config.rulePops&&s.config.rulePops.forEach((e=>{$$(e)&&$$(e).destructor()})),s.define("rules",{}),s.refresh();const m=[];r.labelAsField&&(c.unshift({id:"appbuilder_label_field",header:"Label",fillspace:!0,template:e=>t.displayData(e)}),m.push("appbuilder_label_field")),r.massUpdate&&2===n?(c.unshift({id:"appbuilder_select_item",header:{content:"masterCheckbox",contentId:"mch"},width:40,template:"<div class='singleSelect'>{common.checkbox()}</div>",css:{"text-align":"center"}}),this.columnSplitLeft=1,m.push("appbuilder_select_item")):this.columnSplitLeft=0,""===r.detailsPage||r.hideButtons||(c.push({id:"appbuilder_view_detail",header:"",width:40,template:(e,t)=>"<div class='detailsView'><span class='webix_icon fa fa-eye'></span></div>",css:{"text-align":"center"}}),m.push("appbuilder_view_detail")),0!==r.trackView&&2===n&&(c.push({id:"appbuilder_view_track",header:"",width:40,template:"<div class='track'><span class='track fa fa-history'></span></div>",css:{"text-align":"center",cursor:"pointer"}}),m.push("appbuilder_view_track")),""===r.editPage||r.hideButtons||2!==n||(c.push({id:"appbuilder_view_edit",header:"",width:40,template:"<div class='edit'>{common.editIcon()}</div>",css:{"text-align":"center"}}),m.push("appbuilder_view_edit")),r.allowDelete&&2===n&&(c.push({id:"appbuilder_trash",header:"",width:40,template:"<div class='trash'>{common.trashIcon()}</div>",css:{"text-align":"center"}}),m.push("appbuilder_trash"));let g=null;for(let e=c.length-1;e>=0;e--)if(!g){const t=c[e];if(!t.hidden&&-1===m.indexOf(t.id)){g=t;break}}g&&(g.fillspace=!0,g.minWidth=g.width,g.width=150),s.refreshColumns(c),this.columnSplitRight=m.length,m.indexOf("appbuilder_select_item")>-1&&(this.columnSplitRight-=1),this.columnSplitRight<0&&(this.columnSplitRight=0);const b=r.frozenColumnID;""!=b?s.define("leftSplit",s.getColumnIndex(b)+1):s.define("leftSplit",this.columnSplitLeft),this.freezeDeleteColumn(),s.refreshColumns()}async localSettingsSave(){const e=this.AB,t=await e.Storage.get(this.keyStorageSettings)||{},i=this._gridSettings;t[this.settingsID()]=i[this.settingsID()]?i[this.settingsID()]:[];for(const e in t)t[e].forEach((e=>{e?.footer?.field&&delete e.footer.field}));await e.Storage.set(this.keyStorageSettings,t)}localSettings(e=null){const t=this._gridSettings;if(!e)return t[this.settingsID()];t[this.settingsID()]=e}selectRow(e){let t=e?.id??e;this.__timeout_selectRow&&(console.log("Duplicate selectRow():",t),clearTimeout(this.__timeout_selectRow)),this.__timeout_selectRow=setTimeout((()=>{const e=this.getDataTable();e&&(t?e.exists(t)?(e.select(t,!1),e.showItem(t)):e.select(null,!1):e.unselect(),this.__timeout_selectRow=null)}),15)}settingsID(){const e=this.datacollection.datasource;return`${this.id}-${e?e.id:"0"}`}toggleTab(e,t){const i=t.getTopParentView().queryView({id:e})||$$(e);if(!i)return;const s=i.getParentView().getParentView();if(!s)return;s.setValue&&s.setValue(e);const n=s.queryView({view:"scrollview"},"parent");n&&this.toggleTab(n,t)}toggleUpdateDelete(){const e=this.getDataTable();let t=0;e.data.each((e=>{void 0!==e&&Object.prototype.hasOwnProperty.call(e,"appbuilder_select_item")&&1===e.appbuilder_select_item&&t++})),t>0?this.enableUpdateDelete():this.disableUpdateDelete()}toolbarDeleteSelected(e){const t=this.getDataTable(),i=this.datacollection.datasource,s=[];t.data.each((e=>{void 0!==e&&Object.prototype.hasOwnProperty.call(e,"appbuilder_select_item")&&1===e.appbuilder_select_item&&s.push((()=>i.model().delete(e.id)))}));const n=this.AB.Webix;s.length>0?n.confirm({title:this.label("Delete Multiple Records"),text:this.label("Are you sure you want to delete the selected records?"),callback:async e=>{e&&(await Promise.all(s.map((e=>e()))),this.disableUpdateDelete())}}):n.alert({title:this.label("No Records Selected"),text:this.label("You need to select at least one record...did you drink your coffee today?")})}toolbarFilter(e){this.view.filterHelper.showPopup(e)}toolbarSort(e){this.PopupSortDataTableComponent.show(e)}toolbarExport(e){this.PopupExport.show(e)}toolbarMassUpdate(e){this.PopupMassUpdateComponent.show(e)}toolTip(e,t){const i=this.datacollection.datasource,s=i.imageFields().map((e=>e.columnName));let n="";const a=t.column.id.replace(" ","");if(Array.isArray(e[a]))e[a].forEach((function(e){e.text&&(n+=e.text+"<br/>")}));else if(void 0!==e[a+"__relation"]&&"number"==typeof e[a])n=e[a+"__relation"].text;else if(void 0!==e[a+"__relation"]){let t=e[a+"__relation"];Array.isArray(t)||(t=[t]),(t||[]).forEach((function(e){e&&(n+=e.text+"<br/>")}))}else if(-1!==s.indexOf(a)){if(!e[a])return"";n=`<img style='max-width: 500px; max-height: 500px;' src='/file/${e[a]}' />`}else"date"===t.column.editor?n=t.column.format(e[a]):"richselect"===t.column.editor?i.fields().forEach((t=>{t.columnName===a&&t.settings.options&&t.settings.options.forEach((t=>{t.id===e[a]&&(n=t.text)}))})):n=e[a];return n||""}toolTipOnBeforeRender(e){e.style.visibility="hidden"}toolTipOnAfterRender(e){"IMG"===e.firstChild?.nodeName?setTimeout((()=>{const t=parseInt(e.style.top.replace("px",""))+500,i=parseInt(e.style.left.replace("px",""))+500;if(t>window.innerHeight){const i=t-window.innerHeight,s=parseInt(e.style.top.replace("px",""))-i;e.style.top=s+"px"}if(i>window.innerWidth){const t=i-window.innerWidth,s=parseInt(e.style.left.replace("px",""))-t;e.style.left=s+"px"}e.style.visibility="visible"}),250):e.style.visibility="visible"}get isCustomGroup(){const e=this.datacollection?.datasource;return"treetable"===this.getDataTable()?.config?.view&&!e?.isGroup}populateGroupData(){if(!this.isCustomGroup)return;this.busy();const e=this.datacollection,t=this.getDataTable();t.clearAll(),t.parse(e.getData()||[]),this.grouping(),this.ready()}}var d=i(43348);const h=i(1063),p=i(25733).Z;class f extends h{fromValues(e){super.fromValues(e),this.filterHelper.fromSettings(this.settings.gridFilter)}propertyGroupByList(e,t){let i=t||[];"string"==typeof i&&(i=i.split(","));let s=$$(e.groupBy).getList().data.find({});$$(e.groupByList).clearAll(),i.forEach((t=>{let i=s.filter((e=>e.id==t))[0];i&&$$(e.groupByList).add(i)}))}component(){return new u(this)}get filterHelper(){return null==this.__filterHelper&&(this.__filterHelper=new d.Z(this.AB,`${this.id}_filterHelper`)),this.__filterHelper}get linkPageHelper(){return null==this.__linkPageHelper&&(this.__linkPageHelper=new p),this.__linkPageHelper}warningsEval(){super.warningsEval();let e=this.warningsSilent;this.warningsSilent=!0;let t=this.datacollection;this.warningsSilent=e,t||this.warningsMessage(`can't resolve it's datacollection[${this.settings.dataviewID}]`)}}},83595:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var s=i(32019),n=null;class a extends s.Z{constructor(e){super({component:`${e=e||"abviewgridpopupSortFields"}_popupSort`,list:`${e}_popupSort_list`,form:`${e}_popupSort_form`}),this.CurrentObject=null,this._blockOnChange=!1,this._settings=null,n||(n=(...e)=>this.AB.Multilingual.label(...e))}uiForm(){const e=this.ids.component;return{view:"form",id:this.ids.form,borderless:!0,elements:[{view:"button",type:"form",css:"webix_primary",value:n("Add new sort"),on:{onItemClick:()=>{this.clickAddNewSort(),this.triggerOnChange()},onAfterRender:function(){this.getInputNode().setAttribute("data-cy",`${e} add sort button`)}}}]}}ui(){return{view:"popup",id:this.ids.component,width:600,body:this.uiForm()}}async init(e){e&&(this.AB=e),$$(this.ids.component)||webix.ui(this.ui())}clickAddNewSort(e,t){var i=this,s=$$(this.ids.form),a=s.getChildViews().length-1,r=this.getFieldList(!0);s.addView({id:"sort"+webix.uid(),cols:[{view:"combo",width:220,options:r,on:{onChange:function(e){i.onChangeCombo(e,this)}}},{view:"segmented",width:200,options:[{id:"",value:n("Please select field")}],on:{onChange:()=>{this.triggerOnChange()}}},{view:"button",css:"webix_danger",icon:"fa fa-trash",type:"icon",width:30,on:{onItemClick:function(){s.removeView(this.getParentView()),i.refreshFieldList(!0),i.triggerOnChange()}}}]},a),e&&s.getChildViews()[a].getChildViews()[0].setValue(e),t&&s.getChildViews()[a].getChildViews()[1].setValue(t)}getFieldList(e){var t=$$(this.ids.form),i=[],s=this.CurrentObject.fields();if(0==s.length)return i;if(s.forEach((e=>{e.fieldIsSortable()&&i.push({id:e.id,value:e.label})})),e){var n=t.getChildViews();n.length>1&&n.forEach((function(e,t){if(n.length-1<=t)return!1;var s=e.getChildViews()[0].getValue();s&&(i=i.filter((e=>e.id!=s)))}))}return i}objectLoad(e){this.CurrentObject=e}setSettings(e){this._settings=this.AB.cloneDeep(e)}getSettings(){var e=$$(this.ids.form),t=[],i=e.getChildViews();return i.length>1&&i.forEach((function(e,s){if(i.length-1<=s)return!1;var n=e.getChildViews()[0].getValue(),a=e.getChildViews()[1].getValue();t.push({key:n,dir:a})})),t}onChangeCombo(e,t){var i,s=this.CurrentObject.fields(),a=t.getParentView().getChildViews()[1],r=null;if(i=s.find((t=>t.id==e))){switch(i.key){case"date":r=[{id:"asc",value:n("Before -> After")},{id:"desc",value:n("After -> Before")}];break;case"number":r=[{id:"asc",value:n("1 -> 9")},{id:"desc",value:n("9 -> 1")}];break;default:r=[{id:"asc",value:n("A -> Z")},{id:"desc",value:n("Z -> A")}]}a.define("options",r),a.refresh(),this.refreshFieldList(),this.triggerOnChange()}}onShow(e,t){var i=$$(this.ids.form);webix.ui(this.uiForm(),i);var s=this._settings;s&&s.forEach&&s.forEach((e=>{this.clickAddNewSort(e.key,e.dir)})),null!=s&&0!=s.length||this.clickAddNewSort(),$$(this.ids.component).show(e,t)}refreshFieldList(e){var t=$$(this.ids.form),i=this.getFieldList(!1),s=[],n=[],a=t.getChildViews();a.length>1&&a.forEach((function(e,t){if(a.length-1<=t)return!1;var r=e.getChildViews()[0].getValue(),o=i.find((e=>e.id==r));o?s.push(o):n.push(e)})),e||n.forEach((function(e){t.removeView(e)})),(a=t.getChildViews()).length>1&&a.forEach((function(e,t){if(a.length-1<=t)return!1;var n=e.getChildViews()[0].getValue(),r=i.filter((function(e){return e.id==n})),o=s.filter((function(e){return!Array.isArray(r)||-1===r.indexOf(e)})),l=i.filter((function(e){return!Array.isArray(o)||-1===o.indexOf(e)}));e.getChildViews()[0].define("options",l),e.getChildViews()[0].refresh()}))}triggerOnChange(){this._blockOnChange||(this._settings=this.getSettings(),this.emit("changed",this._settings))}blockOnChange(){this._blockOnChange=!0}unblockOnChange(){this._blockOnChange=!1}show(e,t,i){this.blockOnChange(),this.onShow(e,i||null),t&&this.clickAddNewSort(t),this.unblockOnChange()}sort(e,t){let i=0;const s=$$(this.ids.form).getChildViews();return s.length>1&&s.forEach(((n,a)=>{if(s.length-1<=a||0!=i)return;const r=n.getChildViews()[0].getValue(),o=n.getChildViews()[1].getValue(),l=this.CurrentObject.fieldByID(r);if(!l)return;const c=l.columnName;let u=e[c],d=t[c];Array.isArray(u)&&(u=(u||[]).map((function(e){return e.text||e})).join(" ")),Array.isArray(d)&&(d=(d??[]).map((e=>e.text||e)).join(" ")),u!=d&&(i="asc"==o?u>d?1:-1:u<d?1:-1)})),i}}},44998:(e,t,i)=>{const s=i(94606),n=i(58942);e.exports=class extends s{component(){return new n(this)}warningsEval(){super.warningsEval(),this.settings.filename||this.warningsMessage("has no image set")}}},13665:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>r});const s=i(42928),n=i(3893),a=i(25733).Z;class r extends s{component(){return new n(this)}get linkPageHelper(){return this.__linkPageHelper=this.__linkPageHelper||new a}warningsEval(){super.warningsEval(),this.datacollection||this.warningsMessage(`can't resolve it's datacollection[${this.settings.dataviewID}]`)}}},47304:(e,t,i)=>{const s=i(44363).Z,n=i(40194),a=i(44388);var r=null;e.exports=class extends s{constructor(e,t,i){super(t=t||`${e.view?.id}_formSidePanel`,{form:""}),r||(r=(...e)=>this.AB.Multilingual.label(...e)),this.AB=e.AB,this.CurrentObjectID=null,this.editFields=i,this._mockApp=this.AB.applicationNew({})}get CurrentObject(){return this.AB.objectByID(this.CurrentObjectID)}ui(){var e=this.ids;return{id:e.component,width:300,hidden:!0,rows:[{view:"toolbar",css:"webix_dark",cols:[{view:"label",label:r("Edit Record")},{view:"icon",icon:"wxi-close",align:"right",click:()=>{this.hide()}}]},{view:"scrollview",body:{rows:[{id:e.form,view:"form",borderless:!0,rows:[]}]}}]}}async init(e){this.AB=e}get CurrentObject(){return this.AB.objectByID(this.CurrentObjectID)}objectLoad(e){this.CurrentObjectID=e.id}hide(){$$(this.ids.component)?.hide(),this.emit("close")}show(e){$$(this.ids.component)?.show(),this.refreshForm(e)}isVisible(){return $$(this.ids.component)?.isVisible()??!1}refreshForm(e){var t=this.ids;let i=$$(t.form),s=this.CurrentObject;if(!s||!i)return;e=e||{};let r={id:`${this.ids.component}_sideform`,key:n.common().key,settings:{columns:1,labelPosition:"top",showLabel:1,clearOnLoad:0,clearOnSave:0,labelWidth:120,height:0}},o=this.AB.viewNewDetatched(r);o.objectLoad(s),s.fields().forEach(((e,t)=>{(!this.editFields||this.editFields.indexOf(e.id)>-1)&&o.addFieldToForm(e,t)})),o._views.push(new a({settings:{includeSave:!0,includeCancel:!1,includeReset:!1},position:{y:s.fields().length}},this._mockApp,o)),o._views.forEach(((e,t)=>e.id=`${o.id}_${e.key}_${t}`));let l=o.component(this.AB._App);webix.ui(l.ui().rows.concat({}),i),webix.extend(i,webix.ProgressBar),l.init(this.AB,2,{onBeforeSaveData:()=>{var e=o.getFormValues(i,s);return!!o.validateData(i,s,e)&&(i?.showProgress({type:"icon"}),e.id?s.model().update(e.id,e).then((e=>{this.emit("update",e),i?.hideProgress({type:"icon"})})).catch((t=>{this.AB.notify.developer(t,{context:"ABViewKanbanFormSidePanel:onBeforeSaveData():update(): Error updating value",formVals:e}),i?.hideProgress({type:"icon"})})):s.model().create(e).then((e=>{this.emit("add",e),i?.hideProgress({type:"icon"})})).catch((t=>{this.AB.notify.developer(t,{context:"ABViewKanbanFormSidePanel:onBeforeSaveData():.create(): Error creating value",formVals:e}),i?.hideProgress({type:"icon"})})),!1)}},2),i.clear(),i.parse(e),l.onShow(e)}}},47935:(e,t,i)=>{const s=i(29247),n=i(97922);e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s)}component(){return new n(this)}warningsEval(){super.warningsEval(),this.text||this.warningsMessage("has no text value set.")}}},90427:(e,t,i)=>{const s=i(79361),n=i(30909);e.exports=class extends s{component(){return new n(this)}warningsEval(){super.warningsEval(),0==this._views.length&&this.warningsMessage("has no columns set.")}}},94116:(e,t,i)=>{const s=i(17145),n=i(4030);e.exports=class extends s{component(){return new n(this)}warningsEval(){super.warningsEval(),this.datacollection||this.warningsMessage(`can't resolve it's datacollection[${this.settings.dataviewID}]`)}}},85342:(e,t,i)=>{const s=i(57888),n=i(46078);e.exports=class extends s{component(){return new n(this)}}},7617:(e,t,i)=>{const s=i(47497),n=i(90510);e.exports=class extends s{component(){return new n(this)}}},2983:(e,t,i)=>{const s=i(28326),n=s.defaultValues();e.exports=class extends s{component(e=!1){var t=super.component();if(t._ui=t.ui(),t.ui=()=>({view:"scrollview",borderless:!0,css:this.settings.pageBackground||n.pageBackground,body:t._ui}),e){var i=t;t={ui:t.ui(),init:(e,t)=>(t=t??this.getUserAccess(),i.init(this.AB,t,e)),onShow:(...e)=>i.onShow?.(...e)}}return t}warningsEval(){super.warningsEval(),0==this.views().length&&this.warningsMessage("has no sub views"),(this.pages()||[]).forEach((e=>{e.warningsEval()}))}}},40912:(e,t,i)=>{const s=i(89062),n=i(5740);e.exports=class extends s{constructor(e,t,i,s){super(e,t,i,s)}component(){return new n(this)}warningsEval(){super.warningsEval(),this.datacollection||this.warningsMessage(`can't resolve it's datacollection[${this.settings.dataviewID}]`)}}},25583:(e,t,i)=>{const s=i(78379),n=i(33188);e.exports=class extends s{component(){return new n(this)}}},68695:(e,t,i)=>{const s=i(47385),n=i(79608);e.exports=class extends s{component(){return new n(this)}warningsEval(){super.warningsEval()}}},69366:(e,t,i)=>{const s=i(39646),n=i(59724);e.exports=class extends s{component(e=!1){let t=new n(this);if(e){const e=t;t={ui:e.ui(),init:(t,i)=>e.init(this.AB),onShow:(...t)=>e.onShow?.(...t)}}return t}warningsEval(){super.warningsEval(),0==this.views().length&&this.warningsMessage("has no tabs set")}}},69330:(e,t,i)=>{const s=i(63527),n=i(97669);e.exports=class extends s{component(e){return new n(this,e)}}},4814:(e,t,i)=>{const s=i(8846);s.defaultValues(),e.exports=class extends s{component(e){let t=super.component(e);return t.onShow=e=>{let t=this.datacollection;t&&t.dataStatus==t.dataStatusFlag.notInitial&&t.loadData()},t}}},26822:(e,t,i)=>{const s=i(44363).Z;e.exports=class extends s{constructor(e,t,i){super(e,t||`ABCSVExporter_${e.id}`,Object.assign({button:"",buttonFilter:"",filterComplex:""},i)),this.clientFilter=null}ui(){const e=this.ids,t=this.settings,i=this.view.constructor.defaultValues(),s=super.ui([{view:"layout",type:"clean",borderless:!0,cols:[{id:e.buttonFilter,view:"button",css:"webix_transparent",type:"icon",icon:"fa fa-filter",borderless:!0,width:50,label:"",click:()=>{this.showFilterPopup()}},{id:e.button,view:"button",css:"webix_primary",type:"icon",icon:"fa fa-download",borderless:!0,width:t.width||i.width,label:t.buttonLabel??i.buttonLabel,click:()=>{this.downloadCsvFile()}},{fillspace:!0}]}]);return delete s.type,s}async init(e){if(await super.init(e),!this.clientFilter){const t=e.filterComplexNew(this.ids.filterComplex),i=this.datacollection;if(i){const e=i.datasource;t.fieldsLoad(e?.fields?.()??[])}t.init(),t.on("change",(e=>{this.onFilterChange(e)})),this.clientFilter=t}}downloadCsvFile(){let e=`/appbuilder/csv-export/${this.view.id}`;const t={glue:"and",rules:[]},i=this.view.settings?.where;(i?.rules??[]).length&&t.rules.push(i);const s=this.clientFilter.getValue();if((s?.rules??[]).length&&t.rules.push(s),(t?.rules||[]).length){let i=JSON.stringify(t);i=encodeURIComponent(i),e=`${e}?where=${i}`}window.open(e)}showFilterPopup(){const e=$$(this.ids.buttonFilter);this.clientFilter.popUp(e?e.$view:null)}onFilterChange(){const e=$$(this.ids.buttonFilter);if(!e)return;const t=this.clientFilter.getValue();e.define("badge",(t.rules||[]).length||null),e.refresh()}}},67090:(e,t,i)=>{const s=i(44363).Z,n=i(88708);e.exports=class extends s{constructor(e,t,i){super(e,t||`ABCSVImporter_${e.id}`,Object.assign({button:"",popup:"",form:"",uploader:"",uploadFileList:"",separatedBy:"",headerOnFirstLine:"",columnList:"",search:"",datatable:"",statusMessage:"",progressBar:"",linkedDataButton:"",importButton:"",rules:""},i)),this.csvImporter=new n(((...e)=>this.label(...e))),this.validationError=!1,this._dataRows=null,this._csvFileInfo=null}ui(){const e=this.settings,t=this.view.constructor.defaultValues(),i=super.ui([{cols:[{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-upload",label:this.label(e.buttonLabel||t.buttonLabel),width:e.width||t.width,click:()=>{this.showPopup()}},{fillspace:!0}]}]);return delete i.type,i}uiConfig(){const e=this.ids;return{id:e.form,view:"form",type:"clean",borderless:!0,minWidth:400,gravity:1,elements:[{rows:[{id:e.uploader,view:"uploader",name:"csvFile",css:"webix_primary",value:this.label("Choose a CSV file"),accept:"text/csv",multiple:!1,autosend:!1,link:e.uploadFileList,on:{onBeforeFileAdd:e=>(this._csvFileInfo=e,this.loadCsvFile())}},{id:e.uploadFileList,name:"uploadedFile",view:"list",type:"uploader",autoheight:!0,borderless:!0,onClick:{webix_remove_upload:(e,t)=>{this.removeCsvFile(t)}}},{padding:10,rows:[{id:e.separatedBy,view:"richselect",name:"separatedBy",label:this.label("Separated by"),labelWidth:140,options:this.csvImporter.getSeparateItems(),value:",",on:{onChange:()=>{this.loadCsvFile()}}},{id:e.headerOnFirstLine,view:"checkbox",name:"headerOnFirstLine",label:this.label("Header on first line"),labelWidth:140,disabled:!0,value:!0,on:{onChange:()=>{this.populateColumnList()}}}]},{type:"space",rows:[{view:"scrollview",minHeight:300,body:{padding:10,id:e.columnList,rows:[]}}]}]}]}}uiRecordsView(){const e=this.ids;return{gravity:2,rows:[{view:"toolbar",css:"bg_gray",cols:[{width:5},{id:e.search,view:"search",value:"",label:"",placeholder:this.label("Search records..."),keyPressTimeout:200,on:{onTimedKeyPress:()=>{this.search($$(e.search).getValue())}}},{width:2}]},{id:e.datatable,view:"datatable",resizeColumn:!0,editable:!0,editaction:"dblclick",css:"ab-csv-importer",borderless:!1,tooltip:e=>e._errorMsg?e._errorMsg:"No validation errors",minWidth:650,columns:[],on:{onValidationError:(t,i,s)=>{let n="";Object.keys(s).forEach((e=>{this.$view.complexValidations[e].forEach((e=>{n+=e.invalidMessage+"</br>"}))}));const a=$$(e.datatable);a.blockEvent(),a.updateItem(t,{_status:"invalid",_errorMsg:n}),a.unblockEvent(),this.validationError=!0},onValidationSuccess:(t,i,s)=>{const n=$$(e.datatable);n.blockEvent(),n.updateItem(t,{_status:"valid",_errorMsg:""}),n.unblockEvent(),this.validationError=!1},onCheck:()=>{const t=$$(e.datatable).find({_included:!0}),i=$$(e.importButton);i.setValue(this.labelImport(t)),this.overLimitAlert(t)?i.disable():i.enable()}}},{id:e.progressBar,height:6},{cols:[{id:e.linkedDataButton,view:"button",label:this.label("Linked Data"),type:"icon",icon:"fa fa-info",maxWidth:180,click:()=>{this.showLinkedData()}},{view:"button",name:"import",id:e.importButton,label:this.label("Import"),css:"webix_primary",disabled:!0,type:"icon",icon:"fa fa-upload",click:()=>{this.import()}}]}]}}uiPopup(){const e=this.ids;return{id:e.popup,view:"window",hidden:!0,position:"center",modal:!0,resize:!0,head:{view:"toolbar",css:"webix_dark",cols:[{},{view:"label",label:this.label("CSV Importer"),autowidth:!0},{},{view:"button",width:35,css:"webix_transparent",type:"icon",icon:"nomargin fa fa-times",click:()=>{this.hide()}}]},body:{type:"form",rows:[{type:"line",cols:[this.uiConfig(),{width:20},this.uiRecordsView(),{width:1}]},{id:e.statusMessage,view:"label",align:"right",hidden:!0},{hidden:!0,margin:5,cols:[{fillspace:!0},{view:"button",name:"cancel",value:this.label("Cancel"),css:"ab-cancel-button",autowidth:!0,click:()=>{this.hide()}}]}]}}}async init(e){await super.init(e);const t=this.ids,i=this.datacollection;i&&this.objectLoad(i.datasource);const s=e.Webix;s.ui(this.uiPopup());const n=$$(t.form);n&&s.extend(n,s.ProgressBar);const a=$$(t.progressBar);a&&s.extend(a,s.ProgressBar)}showPopup(){const e=this.ids;$$(e.popup)?.show(),this.formClear(),$$(e.uploader).fileDialog()}hide(){$$(this.ids.popup)?.hide()}formClear(){const e=this.ids;this._dataRows=null,this._csvFileInfo=null;const t=$$(e.form);t.clearValidation(),t.clear(),$$(e.separatedBy).setValue(","),this.AB.Webix.ui([],$$(e.columnList)),$$(e.headerOnFirstLine).disable(),$$(e.importButton).disable(),$$(e.search).setValue(""),$$(e.uploadFileList).clearAll(),$$(e.datatable).clearAll();const i=$$(e.statusMessage);i.setValue(""),i.hide()}search(e){const t=$$(this.ids.datatable);if(!t)return;e=(e||"").toLowerCase();const i=this.getMatchFields();t.filter((t=>{let s=!1;return(i||[]).forEach((i=>{s||(s=(t[`${i.columnIndex}`]||"").toString().toLowerCase().indexOf(e)>-1)})),s}))}statusTemplate(e){let t="";if(!e)return t;switch(e._status){case"in-progress":t="<span class='fa fa-refresh'></span>";break;case"invalid":t="<span class='fa fa-exclamation-triangle'></span>";break;case"valid":case"done":t="<span class='fa fa-check'></span>";break;case"fail":t="<span class='fa fa-remove'></span>"}return t}async loadCsvFile(){const e=this._csvFileInfo;if(!e)return!1;const t=this.csvImporter;if(!t.validateFile(e))return this.AB.Webix.alert({title:this.label("This file extension is not allowed"),text:this.label("Please only upload CSV files"),ok:this.label("Ok")}),!1;const i=this.ids,s=$$(i.form);s?.showProgress?.({type:"icon"});const n=$$(i.headerOnFirstLine),a=$$(i.importButton);n.enable(),a.enable(),this._dataRows=await t.getDataRows(e,$$(i.separatedBy).getValue());const r=this._dataRows;let o=r.length;return n.getValue()&&(o=r.length-1),a.setValue(this.labelImport(o)),this.populateColumnList(),s?.hideProgress?.(),!0}removeCsvFile(e){return $$(this.ids.uploadFileList).remove(e),this.formClear(),!0}populateColumnList(){const e=this,t=this.ids,i=this.AB.Webix,s=$$(t.columnList);i.ui([],s);const n=this._dataRows;if(!n)return;const a=n[0];if(!a)return;const r=[],o=[],l=this.CurrentObject;l&&o.push(...l.fields((e=>{if(this.settings.availableFieldIds?.length&&this.settings.availableFieldIds.indexOf(e.id)<0)return!1;const t=e.formComponent();if(!t)return!0;const i=t.common();return!i||"fieldreadonly"!=i.key})));const c=this.csvImporter;$$(t.headerOnFirstLine).getValue()?r.push(...a.map(((e,t)=>({id:t+1,value:e,key:c.getGuessDataType(n,t)})))):a.forEach(((e,t)=>{r.push({id:t+1,value:this.label("Column {0}",[t+1]),key:c.getGuessDataType(n,t)})})),r.unshift({id:"none",value:this.label("None")});const u=[],d=[];o.forEach((t=>{const i=r.filter((e=>e.key==t.key&&d.indexOf(e.id)<0))[0];let s="none";i&&(s=i.id,d.push(s));let n={view:"richselect",gravity:2,options:r,fieldId:t.id,abName:"columnIndex",value:s,on:{onChange:function(){e.toggleLinkFields(this),e.loadDataToGrid()}}};if("date"===t.key){const e=["/","-",".",","," "],t=[{value:this.label("1 to 31"),id:"D"},{value:this.label("01 to 31"),id:"DD"}],i=[{value:this.label("1 to 12"),id:"M"},{value:this.label("01 to 12"),id:"MM"}],s=[{value:this.label("00 to 99"),id:"YY"},{value:this.label("2000 to 2099"),id:"YYYY"}],a=[{value:this.label("D-M-Y"),id:1},{value:this.label("M-D-Y"),id:2},{value:this.label("Y-M-D"),id:3},{value:this.label("Y-D-M"),id:4}];n={gravity:2,rows:[n,{view:"richselect",label:this.label("Separator"),labelWidth:100,on:{onChange:()=>{this.loadDataToGrid()}},name:"separator",abName:"columnDateFormat",options:e,value:"/"},{view:"richselect",label:this.label("Day"),labelWidth:100,on:{onChange:()=>{this.loadDataToGrid()}},name:"day",abName:"columnDateFormat",options:t,value:"D"},{view:"richselect",label:this.label("Month"),labelWidth:100,on:{onChange:()=>{this.loadDataToGrid()}},name:"month",abName:"columnDateFormat",options:i,value:"M"},{view:"richselect",label:this.label("Year"),labelWidth:100,on:{onChange:()=>{this.loadDataToGrid()}},name:"year",abName:"columnDateFormat",options:s,value:"YY"},{view:"richselect",label:this.label("Order"),labelWidth:100,on:{onChange:()=>{this.loadDataToGrid()}},name:"order",abName:"columnDateFormat",options:a,value:1}]}}if(t.isConnection){let e=[];t.datasourceLink&&(e=t.datasourceLink.fields((e=>!e.isConnection)).map((e=>({id:e.id,value:e.label})))),n={gravity:2,rows:[n,{view:"richselect",label:"=",labelWidth:20,abName:"columnLinkData",hidden:!0,options:e,value:e[0]?e[0].id:null}]}}u.push({view:"layout",borderless:!0,cols:[{view:"template",gravity:1,borderless:!0,css:{"padding-top":10},template:`<span class="fa fa-${t.icon}"></span> ${t.label}`},n]})})),i.ui(u,s),this.loadDataToGrid()}toggleLinkFields(e){if(!e)return;const t=e.getParentView().queryView({abName:"columnLinkData"},"all")[0];t&&("none"===e.getValue()?t.hide():t.show())}overLimitAlert(e){return e.length>1e3&&(this.AB.Webix.alert({title:this.label("Too many records"),ok:this.label("Ok"),text:this.label("Due to browser limitations we only allow imports of {0} records. Please upload a new CSV or deselect records to import.",[1e3])}),!0)}loadDataToGrid(){const e=this.ids,t=$$(e.datatable),i=this.AB;if(!t)return;t.clearAll(),t.showProgress?.({type:"icon"});const s=this.getMatchFields(),n=[];n.push({id:"_status",header:"",template:this.statusTemplate,width:30}),n.push({id:"_included",header:{content:"masterCheckbox"},template:"{common.checkbox()}",width:30});const a=[],r=[];if((s||[]).forEach((t=>{let s=t.field.settings.validationRules;if(s&&"string"==typeof s&&(s=JSON.parse(s)),s?.length){const n=[];s.forEach((e=>{const s=i.filterComplexNew(`${t.field.id}_${i.Webix.uid()}`);n.push(s.ui),a.push({filter:s,view:s.ids.querybuilder,columnName:t.field.id,validationRules:e.rules,invalidMessage:e.invalidMessage,columnIndex:t.columnIndex})}));const o=`${e.rules}_${t.field.id}_${i.Webix.uid()}`;r.push(o),i.Webix.ui({view:"popup",css:"ab-rules-popup",id:o,body:{rows:n}})}const o="number"==t.field?.key?"number":"text";n.push({id:t.columnIndex,header:t.field.label,editor:o,template:(e,t,i)=>i.replace(/[<]/g,"&lt;"),minWidth:150,fillspace:!0})})),a.length){const e=[];a.forEach((i=>{i.filter.fieldsLoad(this.CurrentObject.fields()),i.filter.setValue(i.validationRules),Array.isArray(e[i.columnName])||(e[i.columnName]=[]),e[i.columnName].push({filters:$$(i.view).getFilterHelper(),values:t.getSelectedItem(),invalidMessage:i.invalidMessage,columnIndex:i.columnIndex})}));const i={};t.$view.complexValidations=e,Object.keys(e).forEach((e=>{i[e]=(i,n)=>{let a=!0;return t.$view.complexValidations[e].forEach((e=>{const t={};(s||[]).forEach((e=>{const i=n[e.columnIndex];"date"===e.field.key&&i.includes("Invalid date")&&(a=!1),t[e.field.id]=i})),e.filters(t)||(a=!1)})),a}})),t.define("rules",i),t.config.rulePops=r,t.refresh()}else t.config.rulePops&&t.config.rulePops.forEach((e=>{const t=$$(e);t&&t.destructor()})),t.define("rules",{}),t.refresh();const o=[];(this._dataRows||[]).forEach(((e,t)=>{const n={id:t+1};(s||[]).forEach((t=>{const s=e[t.columnIndex-1];if("date"===t.field.key){let e=i.rules.toDate(s,{format:t.format});e=i.rules.toDateFormat(e,{format:"YYYY-MM-DD"}),"Invalid date"===e&&(e=e+" - "+s),n[t.columnIndex]=e}else n[t.columnIndex]=s})),n._included=!0,o.push(n)})),$$(e.headerOnFirstLine).getValue()&&o.length>1&&o.shift();const l=$$(e.importButton);l.setValue(this.labelImport(o)),t.refreshColumns(n),t.parse(o),this.overLimitAlert(o)?l.disable():l.enable(),t.hideProgress?.()}refreshRemainingTimeText(e,t,i){const s=this.ids,n=(new Date-e)/i*(t-i);let a="";const r=(n/864e5).toFixed(0),o=(n/36e5).toFixed(0),l=(n/6e4).toFixed(0),c=(n/1e3).toFixed(0);if(a=c<1?"":c<60?this.label("Approximately {0} second(s) remaining",[c]):1==l?this.label("Approximately 1 minute {0} seconds remaining",[c-60]):l<60?this.label("Approximately {0} minutes remaining",[l]):o<24?this.label("Approximately {0} hour(s) remaining",[o]):this.label("Approximately {0} day(s) remaining",[r]),a)$$(s.importButton)?.setValue(a);else{const e=$$(s.datatable)?.find({_included:!0});$$(s.importButton)?.setValue(this.labelImport(e))}}getMatchFields(){const e=[],t=this.ids;return($$(t.columnList).queryView({abName:"columnIndex"},"all").filter((e=>"none"!=e.getValue()))||[]).forEach((t=>{const i=this.CurrentObject;if(!i)return;const s=i.fieldByID(t.config.fieldId);if(!s)return;const n={columnIndex:t.getValue(),field:s};if("date"===s.key){const e=t.getParentView().queryView({abName:"columnDateFormat"},"all");if(e){let t;switch(e.forEach((e=>{n[e.config.name]=e.getValue()})),n.order){case"1":t=n.day+n.separator+n.month+n.separator+n.year;break;case"2":t=n.month+n.separator+n.day+n.separator+n.year;break;case"3":t=n.year+n.separator+n.month+n.separator+n.day;break;case"4":t=n.year+n.separator+n.day+n.separator+n.month}n.format=t}}if(s.isConnection){const e=t.getParentView().queryView({abName:"columnLinkData"},"all")[0];if(e){const t=s.datasourceLink.fieldByID(e.getValue());n.searchField=t}}e.push(n)})),e}labelImport(e){let t=e;return Array.isArray(e)&&(t=e.length),this.label("Import {0} Records",[t])}async import(){const e=this.CurrentObject;if(!e)return;const t=this.ids,i=$$(t.importButton);i.disable();const s=$$(t.form),n=$$(t.progressBar);s.showProgress({type:"icon"}),n.showProgress({type:"top",position:1e-4});const a=this.getMatchFields(),r=e.model(),o=$$(t.datatable),l=o.find({_included:!0});let c=0;const u=()=>{c+=1,n.showProgress({type:"bottom",position:c/l.length})},d=(e,t)=>{o&&(o.addRowCss(e,"row-fail"),o.blockEvent(),o.updateItem(e,{_status:"fail",_errorMsg:t}),o.unblockEvent()),u(),console.error(t)},h=this.AB.Webix,p=(e,t=[])=>{if(o){const i=[];t.forEach((e=>{e?.name&&(a.filter((t=>t.field&&t.field.columnName==e.name))[0],i.push(e.name+": "+e.message))})),o.blockEvent(),o.updateItem(e,{_status:"invalid",_errorMsg:i.join("</br>")}),o.unblockEvent(),o.addRowCss(e,"webix_invalid")}},f=$$(t.statusMessage),m=()=>{i.enable(),s.hideProgress(),n.hideProgress(),f.setValue(""),f.hide();const e=o.find({_included:!0});i.setValue(this.labelImport(e)),this.emit("done")},g=[];let b=!0;if((l||[]).forEach(((t,i)=>{const s=this.getParentValues();a.forEach((e=>{if(e.field?.key)switch(e.field.key){case"number":if("number"!=typeof t[e.columnIndex]){s[e.field.columnName]=(t[e.columnIndex]||"").replace(/[^-0-9.]/gi,"");break}s[e.field.columnName]=t[e.columnIndex];break;default:s[e.field.columnName]=t[e.columnIndex]}}));let n=!1,r="";const l=e.isValidData(s);var c;n=l.pass(),r=l.errors,n?n=o.validate(t.id):(b=!1,p(t.id,r)),n?(c=t.id,o&&(o.removeRowCss(c,"webix_invalid"),o.blockEvent(),o.updateItem(c,{_status:"",_errorMsg:""}),o.unblockEvent()),g.push({id:t.id,data:s})):b=!1})),!b)return m(),void h.alert({title:this.label("Invalid Data"),ok:this.label("Ok"),text:this.label("The highlighted row has invalid data. Please edit in the window or update the CSV and try again.")});const v={},w=a.filter((e=>e&&e.field?.isConnection&&e.searchField));let y,_=0;try{const e=[];if((w||[]).forEach((t=>{const i=t.field,s=i.datasourceLink;if(!s)return;const n=s.model();if(!n)return;const a=i.indexField?i.indexField.columnName:i.object.PK();v[i.id]={},e.push((async()=>{try{const e=await n.findAll({where:{},populate:!1});(e.data||e||[]).forEach((e=>{v[i.id][e[t.searchField.columnName]]=e[a]}))}catch(e){console.error(e)}})())})),await Promise.all(e),g.forEach((e=>{const t=e.data;o.blockEvent(),o.updateItem(e.id,{_status:"in-progress",_errorMsg:""}),o.unblockEvent(),(w||[]).forEach((i=>{const s=i.field,n=s.indexField?s.indexField.columnName:s.object.PK(),a=v[s.id][t[s.columnName]];a||(p(e.id,[{name:s.columnName}]),b=!1),t[s.columnName]={},t[s.columnName][n]=a}))})),!b)return h.alert({title:this.label("Invalid Data"),ok:this.label("Ok"),text:this.label("The highlighted row has invalid data. Please edit in the window or update the CSV and try again.")}),void m();const t=[],s=(e,t,s,n)=>new Promise(((a,r)=>{s.doRecordRulesPre(t),(async()=>{try{const l=await e.batchCreate({batch:t}),c=l.errors;Object.keys(c).forEach((e=>{const t=c[e];t&&d(e,t.message||t.sqlMessage||t)}));const h=l.data,p=[];Object.keys(h).forEach((e=>{p.push(new Promise(((t,i)=>{(async()=>{try{await s.doRecordRules(h[e]),n=e,o&&(o.removeRowCss(n,"row-fail"),o.addRowCss(n,"row-pass"),o.blockEvent(),o.updateItem(n,{_status:"done",_errorMsg:""}),o.unblockEvent()),u(),t()}catch(t){d(e,t),i("that didn't work")}var n})()})))}));const f=async()=>{try{await Promise.all(p),t.forEach((e=>{_++,_%10==0&&this.refreshRemainingTimeText(y,g.length,_)})),_===n&&(m(),i.disable()),a()}catch(e){r(e)}};await f()}catch(e){console.error(e),r(e)}})()}));g.forEach((e=>{t.push({id:e.id,data:e.data})}));const n=[],a=t.length;let l=0;for(;t.length;)n[l]=t.splice(0,10),l++;const c=(e,t,i,n)=>new Promise(((a,o)=>{(async()=>{try{await s(r,e,i,n);const o=t.shift();o?.length?await c(o,t,i,n):a()}catch(e){o(e)}})()}));y=new Date;const f=n.shift();await c(f,n,this.view,a)}catch(e){h.alert({title:this.label("Error Creating Records"),ok:this.label("Ok"),text:this.label("One or more records failed upon creation.")}),m(),console.error(e)}}uiLinkedData(){const e=this.datacollection?.datacollectionLink,t=e?.getCursor();if(t)return{view:"window",modal:!0,resize:!1,head:{view:"toolbar",cols:[{},{view:"button",width:35,css:"webix_transparent",type:"icon",icon:"nomargin fa fa-times",click:()=>{this.hideLinkedData()}}]},body:{view:"property",id:"sets",editable:!1,width:400,height:200,elements:[{label:this.label("Linked Data"),type:"label"},{label:"ID",type:"text",value:t.uuid??t.id},{label:"Label",type:"text",value:e.datasource.displayData(t)}]}}}showLinkedData(){const e=this.uiLinkedData();this._info_popup=this.AB.Webix.ui(e),this._info_popup.show($$(this.ids.linkedDataButton).$view,{pos:"top"})}hideLinkedData(){this._info_popup?.hide()}getParentValues(){const e={},t=this.datacollection,i=this.CurrentObject,s=t?.datacollectionLink,n=[];let a,r;return s?.getCursor()&&(a=s.datasource,n.push(...i.fields((e=>e.isConnection&&e.settings.linkObject===a.id))),r=s.getCursor()),a&&n.length&&r&&n.forEach((t=>{const i=t.indexField?t.indexField.columnName:a.PK();e[t.columnName]=e[t.columnName]??{},e[t.columnName][i]=r[i]??r.id})),e}}},80651:(e,t,i)=>{const s=i(71233);e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewChartArea_${e.id}`,i)}ui(){const e=this.settings;return super.ui({view:"chart",type:e.areaType,yAxis:{start:0,step:e.stepValue,end:e.maxValue},xAxis:{template:e.isLegend?`<div style='font-size:${e.labelFontSize}px;'>#label#</div>`:""},legend:e.isLegend?{template:`<div style='font-size:${e.labelFontSize}px;'>#label#</div>`,values:[]}:null,series:[{alpha:.7,value:"#value#",color:"#ee4339"},{alpha:.4,value:"#value2#",color:"#a7ee70"}],height:e.chartHeight})}async init(e){await super.init(e)}onShow(){super.onShow()}}},87139:(e,t,i)=>{const s=i(71233);e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewChartBar_${e.id}`,i)}ui(){const e=this.settings;return super.ui({view:"chart",type:e.barType,preset:e.barPreset,value:"#value#",color:"#color#",yAxis:{start:0,step:e.stepValue,end:e.maxValue},xAxis:{template:e.isLegend?`<div style='font-size:${e.labelFontSize}px;'>#label#</div>`:""},legend:"bar"!==e.barType&&e.barType?e.isLegend?{template:`<div style='font-size:${e.labelFontSize}px;'>#label#</div>`,values:[]}:null:e.isLegend?`<div style='font-size:${e.labelFontSize}px;'>#label#</div>`:"",height:e.height})}async init(e){await super.init(e)}onShow(){super.onShow()}}},26869:(e,t,i)=>{const s=i(91219);e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewChart_${e.id}`,i)}async init(e,t){await super.init(e,t);const i=$$(this.ids.component),s=this.AB.Webix;i&&s.extend(i,s.ProgressBar);const n=this.view,a=this.datacollection;if(a){const e=["changeCursor","cursorStale","create","update","delete","initializedData"];["changeCursor","cursorStale"].forEach((e=>{a.datacollectionLink&&!(e in(a.datacollectionLink._events??[]))&&n.eventAdd({emitter:a.datacollectionLink,eventName:e,listener:()=>{n.refreshData()}})})),e.forEach((e=>{n.eventAdd({emitter:a,eventName:e,listener:()=>{n.refreshData()}})}))}n.refreshData()}onShow(){super.onShow()}}},71233:(e,t,i)=>{const s=i(44363).Z;e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewChartContainer_${e.id}`,Object.assign({chartContainer:""},i))}ui(e){const t=super.ui([Object.assign({id:this.ids.chartContainer},e??{})]);return delete t.type,t}async init(e){await super.init(e)}onShow(){super.onShow();const e=this.view;e._isShow=!0,this.refreshData(e.parent.getDCChart())}refreshData(e){const t=$$(this.ids.chartContainer),i=$$(this.ids.component);t?.data&&t.data.sync(e),setTimeout((()=>{i?.adjust(),t?.adjust()}),160)}}},52564:(e,t,i)=>{const s=i(71233);e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewChartLine_${e.id}`,i)}ui(){const e=this.settings;return super.ui({view:"chart",type:e.lineType,preset:e.linePreset,value:"#value#",color:"#color#",yAxis:{start:0,step:e.stepValue,end:e.maxValue},xAxis:{template:e.isLegend?`<div style='font-size:${e.labelFontSize}px;'>#label#</div>`:""},legend:e.isLegend?{template:`<div style='font-size:${e.labelFontSize}px;'>#label#</div>`,values:[]}:null,height:e.chartHeight})}}},48370:(e,t,i)=>{const s=i(71233);e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewChartPie_${e.id}`,i)}ui(){const e=this.settings;return super.ui({view:"chart",type:e.pieType,value:"#value#",color:"#color#",legend:e.isLegend?{width:this.view.parent.settings.labelWidth,template:`<div style='font-size: ${e.labelFontSize}px;'>#label#</div>`}:null,pieInnerText:`<div style='font-size: ${e.innerFontSize}px;'>#value#</div>`,shadow:1,height:e.height})}}},29405:(e,t,i)=>{const s=i(44363).Z;e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewComment_${e.id}`,Object.assign({comment:""},i))}ui(){const e=this.view,t=super.ui([{id:this.ids.comment,view:"comments",users:e.getUserData(),currentUser:e.getCurrentUserId(),height:this.settings.height,data:this.getCommentData(),on:{onBeforeAdd:(e,t,i)=>{this.addComment(t.text,new Date)},onAfterDelete:e=>{this.deleteComment(e)}}}]);return delete t.type,t}async init(e){await super.init(e);const t=this.view;t.__dvEvents=t.__dvEvents||{};const i=this.ids,s=$$(i.comment);if(s){const e=s.queryView({view:"list"});e&&(t.__dvEvents.onStoreUpdated||(t.__dvEvents.onStoreUpdated=e.data.attachEvent("onStoreUpdated",((e,t,i)=>{"update"===i&&this.updateComment(e,(t||{}).text)}))),webix.extend(e,webix.ProgressBar))}const n=this.datacollection;n&&(t.__dvEvents.create||(t.__dvEvents.create=n.on("create",(()=>this.refreshComment()))),t.__dvEvents.update||(t.__dvEvents.update=n.on("update",(()=>this.refreshComment()))),t.__dvEvents.delete||(t.__dvEvents.delete=n.on("delete",(()=>this.refreshComment()))),t.__dvEvents.loadData||(t.__dvEvents.loadData=n.on("loadData",(()=>this.refreshComment()))),s.refresh())}getCommentData(){const e=this.view,t=this.datacollection;if(!t)return null;const i=e.getUserField(),s=e.getCommentField(),n=e.getDateField();if(!i||!s)return null;const a=i.columnName,r=s.columnName,o=n?n.columnName:null,l=t.getData(),c=[];return l.forEach(((t,i)=>{if(t[r]){const i=e.getUserData().find((e=>e.value===t[a])),s={id:t.id,user_id:i?i.id:0,date:t[o]?new Date(t[o]):null,default_date:new Date(t.created_at),text:t[r]};c.push(s)}})),c.sort((function(e,t){return o?new Date(e.date).getTime()-new Date(t.date).getTime():new Date(e.default_date).getTime()-new Date(t.default_date).getTime()})),c}refreshComment(){const e=this.view;e.__refreshTimeout&&clearTimeout(e.__refreshTimeout),this.busy();const t=this.ids;e.__refreshTimeout=setTimeout((()=>{const i=$$(t.comment);if(!i)return;const s=i.queryView({view:"list"});s&&s.clearAll();const n=this.getCommentData();n&&i.parse(n),s&&s.scrollTo(0,Number.MAX_SAFE_INTEGER),delete e.__refreshTimeout,this.ready()}),90)}addComment(e,t){this.saveData(e,t)}async updateComment(e,t){const i=this.view,s=i.model();if(!s)return;const n=i.getCommentField();if(!n)return;const a={};return a[n.columnName]=t??"",await s.update(e,a)}async deleteComment(e){const t=this.view.model();if(t)return await t.delete(e)}busy(){const e=this.ids,t=$$(e.comment);if(!t)return;const i=t.queryView({view:"list"});i&&(i.disable(),i.showProgress&&i.showProgress({type:"icon"}))}ready(){const e=this.ids,t=$$(e.comment);if(!t)return;const i=t.queryView({view:"list"});i&&(i.enable(),i.hideProgress&&i.hideProgress())}async saveData(e,t){if(!e)return;const i=this.datacollection;if(!i)return;const s=this.view,n=s.model(),a=this.AB;if(!n)return void a.notify.builder({},{message:"ABViewComment.saveData(): could not pull a model to work with.",viewName:s.label});const r={},o=s.getUserField();o&&(r[o.columnName]=a.Account.username());const l=s.getCommentField();l&&(r[l.columnName]=e);const c=s.getDateField();c&&(r[c.columnName]=t);const u=i.datacollectionLink;if(u?.getCursor()){const e=u.datasource,t=i.fieldLink;e&&t&&(r[t.columnName]={},r[t.columnName][e.PK()]=u.getCursor().id)}return await n.create(r)}}},44363:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});var s=i(32019);class n extends s.Z{constructor(e,t,i){super(t||`ABView_${e.id}`,i),this.view=e,this.settings=e.settings,this.AB=e.AB,this.datacollection=e.datacollections||e.datacollection,this.__events=[],this.CurrentObjectID=null,this.CurrentDatacollectionID=null}get CurrentObject(){return this.AB.objectByID(this.CurrentObjectID)}get CurrentDatacollection(){return this.AB.datacollectionByID(this.CurrentDatacollectionID)}ui(e=[]){const t={id:this.ids.component,view:"layout",type:"space",rows:e};return t.rows.length||(t.height=30),t}async init(e){this.AB=e}datacollectionLoad(e){this.CurrentDatacollectionID=e?.id}objectLoad(e){this.CurrentObjectID=e?.id}eventAdd(e){if(!e||!e.emitter||!e.listener)return;const t=this.__events;t.filter((t=>t.emitter===e.emitter&&t.eventName===e.eventName)).length||(t.push({emitter:e.emitter,eventName:e.eventName,listener:e.listener}),e.emitter.on(e.eventName,e.listener))}eventsClear(){this.__events.forEach((e=>{e.emitter.removeListener(e.eventName,e.listener)})),this.__events=[]}async waitInitializingDCEvery(e,t){if(this.__isShowing&&null!=t)return t.dataStatus===t.dataStatusFlag.notInitial&&await t.loadData(),await new Promise((i=>{if(t.dataStatus===t.dataStatusFlag.initialized)return void i();const s=setInterval((()=>{t.dataStatus===t.dataStatusFlag.initialized&&(clearInterval(s),i())}),e)}))}onShow(){if(this?.view?.settings?.hintID){let e=this.AB.hintID(this.view.settings.hintID);e.settings.active&&e.createHintUI()}const e=this.datacollection;e&&e.dataStatus===e.dataStatusFlag.notInitial&&e.loadData()}}},54112:(e,t,i)=>{const s=i(91219);e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewConditionalContainer_${e.id}`,Object.assign({batch:""},i)),this._ifComponent=null,this._elseComponent=null,this.__filterComponent=e.AB.filterComplexNew(`${e.id}_filterComponent`),this.populateFilterComponent()}ui(){const e={id:this.ids.batch,view:"multiview",cells:[{batch:"wait",view:"layout",rows:[{view:"label",label:this.label("Please wait...")}]}]},t=super.ui([e]);return e.cells.push(Object.assign({batch:"if"},this.ifComponent.ui()),Object.assign({batch:"else"},this.elseComponent.ui())),delete t.type,t}async init(e,t){await super.init(e,t),await Promise.all([this.ifComponent.init(e,t),this.elseComponent.init(e,t)]),this.populateFilterComponent();const i=this.datacollection;if(i){const e=this.view;e.eventAdd({emitter:i,eventName:"loadData",listener:()=>this.displayView()}),e.eventAdd({emitter:i,eventName:"initializedData",listener:()=>this.displayView()}),["changeCursor","cursorStale"].forEach((t=>{e.eventAdd({emitter:i,eventName:t,listener:(...e)=>this.displayView(...e)})}))}this.displayView()}onShow(){super.onShow(),this.populateFilterComponent(),this.displayView()}get ifComponent(){return this._ifComponent=this._ifComponent||this.view.views().find((e=>"If"===e?.name)).component()}get elseComponent(){return this._elseComponent=this._elseComponent||this.view.views().find((e=>"Else"===e?.name)).component()}displayView(e){const t=this.datacollection,i=this.ids,s=$$(i.batch);!t||(e||(e=t.getCursor()),e||t.dataStatus!==t.dataStatusFlag.notInitial&&t.dataStatus!==t.dataStatusFlag.initializing)?this.__filterComponent.isValid(e)?(s?.showBatch("if"),this.ifComponent?.onShow?.()):(s?.showBatch("else"),this.elseComponent?.onShow?.()):s?.showBatch("wait")}populateFilterComponent(){const e=this.datacollection,t=this.__filterComponent;e?.datasource?t.fieldsLoad(e.datasource.fields()):t.fieldsLoad([]),t.setValue(this.settings.filterConditions??this.view.constructor.defaultValues().filterConditions)}}},91219:(e,t,i)=>{const s=i(44363).Z;e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewContainer_${e.id}`,i),this.idBase=t,this.options=null,this.viewComponents={},this.viewComponentIDs={},this._handlerChangePage=t=>{e.changePage(t)}}ui(e){const t=this.view.viewsSortByPosition(),i=this.getElements(t),s=super.ui(e||i);return delete s.type,s}async init(e,t=0,i={}){await super.init(e),this.options=i;const s=[];$$(this.ids.component)?.define("css",`accessLevel-${t}`);const n=this.viewComponents;for(const a in n)(!n[a]??!this.view.views((e=>e.id===a)).length)||(t?s.push(n[a].init(e,t,i)):$$(this.viewComponentIDs[a])?.hide());await Promise.all(s)}getElements(e){const t=[],i={};let s,n;const a=this.settings,r=this.view.constructor.defaultValues();return e.forEach((e=>{let o;try{o=e.component(this.idBase),e.removeAllListeners("changePage")}catch(t){o=e.component(this.idBase);const i=o.ui;o.ui=(()=>i).bind(o)}if(this.viewComponents[e.id]=o,null==e.position.y||e.position.y!==s){s=e.position.y||t.length,n=0;const i={cols:[]},o=a.columns||r.columns;for(let e=0;e<o;e++)i.cols.push({gravity:a.gravity?.[e]?parseInt(a.gravity[e]):r.gravity});t.push(i)}const l=t.length-1,c=t[l],u=e.position.x??0,d=`${l}-${u}`;let h=1;i[d]&&console.error(`Component[${o?.ids?.component}] is overwriting component[${i[d].ids?.component}]. <-- Reorder them to fix.`),i[d]=o,c.cols[u]?.gravity&&(h=c.cols[u].gravity);const p=o.ui();this.viewComponentIDs[e.id]=p.id,p.gravity=h,c.cols[u]=p,this.eventAdd({emitter:e,eventName:"changePage",listener:this._handlerChangePage}),n++})),t}onShow(){super.onShow(),Object.values(this.viewComponents).forEach((e=>{e.onShow?.()}))}}},93349:(e,t,i)=>{const s=i(44363).Z,n=i(97346),a=i(25733).Z;e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewDataview_${e.id}`,Object.assign({dataview:""},i)),this.linkPage=null}ui(){this.initDetailComponent();const e=this.ids;return super.ui([{id:e.dataview,view:"dataview",scroll:"y",sizeToContent:!0,css:"borderless transparent",xCount:this.settings.xCount,template:e=>this.itemTemplate(e),on:{onAfterRender:()=>{this.applyClickEvent(),this.addCyAttribute()}}}])}async init(e){await super.init(e);const t=this.datacollection;if(!t)return;this.linkPage=this.linkPageHelper.component(),this.linkPage.init({view:this.view,datacollection:t});const i=this.ids,s=$$(i.dataview);e.Webix.extend(s,e.Webix.ProgressBar),t.bind(s),window.addEventListener("resize",(()=>{clearTimeout(this._resizeEvent),this._resizeEvent=setTimeout((()=>{this.resize(s.getParentView()),delete this._resizeEvent}),20)}))}onShow(){super.onShow(),this.resize()}resize(e){const t=$$(this.ids.dataview);t.resize();const i=this.getItemWidth(e);t.customize({width:i}),t.getTopParentView?.().resize?.()}initDetailComponent(){const e=this.getDetailUI();this._detail_ui=this.AB.Webix.ui(e),this.detailComponent.init(null,2)}getDetailUI(){const e=this.detailComponent,t=this.settings.editPage,i=this.settings.detailsPage,s=e.ui();return s.type="clean",s.css="ab-detail-view",(i||t)&&(s.css+=" ab-detail-hover ab-record-#itemId#",i&&(s.css+=" ab-detail-page"),t&&(s.css+=" ab-edit-page")),s}itemTemplate(e){const t=this.detailComponent,i=$$(this.ids.dataview),s=this._detail_ui;e&&Object.keys(e).length||(e=e??{},this.datacollection?.datasource?.fields().forEach((t=>{switch(t.key){case"string":case"LongText":e[t.columnName]="Lorem Ipsum";break;case"date":case"datetime":e[t.columnName]=new Date;break;case"number":e[t.columnName]=7}}))),t.displayData(e);const n=i.data.count()>0?i.type.width:(s.$width-20)/this.settings.xCount,a=i.data.count()>0?i.type.height:s.getChildViews()?.[0]?.$height,r=document.createElement("div");return r.appendChild(s.$view),s.define("width",n-24),s.define("height",a+15),s.adjust(),this.addCyItemAttributes(r,e),r.innerHTML.replace(/#itemId#/g,e.id)}getItemWidth(e){const t=$$(this.ids.dataview);let i=e??t,s=i?.$width;for(;i;)"scrollview"!=i.config.view&&"layout"!=i.config.view||(s=i?.$width<s?i?.$width:s),i=i?.getParentView?.();if(s||(s=t?.getParentView?.().$width||window.innerWidth),s>window.innerWidth&&(s=window.innerWidth),window.innerWidth-19<=s){const e=this.getTabSidebar();e&&(s-=e.$width)}return Math.floor(s/this.settings.xCount)}getTabSidebar(){let e,t=$$(this.ids.dataview);for(;t&&!e;)e=(t.getChildViews?.()??[]).filter((e=>"sidebar"==e?.config?.view))[0],t=t?.getParentView?.();return e}applyClickEvent(){const e=this.settings.editPage,t=this.settings.detailsPage;if(!t&&!e)return;const i=$$(this.ids.dataview);i&&(i.$view.onclick=i=>{let s=!1,n=i.path??[];if(n.length||(n.push(i.target),n.push(i.target.parentNode)),e)for(let t of n)if(t.className&&t.className.indexOf("webix_accordionitem_header")>-1){s=!0,t.parentNode.parentNode.classList.forEach((t=>{if(t.indexOf("ab-record-")>-1){const i=t.replace("ab-record-","");this.linkPage.changePage(e,i)}}));break}if(t&&!s)for(let e of n)if(e.className&&e.className.indexOf("webix_accordionitem")>-1){e.parentNode.parentNode.classList.forEach((e=>{if(e.indexOf("ab-record-")>-1){const i=e.replace("ab-record-","");this.linkPage.changePage(t,i)}}));break}})}addCyAttribute(){const e=this.view,t=$$(this.ids.dataview),i=(e.name??"").replace(".dataview","");t.$view.setAttribute("data-cy",`dataview container ${i} ${e.id}`)}addCyItemAttributes(e,t){const i=this.view,s=t.uuid,n=(i.name??"").replace(".dataview","");e.querySelector(".webix_accordionitem_body")?.setAttribute("data-cy",`dataview item ${n} ${s} ${i.id}`),e.querySelector(".webix_accordionitem_button")?.setAttribute("data-cy",`dataview item button ${n} ${s} ${i.id}`)}get detailComponent(){return this._detailComponent=this._detailComponent??new n(this.view,`${this.ids.component}_detail_view`)}get linkPageHelper(){return this.__linkPageHelper=this.__linkPageHelper||new a}}},78781:(e,t,i)=>{const s=i(57076);e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewDetailCheckbox_${e.id}`,i)}ui(){const e=this.view,t=e.field();return super.ui({on:{onAfterRender:()=>{const i=`detail checkbox ${t?.columnName} ${t?.id} ${e.parentDetailComponent()?.id??e.parent.id}`;$$(this.ids.detailItem)?.$view.setAttribute("data-cy",i)}}})}setValue(e){let t="";t=e&&JSON.parse(e)?'<span class="check webix_icon fa fa-check-square-o"></span>':'<span class="check webix_icon fa fa-square-o"></span>',super.setValue(t)}}},97346:(e,t,i)=>{i(76500);const s=i(91219);e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewDetail_${e.id}`,i),this.idBase=t}ui(){return{type:"form",borderless:!0,rows:[{body:super.ui()}]}}onShow(){const e=this.view;try{const t=`Detail ${e.name?.split(".")[0]} ${e.id}`;$$(this.ids.component).$view.setAttribute("data-cy",t)}catch(e){console.warn("Problem setting data-cy",e)}const t=this.datacollection;if(t){const e=t.getCursor();e&&this.displayData(e),["changeCursor","cursorStale"].forEach((e=>{this.eventAdd({emitter:t,eventName:e,listener:(...e)=>this.displayData(...e)})})),this.eventAdd({emitter:t,eventName:"create",listener:e=>{t.getCursor()?.id===e.id&&this.displayData(e)}}),this.eventAdd({emitter:t,eventName:"update",listener:e=>{t.getCursor()?.id===e.id&&this.displayData(e)}})}super.onShow()}displayData(e={}){(this.view.views()||[]).sort(((e,t)=>e?.field?.()&&t?.field?.()?"formula"===e.field().key&&"calculate"===t.field().key?-1:"calculate"===e.field().key&&"formula"===t.field().key?1:0:0)).forEach((t=>{let i;if(t.field){const s=t.field();if(!s)return;switch(s.key){case"connectObject":case"user":i=s.pullRelationValues(e);break;case"list":if(i=e?.[s.columnName],!i){i="";break}if(0===s.settings.isMultiple){let e="";if(s.settings.options.forEach((t=>{t.id===i&&(e=t.text)})),s.settings.hasColors){let t="#66666",i="";s.settings.options.forEach((s=>{s.text===e&&(t=s.hex,i="hascustomcolor")})),e=`<span class="webix_multicombo_value ${i}" style="background-color: ${t} !important;"><span>${e}</span></span>`}i=e}else{const e=[];let t="";i.forEach((i=>{let n="",a="";s.settings.hasColors&&i.hex&&(n="hascustomcolor",a=`background: ${i.hex};`),s.settings.options.forEach((e=>{e.id===i.id&&(t=e.text)})),e.push(`<span class="webix_multicombo_value ${n}" style="${a}" optvalue="${i.id}"><span>${t}</span></span>`)})),i=e.join("")}break;case"file":if(i=e?.[s.columnName],!i){i="";break}break;case"formula":if(e){const t=!1;i=s.format(e,t)}break;default:i=s.format(e)}}const s=t.component(this.idBase);s?.setValue?.(i),s?.displayText?.(e)}))}}},84704:(e,t,i)=>{const s=i(57076);e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewDetailConnect_${e.id}`,i)}ui(){const e=this.view,t=this.settings;return super.ui({on:{onAfterRender:()=>{const i=`detail connected ${e.field((e=>e.id===t.fieldId))?.columnName??""} ${t.fieldId} ${e.parentDetailComponent()?.id||e.parent.id}`;$$(this.ids.detailItem)?.$view.setAttribute("data-cy",i)}}})}setValue(e){const t=[];Array.isArray(e)?e.forEach((e=>{t.push(`<span class="webix_multicombo_value">${e.text}</span>`)})):t.push(`<span class="webix_multicombo_value">${e.text}</span>`),super.setValue(t.join(""))}}},99484:(e,t,i)=>{const s=i(57076);e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewDetailCustom_${e.id}`,i)}ui(){const e=this.view,t=e.field();e.detailComponent();let i=t?t.columnHeader().template({}):"";return super.ui({minHeight:45,height:60,template:i,on:{onAfterRender:()=>{const i=`detail custom ${t?.columnName} ${t?.id} ${e.parentDetailComponent()?.id||e.parent.id}`;$$(this.ids.detailItem)?.$view.setAttribute("data-cy",i)}}})}onShow(){super.onShow;const e=this.view,t=e.field();if(!t)return;const i=$$(this.ids.detailItem);if(!i)return;const s=e.detailComponent().datacollection.getCursor()||{},n=i.$view;t.customDisplay(s,null,n,{editable:!1}),n.getElementsByClassName("webix_template")[1].removeAttribute("class")}setValue(e){const t=this.view.field();if(!t)return;const i=$$(this.ids.detailItem);if(!i)return;const s={};s[t.columnName]=e,t.setValue(i,s)}}},28805:(e,t,i)=>{const s=i(57076);e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewDetailImage_${e.id}`,i)}ui(){const e=this.view,t=e.field(),i={on:{onAfterRender:()=>{const i=`detail image ${t?.columnName} ${t?.id} ${e.parentDetailComponent()?.id||e.parent.id}`;$$(this.ids.detailItem)?.$view.setAttribute("data-cy",i)}}},s=this.settings;return s.height&&(i.height=s.height),super.ui(i)}setValue(e){const t=this.view.field();if(!t)return void super.setValue("");const i=e||t.settings.defaultImageUrl;if(!i)return void super.setValue("");const s=t.urlImage(i),n=this.settings,a=['<div class="ab-image-data-field">',`<div style="float: left; background-size: cover; background-position: center center; background-image:url('${s}');  width: ${n.width||t.settings.imageWidth||200}px; height: ${n.height?`${n.height}px`:t.settings.imageHeight?`${t.settings.imageHeight}px`:"100%"}; position:relative;">`,`<a href="${s}" target="_blank" title="" class="fa fa-download ab-image-data-field-download"></a>`,"</div></div>"].join("");super.setValue(a)}}},57076:(e,t,i)=>{const s=i(44363).Z,n=["abbr","acronym","b","blockquote","br","code","div","em","i","li","ol","p","span","strong","table","td","tr","ul","h1","h2","h3","h4","h5"];e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewDetailItem_${e.id}`,Object.assign({detailItem:"",detailItemLabel:""},i))}ui(e={}){const t=this.view,i=t.detailComponent()?.settings??{},s=t.field(),n="top"==i.labelPosition,a=[];if(i.showLabel){const e=n?"<label style='display:block; text-align: left; line-height: 32px;' class='webix_inp_top_label'>#label#</label>":"<label style='display: inline-block; float: left; line-height: 32px; width:#width#px;'>#label#</label>",t={id:this.ids.detailItemLabel,view:"template",borderless:!0,height:38,template:e,data:{label:s?.label??""}};n||(t.width=i.labelWidth+24),a.push(t)}let r;1===s?.settings?.useHeight&&(r=parseInt(s.settings.imageHeight)||r);const o=Object.assign({id:this.ids.detailItem,view:"template",borderless:!0,autowidth:!0,height:r,isUsers:"user"===s?.key,template:n?"<div style='min-height: 38px'>#display#</div>":"<div class='ab-detail-component-holder'>#display#</div>",data:{display:""}},e);o.height&&0!=o.height||(delete o.height,o.autoheight=!0),a.push(o);const l={};"top"==i.labelPosition?l.rows=a:l.cols=a;const c=super.ui([l]);return delete c.type,c}setValue(e,t){const i=$$(t??this.ids.detailItem);if(i)switch(this.view.field()?.key){case"string":case"LongText":const t=e.replace(/[<]/gm,"&lt;").replace(new RegExp(`(&lt;(/)?(${n.join("|")}))`,"gm"),"<$2$3");i.setValues({display:t});break;default:i.setValues({display:e})}}}},53676:(e,t,i)=>{const s=i(57076);e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewDetailText_${e.id}`,i)}ui(){const e=this.view.field(),t={css:"ab-text",on:{onAfterRender:()=>{const t=`detail text ${e?.columnName} ${e?.id} ${this.view.parentDetailComponent()?.id||this.view.parent.id}`;$$(this.ids.component)?.$view.setAttribute("data-cy",t)}}},i=this.settings;return i.height&&(t.height=i.height),super.ui(t)}}},72666:(e,t,i)=>{const s=i(57076);e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewDetailTree_${e.id}`,i)}get className(){return"ab-detail-tree"}async init(e){await super.init(e),this.setValue(`<div class="${this.className}"></div>`)}getDomTree(){const e=$$(this.ids.detailItem);if(e)return e.$view.getElementsByClassName(this.className)[0]}setValue(e){const t=[];e&&!Array.isArray(e)&&t.push(e),setTimeout((()=>{const e=this.getDomTree();if(!e)return!1;const i=this.view.field(),s=[];void 0===i.settings.options.data&&(i.settings.options=new this.AB.Webix.TreeCollection({data:i.settings.options})),i.settings.options.data.each((function(e){if(-1!==t.indexOf(e.id)){let t="",n=e.id;for(;this.getParentId(n);)i.settings.options.data.each((function(e){i.settings.options.data.getParentId(n)===e.id&&(t=`${e.text}: ${t}`)})),n=this.getParentId(n);t+=e.text,s.push(t)}}));let n="<div class='list-data-values'>";s.forEach((function(e){n+=`<span class="selectivity-multiple-selected-item rendered" style="background-color: #4CAF50 !important;">${e}</span>`})),n+="</div>",e.innerHTML=n;let a=33;e.scrollHeight>33&&(a=e.scrollHeight);const r=$$(this.ids.detailItem);r.config.height=a,r.resize()}),50)}}},19454:(module,__unused_webpack_exports,__webpack_require__)=>{const Docxtemplater=__webpack_require__(11824),ImageModule=__webpack_require__(11619),JSZipUtils=__webpack_require__(63075),JSZip=__webpack_require__(58296),ABFieldConnect=__webpack_require__(89981),ABFieldImage=__webpack_require__(15884),ABObjectQuery=__webpack_require__(76500),ABViewComponent=__webpack_require__(44363).Z;module.exports=class ABViewDocxBuilderComponent extends ABViewComponent{constructor(e,t,i){super(e,t||`ABViewDocxBuilder_${e.id}`,Object.assign({downloadButton:"",noFileLabel:""},i))}ui(){const e=this.view,t=this.settings,i=e.constructor.defaultValues();let s=!1;0===(t.width??i.width)&&(s=!0);let n={type:"spacer",width:1},a={type:"spacer",width:1};switch(t.buttonPosition??i.buttonPosition){case"left":break;case"center":n={type:"spacer"},a={type:"spacer"};break;case"right":n={type:"spacer"}}const r=e.buttonlabel||t.buttonlabel||i.buttonlabel,o=this.ids,l=super.ui([{view:"toolbar",css:t.toolbarBackground??i.toolbarBackground,cols:[n,{id:o.downloadButton,view:"button",css:"webix_primary",type:"icon",icon:"fa fa-file-word-o",label:r,width:t.width||i.width,autowidth:s,click:()=>{this.renderFile()},on:{onAfterRender:()=>{const t=e.name?.replace(".docxBuilder",""),i=`docx download ${t} ${e.id}`;$$(o.downloadButton)?.$view.querySelector("button").setAttribute("data-cy",i)}}},{id:o.noFileLabel,view:"label",label:this.label("No template file")},{type:"spacer"},a]}]);return delete l.type,l}async init(e){await super.init(e);const t=this.ids,i=$$(t.downloadButton),s=$$(t.noFileLabel);this.view.settings.filename?(i.show(),s.hide()):(i.hide(),s.show())}async onShow(){super.onShow;const e=[];this.view.datacollections.forEach((t=>{t.dataStatus===t.dataStatusFlag.notInitial&&e.push(t.loadData())})),e.length>0&&this.busy(),await Promise.all(e),this.ready()}busy(){const e=$$(this.ids.downloadButton);e&&(e.disable(),e.define("icon","fa fa-refresh fa-spin"),e.refresh())}ready(){const e=$$(this.ids.downloadButton);e&&(e.enable(),e.define("icon","fa fa-file-word-o"),e.refresh())}async renderFile(){this.busy();const e=this.getReportData(),t=await this.downloadImages(),i=await this.downloadTemplateFile(),s=this.generateDocxFile(i,e,t),n=this.view;n.letUserDownload(s,n.filelabel),this.ready()}getReportData(){const e={},t=this.view.datacollections,i=t.length>1;return t.filter((e=>e?.datasource)).forEach((async t=>{const s=t.datasource,n=s.model(),a=t.getCursor(),r=[];let o={};o=a?{glue:"and",rules:[{key:s.PK(),rule:"equals",value:a[s.PK()]}]}:this.AB.merge(o,t.settings?.objectWorkspace?.filterConditions??{});const l=(await n.findAll({disableMinifyRelation:!0,populate:!0,skip:0,where:o})).data,c=s.multilingualFields();l.forEach((e=>{let t;s.fields().forEach((i=>{const n=[];s instanceof ABObjectQuery?("string"==typeof i.object.translations&&(i.object.translations=JSON.parse(i.object.translations)),"string"==typeof i.translations&&(i.translations=JSON.parse(i.translations)),(i.object.translations||[]).forEach((e=>{const t=(i.translations||[]).filter((t=>t.language_code===e.language_code))[0];if(!t)return;const s=e.label,a=t.label;n.push(`${s}.${a}`)}))):"string"==typeof i.translations&&(i.translations=JSON.parse(i.translations)),i.translations.forEach((e=>{n.push(e.label)})),t=Object.assign(t??{},this.setReportValues(e,i,n,c)??{}),t._object=s})),r.push(t)}));const u=r.length>1?r:r[0];i||Array.isArray(u)&&u.length>1?(t.translations||[]).forEach((t=>{e[t.label]=u})):Object.assign(e,u)})),e}setReportValues(e,t,i=[],s){const n={};let a=null;n.id=e.id,n[`${t.columnName}_ORIGIN`]=e[t.columnName];const r=this.view;if(s.length){const t=(s||[]).filter((t=>null!=e[t]));r.translate(e,e,t,r.languageCode)}return t instanceof ABFieldConnect?(a=e[t.columnName],a?.forEach&&a.forEach((e=>{e&&"string"!=typeof e&&(t.datasourceLink&&t.datasourceLink.fields((e=>!e.isConnection)).forEach((t=>{e[`${t.columnName}_ORIGIN`]=e[t.columnName],e[t.columnName]=t.format(e,{languageCode:r.languageCode})})),e&&"object"==typeof e&&(e._object=t.datasourceLink))}))):a=t.format(e,{languageCode:r.languageCode}),i.forEach((e=>{a?n[e]=a:n[e]||(n[e]="")})),e.data?.length&&(n.data=n.data||[],(e.data||[]).forEach(((e,a)=>{n.data[a]=this.setReportValues(e,t,i,s)}))),n}async downloadImages(){const e={},t=[],i=(s,n=[])=>{n.forEach((n=>{const a=s.format(n);a&&!e[a]&&t.push(new Promise(((t,i)=>{const n=s.urlImage(a);JSZipUtils.getBinaryContent(n,((s,n)=>{if(s)return i(s);e[a]=n,t()}))}))),i(s,n.data||[])}))};return this.view.datacollections.filter((e=>e?.datasource)).forEach((e=>{const t=e.datasource;let s=e.getCursor();if(s){const t=e.getCursor(!0);s=[this.AB.merge({},s,t)]}else s=e.getData();t.fields((e=>e instanceof ABFieldImage)).forEach((e=>{i(e,s)}))})),await Promise.all(t),e}downloadTemplateFile(){const e=this.view.downloadUrl();return new Promise(((t,i)=>{JSZipUtils.getBinaryContent(e,((e,s)=>{if(e)return i(e);t(s)}))}))}generateDocxFile(contentFile,data,images){const summaries={},zip=new JSZip(contentFile),doc=new Docxtemplater,imageModule=new ImageModule({centered:!1,getImage:(e,t)=>images[e]||"",getSize:(e,t,i)=>{const s=[300,160],n=this.view,a=n.datacollection;if(a){let e=a.datasource;if(!e)return s;if(i.indexOf(".")>-1){const t=i.split(".");if(e=e.objects((e=>e.label===t[0]))[0],!e)return s;i=t[1]}const t=e.fields((e=>e.columnName===i))[0];return t?.settings?(t.settings.useWidth&&t.settings.imageWidth&&(s[0]=t.settings.imageWidth),t.settings.useHeight&&t.settings.imageHeight&&(s[1]=t.settings.imageHeight),s):s}{const e=n.datacollections;return e?(e.forEach((e=>{let t=e.datasource;if(!t)return!1;if(i.indexOf(".")>-1){let e=i.split(".");if(!t.objects)return!1;if(t=t.objects((t=>t.label===e[0]))[0],!t)return!1;i=e[1]}const n=t.fields((e=>e.columnName===i))[0];return!!n?.settings&&(n.settings.useWidth&&n.settings.imageWidth&&(s[0]=n.settings.imageWidth),n.settings.useHeight&&n.settings.imageHeight&&(s[1]=n.settings.imageHeight),!1)})),s):s}}});try{doc.attachModule(imageModule).loadZip(zip).setData(data).setOptions({parser:function(tag){return{get:function(scope,context){if(0===tag.indexOf("data|")){const e=(tag.split("|")[1]||"").trim();return(scope.data||[]).filter((function(t){return!!t[e]}))}if(tag.indexOf("|$sum?")>-1){const e=tag.split("|$sum?")[0],t=tag.split("|$sum?")[1];let i=scope[e];return"string"==typeof i&&(i=i.replace(/[^\d.]/g,"")),summaries[t]||(summaries[t]=0),summaries[t]+=parseFloat(i),scope[e]}if(0===tag.indexOf("$sum?")){const e=tag.replace("$sum?","");return summaries[e]||0}if(0===tag.indexOf("$")){const e=tag.replace("$","").split("|"),t=e[0].trim(),i=e[1].trim();if(!t||!i)return"";let s;const n=scope._object;if(n){const e=n.fields((e=>e.columnName===i))[0];if(e){const t=e.indexField;s=t?t.columnName:null}}let a=data[t];a&&!Array.isArray(a)&&(a=[a]);const r=e=>e[`${s}_ORIGIN`]||e[s]||e.id||e;return(a||[]).filter((function(e){let t=scope[i];return Array.isArray(t)?t.filter((t=>r(t)===r(e))).length>0:r(e)===r(t)}))}if(tag.indexOf("?")>-1){const result=scope,prop=tag.split("?")[0],condition=tag.split("?")[1];if(prop&&condition){let data=scope[prop];if(data)return Array.isArray(data)||(data=[data]),data.filter((d=>eval(condition.replace(/\./g,"d."))))}return result}return"."===tag?scope:scope[tag]}}}}).render()}catch(e){return e}const docxFile=doc.getZip().generate({type:"blob",mimeType:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});return docxFile}}},5793:(e,t,i)=>{const s=i(13097);e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewFormButton_${e.id}`,i)}ui(){const e=this,t=this.view,i=t.parentFormComponent(),s=t.settings??{},n=s.alignment||t.constructor.defaultValues().alignment,a={cols:[]};return"center"!==n&&"right"!==n||a.cols.push({}),s.includeDelete&&a.cols.push({view:"button",autowidth:!0,value:s.deleteLabel||this.label("Delete"),css:"webix_danger",click:function(){e.onDelete(this)},on:{onAfterRender:function(){this.getInputNode().setAttribute("data-cy",`button delete ${i.id}`)}}},{width:10}),s.includeCancel&&a.cols.push({view:"button",autowidth:!0,value:s.cancelLabel||this.label("Cancel"),click:function(){e.onCancel(this)},on:{onAfterRender:function(){this.getInputNode().setAttribute("data-cy",`button cancel ${i.id}`)}}},{width:10}),s.includeReset&&a.cols.push({view:"button",autowidth:!0,value:s.resetLabel||this.label("Reset"),click:function(){e.onClear(this)},on:{onAfterRender:function(){this.getInputNode().setAttribute("data-cy",`button reset ${i.id}`)}}},{width:10}),s.includeSave&&a.cols.push({view:"button",type:"form",css:"webix_primary",autowidth:!0,value:s.saveLabel||this.label("Save"),click:function(){e.onSave(this)},on:{onAfterRender:function(){this.getInputNode().setAttribute("data-cy",`button save ${i.id}`)}}}),"center"!==n&&"left"!==n||a.cols.push({}),super.ui(a)}onCancel(e){const t=this.view,i=t.settings??{},s=t.parentFormComponent();if(s.datacollection?.setCursor(null),e?.getFormView?.().clear(),i.afterCancel)s.changePage(i.afterCancel);else{const e=e=>e.settings&&"popup"!=e.settings.type,t=this.view.pageParent();if(t){const i=t.pageParent(e)??t;i&&s.changePage(i.id)}}}onClear(e){const t=this.view.parentFormComponent().datacollection;t&&t.setCursor(null),e?.getFormView?.().clear()}onSave(e){if(!e)return void console.error("Require the button element");const t=this.view.parentFormComponent(),i=e.getFormView();e.disable?.(),t.saveData(i).then((()=>{e.enable?.(),t.focusOnFirst()})).catch((t=>{console.error(t);try{e.enable?.()}catch(e){this.AB.notify.developer(e,{context:"formButton.onSave > catch err > saveButton.enable()",buttonID:this?.view?.id,formID:this?.view?.parent?.id})}}))}onDelete(e){this.AB.Webix.confirm({title:this.label("Delete data"),text:this.label("Do you want to delete this data?"),callback:async t=>{if(t){e.disable?.();try{const t=this.view.parentFormComponent(),i=e.getFormView();await t.deleteData(i)}catch(e){console.error(e)}finally{e.enable?.()}}}})}}},90418:(e,t,i)=>{const s=i(13097);e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewFormCheckbox_${e.id}`,i)}ui(){return super.ui({view:"checkbox"})}}},68759:(e,t,i)=>{const s=i(44363).Z,n=i(48933),a=i(55030),r=i(36365),o=i(83743),l=i(51533),c=[];e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewForm_${e.id}`,Object.assign({form:"",layout:"",filterComplex:""},i)),this.timerId=null,this._showed=!1}ui(){const e=this.view,t=e.superComponent().ui().rows??[],i=this.uiValidationHolder(),s=super.ui([{id:this.ids.form,view:"form",abid:e.id,rows:t.concat(i)}]);return delete s.type,s}uiValidationHolder(){const e=[{hidden:!0,rows:[]}],t=this.view,i=this.datacollection?.datasource??t._currentObject;if(!i)return e;const s=[],n=t.fieldComponents();return i.fields((e=>e?.settings?.validationRules)).forEach((e=>{n.find((t=>e.id===t.settings.fieldId))&&("string"==typeof e.settings.validationRules&&(e.settings.validationRules=JSON.parse(e.settings.validationRules)),e.settings.validationRules.forEach(((t,i)=>{const n=this.AB.filterComplexNew(`${e.columnName}_${i}`);"function"==typeof n.ui?s.push(n.ui()):s.push(n.ui),c.push({filter:n,view:n.ids.querybuilder,columnName:e.columnName,validationRules:t.rules,invalidMessage:t.invalidMessage})})))})),e.rows=s,e}async init(e,t,i={}){await super.init(e),this.view.superComponent().init(e,t,i),this.initCallbacks(i),this.initEvents(),this.initValidationRules();const s=this.AB.Webix,n=$$(this.ids.form);n&&s.extend(n,s.ProgressBar),t<2&&n.disable()}initCallbacks(e={}){e?.clearOnLoad&&(this.view.settings.clearOnLoad=e.clearOnLoad());const t=this.view;e.onBeforeSaveData?t._callbacks.onBeforeSaveData=e.onBeforeSaveData:t._callbacks.onBeforeSaveData=()=>!0}initEvents(){const e=this.datacollection;if(!e)return;["changeCursor","cursorStale"].forEach((t=>{this.eventAdd({emitter:e,eventName:t,listener:e=>{this.view.fieldComponents((e=>e instanceof a)).forEach((t=>{const i=t.field();if("one"==i?.settings?.linkViaType&&i?.linkViaOneValues){delete i.linkViaOneValues;const t=e?.[i.relationName()]??e?.[i.columnName];if(t)if(Array.isArray(t)){const e=[];t.forEach((t=>{e.push(i.getRelationValue(t,{forUpdate:!0}))})),i.linkViaOneValues=e.join(",")}else i.linkViaOneValues=i.getRelationValue(t,{forUpdate:!0})}})),this.displayData(e)}})}));const t=this.ids;this.eventAdd({emitter:e,eventName:"initializingData",listener:()=>{const e=$$(t.form);e&&(e.disable(),e.showProgress?.({type:"icon"}))}}),this.eventAdd({emitter:e,eventName:"initializedData",listener:()=>{const e=$$(t.form);e&&(e.enable(),e.hideProgress?.())}});const i=e.datacollectionLink;i&&["changeCursor","cursorStale"].forEach((e=>{this.eventAdd({emitter:i,eventName:e,listener:e=>{this.displayParentData(e)}})}))}initValidationRules(){const e=this.datacollection;if(!e)return;if(!c.length)return;const t=[];c.forEach((i=>{i.filter.applicationLoad(e.datasource.application),i.filter.fieldsLoad(e.datasource.fields()),i.filter.setValue(i.validationRules),Array.isArray(t[i.columnName])||(t[i.columnName]=[]),t[i.columnName].push({filters:$$(i.view).getFilterHelper(),invalidMessage:i.invalidMessage})}));const i=this.ids;Object.keys(t).forEach((s=>{const n=$$(i.form).queryView({name:s});n.$view.complexValidations=t[s],n.define("validate",(function(t,s,n){const a=$$(i.form).queryView({name:n});let r=!0;return a.$view.complexValidations.forEach((t=>{const i=e.datasource,s=this.getValues(),n={};(i.fields()||[]).forEach((e=>{n[e.id]=s[e.columnName]})),s.uuid&&(n.this_object=s.uuid),t.filters(n)||(r=!1,a.define("invalidMessage",t.invalidMessage))})),r})),n.refresh()}))}async onShow(e){this.saveButton?.disable(),this._showed=!0;const t=this.view,i=t.superComponent();await i.onShow();const s=$$(this.ids.form),n=this.datacollection;if(n){this.settings.clearOnLoad&&n.setCursor(null);const e=n.getCursor();s&&n.bind(s),await this.displayData(e)}else await this.displayData(e??{});this.focusOnFirst(),s&&s.adjust(),t.loadDcDataOfRecordRules(),this.saveButton?.enable()}async displayData(e){if(this.timerId)return;this.timerId=await async function(e){return new Promise((e=>setTimeout(e,80)))}();const t=this.view,i=t.fieldComponents((e=>e instanceof r||e instanceof o&&"rich"===e.settings.type||e instanceof l&&"filter"===e.settings.type)),s=t.fieldComponents((e=>e instanceof n&&!(e instanceof r)));if(e)i.forEach((i=>{const s=t.viewComponents[i.id];s&&(this._showed&&s?.onShow?.(),i?.field()?.setValue($$(s.ids.formItem),e),s?.refresh?.(e))})),s.forEach((i=>{if("button"===i.key)return;const s=i.field();if(!s)return;const n=t.viewComponents[i.id];n&&s.setValue($$(n.ids.formItem),e)}));else{i.forEach((e=>{const i=e.field();if(!i)return;const s=t.viewComponents[e.id];if(!s)return;this._showed&&s?.onShow?.();const n={};i.defaultValue(n),i.setValue($$(s.ids.formItem),n),s?.refresh?.(n)})),s.forEach((e=>{if("button"===e.key)return;const i=e.field();if(!i)return;const s=t.viewComponents[e.id];if(!s)return;const n=i.columnName,a={};i.defaultValue(a),$$(s.ids.formItem)?.setValue(a[n]??"")}));const e=this.datacollection.datacollectionLink;if(e){const t=e.getCursor();this.displayParentData(t)}}this.timerId=null}displayParentData(e){const t=this.datacollection;if(t.getCursor())return;const i=t.fieldLink;if(!i)return;const s=this.view,a=s.fieldComponents((e=>e instanceof n&&e.field()?.id===i.id))[0];if(!a)return;const r=s.viewComponents[a.id];if(!r)return;const o=$$(r.ids.formItem),l={};l[i.relationName()]=e,i.setValue(o,l)}detatch(){}focusOnFirst(){const e=this.view;let t=0,i="";e.views().forEach((e=>{"textbox"!==e.key&&"numberbox"!==e.key||e.position.y===t&&(t=e.position.y,i=e.id)}));const s=e.viewComponents[i];s&&$$(s.ids.formItem)&&$$(s.ids.formItem).focus()}get saveButton(){return $$(this.ids.form)?.queryView({view:"button",type:"form"})}}},40500:(e,t,i)=>{const s=i(13097);e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewFormConnect_${e.id}`,Object.assign({popup:"",editpopup:""},i)),this.addPageComponent=null,this.editPageComponent=null}get field(){return this.view.field()}get multiselect(){return"many"==this.field?.settings.linkType}ui(){const e=this.field,t=this.view,i=t.parentFormComponent(),s=this.settings;if(!e)return console.error(`This field could not found : ${s.fieldId}`),super.ui({view:"label",label:""});const n=this.multiselect,a=i?.settings||{},r=this.ids;let o={id:r.formItem,view:n?"multicombo":"combo",name:e.columnName,required:e?.settings?.required||parseInt(s?.required)||!1,dataFieldId:e.id,on:{onItemClick:(e,t)=>{if(t.target.classList.contains("editConnectedPage")&&t.target.dataset.itemId){const e=t.target.dataset.itemId;if(!e)return;this.goToEditPage(e)}},onChange:e=>{this._onChange(e)}}};a.showLabel&&(o.label=e.label,o.labelWidth=a.labelWidth,o.labelPosition=a.labelPosition),this.initAddEditTool(),o.suggest={button:!0,selectAll:!!n,body:{data:[],template:(t?.settings?.editForm?'<i data-item-id="#id#" class="fa fa-cog editConnectedPage"></i>':"")+"#value#"},on:{onShow:()=>{e.populateOptionsDataCy($$(r.formItem),e,i)}},filter:({value:e},t)=>e.toLowerCase().includes(t.toLowerCase())},o.onClick={customField:(t,i,n)=>{if(1===s.disable)return;const a={},o=$$(r.formItem);if(o){const t=o.$view;e.customEdit(a,t)}}};let l=this.addPageComponent?.ui;return l?(o.label="",o.labelWidth=0,l.on={onItemClick:()=>(this.addPageComponent?.onClick(i.datacollection),!1)},"top"==o.labelPosition?(o.labelPosition="left",o={inputId:r.formItem,rows:[{view:"label",label:e.label,align:"left"},{cols:[l,o]}]}):o={inputId:r.formItem,rows:[{cols:[{view:"label",label:e.label,width:a.labelWidth,align:"left"},l,o]}]},o=super.ui(o)):(o={inputId:r.formItem,rows:[o]},o=super.ui(o),delete o.rows[0].id),o}async _onChange(e){const t=this.ids,i=this.field,s=this.view;let n;this.multiselect&&"string"==typeof e&&(e=e.split(",")),Array.isArray(e)?(n=[],e.forEach((e=>{n.push(e.id||e)}))):(n=e,"object"!=typeof e&&(n=i.getItemFromVal(e)),n=n?.id?n.id:e);const a=$$(t.formItem);if(a){"one"==this?.field?.settings?.linkViaType&&(this.busy(),await i.getAndPopulateOptions(a,s.options,i,s.parentFormComponent()),this.ready()),a.blockEvent();const e=n.join?n.join():n;a.setValue(e),a.unblockEvent()}}async init(e,t){await super.init(e);const i=$$(this.ids.formItem);i&&webix.extend(i,webix.ProgressBar),this.initAddEditTool()}initAddEditTool(){const e=this.view,t=e?.settings?.formView;t&&e&&!this.addPageComponent&&(this.addPageComponent=e.addPageTool.component(this.AB,`${e.id}_${t}`),this.addPageComponent.applicationLoad(e.application),this.addPageComponent.init({onSaveData:this.callbackSaveData.bind(this),onCancelClick:this.callbackCancel.bind(this),clearOnLoad:this.callbackClearOnLoad.bind(this)}));const i=e?.settings?.editForm;i&&e&&!this.editPageComponent&&(this.editPageComponent=e.editPageTool.component(this.AB,`${e.id}_${i}`),this.editPageComponent.applicationLoad(e.application),this.editPageComponent.init({onSaveData:this.callbackSaveData.bind(this),onCancelClick:this.callbackCancel.bind(this),clearOnLoad:this.callbackClearOnLoad.bind(this)}))}async callbackSaveData(e){if(null==e)return;Array.isArray(e)||(e=[e]);const t=this.ids,i=this.field,s=$$(t.formItem);if(!s)return;this.busy(),i.clearStorage(this.view.settings.filterConditions);const n=await i.getAndPopulateOptions(s,this.view.options,i,this.view.parentFormComponent());if(this.ready(),n.forEach((e=>{e.value=e.text})),s.getList().clearAll(),s.getList().define("data",n),"many"===i.settings.linkType){let t=s.getValue();e.forEach((e=>{-1===t.indexOf(e.id)&&(t=t?`${t},${e.id}`:e.id)})),s.setValue(t)}else s.setValue(e[0].id)}callbackCancel(){return $$(this.ids?.popup)?.close?.(),!1}callbackClearOnLoad(){return!0}getValue(e){return this.field.getValue($$(this.ids.formItem),e)}formBusy(e){e&&(e.disable?.(),e.showProgress?.({type:"icon"}))}formReady(e){e&&(e.enable?.(),e.hideProgress?.())}goToEditPage(e){const t=this.settings;if(!t.editForm)return;const i=this.view.application.urlResolve(t.editForm);i&&($$(this.ids.formItem).getFormView(),this.editPageComponent.onClick().then((()=>{const t=i.datacollection;t&&(t.setCursor(e),this.__editFormDcEvent=this.__editFormDcEvent||t.on("initializedData",(()=>{t.setCursor(e)})))})))}async onShow(){const e=this.ids,t=$$(e.formItem);if(!t)return;const i=this.field;if(!i)return;const s=t.$view;if(!s)return;const n=$$(s);if(!n)return;const a=this.settings;let r={glue:"and",rules:[]};if(a?.filterConditions?.rules?.length&&(r=this.AB.cloneDeep(this.view.settings.filterConditions)),!r?.rules?.length&&a?.objectWorkspace?.filterConditions?.rules?.length&&(r=this.AB.cloneDeep(a.objectWorkspace.filterConditions)),(a?.filterConnectedValue??"").indexOf(":")>-1){const e=a.filterConnectedValue.split(":"),t=e[0],i=e[1];r.rules.push({key:i,rule:"filterByConnectValue",value:t})}const o=(e,t=0)=>[...e.rules.filter((e=>"filterByConnectValue"===e.rule)).map((e=>{const i=Object.assign({},e);return i.depth=t,i}))].concat(...e.rules.filter((e=>e.glue)).map((e=>o(e,t+1)))),l=this.view,c=o(r).map((e=>{for(const t in l.parent.viewComponents){if(!(l.parent.viewComponents[t]instanceof this.constructor))continue;const i=$$(l.parent.viewComponents[t].ui().rows.find((e=>e.inputId))?.inputId);if(i?.config?.name===e.value){e.filterValue=i;break}}const t=this.AB,i=t.objectByID(a.objectId).fieldByID(a.fieldId),s=t.objectByID(i.settings.linkObject).fieldByID(e.key);return e.filterColumn=s?.settings?.isCustomFK?t.objectByID(s.settings.linkObject).fields((e=>e.id===s.settings.indexField||s.settings.indexField2))[0].columnName:null,e}));if(l.options={formView:a.formView,filters:r,sort:a.sortFields??a.objectWorkspace?.sortFields,editable:1!==a.disable,editPage:!(!a.editForm||"none"===a.editForm),filterByConnectValues:c},l.options.editable){const e=[];c.forEach((t=>{if(t.filterValue&&t.key){const s=$$(t.filterValue.config.id);let a=null;s?(i.getValue(s)||(a={id:t.filterValue.config.id,label:s.config.label}),s.attachEvent("onChange",(async e=>{s.getValue()?(n.define("disabled",!1),n.define("placeholder",this.label("Select items")),this.busy(),await i.getAndPopulateOptions(n,l.options,i,l.parentFormComponent()),this.ready()):(n.define("disabled",!0),n.define("placeholder",this.label("Must select item from '{0}' first.",[s.config.label]))),n.refresh()}),!1)):a={id:"perentElement",label:this.label("PARENT ELEMENT")},a&&e.findIndex((e=>e.id===a.id))<0&&e.push(a)}})),e.length&&!n.getValue()?(n.define("disabled",!0),n.define("placeholder",this.label("Must select item from '{0}' first.",[e.map((e=>e.label)).join(", ")]))):(n.define("disabled",!1),n.define("placeholder",this.label("Select items")))}else n.define("placeholder",""),n.define("disabled",!0);n.refresh();const u=`${i.key} ${i.columnName} ${i.id} ${l.parent.id}`;s.setAttribute("data-cy",u),this.busy();try{await i.getAndPopulateOptions(t,l.options,i,l.parentFormComponent())}catch(e){this.AB.notify.developer(e,{context:"ABViewFormConnectComponent > onShow() error calling field.getAndPopulateOptions"})}this.ready(),this._onChange(t.getValue())}busy(){const e=$$(this.ids.formItem);e?.disable(),e?.showProgress?.({type:"icon"})}ready(){const e=$$(this.ids.formItem);e?.enable(),e?.hideProgress?.()}}},12213:(e,t,i)=>{const s=i(13097),n=i(15884),a=i(79119);e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewFormCustom_${e.id}`,i)}get new_width(){const e=this.view,t=e.parentFormComponent()?.settings??{},i=e.settings??{};let s=t.labelWidth;return i.formView?s+=40:t.showLabel&&"top"===t.labelPosition&&(s=0),s}ui(){const e=this.view,t=e.field(),i=e.parentFormComponent()?.settings??{},s=t?.settings??e.settings??{},r=t?.settings?.required||this.settings.required?"webix_required":"";let o="";i.showLabel&&(o="top"===i.labelPosition?`<label style="box-sizing: border-box; display:block; text-align: left; margin: 0; padding:1px 7.5px 0 3px; text-overflow:ellipsis; overflow:hidden; white-space:nowrap; color: #313131;" class="webix_inp_top_label ${r}">#label#</label>`:`<label style="box-sizing: border-box; width: #width#px; display: inline-block; line-height: 32px; float: left; margin: 0; padding:1px 8px 0 0; text-overflow:ellipsis; overflow:hidden; white-space:nowrap; color: #313131;" class="${r}">#label#</label>`);let l=38,c=this.new_width;void 0===t&&console.warn(`BaseView[${e.id}] returned an undefined field()`,e.toObj()),t instanceof n?(s.useHeight?"top"===i.labelPosition?(l=parseInt(s.imageHeight)||80,l+=38):l=parseInt(s.imageHeight)||80:l="top"===i.labelPosition?118:80,c=s.useWidth&&s.imageWidth?s.imageWidth:0):i.showLabel&&"top"===i.labelPosition&&(l=80);let u=`<div class="customField ${i.labelPosition}">${"top"==i.labelPosition?"":o}#template#</div>`.replace(/#width#/g,i.labelWidth).replace(/#label#/g,t?.label??"").replace(/#template#/g,t?.columnHeader({width:c,height:l,editable:!0}).template({})??"");return 0==s.useWidth&&(u=u.replace(/"ab-image-data-field" style="float: left; width: 100%/g,'"ab-image-data-field" style="float: left; width: calc(100% - '+i.labelWidth+"px)")),super.ui({view:"forminput",labelWidth:0,paddingY:0,paddingX:0,css:"ab-custom-field",body:{view:new a(this.AB._App).key,css:"customFieldCls",borderless:!0,template:u,height:l,onClick:{customField:(e,i,n)=>{if(1===s.disable)return;let a={};const r=this?.parentFormComponent?.()||this.view?.parentFormComponent?.();if(r){const e=r.datacollection;e&&(a=e.getCursor()||{})}let o=$$(n).getParentView().$view;t?.customEdit(a,this.AB_App,o,this.ids.formItem,e)}}}})}onShow(){const e=this.ids,t=$$(e.formItem);if(!t)return;const i=this.view,s=i.field(),a=t.$view,r=`${i.key} ${s.key} ${s.columnName} ${i.id} ${i.parent.id}`;a.setAttribute("data-cy",r);const o={formId:e.formItem,editable:1!==i.settings.disable};s instanceof n&&(o.height=s.settings.useHeight&&parseInt(s.settings.imageHeight)||80,o.width=s.settings.useWidth&&parseInt(s.settings.imageWidth)||0),s.customDisplay({},this.AB._App,a,o)}getValue(e){const t=this.view.field(),i=$$(this.ids.formItem);return t.getValue(i,e)}}},37264:(e,t,i)=>{const s=i(13097);e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewFormDatepicker_${e.id}`,i)}ui(){const e=this,t=this.view.field(),i={view:"datepicker",suggest:{body:{view:"th"==this.AB.Account?._config?.languageCode?"thaicalendar":"calendar",on:{onAfterDateSelect:function(e){this.getParentView().setMasterValue({value:e})},onTodaySet:function(e){this.getParentView().setMasterValue({value:e})},onDateClear:function(e){this.getParentView().setMasterValue({value:e})}}},on:{onShow:function(){const t=this.getMasterValue(),i=e.view.field();if(!t||!i)return!0;const s={};s[i.columnName]=t;const n=e.getValue(s);this.getChildViews()[0].setValue(n)}}}};return t?(1===t.settings?.dateFormat&&(i.type="time"),"datetime"===t.key&&1!==t.settings?.timeFormat&&(i.timepicker=!0),i.editable=!0,!i.value||i.value instanceof Date||(i.value=new Date(i.value)),null===t||window.webixLocale||(i.format=t.getFormat()),super.ui(i)):i}getValue(e){const t=this.view.field(),i=e[t.columnName];if(!t||!i)return null;if(!this.AB){if(!this.view.AB){let e=new Error("ABViewFormDatePicerComponent:getValue(): AB was not set.");throw console.log("view:",JSON.stringify(this.view.toObj())),e}this.AB=this.view.AB}const s=this.AB.Webix.Date.strToDate(t.getFormat())(i);return"th"==this.AB.Account?._config?.languageCode&&s.setFullYear(s.getFullYear()-543),s}}},13097:(e,t,i)=>{const s=i(44363).Z;e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewFormItem_${e.id}`,Object.assign({formItem:""},i))}ui(e={}){const t=this.view,i=t.parentFormComponent(),s=t.field?.()||null,n=i?.settings||{},a={id:this.ids.formItem,labelPosition:n.labelPosition,labelWidth:n.labelWidth,label:""};if(s){a.name=s.columnName;const e={};s.defaultValue(e),e[s.columnName]&&(a.value=e[s.columnName]),n.showLabel&&(a.label=s.label),(s.settings.required||t.settings?.required)&&(a.required=1),1===t.settings?.disable&&(a.disabled=!0),a.on={onAfterRender(){if(this.getList){const e=this.getPopup();if(!e)return;this.getList().data.each((t=>{if(!t)return;const n=e.$view.querySelector(`[webix_l_id='${(t?.id??"").toString().replaceAll("'","\\'")}']`);n&&n.setAttribute("data-cy",`${s.key} options ${t.id} ${s.id} ${i?.id||"nf"}`)}))}this.getInputNode?.().setAttribute?.("data-cy",`${s.key} ${s.columnName} ${s.id} ${i?.id||"nf"}`)}},a.validate=(e,t,i)=>{const n=this.AB.Validation.validator();return s.isValidData(t,n),n.pass()}}const r=super.ui([Object.assign({},a,e)]);return delete r.type,r}}},35986:(e,t,i)=>{const s=i(13097);e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewFormJson_${e.id}`,i),"filter"==this.settings.type&&(this.rowFilter=this.AB.filterComplexNew(`${e.id}_filterComplex`,{isSaveHidden:!0,height:300,borderless:!1,showObjectName:!0}))}getFilterField(e){if(e?.settings?.filterField&&e?.view?.parent?.viewComponents){let t="";for(const[i,s]of Object.entries(e.view.parent.viewComponents))s.settings.fieldId==e.settings.filterField&&(t=s);return t?.ids?.formItem?t.ids.formItem:""}return""}get getSystemObjects(){let e=this.AB.objects(),t=[];return e.forEach((e=>{t.push({id:e.id,label:e.label})})),t}refreshFilter(e){if(e){let t=[];e.forEach((e=>{let i=this.AB.objectByID(e).fields();i.length&&i.forEach((e=>{t.push(e)}))})),this.rowFilter.fieldsLoad(t),$$(this.ids.formItem).config.value&&this.rowFilter.setValue($$(this.ids.formItem).config.value)}else this.rowFilter.fieldsLoad([]),$$(this.ids.formItem).config.value&&this.rowFilter.setValue($$(this.ids.formItem).config.value)}getValue(){return this.rowFilter.getValue()}setValue(e){$$(this.ids.formItem).config.value=e}ui(){const e={};switch(this.settings.type||this.view.settings.type||this.view.constructor.defaultValues().type){case"string":e.view="textarea",e.disabled=!0,e.height=200,e.format={parse:function(e){try{e=JSON.parse(e)}catch(e){}return e},edit:function(e){try{e=JSON.stringify(e)}catch(e){}return e}};break;case"systemObject":e.view="multicombo",e.placeholder=this.label("Select one or more system objects"),e.button=!1,e.stringResult=!1,e.suggest={selectAll:!0,body:{data:this.getSystemObjects,template:webix.template("#label#")}};break;case"filter":e.view="forminput",e.css="ab-custom-field",e.body=this.rowFilter.ui}return super.ui(e)}init(){}onShow(){if(this.ui(),"filter"==this?.settings?.type){let e=this.getFilterField(this);if(!$$(e))return;$$(e).detachEvent("onChange"),$$(e).attachEvent("onChange",(e=>{this.refreshFilter(e)})),this.rowFilter.init({showObjectName:!0}),this.rowFilter.on("changed",(e=>{this.setValue(e)})),$$(this.ids.formItem).config.value?this.rowFilter.setValue($$(this.ids.formItem).config.value):this.rowFilter.setValue("")}}}},14956:(e,t,i)=>{const s=i(13097),n=i(65179);e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewFormNumber_${e.id}`,i),this._numberTextInputKey=null}get numberTextInputKey(){return this._numberTextInputKey=this._numberTextInputKey||new n(this.AB._App).key}ui(){return super.ui({view:this.settings.isStepper?"counter":this.numberTextInputKey,type:"number",validate:e=>!isNaN(1*e)})}}},26050:(e,t,i)=>{const s=i(13097);e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewFormReadonly_${e.id}`,Object.assign({template:""},i))}ui(){const e=this.view,t=e.field(),i={view:"forminput",labelWidth:0,paddingY:0,paddingX:0,readonly:!0,css:"ab-readonly-field",body:{id:this.ids.template,view:"label",borderless:!0,css:{"background-color":"#fff"},label:""}},s=e.parentFormComponent().settings||{};return 1==s.showLabel&&"top"==s.labelPosition?i.body.height=80:t.settings.useHeight?i.body.height=parseInt(t.settings.imageHeight)||38:i.body.height=38,super.ui(i)}async init(e){await super.init(e);const t=$$(this.ids.formItem);if(!t)return;const i=t.getFormView(),s=i?.getValues()??{};this.refresh(s),i?.attachEvent("onChange",((e,t)=>{const s=i?.getValues()??{};this.refresh(s)}))}onShow(){const e=$$(this.ids.formItem);if(!e)return;const t=e.getFormView()?.getValues()??{};this.refresh(t)}getValue(e){const t=this.view.field();return t?e[t.columnName]:null}refresh(e){const t=this.view,i=t.parentFormComponent(),s=t.field(),n=i.settings||{};let a="";n.showLabel&&(a="top"===n.labelPosition?`<label style="display:block; text-align: left; margin: 0; padding:1px 7.5px 0 3px; text-overflow:ellipsis; overflow:hidden; white-space:nowrap;" class="webix_inp_top_label">${s.label}</label>`:`<label style="width: ${n.labelWidth}px; display: inline-block; line-height: 32px; float: left; margin: 0; padding:1px 7.5px 0 3px; text-overflow:ellipsis; overflow:hidden; white-space:nowrap;">${s.label}</label>`);let r=n.labelWidth;this.settings.formView?r+=40:n.showLabel&&"top"===n.labelPosition&&(r=0);const o=`<div class="readonlyField">${a}#template#</div>`.replace(/#template#/g,s.columnHeader({width:r,editable:!0}).template(e));$$(this.ids.template)?.setHTML(o)}}},70215:(e,t,i)=>{const s=i(13097);e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewFormSelectMultiple_${e.id}`,i)}ui(){const e=this.view,t=e.field(),i=this.settings,s=[];"user"===t?.key?s.push(...t.getUsers()):t&&s.push(...t.settings.options??i.options??[]);const n=this.ids,a={id:n.formItem,view:i.type||e.constructor.defaultValues().type,options:s.map((e=>({id:e.id,value:e.text,hex:e.hex})))};switch(a.view){case"multicombo":a.tagMode=!1,a.css="hideWebixMulticomboTag",a.tagTemplate=e=>{const i=[],s=$$(n.formItem)??$$(a.id);e.forEach((e=>{i.push(s.getList().getItem(e))}));let r=i;t.getSelectedOptions&&(r=t.getSelectedOptions(t,i));const o=[];return r.forEach((e=>{let i="",s="";t.settings.hasColors&&e.hex&&(i="hascustomcolor",s=`background: ${e.hex};`);const n=e.text?e.text:e.value;o.push(`<span class="webix_multicombo_value ${i}" style="${s}" optvalue="${e.id}"><span>${n}</span><span class="webix_multicombo_delete" role="button" aria-label="Remove item"></span></span>`)})),o.join("")};break;case"checkbox":a.options.push({id:"temp",value:this.label("Option")})}return super.ui(a)}getValue(e){const t=this.view.field(),i=$$(this.ids.formItem);return t.getValue(i,e)}}},35111:(e,t,i)=>{const s=i(13097);e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewFormSelectSingle_${e.id}`,i)}ui(){const e=this.view,t=e.field(),i=e.settings,s=[];"user"===t?.key?s.push(...t.getUsers()):t?s.push(...t.settings.options??i.options??[]):s.push(...i.options??[]);const n={view:i.type||e.constructor.defaultValues().type};return t?.settings.hasColors?(n.css="combowithcolors",n.options={view:"suggest",body:{view:"list",data:s.map((e=>({id:e.id,value:e.text||e.value,hex:t.settings.hasColors?e.hex:""}))),template:function(e){const t=[];let i="",s="";return e.hex&&(i="hascustomcolor",s=`background: ${e.hex};`),t.push(`<span class="webix_multicombo_value ${i}" style="${s}" optvalue="${e.id}"><span>${e.value}</span></span>`),t.join("")}}}):n.options=s.map((e=>({id:e.id,value:e.text||e.value}))),"radio"===n.view&&n.options.length<1&&n.options.push({id:"temp",value:this.label("Option")}),super.ui(n)}}},96936:(e,t,i)=>{const s=i(13097);e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewFormTextbox_${e.id}`,i),this.type=this.settings.type||this.view.settings.type||this.view.constructor.defaultValues().type}ui(){const e={};switch(this.type){case"single":e.view="text";break;case"multiple":e.view="textarea",e.height=200;break;case"rich":e.view="forminput",e.height=200,e.css="ab-rich-text",e.body={view:"tinymce-editor",value:"",cdn:"/js/webix/extras/tinymce",config:{plugins:"link",menubar:"format edit",toolbar:"undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | fontsizeselect | link"}}}return super.ui(e)}async onShow(){if("rich"!==this.type)return;await this.initTinyMCE();const e=this.ui().rows[0];let t=$$(this.ids.formItem);if(t){t=this.AB.Webix.ui(e,t);const i=this.view;t.getChildViews()[0].getEditor(!0).then((t=>{const s=`${i.key} rich ${e.name} ${i.id??""} ${i.parent?.id??""}`;t.contentAreaContainer.setAttribute("data-cy",s)}))}}async initTinyMCE(){await this.AB.custom["tinymce-editor"].init()}}},72708:(e,t,i)=>{const s=i(13097);e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewFormTree_${e.id}`,i)}ui(){const e=this.view,t=e.field(),i={};if(!t)return super.ui(i);const s=e.parentFormComponent().settings||{},n=1===t.settings.required?"webix_required":"";let a="";s.showLabel&&(a="top"===s.labelPosition?`<label style="display:block; text-align: left; margin: 0; padding:1px 7.5px 0 3px; text-overflow:ellipsis; overflow:hidden; white-space:nowrap;" class="webix_inp_top_label ${n}">#label#</label>`:`<label style="width: #width#px; display: inline-block; line-height: 32px; float: left; margin: 0; padding:1px 7.5px 0 3px; text-overflow:ellipsis; overflow:hidden; white-space:nowrap;" class="${n}">#label#</label>`);let r=s.labelWidth;this.settings.formView&&(r+=40);const o=`${a}#template#`.replace(/#width#/g,s.labelWidth).replace(/#label#/g,t.label).replace(/#template#/g,t.columnHeader({width:r}).template);return i.view="template",i.css="webix_el_box",i.height=1===t.settings.useHeight?parseInt(t.settings.imageHeight):38,i.borderless=!0,i.template=`<div class="customField">${o}</div>`,i.onClick={customField:(e,i,s)=>{const n={},a=$$(this.ids.formItem).$view;n[t.columnName]=this.getValue(),t.customEdit(n,this.AB._App,a,this)}},super.ui(i)}getValue(e){let t=$$(this.ids.formItem).getValues();return Array.isArray(t)&&0===t.length&&(t=""),t}}},58942:(e,t,i)=>{const s=i(44363).Z;e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewImage_${e.id}`,Object.assign({image:""},i))}ui(){const e=this.settings,t=super.ui([{cols:[{id:this.ids.image,view:"template",template:"",height:e.height,width:e.width},{}]}]);return delete t.type,t}async init(e){await super.init(e);const t=$$(this.ids.image);if(!t)return;const i=this.settings;i.filename?t.define("template",`<img src="/file/${i.filename}" height="${i.height}" width="${i.width}">`):t.define("template",""),t.refresh()}}},3893:(e,t,i)=>{const s=i(44363).Z,n=i(47304);e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewKanBan_${e.id}`,Object.assign({kanbanView:"",kanban:"",resizer:"",formSidePanel:""},i)),this.FormSide=new n(this,this.ids.formSidePanel,this.settings.editFields),this.CurrentVerticalField=null,this.CurrentHorizontalField=null,this.CurrentOwnerField=null,this.TextTemplate=e.TextTemplate,this._updatingOwnerRowId=null,this._ABFieldConnect=null,this._ABFieldUser=null,this._ABFieldList=null}get ABFieldConnect(){return this._ABFieldConnect=this._ABFieldConnect||this.AB.Class.ABFieldManager.fieldByKey("connectObject")}get ABFieldUser(){return this._ABFieldUser=this._ABFieldUser||this.AB.Class.ABFieldManager.fieldByKey("user")}get ABFieldList(){return this._ABFieldList=this._ABFieldList||this.AB.Class.ABFieldManager.fieldByKey("list")}ui(){const e=this.ids,t=this;this.linkPage=this.view.linkPageHelper.component();const i=super.ui([{id:e.kanbanView,cols:[{id:e.kanban,view:"kanban",cols:[],userList:{view:"menu",template:'<i class="fa fa-user"></i> #value#',width:150,on:{onSelectChange:function(){if(!t._updatingOwnerRowId)return;const e=this.getSelectedId(!1);e&&t.updateOwner(t._updatingOwnerRowId,e)}}},editor:!1,users:[],tags:[],data:[],on:{onListAfterSelect:(e,t)=>{this.CurrentDatacollection?.setCursor(e),this.emit("select",e);const i=this.settings.editPage;i&&this.linkPage.changePage(i,e);const s=this.settings.detailsPage;s&&this.linkPage.changePage(s,e)},onAfterStatusChange:(e,t)=>{this.updateStatus(e,t)},onAvatarClick:e=>{this._updatingOwnerRowId=e}}},{id:e.resizer,view:"resizer",css:"bg_gray",width:11,hidden:!0},this.FormSide.ui()]}]);return delete i.type,i}async init(e){await super.init(e);const t=this.AB.Webix;this.$kb&&t.extend(this.$kb,t.ProgressBar),this.FormSide.init(e),this.FormSide.on("add",(e=>{this.saveData(e)})),this.FormSide.on("update",(e=>{this.saveData(e)}));let i=this.view.datacollection;i&&this.datacollectionLoad(i),this.linkPage.init({view:this.view,datacollection:i}),this.show()}get $kb(){return this._kb=this._kb||$$(this.ids.kanban)}kanbanListTemplate(){return{icons:[{icon:"fa fa-trash-o",click:e=>{this.removeCard(e)}}],templateAvatar:e=>this.CurrentOwnerField&&e[this.CurrentOwnerField.columnName]?this.CurrentOwnerField.format(e):"<span class='webix_icon fa fa-user'></span>",templateBody:e=>this.TextTemplate.text?this.TextTemplate.displayText(e):this.CurrentObject?.displayData(e)}}hide(){$$(this.ids.kanbanView)?.hide()}async show(){const e=this.ids;$$(e.kanbanView)?.show(),this.FormSide.hide(),$$(e.resizer)?.hide();var t=this.CurrentObject;if(t||(t=this.datacollection?.datasource),!t)return;const i=t.fieldByID(this.settings.verticalGroupingField);if(!i)return;this.CurrentVerticalField=i;let s=[];const n=t.fieldByID(this.settings.horizontalGroupingField);this.CurrentHorizontalField=n,n&&n instanceof this.ABFieldConnect&&(s=await n.getOptions());const a=(i.settings.options||[]).map((e=>{if(i&&n){let t=[],a=[];return n instanceof this.ABFieldList?a=(n.settings.options||[]).map((e=>e)):n instanceof this.ABFieldUser?a=n.getUsers().map((e=>({id:e.id,text:e.text||e.value}))):n instanceof this.ABFieldConnect&&(a=s.map((({id:e,text:t})=>({id:e,text:t})))),a.push({id:null,text:this.label("Other")}),a.forEach((s=>{const a={};a[i.columnName]=e.id,a[n.columnName]=s.id,t.push({template:s.text,height:20,css:"progress_header"}),t.push({view:"kanbanlist",status:a,type:this.kanbanListTemplate()})})),{header:e.text,body:{margin:0,rows:t}}}if(i){const t={};return t[i.columnName]=e.id,{header:e.text,body:{view:"kanbanlist",status:t,type:this.kanbanListTemplate()}}}})),r=this.AB;r.Webix.ui(a,$$(e.kanban)),$$(e.kanban).reconstruct();const o=t.fieldByID(this.settings.ownerField);if(this.CurrentOwnerField=o,o){const t=$$(e.kanban).getUserList();if(t.clearAll(),o instanceof this.ABFieldUser){const e=r.Account.userList().map((e=>({id:e.username,value:e.username})));t.parse(e)}else if(o instanceof this.ABFieldConnect){const e=await o.getOptions();try{t.parse(e.map((e=>({id:e.id,value:e.text}))))}catch(t){console.error(t),console.warn(e)}}}}busy(){this.$kb?.showProgress?.({type:"icon"})}ready(){this.$kb?.hideProgress?.()}objectLoad(e){super.objectLoad(e),this.TextTemplate.objectLoad(e),this.FormSide.objectLoad(e)}datacollectionLoad(e){super.datacollectionLoad(e);const t=this.CurrentDatacollection||e;if(t){t.bind(this.$kb);const e=t.datasource;e&&this.objectLoad(e)}else this.$kb.unbind()}async updateStatus(e,t){if(!this.CurrentVerticalField)return;this.busy();let i={};t instanceof Object?i=t:i[this.CurrentVerticalField.columnName]=t;let s=!1;for(const e in i)i[e]||(i[e]="",s=!0);try{if(await(this.CurrentObject?.model().update(e,i)),this.ready(),s&&this.show(),this.FormSide.isVisible()){const t=$$(this.ids.kanban).getItem(e);this.FormSide.refresh(t)}}catch(t){this.AB.notify.developer(t,{context:"ABViewKanban:updateStatus(): Error saving item:",rowId:e,patch:i})}}async updateOwner(e,t){if(!this.CurrentOwnerField)return;this.busy();const i={};i[this.CurrentOwnerField.columnName]=t;try{const t=await(this.CurrentObject?.model().update(e,i));if(this.$kb?.updateItem(e,t),this.FormSide.isVisible()){const t=this.$kb.getItem(e);this.FormSide.refresh(t)}this.ready()}catch(i){this.AB.notify.developer(i,{context:"ABViewKanban:updateOwner(): Error saving item:",rowId:e,val:t}),this.ready()}}saveData(e){e.id&&this.$kb.exists(e.id)?this.$kb.updateItem(e.id,e):this.$kb.add(e)}unselect(){this.$kb&&this.$kb.eachList((e=>{e?.unselect?.()}))}addCard(){this.unselect(),this.FormSide.show(),$$(this.ids.resizer).show()}async removeCard(e){const t=this.AB,i=t.Webix;i.confirm({title:this.label("Remove card"),text:this.label("Do you want to delete this card?"),callback:async s=>{if(s){this.busy();try{(await(this.CurrentObject?.model().delete(e))).numRows>0?this.$kb.remove(e):i.alert({text:this.label("No rows were effected. This does not seem right.")})}catch(i){t.notify.developer(i,{message:"ABViewKanban:removeCard(): Error deleting item:",rowId:e})}this.ready()}}})}setFields(e){this.CurrentVerticalField=e.verticalGrouping,this.CurrentHorizontalField=e.horizontalGrouping,this.CurrentOwnerField=e.ownerField}}},97922:(e,t,i)=>{const s=i(44363).Z;e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewLabel_${e.id}`,i)}ui(){const e=this.view,t=super.ui([this.uiFormatting({view:"label",label:e.text||"*",align:this.settings.alignment,type:{height:"auto"}})]);return delete t.type,t}uiFormatting(e){switch(parseInt(this.settings.format)){case 0:e.css="ab-component-label ab-ellipses-text";break;case 1:e.css="ab-component-header ab-ellipses-text";break;case 2:e.css="ab-component-description ab-ellipses-text"}return e}}},30909:(e,t,i)=>{const s=i(44363).Z;e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewLayout_${e.id}`,i);const s=this.viewComponents??{};e.views().forEach((e=>{s[e.id]=e.component()})),this.viewComponents=s}ui(){const e=this.viewComponents,t=Object.keys(e).map((t=>e[t].ui())).filter((e=>e));0==t.length&&(t.push({}),t.push({view:"label",label:this.label("no content")}),t.push({}));const i=super.ui([{view:"layout",cols:t}]);return delete i.type,i}async init(e,t){await super.init(e);const i=this.view;i.views().forEach((s=>{this.viewComponents[s.id]?.init(e,t),i.eventAdd({emitter:s,eventName:"changePage",listener:e=>{i.changePage(e)}})}))}onShow(){this.view.views().forEach((e=>{this.viewComponents[e.id]?.onShow()}))}}},4030:(e,t,i)=>{const s=i(44363).Z;e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewList_${e.id}`,Object.assign({list:""},i))}ui(){const e=this.settings,t={id:this.ids.list,view:"dataview",type:{width:1e3,height:30},template:e=>{const t=this.view.field();return t?t.format(e):""}};0!==e.height?t.height=e.height:t.autoHeight=!0;const i=super.ui([t]);return delete i.type,i}async init(e){await super.init(e);const t=this.datacollection;t&&t.bind($$(this.ids.list))}}},46078:(e,t,i)=>{const s=i(44363).Z;e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewMenu_${e.id}`,Object.assign({menu:""},i))}ui(){const e=this.settings,t=super.ui([parseInt(e.menuInToolbar)?this.uiToolbar():this.uiMenu()]);return delete t.type,t}uiMenu(){const e=this.view,t=this.settings,i=e.constructor.defaultValues(),s=`${t.buttonStyle||i.buttonStyle} ${t.menuAlignment||i.menuAlignment} `;return{id:this.ids.menu,view:"menu",autoheight:!0,autowidth:!0,datatype:"json",css:s,layout:t.orientation||i.orientation,on:{onMenuItemClick:e=>{this.onClick(e)},onAfterRender:()=>{this.defineCypress()}},type:{subsign:!0}}}uiToolbar(){const e=this.settings,t=this.view,i=t.constructor.defaultValues(),s=this.uiMenu();let n=[],a=!1;const r=t.menuTextLeft??e.menuTextLeft,o=t.menuTextCenter??e.menuTextCenter,l=t.menuTextRight??e.menuTextRight;if("left"===e.menuPosition)a=!0,n.push(s);else if(r?.length){const e=15*r.length;n.push({view:"label",label:r,align:"left",width:e})}else n.push({view:"label",label:"",autowidth:!0});if("center"===e?.menuPosition)a=!0,n.push(s);else if(o?.length){const e=15*r.length;n.push({},{view:"label",label:o,align:"center",width:e},{})}else n.push({view:"label",label:"",autowidth:!0});if("right"===e?.menuPosition)a=!0,n.push(s);else if(l?.length){const e=15*r.length;n.push({view:"label",label:l,align:"right",width:e})}else n.push({view:"label",label:"",autowidth:!0});return!1===a&&(n=[s]),{view:"toolbar",css:e.menuTheme??i.menuTheme,padding:e.menuPadding?parseInt(e.menuPadding):i.menuPadding,elements:n}}async init(e){await super.init(e);const t=$$(this.ids.menu),i=this.view;if(t){const e=this.settings;i.ClearPagesInView(t),e.order?.length&&(i.AddPagesToView(t,e.order),t.refresh())}}onClick(e){const t=$$(this.ids.menu);let i;try{i=t.getMenuItem(e)}catch(t){return void this.AB.notify.developer(t,{context:"ABViewMenuComponent > onClick error gettint menu / menu item",itemId:e,menu:{id:this.view.id,settings:this.view.settings}})}const s=this.view;if("tab"===i.type){s.changePage(i.pageId);const e=s.application.pages((e=>e.id===i.pageId),!0)[0];if(!e)return;const t=e.views((e=>e.id===i.id),!0)[0];if(!t)return;const n=t.parent;if(!n)return;this.toggleParent(n);const a=setInterval((()=>{$$(t.id)&&$$(t.id).isVisible()?clearInterval(a):n.emit("changeTab",t.id)}),100)}else s.changePage(e)}toggleParent(e){if(!e.parent)return!1;const t=e.parent;if(!t?.parent)return!1;t.parent.emit("changeTab",t.id),this.toggleParent(t.parent)}defineCypress(){const e=$$(this.ids.menu);e&&e.data.each((t=>{const i=e.getItemNode(t.id);if(!i)return;const s=this.AB.definitionByID(t.id);i.setAttribute("data-cy",`menu-item ${s?.name} ${t.id} ${this.view.id}`)}))}}},90510:(e,t,i)=>{const s=i(44363).Z;e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewPDFImporter_${e.id}`,Object.assign({fileUploader:"",uploadList:"",dataview:"",fullImagePopup:"",fullImageCarousel:"",fullImageSelectToggle:"",fullImageLabel:"",selectAll:"",unselectAll:"",submit:""},i))}ui(){const e=this.ids,t=this;return super.ui([{rows:[{cols:[{id:e.fileUploader,view:"uploader",name:"records",link:e.uploadList,label:this.label("Upload a PDF file"),inputWidth:200,width:210,accept:"application/pdf",multiple:!1,autosend:!1,type:"icon",icon:"fa fa-file-pdf-o",on:{onBeforeFileAdd:e=>(this._csvFileInfo=e,!!this._csvFileInfo&&(this.loadFile(),!0))}},{id:e.uploadList,view:"list",type:"uploader",autoheight:!0,borderless:!0,onClick:{webix_remove_upload:(e,t)=>{this.removeFile(t)}}},{width:10},{view:"button",type:"icon",icon:"fa fa-th-large",maxWidth:30,click:()=>{this.displayBig()}},{view:"button",type:"icon",icon:"fa fa-th",maxWidth:30,click:()=>{this.displaySmall()}}]},{height:10},{id:e.dataview,view:"dataview",borderless:!0,css:"pdf-data-view",multiselect:!1,select:!1,type:{template:e=>this.pageTemplate(e),width:"auto",height:"auto"},on:{onSelectChange:e=>{this.renderPageImages()},onItemClick:function(e,i,s){i?.target?.className?.includes?.("unselect-page")?t.unselect(e):i?.target?.className?.includes?.("select-page")?t.select(e):i?.target?.className?.includes?.("pdf-zoom")&&(t._fullImagePopup.show(),$$(t.ids.fullImageCarousel).setActiveIndex(parseInt(e??0)-1),t.refreshFullImage())}}},{height:10},{cols:[{id:e.selectAll,view:"button",type:"icon",icon:"fa fa-check-square-o",maxWidth:160,label:this.label("Select All"),click:()=>{this.selectAll()}},{id:e.unselectAll,view:"button",type:"icon",icon:"fa fa-square-o",maxWidth:160,label:this.label("Unselect All"),click:()=>{this.unselectAll()}},{fillspace:!0},{id:e.submit,view:"button",css:"webix_primary",type:"icon",icon:"fa fa-floppy-o",disabled:!0,maxWidth:180,label:this.label("Submit"),click:()=>{this.submit()}}]}]}])}uiPopup(){const e=this.ids;return{id:e.fullImagePopup,view:"window",modal:!0,position:"center",headHeight:25,head:{cols:[{fillspace:!0},{view:"button",type:"icon",icon:"fa fa-times",maxWidth:25,height:25,click:()=>{$$(e.fullImagePopup)?.hide()}}]},body:{rows:[{id:e.fullImageCarousel,view:"carousel",width:600,height:500,navigation:{items:!0,buttons:!0,type:"side"},cols:[],on:{onShow:()=>{this.refreshFullImage()}}},{view:"layout",cols:[{id:e.fullImageSelectToggle,view:"toggle",type:"icon",offIcon:"fa fa-square-o",onIcon:"fa fa-check-square-o",offLabel:this.label("Unselected"),onLabel:this.label("Selected"),width:130,on:{onChange:e=>{const t=$$(this.ids.fullImageCarousel).getActiveIndex()+1;e?this.select(t):this.unselect(t)}}},{fillspace:!0},{id:e.fullImageLabel,view:"label",width:120,label:`${this.label("Page Number")}: #`}]}]}}}async init(e){await super.init(e);const t=$$(this.ids.dataview);if(t&&this.AB.Webix.extend(t,webix.ProgressBar),!this._fullImagePopup){const e=this.uiPopup();this._fullImagePopup=this.AB.Webix.ui(e)}}onShow(){this.initPdfjs(),super.onShow()}async initPdfjs(){this.pdfjs&&window.pdfjsWorker||(this.busy(),this.pdfjs=(await Promise.all([i.e(88),i.e(555),i.e(611)]).then(i.bind(i,12555))).default,this.ready())}async _readFileBuffer(){const e=this._csvFileInfo;if(!e||!e.file)return Promise.resolve(new ArrayBuffer(0));const t=new FileReader;return new Promise(((i,s)=>{t.onload=e=>{const t=e.target.result;i(t)},t.onerror=e=>{s(e)},t.readAsArrayBuffer(e.file)}))}async _toBlob(e,t){if(t)return new Promise(((i,s)=>{t.toBlob((t=>{const s=new File([t],`${e}.png`,{type:"image/png"});i(s)}),"image/png")}))}async _uploadImage(e){const t=$$(this.ids.fullImageCarousel),i=`${this.view.id}_temp_canvas`,s=document.getElementById(i)??document.createElement("canvas");s.id=i,s.width=t.config.width-20,await this.showPage(e,s);const n=await this._toBlob(e,s);return new Promise(((e,t)=>{const i=this.AB.Webix.ui({view:"uploader",apiOnly:!0,upload:this.field.urlUpload(),inputName:"file",multiple:!1,on:{onFileUpload:(t,i)=>{e(i?.data?.uuid)},onFileUploadError:(e,i)=>{t(i)},onUploadComplete:()=>i.destructor()}});i.addFile(n,n.size)}))}_increaseProgressValue(){const e=$$(this.ids.dataview),t=2*(e.getSelectedId(!0)??[]).length;this._progressSteps=this._progressSteps??0,this._progressSteps++,e?.showProgress?.({type:"bottom",position:this._progressSteps/t})}async loadFile(){if(this.clearDataview(),!this._csvFileInfo)return;const e=await this._readFileBuffer();this._pdfDoc=await this.pdfjs.getDocument(e).promise;const t=this._pdfDoc.numPages,i=$$(this.ids.dataview),s=$$(this.ids.fullImageCarousel),n=[];for(let e=1;e<=t;e++)i.add({id:e,pageNumber:e}),n.push({template:e=>this.fullImageTemplate(e),data:{pageNumber:e}});this.renderPageImages(),s&&this.AB.Webix.ui(n,s),this.selectAll(),$$(this.ids.submit)?.enable()}removeFile(e){return $$(this.ids.uploadList)?.remove(e),delete this._pdfDoc,delete this._csvFileInfo,this.clearDataview(),$$(this.ids.submit)?.disable(),!0}pageTemplateId(e){return`pdf-importer-${this.view.id}-${e}`}pageTemplate(e){return`\n      <div>\n         <div class="pdf-data-view-item">\n            <div>\n            ${$$(this.ids.dataview).getSelectedId(!0).filter((t=>t==e.id)).length?'<i class="unselect-page fa fa-check-square-o"></i>':'<i class="select-page fa fa-square-o"></i>'}\n            </div>\n            <div style="width: 15px;">\n               ${e.pageNumber}\n            </div>\n         </div>\n         <div class="pdf-zoom pdf-data-view-image">\n            <canvas class="pdf-zoom" width="${this.pageItemWidth}" id="${this.pageTemplateId(e.pageNumber)}"></canvas>\n            <div class="pdf-zoom pdf-data-view-image-icon">\n               <i class="pdf-zoom fa fa-search-plus fa-4x"></i>\n            </div>\n         </div>\n      </div>\n      `}renderPageImages(){$$(this.ids.dataview)?.find({}).forEach((e=>{const t=document.querySelector(`#${this.pageTemplateId(e.pageNumber)}`);this.showPage(e.pageNumber,t)}))}async showPage(e,t){if(!this._pdfDoc)return;e=parseInt(e);const i=await this._pdfDoc.getPage(e),s=i.getViewport({scale:1}).width,n=t.width/s,a=i.getViewport({scale:n});return t.height=a.height,i.render({canvasContext:t.getContext("2d"),viewport:a}).promise}clearDataview(){const e=$$(this.ids.dataview),t=$$(this.ids.fullImageCarousel);e?.clearAll(),t&&this.AB.Webix.ui([{view:"label",align:"center",height:t.height,label:this.label("No image")}],t)}displaySmall(){this._isDisplayBig=!1,$$(this.ids.dataview)?.render(),this.renderPageImages()}displayBig(){this._isDisplayBig=!0,$$(this.ids.dataview)?.render(),this.renderPageImages()}get pageItemWidth(){return this._isDisplayBig?250:150}select(e){const t=$$(this.ids.dataview);let i=t.getSelectedId(!0);i.push(e),i=i.filter((e=>e)),i.length?t.select(i):t.unselectAll()}unselect(e){const t=$$(this.ids.dataview);let i=t.getSelectedId(!0);i=i.filter((t=>t&&t!=e)),i.length?t.select(i):t.unselectAll()}selectAll(){$$(this.ids.dataview)?.selectAll()}unselectAll(){$$(this.ids.dataview)?.unselectAll()}fullImageTemplateId(e){return`${this.pageTemplateId(e)}_full_size`}fullImageTemplate(e){return`<canvas width="${$$(this.ids.fullImageCarousel).config.width-20}" id="${this.fullImageTemplateId(e.pageNumber)}"></canvas>`}refreshFullImage(){const e=this.ids,t=$$(e.fullImageCarousel).getActiveIndex()+1,i=document.querySelector(`#${this.fullImageTemplateId(t)}`);this.showPage(t,i);const s=$$(e.dataview).getSelectedId(!0).filter((e=>e==t)).length>0;$$(e.fullImageSelectToggle).setValue(s),$$(e.fullImageLabel).setValue(`${this.label("Page Number")}: ${t}`)}get object(){return this.view.datacollection?.datasource}get field(){return this.object?.fields?.((e=>e.id==this.view.settings.fieldID))[0]}busy(){const e=this.ids,t=$$(e.fileUploader),i=$$(e.uploadList),s=$$(e.dataview),n=$$(e.submit),a=$$(e.selectAll),r=$$(e.unselectAll),o=$$(e.fullImageSelectToggle);t?.disable(),i?.disable(),n?.disable(),a?.disable(),r?.disable(),o?.disable(),s?.showProgress?.({type:"bottom",position:.001})}ready(){const e=this.ids,t=$$(e.fileUploader),i=$$(e.uploadList),s=$$(e.dataview),n=$$(e.submit),a=$$(e.selectAll),r=$$(e.unselectAll),o=$$(e.fullImageSelectToggle);t?.enable(),i?.enable(),n?.enable(),a?.enable(),r?.enable(),o?.enable(),s?.hideProgress?.(),delete this._progressSteps}async submit(){const e=this.field;if(!this._pdfDoc||!e)return;this.busy();const t=this.ids,i=$$(t.dataview).getSelectedId(!0)??[],s=e.object.model(),n=this.datacollection.datacollectionLink,a=[];for(let t=0;t<i.length;t++){const r=i[t];if(null==r||""==r)return;const o=await this._uploadImage(r);this._increaseProgressValue();const l=e.object.defaultValues();l[e.columnName]=o;const c=n?.getCursor();if(c){const t=n?.datasource;e.object.connectFields().forEach((e=>{if(t.id==e.settings.linkObject&&void 0===l[e.columnName]){const i=e.indexField?e.indexField.columnName:t.PK();l[e.columnName]={},l[e.columnName][i]=c[i]??c.id}}))}a.push(await s.create(l)),this._increaseProgressValue()}this.view.doSubmitRules(a),a&&this.view.emit("saved",a),this.ready()}}},5740:(e,t,i)=>{const s=i(44363).Z,n=i(59675),a=i(37900),r=i(18799);e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewPivot_${e.id}`,Object.assign({pivot:""},i))}ui(){const e=this,t=this.settings,i={id:this.ids.pivot,view:"pivot",readonly:!0,removeMissed:t.removeMissed,totalColumn:t.totalColumn,separateLabel:t.separateLabel,min:t.min,max:t.max,height:t.height,fields:this._getFields(),format:e=>{const i=t.decimalPlaces??2;return e&&"0"!=e?parseFloat(e).toFixed(i||0):e},override:new Map([[pivot.services.Backend,class extends pivot.services.Backend{async data(){const t=e.datacollection;if(!t)return webix.promise.resolve([]);const i=t.datasource;if(!i)return webix.promise.resolve([]);t.dataStatus===t.dataStatusFlag.notInitial&&await t.loadData();const s=t.getData().map((e=>{const t={};return i.fields().forEach((i=>{t[i.columnName]=i instanceof n||i instanceof a||i instanceof r?e[i.columnName]:i.format(e)})),t}));return webix.promise.resolve(s)}}],[pivot.views.table,class extends pivot.views.table{CellFormat(e){const i=t.decimalPlaces??2;return e||(e=0===e?"0":""),e?parseFloat(e).toFixed(i):e}}]])};t.structure&&(i.structure=t.structure);const s=super.ui([i]);return delete s.type,s}_getFields(){const e=this.datacollection;if(!e)return[];const t=e.datasource;return t?t.fields().map((e=>{let t="text";switch(e.key){case"calculate":case"formula":case"number":t="number";break;case"date":case"datetime":t="date"}return{id:e.columnName,value:e.label,type:t}})):[]}}},33188:(e,t,i)=>{const s=i(44363).Z;e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewReportManager_${e.id}`,Object.assign({reportManager:""},i)),this.readonly=!1}ui(){const e=this,t=this.settings,i=this.AB,s=i.Webix,n=this.datacollection,a=n?.datasource.fieldByID(t.dataviewFields.name)?.columnName,r=n?.datasource.fieldByID(t.dataviewFields.text)?.columnName,o=n?.datasource.fieldByID(t.dataviewFields.queries)?.columnName,l=this.ids;class c extends reports.services.Backend{async getModules(){return null==n?[]:(await e.waitInitializingDCEvery(1e3,n),n.getData().map((e=>({id:e.id,name:e[a],text:JSON.stringify(e[r]),updated:e.updated_at}))))}async addModule(e){const t={};return t[a]=e.name,t[r]=e.text,{id:(await n.model.create(t)).id}}async updateModule(e,t){const i={};i[a]=t.name,i[r]=t.text;let s={};return s=await n.model.update(e,i),{id:s.id}}async deleteModule(e){return await n.model.delete(e),{id:e}}async getModels(){const s={};return(t.datacollectionIDs.length>0?t.datacollectionIDs:e.view.application.datacollectionIDs).forEach((t=>{const n=i.datacollectionByID(t);if(!n)return;if(!n.datasource)return;const a=e.getReportFields(n);s[n.id]={id:n.id,name:n.label,data:a,refs:[]}})),s}async getQueries(){const e=$$(l.reportManager).getState().moduleId||"";return""===e?[]:(await n.model.findAll({where:{uuid:e}})).data[0][o]||[]}async addQuery(e){const t=$$(l.reportManager).getState().moduleId||"";if(""===t)return{};const i=(await n.model.findAll({where:{uuid:t}})).data[0];if(null==i)return{};const a=[...i[o]||[]],r=s.uid();a.push(Object.assign({id:r},e));const c={};return c[o]=a.sort(((e,t)=>e.name<t.name?-1:e.name>t.name?1:0)),await n.model.update(t,c),{id:r}}async updateQuery(e,t){const i=$$(l.reportManager).getState().moduleId||"";if(""===i)return{};const s=(await n.model.findAll({where:{uuid:i}})).data[0];if(null==s)return{};const a=[...s[o]||[]],r=a.findIndex((t=>t.id===e));a[r]=Object.assign({id:e},t);const c={};return c[o]=a.sort(((e,t)=>e.name<t.name?-1:e.name>t.name?1:0)),await n.model.update(i,c),{id:e}}async deleteQuery(e){const t=$$(l.reportManager).getState().moduleId||"";if(""===t)return{};const i=(await n.model.findAll({where:{uuid:t}})).data[0];if(null==i)return{};const s=i[o]||[],a=s.findIndex((t=>t.id===e));if(a>=0){const e={};e[o]=s.filter(((e,t)=>t!==a)).sort(((e,t)=>e.name<t.name?-1:e.name>t.name?1:0)),await n.model.update(t,e)}return{id:e}}async getData(t){let n=[],a=[],r=[],o={},l=[];r.push(t.data),(t.joins||[]).forEach((e=>{r.push(e.sid),r.push(e.tid)})),r=i.uniq(r),r.forEach((t=>{a.push(new Promise(((i,s)=>{(async()=>{try{o[t]=await e.getData(t)||[],i()}catch(e){s(e)}})()})))})),r.forEach((t=>{const s=i.datacollectionByID(t);s&&(l=l.concat(e.getReportFields(s).map((e=>(e.id=`${t}.${e.id}`,e)))))})),await Promise.all(a),n=o[t.data]||[],t.joins?.length&&(t.joins||[]).forEach((e=>{const t=i.datacollectionByID(e.sid);if(!t)return;const s=t.datasource;if(!s)return;const a=i.datacollectionByID(e.tid);if(!a)return;const r=a.datasource;if(!r)return;const l=s.fieldByID(e.sf),c=r.fieldByID(e.tf);if(!l&&!c)return;const u=o[e.sid]||[],d=o[e.tid]||[];u.forEach((t=>{d.forEach((s=>{let a=t[l?`${e.sid}.${l.columnName}.id`:`${e.sid}.id`]||[],r=s[c?`${e.tid}.${c.columnName}.id`:`${e.tid}.id`]||[];if(Array.isArray(a)||(a=[a]),Array.isArray(r)||(r=[r]),a.filter((e=>r.indexOf(e)>-1))?.length){const a=n.filter((i=>i[`${e.sid}.id`]===t[`${e.sid}.id`]&&!i[`${e.tid}.id`]))||[];a?.length?(a||[]).forEach((e=>{for(const t in s)"id"!==t&&(e[t]=s[t])})):n.push(Object.assign(i.cloneDeep(t),i.cloneDeep(s)))}}))}))}));const c=JSON.parse(t.query||"{}");c?.rules?.length&&c.rules.forEach((e=>{e&&e.type&&e.condition&&"date"===e.type&&e.condition.filter&&("string"==typeof e.condition.filter&&(e.condition.filter=i.rules.toDate(e.condition.filter)),e.condition.filter.start&&"string"==typeof e.condition.filter.start&&(e.condition.filter.start=i.rules.toDate(e.condition.filter.start)),e.condition.filter.end&&"string"==typeof e.condition.filter.end&&(e.condition.filter.end=i.rules.toDate(e.condition.filter.end)))}));const u=s.ui({view:"query",fields:l,value:c}),d=new s.DataCollection;let h;d.parse(n);try{h=u.getFilterFunction()}catch(e){}return h&&d.filter(h),(t.sort||[]).forEach((e=>{e.id&&d.sort({as:"string",dir:e.mod||"asc",by:`#${e.id}#`})})),n=d.serialize(),u.destructor(),d.destructor(),t?.group?.length&&(n=_.groupBy(n,(e=>t.group.map((t=>{const i=t.split("."),n=i.length>2?`${i[1]}.${i[2]}`:t;if("date"===l.find((e=>e.id===n)).type){const a=s.i18n.dateFormatStr(e[n]),r=a.split("/");switch(i[0]){case"day":return e[t]=r[1],r[1];case"month":return e[t]=r[0],r[0];case"year":return e[t]=r[2],r[2];case"yearmonth":return e[t]=`${r[0]}/${r[2]}`,e[t];default:return e[t]=a,a}}return e[n]?.toString?.()})).join(""))),n=Object.values(n).map((e=>{const s={};return(t.columns||[]).forEach((t=>{const n=t.split(".")[0],a=t.replace(/sum.|avg.|count.|max.|min./g,"");switch(n){case"sum":s[t]=i.sumBy(e,a);break;case"avg":s[t]=i.meanBy(e,a);break;case"count":s[t]=(e||[]).length;break;case"max":s[t]=(i.maxBy(e,a)||{})[a]||"";break;case"min":s[t]=(i.minBy(e,a)||{})[a]||"";break;default:s[t]=e[0][t]}})),s}))),n}async getOptions(e){return[]}async getFieldData(e){return[]}}class u extends reports.services.Local{constructor(e){super(e),this._currentModuleID=""}getQueries(){const e=$$(l.reportManager).getState().moduleId;return this._currentModuleID!==e&&(this._currentModuleID=e,this._queries=null),super.getQueries()}}class d extends reports.views.editor{init(){if(super.init(),!e.readonly||1===t.editMode)return;const i=this.$$("tabbar");if(1===t.hideCommonTab){const t=()=>{i.callEvent("onChange",["data"]),i.disableOption("common"),e.removeListener("editMode.tabbar.query",t)};e.on("editMode.tabbar.query",t)}1===t.hideDataTab&&i.disableOption("other"),1===t.hideViewTab&&i.disableOption("structure"),this.on(this.app,"editMode.button.back",(()=>{this.Reset(!0)}))}Reset(i=!1){const s=this.AppState.moduleId;e.readonly&&!(1===t.editMode)&&null!=s&&!i||super.Reset(),this.Local.getModule(s)}TrackChanges(){super.TrackChanges(),t.hideCommonTab&&e.emit("editMode.tabbar.query")}}class h extends reports.views.toolbar{config(){const i=super.config();return e.readonly&&1!==t.editMode&&(i.elements[5].cols=i.elements[5].cols.map((i=>Object.assign(i,{hidden:e.readonly&&!(1===t.editMode)}))),i.elements[5].cols.push({},{view:"button",type:"icon",icon:"wxi-angle-double-left",label:e.label("Back"),localId:"forceReset",click:()=>this.app.callEvent("editMode.button.back",[])})),i}}class p extends reports.views["editor/common"]{config(){const t=super.config();return e.readonly?Object.assign({},t,{elements:t.elements.map(((e,t)=>Object.assign({hidden:!(t>=2&&t<5)},e)))}):t}ShowDeleteButton(){super.ShowDeleteButton(),e.readonly&&this.$$("delete").hide()}}class f extends reports.views["editor/data"]{config(){const t=super.config();return e.readonly&&(t.rows[0].rows[0].hidden=!0,t.rows[0].rows.unshift({label:"Filtering query",view:"label",width:120})),t}}class m extends reports.views.table{GetColumnConfig(t){let i={id:t.id,header:t.meta.header&&"none"!==t.meta.header?[t.meta.name||t.name,{content:"text"===t.header?"textFilter":"richSelectFilter"}]:t.meta.name||t.name,type:t.type,sort:"date",width:t.width||200};const n=e.AB.datacollectionByID(t.mid)?.datasource.fields((e=>e.columnName===t.name))[0];return"date"===t.type?i.format=e=>e?.getTime&&!isNaN(e.getTime())?"datetime"===n?.key?s.i18n.fullDateFormatStr(e):s.i18n.dateFormatStr(e):"":i=super.GetColumnConfig(t),i}async GetTableData(e){const t=await super.GetTableData(e),i=e.buckets;if(!i)return t;if(0===i.length)return t;const s=e.columns.map((e=>e.id)),n=e.buckets.filter((e=>s.includes(e.column)));return 0===n.length?t:[t[0].map((e=>{const t={};return n.forEach((i=>{const s=i.options;for(let n=0;n<s.length;n++)if(s[n].values?.includes(e[i.column])||n===s.length-1){t[i.column]=s[n].id;break}})),Object.assign({},e,t)})),t[1]]}}const g=super.ui([{id:l.reportManager,view:"reports",toolbar:!0,override:new Map([[reports.services.Backend,c],[reports.services.Local,u],[reports.views.editor,d],[reports.views.toolbar,h],[reports.views["editor/common"],p],[reports.views["editor/data"],f],[reports.views.table,m]])}]);return delete g.type,delete g.height,g}async init(e,t){this.AB=e,this.readonly=t<2;const i=$$(this.ids.reportManager).getState();i.readonly=this.readonly,i.mode=this.readonly&&1===this.settings.editMode?"edit":"list"}getReportFields(e){if(!e)return[];const t=e.datasource;if(!t)return[];const i=[];return t.fields().forEach((e=>{const t=e.columnHeader();if(e.isConnection){if(e.isSource()){const t=this.view.application.datacollectionsIncluded((t=>this.settings.datacollectionIDs.includes(t.id)&&t.settings.datasourceID===e.settings.linkObject));(t||[]).forEach((t=>{i.push({id:e.id,name:e.label,filter:!1,edit:!1,type:"reference",ref:t.id,key:!1,show:!1})}))}}else{let s="text";switch(e.key){case"boolean":case"number":case"date":s=e.key;break;case"datetime":s="date"}i.push({id:e.columnName,name:e.label,filter:e.fieldIsFilterable(),edit:!1,type:s,format:t.format,options:t.options,ref:"",key:!1,show:!0,abField:e})}})),i}async getData(e){const t=this.AB.datacollectionByID(e);if(!t)return[];const i=t.datasource;if(!i)return[];await this.waitInitializingDCEvery(1e3,t);const s=this.getReportFields(t),n=[];return(t.getData()||[]).forEach((e=>{const a={id:e.id};a[`${t.id}.id`]=e.id,i.fields().forEach((i=>{const n=i.columnName,r=`${t.id}.${n}`;if(i)if(i.isConnection){let t=i.datasourceLink.PK();Array.isArray(e[n])?a[`${r}.id`]=e[n].map((e=>e[t]||e.id||e)):e[n]&&(a[`${r}.id`]=e[n][t]||e[n].id||e[n])}else a[r]=i.format(e);else a[r]=e[n];const o=s.find((e=>e.id===n||e.id===i.id));if(o)switch(o.type){case"text":case"reference":a[r]=(a[r]||"").toString();break;case"number":a[r]=parseFloat((a[r]||0).toString().replace(/[^\d.-]/g,""));break;case"date":a[r]=e[n],a[r]?a[r]instanceof Date||(a[r]=this.AB.rules.toDate(e[n])):a[r]=""}})),n.push(a)})),n}async onShow(){super.onShow();const e=this.ids,t=$$(e.component);null==t||this.__isShowing||(this.__isShowing=!0,t.reconstruct())}}},79608:(e,t,i)=>{const s=i(44363).Z;e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewScheduler_${e.id}`,Object.assign({scheduler:""},i))}ui(){const e=this.ids,t=this.AB,i=this,s=this.AB.Webix,n=this.settings,a=this.datacollection,r=a?.datasource.fieldByID(n.dataviewFields.name)?.columnName,o=a?.datasource.fieldByID(n.dataviewFields.start)?.columnName,l=a?.datasource.fieldByID(n.dataviewFields.end)?.columnName,c=a?.datasource.fieldByID(n.dataviewFields.allDay)?.columnName,u=a?.datasource.fieldByID(n.dataviewFields.repeat)?.columnName,d=a?.datasource.fieldByID(n.dataviewFields.calendar)?.columnName,h=a?.datasource.fieldByID(n.dataviewFields.color)?.columnName,p=a?.datasource.fieldByID(n.dataviewFields.notes)?.columnName,f=a?.datasource.fieldByID(n.dataviewFields.originID)?.columnName,m=a?.datasource.fieldByID(n.dataviewFields.sectionID)?.columnName,g=a?.datasource.fieldByID(n.dataviewFields.unitID)?.columnName,b=t.datacollectionByID(this.settings.calendarDataviewID),v=b?.datasource.fieldByID(n.calendarDataviewFields.title)?.columnName,w=b?.datasource.fieldByID(n.calendarDataviewFields.color)?.columnName,y=b?.datasource.fieldByID(n.calendarDataviewFields.active)?.columnName,_=[];Object.keys(n.timeline).forEach((e=>{0!==n.timeline[e]&&_.push({id:`${e}`,value:`${e.charAt(0).toUpperCase()}${e.slice(1)}`})}));const x=super.ui([{padding:6,cols:[{view:"label",width:150,label:"Export events data to: "},{view:"button",width:100,value:this.label("Excel"),hidden:0===n.export.excel,click:()=>{s.toExcel(e.scheduler)}},{view:"button",width:100,value:this.label("CSV"),hidden:0===n.export.csv,click:()=>{s.toCSV(e.scheduler)}},{view:"button",width:100,value:this.label("PDF"),hidden:0===n.export.pdf,click:()=>{s.toPDF(e.scheduler,{autowidth:!0})}},{}]},{id:e.scheduler,view:"scheduler",date:new Date,readonly:1===n.readonly,timeline:1===n.timeline.timeline,override:new Map([[scheduler.services.Backend,class extends reports.services.Backend{async addCalendar(e){if(null==b)return{};const t={};return t[v]=e.text,t[w]=e.color,t[y]=e.active,{id:(await b.model.create(t)).id}}async addEvent(e){if(null==a)return{};const t={};return t[r]=e.text,t[o]=new Date(e.start_date),t[l]=new Date(e.end_date),t[c]=e.all_day,t[u]=e.recurring,t[d]=e.calendar,t[h]=e.color,t[m]=e.section||"No Section",t[g]=e.units||"No Unit",t[p]=e.details,t[f]=e.origin_id,{id:(await a.model.create(t)).id}}async calendars(){return null==b?[]:(await i.waitInitializingDCEvery(1e3,b),b.getData().map((e=>({id:e.id,text:e[v],color:e[w],active:e[y]}))))}async events(e){if(null==a)return[];await i.waitInitializingDCEvery(1e3,a);const t=await this.units(),n=await this.sections();return a.getData().map((e=>{let i=t.find((t=>t.id===e[g]))?.id,a=n.find((t=>t.id===e[m]))?.id;return null!=a&&null!=i||(a=a||"No Section",i=i||"No Unit"),{id:e.id,text:e[r],start_date:s.Date.dateToStr("%Y-%m-%d %H:%i:%s")(e[o]),end_date:s.Date.dateToStr("%Y-%m-%d %H:%i:%s")(e[l]),all_day:e[c],recurring:e[u],calendar:e[d],color:e[h],section:a,units:i,details:e[p],origin_id:e[f]}}))}async removeCalendar(e){await b.model.delete(e)}async removeEvent(e){await a.model.delete(e)}async sections(){return[{text:"No Section",id:"No Section"}].concat(n.timelineSectionList.split(", ").map((e=>({id:e,text:e}))))}async units(){return[{id:"No Unit",value:"No Unit"}].concat(n.unitList.split(", ").map((e=>({id:e,value:e}))))}async updateCalendar(e,t){if(null==b)return{};const i={};i[v]=t.text,i[w]=t.color,i[y]=t.active,await b.model.update(e,i)}async updateEvent(e,t,i,s){if(null==a)return{};const n={};n[r]=t.text,n[o]=new Date(t.start_date),n[l]=new Date(t.end_date),n[c]=t.all_day,n[u]=t.recurring,n[d]=t.calendar,n[h]=t.color,n[m]=t.section||"No Section",n[g]=t.units||"No Unit",n[p]=t.details,n[f]=t.origin_id,await a.model.update(e,n)}}],[scheduler.views["bars/nav"],class extends scheduler.views["bars/nav"]{config(){const e=super.config();return e.width=160,e.options=_,e}}],[scheduler.views["bars/navpopup"],class extends scheduler.views["bars/navpopup"]{config(){const e=super.config(),t=_.map((e=>Object.assign({icon:`shi-${e.id}`},e)));return this.app.config.calendars?e.body.body.rows[0].data=t:e.body.data=t,e}}],[scheduler.views["modes/day/multiday"],class extends scheduler.views["modes/day/multiday"]{LimitData(e){super.LimitData(e||[])}}]])}]);return delete x.type,x}async onShow(){super.onShow();const e=this.ids,t=$$(e.component);null==t||this.__isShowing||(this.__isShowing=!0,t.reconstruct())}}},59724:(e,t,i)=>{const s=i(44363).Z;e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewTab_${e.id}`,Object.assign({tab:"",sidebar:"",expandMenu:"",collapseMenu:"",popupTabManager:"",popupTabManagerForm:"",popupTabManagerSaveButton:""},i)),this.viewComponents=this.viewComponents||e.views((e=>e.getUserAccess())).map((e=>({view:e})))}ui(){const e=this.ids,t=this.view,i=this.AB,s=i.Webix;let n=null;s.type(s.ui.tree,{baseType:"sideBar",name:"customIcons",icon:(e,t)=>e.icon.length?["<span class='webix_icon webix_sidebar_icon fa fa-fw fa-",e.icon,"'></span>"].join(""):["<span class='webix_icon webix_sidebar_icon sidebarCustomIcon'>",e.value.charAt(0).toUpperCase(),"</span>"].join("")});const a=this.viewComponents,r=this.settings;if(a.length>0)if(r.stackTabs){const s=a.map((e=>{const t=e.view;return{id:`${t.id}_menu`,value:t.label,icon:t.tabicon?t.tabicon:""}}));if(s.length){const o={id:e.collapseMenu,value:this.label("Collapse Menu"),icon:"chevron-circle-left"},l={id:e.expandMenu,value:this.label("Expand Menu"),icon:"chevron-circle-right",hidden:!0};let c=`${a[0].view.id}_menu`;const u=i.Storage,d={view:"sidebar",type:"customIcons",id:e.sidebar,height:r.height,width:r.sidebarWidth?r.sidebarWidth:0,scroll:!0,position:r.sidebarPos?r.sidebarPos:"left",css:r.darkTheme?"webix_dark":"",data:s.concat(o),on:{onItemClick:t=>{if(t===e.collapseMenu)setTimeout((()=>{const t=$$(e.sidebar);t.remove(e.collapseMenu),t.add(l),t.toggle(),t.select(c),u.set(`${e.tab}-state`,t.getState())}),0);else if(t===e.expandMenu)setTimeout((()=>{const t=$$(e.sidebar);t.remove(e.expandMenu),t.add(o),t.toggle(),t.select(c),u.set(`${e.tab}-state`,t.getState())}),0);else{c=t,t=t.replace("_menu","");let e=$$(t);if(e)e.show(!1,!1);else{let e=`ABViewTabComponent[${this.name}][${this.id}] could not resolve UI panel for provided menu [${c}].`;this.AB.notify("developer",e,{})}}},onSelectChange:()=>{p()},onAfterRender:()=>{p()}}},h={view:"multiview",id:e.tab,keepViews:!0,minWidth:r.minWidth,cells:a.map((e=>({id:e.view.id,view:"layout",rows:[]}))),on:{onViewChange:(e,t)=>{this.onShow(t)}}},p=function(){const i=$$(e.sidebar),s=i?.$view.querySelector(`[webix_tm_id="${e.collapseMenu}"]`);s&&s.setAttribute("data-cy",`tab-collapseMenu-${e.collapseMenu}`);const n=i?.$view.querySelector(`[webix_tm_id="${e.expandMenu}"]`);n&&n.setAttribute("data-cy",`tab-expandMenu-${e.expandMenu}`),t.views((e=>{const s=i?.$view?.querySelector(`[webix_tm_id="${e.id}_menu"]`);s&&s.setAttribute("data-cy",`tab-${e.name.replace(" ","")}-${e.id}-${t.id}`)}))};let f=[d,h];"right"===r.sidebarPos&&(f=[h,d]),n={cols:f}}else n={view:"spacer"}}else{const i=t.views((e=>{if(e.getUserAccess()>0)return e})).map((e=>{const t={id:e.id,view:"layout",rows:[]};let i="";return i=e.tabicon?r.iconOnTop?["<div class='ab-tabIconContainer'><span class='fa fa-lg fa-fw fa-",e.tabicon,"'></span><br/>",e.label,"</div>"].join(""):["<span class='fa fa-lg fa-fw fa-",e.tabicon,"'></span> ",e.label].join(""):e.label,{header:i,body:t}}));n=i.length?{rows:[{view:"tabview",id:e.tab,minWidth:r.minWidth,height:r.height,tabbar:{height:60,type:"bottom",css:r.darkTheme?"webix_dark":"",on:{onAfterRender:()=>{t.views((i=>{const s=$$(e.tab)?.$view?.querySelector(`[button_id="${i.id}"]`);s&&s.setAttribute("data-cy",`tab ${i.name} ${i.id} ${t.id}`)}))}}},multiview:{on:{onViewChange:(e,t)=>{this.onShow(t)}}},cells:i}]}:{view:"spacer"}}else n={view:"spacer"};return n=super.ui([n]),delete n.type,n}async init(e){await super.init(e);const t=this.ids,i=$$(t.tab),s=this.AB,n=s.Webix;i&&n.extend(i,n.ProgressBar);const a=this.view;this.viewComponents.forEach((e=>{this.eventAdd({emitter:e.view,eventName:"changePage",listener:(...e)=>this.changePage(...e)})})),this.eventAdd({emitter:a,eventName:"changeTab",listener:(...e)=>this.changeTab(...e)});const r=$$(t.sidebar);if(!r)return;const o=await s.Storage.get(`${t.tab}-state`);if(!o)return;const l={id:t.collapseMenu,value:this.label("Collapse Menu"),icon:"chevron-circle-left"},c={id:t.expandMenu,value:this.label("Expand Menu"),icon:"chevron-circle-right",hidden:!0};r.setState(o);const u=r.getItem(t.collapseMenu)??null,d=r.getItem(t.expandMenu)??null;o.collapsed?u&&d&&r.add(c):u&&d&&r.add(l)}changePage(e){const t=$$(this.ids.tab);t?.blockEvent(),this.view.changePage(e),t?.unblockEvent()}changeTab(e){const t=this.view,i=$$(e);if(this.toggleParent(t.parent),this.settings.stackTabs)if(i.isVisible())$$(this.ids.tab).setValue(e);else{const e=setInterval((()=>{i.isVisible()&&clearInterval(e),i.show(!1,!1)}),200)}}toggleParent(e){const t=$$(e.id);"tab"!==e.key&&"viewcontainer"!==e.key||t?.show(!1,!1),e.parent&&this.toggleParent(e.parent)}onShow(e){const t=this.ids;let i=!1;const s=$$(t.sidebar);!e&&s&&(e=s.getSelectedId().replace("_menu",""));const n=this.view;this.viewComponents.forEach((a=>{const r=n.views((e=>e.id===a.view.id));let o=0;r.length&&(o=r[0].getUserAccess()),!e&&!i&&o>0&&(e=a.view.id,i=!0);const l=$$(t.tab),c=this.settings;if(!a?.component&&a?.view?.id===e){l?.showProgress&&l.showProgress({type:"icon"}),a.component=a.view.component();const e=$$(a.view.id),t=this.AB,i=t.Webix;c.stackTabs?i.ui({id:a.view.id,view:"scrollview",css:"ab-multiview-scrollview",body:a.component.ui()},e):i.ui({id:a.view.id,view:"scrollview",css:"ab-tabview-scrollview",body:a.component.ui()},e),o=a.view.getUserAccess(),a.component.init(t,o),setTimeout((()=>{l?.hideProgress?.()}),10)}a?.view?.id===e&&a?.component?.onShow&&a.component.onShow(),c.stackTabs&&a?.view?.id===e&&($$(e).show(!1,!1),s.select(`${e}_menu`))}))}}},97669:(e,t,i)=>{const s=i(44363).Z;e.exports=class extends s{constructor(e,t,i){super(e,t||`ABViewText_${e.id}`,Object.assign({text:""},i))}ui(){const e=this.ids,t=this.settings,i={id:e.text,view:"template",minHeight:10,css:"ab-custom-template",borderless:!0};t.height?i.height=t.height:i.autoheight=!0;const s=super.ui([i]);return delete s.type,s}displayText(e){const t=this.ids,i=this.view.displayText(e,t.text),s=$$(t.text);s&&(s.define("template",i),s.refresh())}onShow(){super.onShow();const e=this.datacollection,t=this.view;e&&"dataview"!==t.parent.key&&["changeCursor","cursorStale"].forEach((i=>{t.eventAdd({emitter:e,eventName:i,listener:(...e)=>this.displayText(...e)})})),this.displayText()}}},81209:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});var s=i(32019);class n extends s.Z{static get default(){return{}}static propertyComponent(){let e={callbacks:{}};return{ui:{view:"template",template:"No UI"},init:t=>{for(var i in e.callbacks)e.callbacks[i]=t[i]||e.callbacks[i]},logic:e}}fromSettings(e){this.settings=e}toSettings(){return this.settings||{}}component(e,t){this.App=e,this.idBase=t;let i={callbacks:{}};return{ui:{view:"template",template:"No UI"},init:e=>{for(var t in i.callbacks)i.callbacks[t]=e[t]||i.callbacks[t]},logic:i}}}},71695:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var s=i(81209),n=i(44388),a=i.n(n),r=i(7617),o=i.n(r);let l=(...e)=>AB.Multilingual.label(...e);class c extends s.Z{static get default(){return{formView:"none"}}static propertyComponent(e,t){let i={formView:`${t}_formView`},s={id:i.formView,name:"formView",view:"richselect",label:l("Add New Form"),labelWidth:this.AB.UISettings.config().labelWidthXLarge,on:{onChange:(e,t)=>{e==l("No add new option")&&$$(i.formView).setValue(""),n.callbacks.onSave()}}},n={callbacks:{onSave:function(){console.warn("NO onSave()!")}},setSettings:(e,t={})=>{if(null==e)return;let s=[{id:"none",value:l("No add new option")}],n=e.pageRoot().pages((t=>t.views((t=>t&&"form"==t.key&&t.datacollection&&t.datacollection.datasource&&t.datacollection.datasource.id==e.field().settings.linkObject),!0).length),!0).map((e=>({id:e.id,value:e.label})));s=s.concat(n);let a=$$(i.formView);a&&(a.define("options",s),a.define("value",t.formView||this.default.formView),a.refresh())},getSettings:e=>{let t=e.settings||{};return t.formView=$$(i.formView).getValue(),t}};return{ui:s,init:e=>{for(let t in n.callbacks)n.callbacks[t]=e[t]||n.callbacks[t]},setSettings:n.setSettings,getSettings:n.getSettings}}fromSettings(e={}){this.settings=this.settings||{},this.settings.formView=e.formView||this.constructor.default.formView}getIds(e,t){return{popup:t._App.unique(`${e}_popup_add_new`),field:e.split("_")[1],button:t._App.unique(`${e}_popup_add_new_button`)}}component(e,t){let i=this.getIds(t,e),s="";if(this.settings.formView&&this.settings.formView!=this.constructor.default.formView){const e=`add new CR button ${this.settings.formView} ${i.field}`;s={id:i.button,view:"button",type:"icon",icon:"fa fa-plus",width:32,height:32,css:"webix_primary ab-connect-add-new-link",on:{onAfterRender:()=>{$$(i.button)?.$view.querySelector("button").setAttribute("data-cy",e)}}}}let n={callbacks:{onSaveData:e=>{$$(i.popup)&&$$(i.popup).close()},onCancel:()=>($$(i.popup)&&$$(i.popup).close(),!1),onClearOnLoad:()=>!0,clearOnLoad:()=>!0},applicationLoad:e=>{this._application=e},onClick:e=>{let t=this.settings.formView,i=this._application.pages((e=>e.id==t),!0)[0];return n.openFormPopup(i,e)},openFormPopup:(e,t)=>new Promise(((s,r)=>{if(null==this._application)return s();if($$(i.popup))return $$(i.popup).show(),s();let c=e.clone(null,null,{ignoreSubPages:!0});c.id=this._application.AB.uuid();let u=c.component(),d=u.ui();(c.views((e=>e instanceof a()||e instanceof o()),!0)??[]).forEach((e=>{(e instanceof a()?e.parent:e).on("saved",(e=>{n?.callbacks?.onSaveData(e),$$(i.popup)?$$(i.popup).close():this.getTopParentView().close()}))}));let h={view:"window",id:i.popup,modal:!0,position:"center",resize:!0,width:parseInt(this.settings.popupWidth)||700,height:parseInt(this.settings.popupHeight)+44||450,css:"ab-main-container",head:{view:"toolbar",css:"webix_dark",cols:[{view:"label",label:e.label,css:"modal_title",align:"center"},{view:"button",label:l("Close"),autowidth:!0,align:"center",click:function(){this.getTopParentView().close()}}]},body:{view:"scrollview",scroll:!0,body:d}};webix.ui(h).show(),u.init(this._application.AB,3,{onSaveData:n.callbacks.onSaveData,onCancelClick:n.callbacks.onCancel,clearOnLoad:n.callbacks.clearOnLoad,onClearOnLoad:n.callbacks.onClearOnLoad}),u.onShow(),setTimeout((async()=>{n.setDefaultValue(t,c),s()}),100)})),setDefaultValue:(e,t)=>{if(!e)return;let i=e.datasource;if(!i)return;let s=e.getCursor();s&&t.views().forEach((e=>{e&&"form"==e.key&&e.views().forEach((t=>{if("connect"!=t.key||null==t.settings)return;let n=t.field();if(null==n)return;let a=n.datasourceLink;if(null==a||a.id!=i.id)return;let r={},o=n.relationName();if(r[o]={id:s.id},(i.indexes()||[]).forEach((e=>{(e.fields||[]).forEach((e=>{r[o][e.columnName]=s[e.columnName]}))})),s.text)r[o].text=s.text,r[o].value=r[o].text;else{let e={};e[o]=s,r[o].text=n.format(e),r[o].value=r[o].text}let l=e.viewComponents[t.id];if(!l)return;const c="function"==typeof l.ui?l.ui():l.ui,u=c?.inputId||c?.rows?.[0]?.inputId;u&&n.setValue($$(u),r)}))}))}};return{ui:s,init:e=>{for(let t in n.callbacks)n.callbacks[t]=e[t]||n.callbacks[t];if(s)for(let t in e)s.on[t]=e[t]},applicationLoad:n.applicationLoad,onClick:n.onClick,openFormPopup:n.openFormPopup}}}},39747:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var s=i(71695);let n=(...e)=>AB.Multilingual.label(...e);class a extends s.Z{static get default(){return{editForm:"none"}}static propertyComponent(e,t){let i={formEdit:`${t}_editForm`},s={id:i.formEdit,name:"editForm",view:"richselect",label:n("Edit Form"),labelWidth:this.AB.UISettings.config().labelWidthXLarge,on:{onChange:(e,t)=>{e==n("No add new option")&&$$(i.formEdit).setValue(""),a.callbacks.onSave()}}},a={callbacks:{onSave:function(){console.warn("NO onSave()!")},clearOnLoad:()=>!1},setSettings:(e,t={})=>{if(null==e)return;t.clearOnLoad=!1;let s=[{id:"none",value:n("No add new option")}];(e.pageRoot().pages((()=>!0),!0)||[]).forEach((t=>{t&&t.views((()=>!0),!0).forEach((i=>{i&&"form"==i.key&&i.datacollection&&i.datacollection.datasource&&i.datacollection.datasource.id==e.field().settings.linkObject&&s.push({id:i.urlPointer(),value:`${t.label} - ${i.label}`})}))}));let a=$$(i.formEdit);a&&(a.define("options",s),a.define("value",t.editForm||this.default.editForm),a.refresh())},getSettings:e=>{let t=e.settings||{},s=$$(i.formEdit),n=(s.getPopup().config.body.data||[]).filter((e=>e.id==s.getValue()))[0];return n&&(t.editForm=n.id),t}};return{ui:s,init:e=>{for(let t in a.callbacks)a.callbacks[t]=e[t]||a.callbacks[t]},setSettings:a.setSettings,getSettings:a.getSettings}}fromSettings(e={}){this.settings=this.settings||{},this.settings.editForm=e.editForm||this.constructor.default.editForm}component(e,t){this.getIds=function(e,t){return{popup:t._App.unique(`${e}_popup_edit_form`),field:e.split("_")[1]}};let i=super.component(e,t);return i.onClick=()=>{if(!this._application||!this.settings.editForm||this.settings.editForm==this.constructor.default.editForm)return Promise.resolve();let e=this._application.urlResolve(this.settings.editForm);if(!e)return Promise.resolve();let t=e.pageParent();return t?i.openFormPopup(t):Promise.resolve()},i}}},43348:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var s=i(81209);const n=i(70504);let a=(...e)=>AB.Multilingual.label(...e);class r extends n{constructor(){super(["label"],AB)}fromSettings(e){super.fromValues(e),this.filters=e.filters}toSettings(){let e=super.toObj();return e.filters=this.filters,e}}class o extends s.Z{constructor(e,t){super(t,{buttonAddfilter:"",filterPanel:"",globalFilterFormContainer:"",globalFilterForm:"",filterMenutoolbar:"",resetFilterButton:""}),this.AB=e,this.idBase=t,this.object=null,this.__externalSearchText=null,this.rowFilter=this.AB.filterComplexNew(`${this.ids.component}_filter`),this.rowFilterForm=this.AB.filterComplexNew(`${this.ids.component}_filter_form`),this._handler_rowFilterChanged=e=>{let t=e.rules||[];this.triggerCallback((e=>this.rowFilter.isValid(e)),t)},this._handler_rowFilterFormChanged=()=>{this.triggerCallback()},this.initialized=!1}static get default(){return{filterOption:1,userFilterPosition:"toolbar",isGlobalToolbar:1}}fromSettings(e){(e=e||{}).filterOption=void 0!==e.filterOption?e.filterOption:o.default.filterOption,e.isGlobalToolbar=void 0!==e.isGlobalToolbar?e.isGlobalToolbar:o.default.isGlobalToolbar,this.settings=e}objectLoad(e){this.object=e,this.rowFilter&&this.rowFilter.fieldsLoad(e.fields()),this.rowFilterForm&&this.rowFilterForm.fieldsLoad(e.fields())}viewLoad(e){this.view=e}ui(){var e=this,t=this.ids;return{id:t.filterPanel,type:"space",borderless:!0,padding:0,hidden:!0,rows:[{id:t.globalFilterFormContainer,hidden:!0,cols:[{id:t.globalFilterForm,view:"text",placeholder:a("Search or scan a barcode to see results"),on:{onTimedKeyPress:()=>{this.triggerCallback()}}},{view:"button",css:"webix_primary",width:28,type:"icon",icon:"fa fa-times",click:function(){var e=$$(t.globalFilterForm);e.setValue(""),e.focus(),e.callEvent("onTimedKeyPress")}}]},{id:t.buttonAddfilter,view:"button",css:"webix_primary",value:a("Add Filter"),click:()=>{this.rowFilterForm.popUp($$(t.buttonAddfilter).getNode(),{pos:"bottom"})}},{view:"toolbar",id:t.filterMenutoolbar,css:"ab-data-toolbar",hidden:!0,cols:[{view:"button",css:"webix_primary",id:t.resetFilterButton,label:a("Reset Filter"),icon:"fa fa-ban",type:"icon",autowidth:!0,click:function(){e.resetFilter()}}]}]}}async init(e){e&&(this.AB=e);var t=this.ids;switch(this.rowFilter.init(),this.rowFilter.removeListener("changed",this._handler_rowFilterChanged),this.rowFilter.on("changed",this._handler_rowFilterChanged),this.rowFilterForm.init(),this.rowFilterForm.removeListener("changed",this._handler_rowFilterFormChanged),this.rowFilterForm.on("changed",this._handler_rowFilterFormChanged),this.rowFilterForm.removeListener("save",this._handler_rowFilterFormChanged),this.rowFilterForm.on("save",this._handler_rowFilterFormChanged),$$(t.filterPanel)?.hide(),$$(t.buttonAddfilter)?.hide(),$$(t.filterMenutoolbar)?.hide(),$$(t.globalFilterFormContainer)?.hide(),this.settings.filterOption){case 0:break;case 1:switch(this.settings.userFilterPosition){case"form":$$(t.buttonAddfilter)?.show(),$$(t.filterPanel)?.show();break;case"toolbar":$$(t.filterPanel)?.hide()}break;case 2:$$(t.filterPanel)?.show();var i=$$(t.filterMenutoolbar);i&&(i.show(),this.settings?.queryRules&&(this.settings.queryRules||[]).forEach((e=>{let t=new r;t.fromSettings(e);var s={view:"button",css:"webix_primary",label:t.label,icon:"fa fa-filter",type:"icon",autowidth:!0,click:()=>{this.emit("filter.data",null,t.filters)}};i.addView(s)})));break;case 3:$$(t.globalFilterFormContainer)?.show(),$$(t.filterPanel)?.show()}}filterRules(){let e=null;switch(this.settings.userFilterPosition){case"form":e=this.rowFilterForm.getValue();break;case"toolbar":e=this.rowFilter.getValue()}return e}getFilter(){return null==this.__currentFilter&&(3==this.settings.filterOption&&"single"==this.settings.globalFilterPosition?this.__currentFilter=()=>!1:this.__currentFilter=()=>!0),this.__currentFilter}triggerCallback(){let e=this.searchText(this.__externalSearchText),t=this.filterRules(),i=0;t?.rules?.length?(i=t?.rules?.length,e&&(i++,t={glue:"and",rules:[t,e]})):t=e,this.emit("filter.data",null,t),0==i&&(i=!1);const s=$$(this.ids.buttonAddfilter);s&&(s.config.badge=i,s.refresh())}resetFilter(){this.triggerCallback((()=>!0),[])}externalSearchText(e=null){this.__externalSearchText=e,this.triggerCallback()}searchText(e){var t;if(!(t=e||($$(this.ids.globalFilterForm)?.getValue()??"").trim()))return null;let i=t.trim().toLowerCase().split(" ");var s=[],n=this.object?.fields()||[];return i.forEach((e=>{var t=[];n.forEach((i=>{if(i.fieldIsFilterable())switch(i.key){case"number":case"string":case"LongText":case"email":t.push({key:i.id,rule:"contains",value:e});break;case"list":i.options().forEach((s=>{s.text.indexOf(e)>-1&&t.push({key:i.id,rule:"equals",value:s.id})}))}})),t.length>0&&s.push({glue:"or",rules:t})})),s.length>0?{glue:"and",rules:s}:null}showPopup(e){this.rowFilter.popUp(e,null,{pos:"center"})}}},25733:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});var s=i(81209),n=i(44363);class a extends n.Z{constructor(e,t){super(t||"ABViewPropertyLinkPage_xxx",{}),this.linkPageHelper=e,this.AB=e.AB,this.view=null,this.datacollection=null}ui(){return{}}init(e){e.view&&(this.view=e.view),e.datacollection&&(this.datacollection=e.datacollection)}changePage(e,t){this.datacollection?(this.datacollection.once("changeCursor",(()=>{this.view?.changePage(e)})),this.datacollection.setCursor(t)):this.view?.changePage(e)}}class r extends s.Z{component(e=!1){let t=new a(this);if(e){var i=t;t={ui:i.ui(),init:(...e)=>i.init(...e),onShow:(...e)=>i.onShow?.(...e),changePage:(...e)=>i.changePage(...e)}}return t}}},25358:e=>{e.exports=class{constructor(e){this.label=e,this.ui=null}cleanRules(e,t,i){void 0===i&&(i=!0),function e(s){if(s)if(s.glue&&s.rules)s.rules.forEach((t=>{e(t)}));else{var n=t.filter((e=>e.id==s.key))[0];if(n)switch(n.type){case"number":case"formula":"string"==typeof s.value&&(-1==s.value.indexOf(".")?s.value=parseInt(s.value):s.value=parseFloat(s.value));break;case"date":i?s.value instanceof Date&&(s.value=webix.i18n.dateFormatStr(s.value)):"string"==typeof s.value&&(s.value=new Date(s.value))}}}(e)}component(e,t){this.App=e,this.idBase=t;var i=e.Label,s=webix.uid(),n=e=>`${t}_${e}_${s}`,a=this.ids={component:n("qbObjectFieldConditions"),queryBuilder:n("qBuilder"),queryBuilderContainer:n("qBuilderContainer"),queryBuilderLayout:n("qBuilderLayout"),showQBButton:n("showQBButton")};this.ui={view:"layout",id:a.queryBuilderLayout,hidden:!0,type:"line",rows:[{id:a.showQBButton,cols:[{fillspace:!0},{view:"button",css:"webix_primary",name:"addqb",value:i("Add Custom Conditions"),autowidth:!0,click:function(){$$(a.queryBuilderContainer).show(),$$(a.showQBButton).hide()}},{fillspace:!0}]},{hidden:!0,id:a.queryBuilderContainer,cols:[{view:"querybuilder",id:a.queryBuilder,fields:this.conditionFields()}]}]},this.label&&this.ui.rows[1].cols.unshift({view:"label",css:"ab-text-bold",label:this.label,width:this.AB.UISettings.config().labelWidthLarge}),this.init=e=>{for(var t in e=e||{},r.callbacks)r.callbacks[t]=e[t]||r.callbacks[t]};var r=this._logic={callbacks:{onCancel:function(){console.warn("NO onCancel()!")},onSave:function(e){console.warn("NO onSave()!")}},cleanRules:(e,t,i)=>{this.cleanRules(e,t,i)},getValue:()=>{var e=null,t=$$(a.queryBuilder);return t&&(e=t.getValue()),e&&r.cleanRules(e[0],e[1],!0),e},setValue:e=>{e=e||[],Array.isArray(e)||(e=[e]),0==e.length&&e.push({}),e.length<2&&e.push(this.conditionFields()),r.cleanRules(e[0],e[1],!1);var t=$$(a.queryBuilder);t&&e[0]&&e[0].rules&&e[0].rules.length&&(t.setValue(e[0]),$$(a.queryBuilderContainer).show(),$$(a.showQBButton).hide())}};this.getValue=r.getValue,this.show=r.show,this.setValue=r.setValue}objectLoad(e){this.currentObject=e}conditionFields(){var e=["string","LongText","number","date","email","formula","calculate"],t=[];return this.currentObject&&this.currentObject.fields().forEach((i=>{if(-1!=e.indexOf(i.key)){let e=i.key;"formula"==i.key||"calculate"==i.key?e="number":"LongText"==i.key&&(e="string"),t.push({id:i.columnName,value:i.label,type:e})}})),t}process(e){return new Promise(((t,i)=>{var s=0,n=()=>{++s>=this.listRules.length&&t()};this.listRules.forEach((t=>{t.process(e).then((function(){n()})).catch((e=>{i(e)}))})),0==this.listRules.length&&t()}))}showQueryBuilderContainer(){$$(this.ids.queryBuilderLayout).show(),$$(this.ids.queryBuilderContainer).show(),$$(this.ids.showQBButton).hide()}}},17172:(e,t,i)=>{const s=i(25358);let n=(...e)=>AB.Multilingual.label(...e);e.exports=class{constructor(e){this.listActions=e||[],this.actionDropList=[],this.listActions.forEach((e=>{this.actionDropList.push({id:e.key,value:e.label})})),this.selectedAction=null,this.actionDropList.length>0&&(this.selectedAction=this.actionDropList[0].id),this.removable=!0,this.currentObject=null,this.objectQB=null,this.currentForm=null}component(e,t){this.App=e,this.idBase=t;var i=webix.uid(),s=e=>`${t}_${e}_${i}`,a=this.ids={component:s("component"),selectAction:s("chooseAction"),queryBuilder:s("queryBuilder"),valueDisplay:s("valueArea")};this.objectQB.label=n("When"),this.objectQB.component(this.App,this.idBase),this.ui=this._generateUI(),this.init=e=>{for(var t in r.callbacks)r.callbacks[t]=e[t]||r.callbacks[t];this.objectQB.init();var i=this.currentAction();if(i){i.component(this.App,this.idBase);var s=i.valueDisplay(a.valueDisplay);r.replaceValueDisplay(s),s.init()}};var r=this._logic={callbacks:{onDelete:function(){console.warn("NO onDelete()!")},onSave:function(e){console.warn("NO onSave()!")}},replaceValueDisplay:e=>{var t=$$(this.ids.valueDisplay);if(t){var i=t.getChildViews(),s=[];i.forEach((e=>{s.push(e)})),s.forEach((e=>{t.removeView(e)})),t.addView(e.ui)}},selectAction:(e,t)=>{e&&$$(this.ids.component).getChildViews().forEach((e=>{e.show()}));var i=this.getAction(t);i&&i.stashCondition(this.objectQB.getValue()),this.selectedAction=e;var s=this.currentAction();if(s){this.objectQB.setValue(s.condition()),s.component(this.App,this.idBase);var n=s.valueDisplay(a.valueDisplay);r.replaceValueDisplay(n),n.init()}}}}_generateUI(){return{id:this.ids.component,view:"layout",css:"ab-component-form-rules",padding:20,type:"line",rows:[{view:"template",css:"ab-component-form-rules-delete",template:'<i class="fa fa-trash ab-component-remove"></i>',height:30,borderless:!0,hidddatasourceen:0==this.removable,onClick:{"ab-component-remove":(e,t,i)=>{this._logic.callbacks.onDelete(this)}}},{id:this.ids.selectAction,view:"richselect",label:n("Action"),placeholder:n("Choose an action"),labelWidth:this.AB.UISettings.config().labelWidthLarge,options:this.actionDropList,on:{onChange:(e,t)=>{this._logic.selectAction(e,t)}}},{for:"values",hidden:!0,cells:[{view:"layout",cols:[{view:"label",label:n("Values"),css:"ab-text-bold",width:this.AB.UISettings.config().labelWidthLarge},{id:this.ids.valueDisplay,view:"layout",rows:[{label:n(" ABViewRule: This should be the Set Area"),css:"ab-text-bold",height:30}]}]}]},this.objectQB.ui]}}conditionFields(){var e=[],t=this.currentAction();return t&&(e=t.conditionFields()),e}currentAction(){return this.getAction(this.selectedAction)}getAction(e){return this.listActions.filter((t=>t.key==e))[0]}objectLoad(e){this.currentObject=e,this.listActions.forEach((t=>{t.objectLoad(e)}));var t=n("When");this.objectQB=new s(t),this.objectQB.objectLoad(e),this.ids&&(this.ui=this._generateUI())}formLoad(e){this.currentForm=e,this.listActions.forEach((t=>{t.formLoad(e)}))}processPre(e={}){if(!this.isValid(e.data))return;let t=this.currentAction();t&&t.processUpdateObject({},e.data)}process(e){var t=this.currentAction();return t?this.isValid(e.data)?t.process(e):new Promise(((e,t)=>{e()})):Promise.resolve()}fromSettings(e){if((e=e||{}).selectedAction){this.selectedAction=e.selectedAction;var t=this.currentAction();if(!t)return;t.stashCondition(e.queryRules||{}),this.ids&&$$(this.ids.selectAction).setValue(this.selectedAction),t.fromSettings(e.actionSettings)}}toSettings(){var e={};if(this.selectedAction){e.selectedAction=this.selectedAction,e.queryRules=this.objectQB.getValue();let t=this.currentAction();t&&(e.actionSettings=t.toSettings())}return e}qbFixAfterShow(){var e=this.currentAction();e&&this.objectQB&&(this.objectQB.setValue(e.condition()),e.qbFixAfterShow())}async isReady(){let e=this.currentAction();return e?e.isReady():Promise.resolve()}isValid(e={}){const t=this.currentObject.fields(),i=this.currentAction().condition()[0]??{},s=(e="")=>"number"==typeof e?e:parseFloat(e.replace(/[^-0-9.]/g,""));t.filter((e=>"number"==e.key||"calculate"==e.key||"formula"==e.key)).forEach((t=>{try{Array.isArray(i?.rules)&&i.rules.forEach((e=>{e.key!=t.id&&e.key!=t.columnName||(e.value=s(e.value))})),e[t.columnName]&&"string"==typeof e[t.columnName]&&(e[t.columnName]=s(e[t.columnName]))}catch(e){}}));const n=(this.AB??AB).filterComplexNew(`${this.idBase}_filter_complex`);return n.fieldsLoad(t,this.currentObject),n.setValue(i),n.init(),n.isValid(e)}get isPreProcess(){return this.currentAction().isPreProcess||!1}}},59816:e=>{e.exports=class{constructor(e,t,i){this.key="ABViewRuleAction",this.queryObject=null,this.currentForm=null,this.queryRules={},this.valueRules={},this.currentForm=i}component(e,t){this.App=e,this.idBase=t,this.label=((...e)=>AB.Multilingual.label(...e))("generic abviewruleaction"),this.ids={component:`${"component",e.unique(`${t}_component`)}_${webix.uid()}`},this._ui=null,this.init=e=>{for(var t in i.callbacks)i.callbacks[t]=e[t]||i.callbacks[t]};var i=this._logic={callbacks:{onDelete:function(){console.warn("NO onDelete()!")},onSave:function(e){console.warn("NO onSave()!")}}}}condition(){return[this.conditionRules(),this.conditionFields()]}stashCondition(e){Array.isArray(e)&&(e=e[0]),e&&("or"!=e.glue&&(e.glue="and"),this.queryRules=e)}conditionFields(){var e=["string","number","date","formula","calculate"],t=[];return this.queryObject&&this.queryObject.fields().forEach((i=>{-1!=e.indexOf(i.key)&&t.push({id:i.columnName,value:i.label,type:i.key})})),t}conditionRules(){return this.queryRules}objectLoad(e){this.queryObjectLoad(e)}queryObjectLoad(e){this.queryObject=e}formLoad(e){this.currentForm=e}process(e){return console.error("!!! ABViewRuleAction.process() should be overridden by its child class."),new Promise(((e,t)=>{t(new Error("ABViewRuleAction.process() should be overridden by its child class."))}))}valueDisplay(e){return this.valueDisplayComponent(e)}valueDisplayComponent(e){return this._ui={ui:{template:"ABViewRuleAction.valueDisplayComponent"},init:e=>{console.error("!!! ABViewRuleAction.valueDisplayComponent() should be overridden."),console.warn(" --\x3e passed in data:",e)}}}fromSettings(e){e=e??{},this.valueRules=e.valueRules??e}toSettings(){return{}}isReady(){return Promise.resolve()}qbFixAfterShow(){}}},69159:e=>{let t=(...e)=>AB.Multilingual.label(...e);e.exports=class{constructor(e){this.listRules=[],this.currentObject=null,(e=e||{}).labels=e.labels||{},e.labels.header=e.labels.header||"ab.components.form.ruleList",e.labels.headerDefault=e.labels.headerDefault||"*Rule List",this.childSettings=e}component(e,i){this.App=this.App||e,this.idBase=i,e=e||this.App,this.currentForm=null;var s=this.ids={component:`${i}_component`,rules:`${i}_rules`,rulesScrollview:`${i}_rulesScrollview`,action:`${i}_action`,when:`${i}_when`,values:`${i}_values`,set:`${i}_set`};this.ui={view:"window",id:s.component,modal:!0,position:"center",resize:!0,width:700,height:450,css:"ab-main-container",head:{view:"toolbar",css:"webix_dark",cols:[{view:"label",label:this.childSettings.labels.headerDefault},{view:"button",css:"webix_primary",icon:"fa fa-plus",type:"iconButton",label:t("Add new rule"),width:150,click:()=>{this.addRule(),console.log($$(s.rules).$height),$$(s.rulesScrollview).scrollTo(0,$$(s.rules).$height)}}]},body:{type:"form",rows:[{view:"scrollview",id:s.rulesScrollview,scroll:"xy",body:{view:"layout",id:s.rules,margin:20,padding:10,rows:[]}},{css:{"background-color":"#fff"},cols:[{fillspace:!0},{view:"button",name:"cancel",value:t("Cancel"),css:"ab-cancel-button",autowidth:!0,click:function(){n.buttonCancel()}},{view:"button",css:"webix_primary",name:"save",label:t("Save"),type:"form",autowidth:!0,click:function(){n.buttonSave()}},{fillspace:!0}]}]}},this.init=e=>{for(var t in n.callbacks)n.callbacks[t]=e[t]||n.callbacks[t];webix.ui(this.ui)};var n=this._logic={buttonCancel:function(){$$(s.component).hide()},buttonSave:()=>{var e=this.toSettings();n.callbacks.onSave(e),n.hide()},callbacks:{onCancel:function(){console.warn("NO onCancel()!")},onSave:function(e){console.warn("NO onSave()!")}},hide:function(){$$(s.component).hide()},show:function(){$$(s.component).show()}};this.show=n.show,this.setValue=n.setValue}addRule(e){var t=this.getRule();if(t){if(this.listRules.push(t),this.ids){var i=$$(this.ids.rules);i&&(t.component(this.App,this.idBase),i.addView(t.ui),t.init({onDelete:e=>{$$(this.ids.rules).removeView(t.ids.component);var i=this.listRules.indexOf(e);-1!==i&&this.listRules.splice(i,1)}}))}e&&t.fromSettings(e)}}fromSettings(e){this.listRules.forEach((e=>{this.ids&&this.ids.rules&&e&&e.ids&&e.ids.component&&$$(this.ids.rules).removeView(e.ids.component)})),this.listRules=[],e&&e.forEach((e=>{this.addRule(e)}))}objectLoad(e){this.currentObject=e,this.listRules.forEach((t=>{t.objectLoad(e)}))}processPre(e){(this.listRules||[]).filter((e=>1==e.isPreProcess)).forEach((t=>{t.processPre(e,e.data)}))}process(e){return new Promise(((t,i)=>{let s=(this.listRules||[]).filter((e=>!e.isPreProcess));var n=0;s.forEach((a=>{a.process(e).then((function(){++n>=s.length&&t()})).catch((e=>{i(e)}))})),0==s.length&&t()}))}toSettings(){var e=[];return this.listRules.forEach((t=>{e.push(t.toSettings())})),e}getRule(){return console.error("!!! ABViewRuleList.getRule() should be overridded by a child object."),null}formLoad(e){this.currentForm=e,this.App=this.App||e.App}rulesReady(){return Promise.resolve()}qbFixAfterShow(){this.listRules.forEach((e=>{e.qbFixAfterShow()}))}}},95652:(e,t,i)=>{const s=i(69159),n=i(17172),a=i(24133),r=i(27239),o=i(59196),l=i(75045);e.exports=class extends s{constructor(){super({labels:{header:"ab.components.form.recordRules",headerDefault:"*Record Rules"}})}getRule(){var e=[new a(this.App,`${this.idBase}_ruleActionUpdate`,this.currentForm),new r(this.App,`${this.idBase}_ruleActionInsert`,this.currentForm),new o(this.App,`${this.idBase}_ruleActionUpdateConnected`,this.currentForm),new l(this.App,`${this.idBase}_ruleActionRemoveConnected`,this.currentForm)],t=new n(e);return this.currentObject&&t.objectLoad(this.currentObject),t}async rulesReady(){var e=(this.listRules||[]).map((e=>e.isReady()));await Promise.all(e)}}},17004:(e,t,i)=>{const s=i(69159),n=i(17172),a=i(70559),r=i(60971),o=i(38488),l=i(44400),c=i(96891),u=i(88493);e.exports=class extends s{constructor(){super({labels:{header:"ab.component.form.submitRule",headerDefault:"*Submit Rules"}})}getRule(){var e=[new a(this.App,`${this.idBase}_ruleActionConfirmMessage`),new r(this.App,`${this.idBase}_ruleActionExistPage`),new o(this.App,`${this.idBase}_ruleActionParentPage`),new l(this.App,`${this.idBase}_ruleActionClosePopup`),new c(this.App,`${this.idBase}_ruleActionWebsite`),new u(this.App,`${this.idBase}_ruleActionEmail`)],t=new n(e);return t.objectLoad(this.currentObject),t.formLoad(this.currentForm),t}}},27239:(e,t,i)=>{const s=i(59196);e.exports=class extends s{constructor(e,t,i){super(e,t,i),this.key="ABViewRuleActionFormRecordRuleInsertConnected",this.label=((...e)=>AB.Multilingual.label(...e))("Insert Connected Object")}valueDisplayChooser(e){var t=super.valueDisplayChooser(e);return t._logic.showQBIfNeeded=function(){},t}queryBuilderDisplay(){return null}process(e){var t=this.connectedObject(),i=t.model(),s=this.selectedField(),n={};if(this.processUpdateObject({},n),!n.newRecords){let a=t.fieldByID(s.settings.linkColumn);return a?(n[a.columnName]=e.data.id,i.create(n)):Promise.reject("No connected object field")}{let a=t.fieldByID(s.settings.linkColumn);if(!a)return Promise.reject("No connected object field");n.newRecords.forEach((t=>(t[a.columnName]=e.data.id,i.create(t))))}}toSettings(){var e=super.toSettings();return delete e.qbCondition,e}}},75045:(e,t,i)=>{const s=i(59196);e.exports=class extends s{constructor(e,t,i){super(e,t,i),this.key="ABViewRuleActionFormRecordRuleRemoveConnected",this.label=((...e)=>AB.Multilingual.label(...e))("Remove Connected Record"),this.isUpdateValueDisabled=!0}process(e){let t=this.selectedField();return this._formData=e.data,new Promise(((i,s)=>{let n=e.form.datacollection;if(!n)return i();let a=n.model;if(!a)return i();let r={};r[t.columnName]="",a.update(e.data.id,r).then(i).catch((t=>{this.AB.notify.developer(t,{message:"!!! ABViewRuleActionFormRecordRuleUpdate.process(): update error:",data:e.data}),s(t)}))}))}}},24133:(e,t,i)=>{const s=i(36746);e.exports=class extends s{constructor(e,t,i){super(e,t,i),this.key="ABViewRuleActionFormRecordRuleUpdate",this.label=((...e)=>AB.Multilingual.label(...e))("Update Record")}get isPreProcess(){return!0}}},59196:(e,t,i)=>{const s=i(36746),n=i(89981),a=i(25358);let r=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{constructor(e,t,i){super(e,t,i),this.key="ABViewRuleActionFormRecordRuleUpdateConnected",this.label=r("Update Connected Record"),this.baseObject=null,this.selectedFieldID=null,this.fieldDropList=[],this.objectQB=null,this.qbCondition=null}objectLoad(e){this.queryObjectLoad(e),this.baseObject=e,this.connectedFieldList().forEach((e=>{this.fieldDropList.push({id:e.id,value:e.label})}))}connectedFieldList(){var e=n.defaults().key;return this.baseObject&&this.baseObject.fields?this.baseObject.fields((t=>t.key==e)):[]}connectedObject(){if(this.selectedFieldID){var e=this.selectedField();if(e)return e.datasourceLink}return null}selectedField(){return this.connectedFieldList().filter((e=>e.id==this.selectedFieldID))[0]}valueDisplayComponent(e){return null==this._uiChooser&&(this._uiChooser=this.valueDisplayChooser(e)),this._uiChooser}valueDisplayChooser(e){var t=webix.uid(),i=e=>e+"_"+t,s={component:i("updateConnectedValues"),updateForm:i("updateChooser"),selectConnectedField:i("updateSelect"),updateFieldsForm:i("updateForm")},n={id:s.component,view:"layout",css:"ab-component-form-rule",rows:[{id:s.selectConnectedField,view:"richselect",label:r("Select which connected object to update."),labelWidth:300,value:this.selectedField,options:this.fieldDropList,on:{onChange:(e,t)=>{a.selectAction(e,t)}}}]},a=this._logic={addDisplay:e=>{$$(s.component).addView(e)},removePreviousDisplays:()=>{var e=$$(s.component).getChildViews(),t=[];e.forEach((e=>{t.push(e)})),t.forEach((e=>{e.config.id!=s.selectConnectedField&&$$(s.component).removeView(e)}))},selectAction:(e,t)=>{a.removePreviousDisplays(),this.selectedFieldID=e;var i=this.connectedObject();if(i){if(this.updateObjectLoad(i),this.updateComponent=super.valueDisplayComponent(s.updateFieldsForm),a.showQBIfNeeded(),a.addDisplay(this.updateComponent.ui),this.updateComponent.init(),this.isUpdateValueDisabled){let e=$$(this.updateComponent.ui.id);e&&(e.disable(),e.hide())}}else this.AB.notify.builder(new Error("No connectedObject found."),{fieldID:this.selectedFieldID})},showQBIfNeeded:()=>{var e=this.queryBuilderDisplay();e.component(this.App,this.idBase),a.addDisplay(e.ui),e.init({})},fromSettings:e=>{$$(s.selectConnectedField).setValue(e.selectedFieldID),this.objectQB&&this.objectQB.setValue(this.qbCondition),this.updateComponent&&this.updateComponent.fromSettings(e)},toSettings:()=>{var e={fieldOperations:[]};return this.formRows.forEach((t=>{var i=t.toSettings();i&&e.fieldOperations.push(i)})),e}};return{ui:n,init:e=>{if(e=e||this.valueRules,this.selectedFieldID){var t=$$(s.selectConnectedField);t&&t.setValue(this.selectedFieldID)}},fromSettings:e=>{a.fromSettings(e)},toSettings:()=>a.toSettings(),_logic:a}}queryBuilderDisplay(){if(!this.objectQB){this.objectQB=new a(r("How to choose which object:"));var e=this.connectedObject();e&&this.objectQB.objectLoad(e)}return this.objectQB}process(e){this._formData=e.data;var t=this.connectedObject(),i=t.model(),s=this.selectedField(),n=null,a=i=>{this.baseObject.model().findConnected(s.columnName,e.data).then((e=>{if(e&&0!=e.length){var s=e.map((e=>e.id));n={glue:"and",rules:[{key:`${t.tableName}.${t.PK()}`,rule:"in",value:s}]},Object.keys(this.qbCondition).length>0&&n.rules.push(this.qbCondition),i()}else i()})).catch(i)};return new Promise(((t,s)=>{var r=(t,s)=>{this.processUpdateObject({},t)?i.update(t.id,t).then((()=>{s()})).catch((t=>{this.AB.notify.developer(t,{message:"!!! ABViewRuleActionFormRecordRuleUpdateConnected.process(): update error:",data:e.data}),s(t)})):s()};a((a=>{if(a)return AB.notify.developer(a,{message:"!!! ABViewRuleActionFormRecordRuleUpdateConnected.modifyCondition: error:",data:e.data}),void s(a);null===n?t():i.findAll({where:n}).then((e=>{var i=0;e&&e.data&&(e=e.data),e.forEach((n=>{r(n,(n=>{if(n)return s(n);++i>=e.length&&t()}))})),0==e.length&&t()})).catch(s)}))}))}fromSettings(e){e=e||{},this.selectedFieldID=e.selectedFieldID||null,this.qbCondition=e.qbCondition||{},super.fromSettings(e),this._uiChooser&&this._logic.fromSettings(e)}toSettings(){var e=super.toSettings();e.selectedFieldID=this.selectedFieldID;var t=null;return this.objectQB&&(t=this.objectQB.getValue(),Array.isArray(t)&&(t=t[0]),t&&(t.glue=t.glue||"and")),e.qbCondition=t,this._uiChooser&&(e.valueRules=this._logic.toSettings()),e}qbFixAfterShow(){this.objectQB&&this.objectQB.setValue(this.qbCondition)}}},44400:(e,t,i)=>{const s=i(59816);e.exports=class extends s{constructor(e,t){super(),this.App=e,this.key="ABViewRuleActionFormSubmitRuleClosePopup",this.label=((...e)=>AB.Multilingual.label(...e))("Close the current popup"),this.currentObject=null,this.formRows=[]}valueDisplayComponent(e){return this._ui={ui:{view:"layout",rows:[]},init:()=>{}},this._ui}process(e){return new Promise(((t,i)=>{let s=e.form;if(!s)return;let n=s.pageParent((e=>"popup"==e.settings.type));if(!n)return;let a=$$(n.id);a&&a.hide(),e.form.changePage(null),t()}))}}},70559:(e,t,i)=>{const s=i(59816);e.exports=class extends s{constructor(e,t){super(),this.App=e,this.key="ABViewRuleActionFormSubmitRuleConfirmMessage",this.label=((...e)=>AB.Multilingual.label(...e))("Show a confirmation message"),this.currentObject=null,this.formRows=[]}valueDisplayComponent(e){var t={message:`${e}_message`};this._ui={ui:{id:t.message,view:"textarea",height:130},init:()=>{},_logic:i,fromSettings:e=>{i.fromSettings(e)},toSettings:()=>i.toSettings()};var i={fromSettings:e=>{e=e||{},$$(t.message).setValue(e.message||"")},toSettings:()=>({message:$$(t.message).getValue()||""})};return this._ui}process(e){return new Promise(((e,t)=>{var i=this.valueRules.message||"";webix.message({text:i,type:"info"}),e()}))}fromSettings(e){e=e||{},super.fromSettings(e),this._ui&&this._ui.fromSettings(e.valueRules)}toSettings(){var e=super.toSettings();return e.valueRules=this._ui.toSettings(),e}}},88493:(e,t,i)=>{const s=i(59816),n=i(89981),a=i(75922);let r=(...e)=>AB.Multilingual.label(...e);e.exports=class extends s{constructor(e,t){super(),this.App=e,this.key="ABViewRuleActionFormSubmitRuleEmail",this.label=r("Send a custom email"),this.queryObject=null,this.formRows=[]}valueDisplayComponent(e){var t={form:`${e}_form`,popup:`${e}_popup`,list:`${e}_fieldList`,toEmailsContainer:`${e}_toEmailsContainer`,toEmails:`${e}_toEmails`,message:`${e}_message`};this._ui={ui:{id:t.form,view:"form",width:450,elementsConfig:{labelPosition:"top",labelWidth:100},cols:[{width:330,rows:[{view:"text",name:"fromName",label:r("From Name")},{view:"text",name:"fromEmail",label:r("From Email"),validate:webix.rules.isEmail,on:{onChange:function(e,i){this.getValue()&&!this.validate()?$$(t.form).markInvalid("fromEmail","Email is invalid"):$$(t.form).markInvalid("fromEmail",!1)}}},{id:t.toEmailsContainer,view:"forminput",name:"toEmails",label:r("Send"),css:"ab-rich-text",width:320,body:{width:320,rows:[{height:25},{id:t.toEmails,width:320,view:"layout",rows:[]},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-plus",label:r("Add a recipient"),width:150,click:()=>{i.toEmailAdd()}}]}},{view:"text",name:"subject",label:r("Subject")},{view:"textarea",id:t.message,name:"message",label:r("Message"),width:320,height:400}]},{rows:[{view:"template",type:"header",template:"Fields"},{id:t.list,view:"list",width:120,css:{"background-color":"#fff !important;"},template:function(e,t){return i.fieldTemplate(e,t)},on:{onItemClick:function(e,t,s){var n=this.getItem(e);i.enterField(n)}}}]}]},init:()=>{this.queryObject&&($$(t.list).parse(this.queryObject.fields((e=>e.fieldUseAsLabel()))),$$(t.list).refresh()),i.refreshUI()},_logic:i,fromSettings:e=>{i.fromSettings(e)},toSettings:()=>i.toSettings()};var i={fromSettings:e=>{e=e||{},$$(t.form).setValues(e),(e.toEmails||[]).forEach((e=>{i.toEmailAdd({type:e.type,emailType:e.emailType,value:e.value})})),i.refreshUI()},toSettings:()=>{var e=$$(t.form).getValues()||{},i=[];return $$(t.toEmails).getChildViews().forEach((e=>{var t=e.queryView({name:"emailType"}).getValue(),s=e.queryView({name:t}).getValue();i.push({type:"to",emailType:t,value:s})})),{fromName:e.fromName,fromEmail:e.fromEmail,toEmails:i,subject:e.subject,message:e.message}},toEmailTemplate:e=>({width:320,cols:[{view:"richselect",name:"emailType",value:(e=e||{}).emailType||"email",width:150,options:[{id:"email",value:r("A custom email address")},{id:"field",value:r("An email field")},{id:"query",value:r("From query")}],on:{onChange:function(e,t){i.emailTypeChange(e,this)}}},{width:150,name:"emailValue",visibleBatch:e.emailType||"email",cols:[{view:"text",name:"email",batch:"email",value:"email"==e.emailType?e.value:"",validate:webix.rules.isEmail,width:150,on:{onChange:function(e,t){i.toEmailValidate()}}},{view:"richselect",name:"field",batch:"field",value:"field"==e.emailType?e.value:"",width:150,suggest:{on:{onBeforeShow:function(){this.define("width",300),this.resize()}},data:i.emailFieldOptions()}},{view:"richselect",name:"query",batch:"query",value:"query"==e.emailType?e.value:"",width:150,suggest:{on:{onBeforeShow:function(){this.define("width",300),this.resize()}},data:i.queryOptions()}}]},{view:"button",css:"webix_danger",type:"icon",icon:"fa fa-trash-o",width:32,click:function(){var e=this.getParentView();i.toEmailRemove(e)}}]}),toEmailAdd:e=>{var s=$$(t.toEmails).getChildViews().length;$$(t.toEmails).addView(i.toEmailTemplate(e),s),i.refreshUI()},emailTypeChange:(e,i)=>{var s=i.getParentView().queryView({name:"emailValue"});switch(e){case"field":s.showBatch("field");break;case"query":s.showBatch("query");break;default:s.showBatch("email")}$$(t.toEmailsContainer).adjust()},toEmailRemove:e=>{$$(t.toEmails).removeView(e),i.refreshUI()},toEmailValidate:()=>{var e=!0;$$(t.toEmails).getChildViews().forEach((t=>{let i=t.queryView({name:"email"});i.getValue()&&!i.validate()&&(e=!1)})),e?$$(t.form).markInvalid("toEmails",!1):$$(t.form).markInvalid("toEmails","Email is invalid")},fieldTemplate:(e,t)=>`<i class='fa fa-${e.icon} webix_icon_btn' aria-hidden='true'></i> ${e.label}`,emailFieldOptions:()=>{var e=[],t=[],i=(e,i)=>{var s=e.fields((e=>e instanceof a)).map((t=>{var s="",n="";return i?(s=`${i.id}|${t.urlPointer()}`,n=`${e.label}.${t.label} (${i.label})`):(s=`|${t.urlPointer()}`,n=`${e.label}.${t.label}`),{id:s,value:n}}));t=t.concat(s)};return i(this.queryObject),this.queryObject.connectFields().forEach((t=>{e.indexOf(t.id)>-1||(e.push(t.id),i(t.datasourceLink,t))})),t},queryOptions:()=>{var e=[];return this.currentForm.AB.datacollections((e=>{let t=e.datasource;return e.settings.isQuery&&t&&t.fields((e=>"email"==e.key)).length>0})).forEach((t=>{t.datasource&&t.datasource.fields((e=>"email"==e.key)).forEach((i=>{e.push({id:`${t.id}|${i.id}`,value:`${t.label}.${i.label}`})}))})),e},enterField:e=>{var t=webix.UIManager.getFocus(),i="";"text"==t.config.view&&"textarea"==t.config.view||(t.getValue&&(i=t.getValue()),t.setValue&&t.setValue(`${i}${e.label}`),webix.UIManager.setFocus(t))},refreshUI:()=>{$$(t.toEmailsContainer).adjust(),$$(t.message).adjust()}};return this._ui}process(e){if(!webix.rules.isEmail(this.valueRules.fromEmail))return Promise.resolve();var t=[];return Promise.resolve().then((()=>new Promise(((i,s)=>{var a=[];this.valueRules.toEmails.forEach((i=>{a.push(new Promise(((s,a)=>{if("field"==i.emailType){var r=i.value.split("|")[1],o=this.queryObject.application.urlResolve(r);if(o){if(o.object.id==this.queryObject.id){var l=e.data[o.columnName];l&&(t=t.concat(l))}else{let s=i.value.split("|")[0];this.queryObject.fields((e=>e instanceof n&&e.id==s)).forEach((i=>{var s=e.data[i.relationName()]||[];s&&!Array.isArray(s)&&(s=[s]),s.forEach((e=>{var i=e[o.columnName];i&&(t=t.concat(i))}))}))}s()}else s()}else if("query"==i.emailType){var c=i.value;if(!c)return s();var u=c.split("|")[0],d=c.split("|")[1],h=this.currentForm.AB.datacollectionByID(u);if(!h)return s();var p=h.datasource.fieldByID(d);if(!p)return s();h.getData().forEach((e=>{var i=e[p.columnName];i&&t.push(i)})),s()}else t.push(i.value),s()})))})),Promise.all(a).catch(s).then(i)})))).then((()=>new Promise(((i,s)=>{if(!(t=this.AB.uniq(t).filter((e=>e)))||t.length<1)return i();var n=this.valueRules.fromName,a=this.valueRules.subject,r=this.valueRules.message;this.queryObject.fields((e=>e.fieldUseAsLabel())).forEach((t=>{var i=new RegExp(`{${t.label}}`,"g"),s=t.format(e.data);n=n.replace(i,s),a=a.replace(i,s),r=r.replace(i,s)})),this.AB.Network.post({url:"/app_builder/email",params:{fromName:n,fromEmail:this.valueRules.fromEmail,subject:a,message:r,recipients:this.AB.uniq(t)}}).then((()=>{i()})).catch(s)}))))}fromSettings(e){e=e||{},super.fromSettings(e),this._ui&&this._ui.fromSettings(e.valueRules)}toSettings(){var e=super.toSettings();return e.valueRules=this._ui.toSettings(),e}}},60971:(e,t,i)=>{const s=i(59816);e.exports=class extends s{constructor(e,t){super(),this.App=e,this.key="ABViewRuleActionFormSubmitRuleExistPage",this.label=((...e)=>AB.Multilingual.label(...e))("Redirect to an existing page"),this.currentObject=null,this.formRows=[]}valueDisplayComponent(e){var t={pagesAndTabs:`${e}_PagesAndTabs`};this._ui={ui:{id:t.pagesAndTabs,view:"richselect",options:[]},init:()=>{i.populateOptions()},_logic:i,fromSettings:e=>{i.fromSettings(e)},toSettings:()=>i.toSettings()};var i={populateOptions:()=>{var e=[],i=(t,s,n,a)=>{s=s||"";let r="fa fa-file-o";"tab"==n&&(r="fa fa-window-maximize");let o=t.pageParent();e.push({id:t.id,value:s+t.label,type:n,pageId:o?o.id:null,icon:r}),"page"!=n&&"tab"!=n||(t.pages&&t.pages().forEach((function(e){i(e,s+"-","page")})),t.views&&t.views((e=>"tab"==e.key)).forEach((e=>{e.views().forEach((e=>{i(e,s+"-","tab",t.id)}))})))};i(this.currentForm.pageRoot(),"","page"),$$(t.pagesAndTabs).define("options",e),$$(t.pagesAndTabs).refresh()},fromSettings:e=>{e=e||{},$$(t.pagesAndTabs).setValue(e.tabId||e.pageId||"")},toSettings:()=>{var e={},i=$$(t.pagesAndTabs).getValue(),s=$$(t.pagesAndTabs).getPopup().getList().config.data.filter((e=>e.id==i))[0];return s&&(e="tab"==s.type?{pageId:s.pageId,tabId:i}:{pageId:i}),e}};return this._ui}process(e){return new Promise(((t,i)=>{if(this.valueRules.pageId&&(e.form.changePage(this.valueRules.pageId),this.valueRules.tabId)){var s=e.form.application.pages((e=>e.id==this.valueRules.pageId),!0)[0];if(!s)return t();var n=s.views((e=>e.id==this.valueRules.tabId),!0)[0];if(!n)return t();var a=n.parent;if(!a)return t();var r=e=>{if(!e.parent)return!1;var t=e.parent;if(!t.parent)return!1;t.parent.emit("changeTab",t.id),r(t.parent)};r(a);let i=setInterval((function(){$$(n.id)&&$$(n.id).isVisible()?clearInterval(i):a.emit("changeTab",n.id)}),100)}t()}))}fromSettings(e){e=e||{},super.fromSettings(e),this._ui&&this._ui.fromSettings(e.valueRules)}toSettings(){var e=super.toSettings();return e.valueRules=this._ui.toSettings(),e}}},38488:(e,t,i)=>{const s=i(59816);e.exports=class extends s{constructor(e,t){super(),this.App=e,this.key="ABViewRuleActionFormSubmitRuleParentPage",this.label=((...e)=>AB.Multilingual.label(...e))("Redirect to the parent page"),this.currentObject=null,this.formRows=[]}valueDisplayComponent(e){this._ui={ui:{view:"label",label:this.label},init:()=>{},_logic:t};var t={};return this._ui}process(e){return new Promise(((t,i)=>{var s=e.form.pageParent().pageParent();e.form.changePage(s.id),t()}))}}},96891:(e,t,i)=>{const s=i(59816);e.exports=class extends s{constructor(e,t){super(),this.App=e,this.key="ABViewRuleActionFormSubmitRuleWebsite",this.label=((...e)=>AB.Multilingual.label(...e))("Redirect to another website URL"),this.currentObject=null,this.formRows=[]}valueDisplayComponent(e){var t={website:`${e}_website`};this._ui={ui:{id:t.website,view:"text"},init:()=>{},_logic:i,fromSettings:e=>{i.fromSettings(e)},toSettings:()=>i.toSettings()};var i={fromSettings:e=>{e=e||{},$$(t.website).setValue(e.website||"")},toSettings:()=>({website:$$(t.website).getValue()||""})};return this._ui}process(e){return new Promise(((e,t)=>{this.valueRules.website&&window.open(`http://${this.valueRules.website.replace("http://","")}`,"_blank"),e()}))}fromSettings(e){e=e||{},super.fromSettings(e),this._ui&&this._ui.fromSettings(e.valueRules)}toSettings(){var e=super.toSettings();return e.valueRules=this._ui.toSettings(),e}}},36746:(e,t,i)=>{const s=i(59816);let n=(...e)=>AB.Multilingual.label(...e);var a={filterConditions:{glue:"and",rules:[]}};e.exports=class extends s{constructor(e,t,i){super(e,t,i),this.key="ABViewRuleActionFormRecordRuleUpdate",this.label=n("Update Record"),this.updateObject=null,this.formRows=[],this.stashRules={}}valueDisplayComponent(e){return null==this._uiUpdater&&(this._uiUpdater=this.valueDisplayList(e)),this._uiUpdater}valueDisplayList(e){var t=webix.uid(),i={updateForm:("updateForm",`${e}_updateForm_${t}`)},s={removeAddRow:()=>{var e=s.formGet();if(e){var t=e.getChildViews().filter((e=>e.queryView((function(e){return"field"==e.config.name&&!e.getValue()}))))[0];t&&e.removeView(t)}},addRow:t=>{var i=s.formGet();if(i){var n=i.getChildViews();if(!(null==t&&n.filter((e=>e.queryView((function(e){return"field"==e.config.name&&!e.getValue()})))).length>0)){var a=this.valueDisplayRow(e);i.addView(a.ui),a.init({onAdd:()=>{s.addRow()},onDelete:e=>{s.delRow(e)},data:t}),this.formRows.push(a)}}},delRow:e=>{this.formRows.forEach(((t,i)=>{t.ui.id==e&&this.formRows.splice(i,0)}));var t=s.formGet();t&&t.removeView($$(e))},formClear:()=>{var e=s.formGet();if(e){var t=e.getChildViews(),i=[];t.forEach((e=>{i.push(e)})),i.forEach((t=>{e.removeView(t)})),this.formRows=[]}},formGet:()=>$$(i.updateForm)||(this.currentForm.AB.notify.developer(new Error("no webix form"),{context:"ABViewRuleActionObjectUpdater:formGet  could not find webix form",id:i.updateForm}),null),setValues:e=>{(e=e||{}).fieldOperations=e.fieldOperations||[],s.formGet()&&(s.formClear(),e.fieldOperations.length>0&&e.fieldOperations.forEach((e=>{s.addRow(e)})),s.removeAddRow(),s.addRow())},fromSettings:e=>{var t=e.valueRules||e;s.setValues(t)},toSettings:()=>{var e={fieldOperations:[]};return this.formRows.forEach((t=>{t.toSettings()&&e.fieldOperations.push(t.toSettings())})),e}};return{ui:{view:"form",id:i.updateForm,elements:[]},init:e=>{e=e||this.valueRules,s.setValues(e)},fromSettings:e=>{s.fromSettings(e)},toSettings:()=>s.toSettings(),_logic:s}}valueDisplayRow(e){var t,i=webix.uid(),s=e=>e+"_"+i,r={row:s("row"),updateForm:s("updateFormRow"),field:s("field"),value:s("value"),selectDc:s("selectDc"),selectBy:s("selectBy"),queryField:s("queryField"),multiview:s("multiview"),buttonAdd:s("add"),buttonDelete:s("delete")},o={callbacks:{onAdd:()=>{},onDelete:()=>{}},buttonsToggle:()=>{$$(r.row).getChildViews()[0].getChildViews()[4].hide(),$$(r.row).getChildViews()[0].getChildViews()[5].show()},getFieldList:e=>{var t=[];if(this.updateObject&&(t=(this.updateObject.fields()||[]).map((e=>({id:e.id,value:e.label}))),e)){var i={};this.formRows.forEach((e=>{var t=$$(e.ui.id);if(t){var s=t.getChildViews()[0].getChildViews()[1];i[s.getValue()]=!0}})),t=t.filter((e=>!i[e.id]))}return t},isValid:()=>{var e=this.currentForm.AB.Validation.validator(),t=$$(r.row).getChildViews()[0].getChildViews()[3],i=t.getParentView().getParentView(),s=this.getUpdateObjectField($$(r.field).getValue());if(s){var a=s.getValue(t,{}),o={};return o[s.columnName]=a,s.isValidData(o,e),(""==a||null==a||Array.isArray(a)&&0==a.length)&&e.addError(s.columnName,n("A value is required")),i.clearValidation(),e.updateForm(i),e.pass()}var l=$$(r.row).getChildViews()[0].getChildViews()[1];return l.define("invalidMessage",n("A value is required")),l.define("invalid",!0),l.refresh(),!1},selectField:i=>{var s=this.getUpdateObjectField(i);if(s){var a,l=s.formComponent().newInstance(s.object.application).component(this.App),c=l.ui;c.id=r.value;var u=this.currentForm.AB.datacollections((e=>e.datasource)),d=[];u.forEach((e=>{d.push({id:e.id,value:e.label})}));var h=[{id:"select-one",value:n("Current selection")},{id:"filter-select-one",value:n("Select first after filter by...")}],p={type:"clean",rows:[{cols:[{id:r.selectDc,view:"combo",options:d,placeholder:n("Choose a data source"),on:{onChange:(e,t)=>{var i=this.currentForm.AB.datacollectionByID(e);if(!i||"query"!=i.sourceType&&s.isConnection)$$(r.queryField).hide();else{var n=[];i.datasource.fields().forEach((e=>{n.push({id:e.id,value:e.label})})),$$(r.queryField).define("options",n),$$(r.queryField).refresh(),$$(r.queryField).show()}}}},{id:r.queryField,view:"combo",hidden:!0,placeholder:n("Choose value from..."),options:[{id:1,value:"figure this out"}]}]},{id:r.selectBy,view:"combo",options:h,placeholder:n("Choose select option"),on:{onChange:(i,s)=>{var n=$$(r.row);if(n.removeView(n.getChildViews()[1]),"select-one"==i)n.addView({},1);else{var a=this.currentForm.datacollection.datasource.fields().map((function(e){return{id:e.id,value:e.label}}));(t=this.AB.filterComplexNew(`${e}_filter`)).init({isRecordRule:!0,recordRuleFieldOptions:a}),t.on("change",(e=>{o.onFilterChange(e)})),n.addView(t.ui,1);var l=$$(r.selectDc).getValue(),c=this.currentForm.AB.datacollectionByID(l);c&&o.populateFilters(c)}}}}]};if("user"==s.key&&(c.options=c.options||[],c.options.unshift({id:"ab-current-user",value:n("[Current User]")})),s.isConnection){var f=s.datasourceLink;u=u.filter((e=>e.datasource.id==f.id));var m=this.currentForm.AB.datacollections((e=>"query"==e.sourceType&&e.datasource&&e.datasource.canFilterObject(f)));u=u.concat(m),d=[],u.forEach((e=>{d.push({id:e.id,value:e.label})})),h.push({id:"filter-select-all",value:n("Select all after filter by...")}),a=p,l={init:function(){}}}else a={id:r.multiview,view:"multiview",cells:[{batch:"custom",rows:[c,{view:"label",label:`<a>${n("Or exists value")}</a>`,on:{onItemClick:function(){this.getParentView().getParentView().showBatch("exist")}}}]},{batch:"exist",rows:[p,{view:"label",label:`<a>${n("Or custom value")}</a>`,on:{onItemClick:function(){var e=this.getParentView().getParentView();$$(r.selectBy).setValue("select-one"),e.showBatch("custom")}}}]}]};var g=$$(r.row).getChildViews()[0];if(g.removeView(g.getChildViews()[3]),g.addView(a,3),l.init(),!s.isConnection&&s.customDisplay){var b=$$(c.id).$view;setTimeout((()=>{s.customDisplay(s,this.App,b,{editable:!0,isForm:!0})}),50)}g.getChildViews()[4].show(),i&&o.callbacks.onAdd()}},setValue:e=>{$$(r.field).setValue(e.fieldID);var t=this.getUpdateObjectField(e.fieldID);if(t){var i=()=>{$$(r.selectDc).setValue(e.value),e.queryField&&$$(r.queryField).setValue(e.queryField);var t=e.selectBy||"select-one";if($$(r.selectBy).setValue(t),"select-one"!=t){var i=e.value,s=this.currentForm.AB.datacollectionByID(i);s&&e.filterConditions&&o.populateFilters(s,e.filterConditions)}};t.isConnection?i():"exist"==e.valueType?($$(r.multiview).showBatch("exist"),i()):($$(r.multiview).showBatch("custom"),setTimeout((function(){var i={};i[t.columnName]=e.value,t.setValue($$(r.value),i)}),50))}},populateFilters:(e,i)=>{i=i||a.filterConditions,t.fieldsLoad(e.datasource?e.datasource.fields():[]),t.setValue(i)},toSettings:()=>{var e=$$(r.buttonDelete);if(e&&e.isVisible()){var i={};i.fieldID=$$(r.field).getValue();var s=$$(r.value),n=this.getUpdateObjectField(i.fieldID);return n.isConnection||"exist"==$$(r.multiview).config.visibleBatch?(i.value=$$(r.selectDc).getValue(),i.queryField=$$(r.queryField).getValue(),i.op="set",i.type=n.key,i.selectBy=$$(r.selectBy).getValue(),i.valueType="exist",t&&(i.filterConditions=t.getValue())):(i.value=n.getValue(s,{}),i.op="set",i.type=n.key,i.valueType="custom"),i}return null}};return{ui:{id:r.row,view:"layout",rows:[{cols:[{view:"label",width:this.currentForm.AB.Config.labelWidthSmall,label:n("Set")},{view:"combo",name:"field",placeholder:n("Choose a field"),id:r.field,height:32,options:o.getFieldList(!0),on:{onChange:function(e){o.selectField(e)}}},{view:"label",width:this.currentForm.AB.Config.labelWidthSmall,label:n("To")},{},{view:"button",css:"webix_danger",id:r.buttonDelete,icon:"fa fa-trash",type:"icon",width:30,hidden:!0,click:function(){o.callbacks.onDelete(r.row)}}]},{}]},init:e=>{for(var t in o.callbacks)o.callbacks[t]=e[t]||o.callbacks[t];e.data&&o.setValue(e.data)},toSettings:()=>o.toSettings(),_logic:o}}getUpdateObjectField(e){return this.queryObject?.fieldByID(e)??this.updateObject?.fieldByID(e)??this.currentForm.AB.fieldNew(this.currentForm.AB.definitionByID(e)??{},this.currentForm.AB.objectNew({}))}processUpdateObject(e,t){this._formData=t;var i=!1;return this.valueRules=this.valueRules||{},this.valueRules.fieldOperations=this.valueRules.fieldOperations||[],this.valueRules.fieldOperations.forEach((e=>{var s=this.getUpdateObjectField(e.fieldID);if(s){var n=e.value;switch(n){case"ab-current-user":n=this.currentForm.AB.Account.username();break;case"ab-current-date":n=new Date}if(s.isConnection||"exist"==e.valueType){const h=this.currentForm.AB.datacollectionByID(e.value);if(!h)return;var a=this.currentForm.AB.cloneDeep(e.filterConditions);a&&a.rules&&a.rules.filter((e=>"same_as_field"==e.rule||"not_same_as_field"==e.rule)).forEach((e=>{var t=this.currentForm.datacollection.datasource.fieldByID(e.value);t.isConnection?e.value=t.format(this._formData):e.value=this._formData[t.columnName],"not_same_as_field"==e.rule?e.rule="not equals":e.rule="equals"}));let p=h.filteredClone(a);switch(e.selectBy){case"select-one":default:switch((n=p.getCursor())&&("exist"==e.valueType?(l=p.datasource.fieldByID(e.queryField))&&(n=n[l.columnName]):n.id&&(n=n.id)),e.op){case"set":if(!n)break;s.isConnection?(t[s.columnName]={},t[s.columnName].id=n[s.datasourceLink.PK()],t[s.columnName][s.datasourceLink.PK()]=n[s.datasourceLink.PK()],s.settings.isCustomFK&&(s.indexField&&(t[s.columnName][s.indexField.columnName]=n[s.indexField.columnName]),s.indexField2&&(t[s.columnName][s.indexField2.columnName]=n[s.indexField2.columnName])),s.datasourceLink.fields((e=>"combined"==e.key||"AutoIndex"==e.key)).forEach((e=>{t[s.columnName][e.columnName]=n[e.columnName]}))):t[s.columnName]=n}break;case"filter-select-all":for(var r=[],o=p.getFirstRecord();o;){switch(p.sourceType){case"object":r.push(o.id);break;case"query":var l,c=o[(l=p.datasource.fieldByID(e.queryField)).columnName];void 0===c&&(c=o[l.relationName()],Array.isArray(c)?c=c.map((e=>e.id?e.id:e)):c.id&&(c=c.id)),r=this.currentForm.AB.uniq(r.concat(c))}o=p.getNextRecord(o)}if("set"===e.op)if("one"==s.linkType()){var u=[];r.forEach((e=>{var i=this.currentForm.AB.cloneDeep(t);i[s.columnName]=e,u.push(i)})),t.newRecords=u}else t[s.columnName]=r;break;case"filter-select-one":if(r=[],n=p.getFirstRecord())if("query"==p.sourceType||"exist"==e.valueType&&e.queryField)l=p.datasource.fieldByID(e.queryField),void 0===(c=n[l.columnName])&&(c=n[l.relationName()],Array.isArray(c)&&(c=c[0]),c.id&&(c=c.id)),n=c;else if("object"==p.sourceType){var d;s.indexField?d=s.indexField.columnName:s.indexField2&&(d=s.indexField2.columnName),d&&n[d]?n=n[d]:n.id&&(n=n.id)}"set"===e.op&&(t[s.columnName]=n)}i=!0}else"set"===e.op&&(t[s.columnName]=n),i=!0}})),i}process(e){return this._formData=e.data,new Promise(((t,i)=>{if(this.processUpdateObject({},e.data)){var s=e.form.datacollection;if(!s)return t();s.model.update(e.data.id,e.data).then(t).catch((t=>{this.currentForm.AB.notify.developer(t,{context:"ABViewRuleActionObjectUpdater:process  update error",id:e.data.id,data:e.data}),i(t)}))}else t()}))}objectLoad(e){super.objectLoad(e),this.updateObjectLoad(e)}updateObjectLoad(e){this.updateObject&&(this.stashRules[this.updateObject.id]=this.valueRules),this.updateObject=e,this._uiUpdater=null,this.valueRules=this.stashRules[this.updateObject.id]||{}}fromSettings(e){if(e=e||{},super.fromSettings(e),e.updateObjectURL){var t=this.currentForm.application.urlResolve(e.updateObjectURL);this.updateObject=t}this._uiUpdater&&this._uiUpdater.fromSettings(e)}toSettings(){var e=super.toSettings();return e.valueRules=this._uiUpdater.toSettings(),e.updateObjectURL=this.updateObject.urlPointer(),e}isReady(){var e=[];return(this.valueRules?.fieldOperations??[]).forEach((t=>{let i=this.getUpdateObjectField(t.fieldID);if(!i)return;if(!i.isConnection&&"exist"!==t.valueType)return;let s=this.currentForm.AB.datacollectionByID(t.value);s?.dataStatus!==s?.dataStatusFlag.initialized&&e.push(new Promise((e=>{s.on("initializedData",(()=>{e()}))})))})),Promise.all(e)}}},11619:e=>{e.exports=function e(t,i,s){function n(r,o){if(!i[r]){if(!t[r]){if(a)return a(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var c=i[r]={exports:{}};t[r][0].call(c.exports,(function(e){return n(t[r][1][e]||e)}),c,c.exports,e,t,i,s)}return i[r].exports}for(var a=void 0,r=0;r<s.length;r++)n(s[r]);return n}({1:[function(e,t,i){"use strict";var s=e("docxtemplater").DocUtils;s.convertPixelsToEmus=function(e){return Math.round(9525*e)},t.exports=s},{docxtemplater:5}],2:[function(e,t,i){"use strict";var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}();var n=e("./docUtils"),a=/[^.]+\.([^.]+)/,r={getPrefix:function(e){return"docx"===e?"word":"ppt"},getFileTypeName:function(e){return"docx"===e?"document":"presentation"},getRelsFileName:function(e){return e.replace(/^.*?([a-zA-Z0-9]+)\.xml$/,"$1")+".xml.rels"},getRelsFilePath:function(e,t){return("pptx"===t?"ppt/slides":"word")+"/_rels/"+r.getRelsFileName(e)}};t.exports=function(){function e(t,i,s,n){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.fileName=i,this.prefix=r.getPrefix(n),this.zip=t,this.xmlDocuments=s,this.fileTypeName=r.getFileTypeName(n),this.mediaPrefix="pptx"===n?"../media":"media";var a=r.getRelsFilePath(i,n);this.relsDoc=s[a]||this.createEmptyRelsDoc(s,a)}return s(e,[{key:"createEmptyRelsDoc",value:function(e,t){var i=this.prefix+"/_rels/"+this.fileTypeName+".xml.rels",s=e[i];if(!s){var a=new Error("Could not copy from empty relsdoc");throw a.properties={mainRels:i,relsFileName:t,files:Object.keys(this.zip.files)},a}for(var r=n.str2xml(n.xml2str(s)),o=r.getElementsByTagName("Relationships")[0],l=o.getElementsByTagName("Relationship"),c=0,u=l.length;c<u;c++)o.removeChild(l[c]);return e[t]=r,r}},{key:"loadImageRels",value:function(){var e=this.relsDoc.getElementsByTagName("Relationship");return Array.prototype.reduce.call(e,(function(e,t){var i=t.getAttribute("Id");return/^rId[0-9]+$/.test(i)?Math.max(e,parseInt(i.substr(3),10)):e}),0)}},{key:"addExtensionRels",value:function(e,t){var i=this.xmlDocuments["[Content_Types].xml"],s=i.getElementsByTagName("Default");if(!Array.prototype.some.call(s,(function(e){return e.getAttribute("Extension")===t}))){var n=i.getElementsByTagName("Types")[0],a=i.createElement("Default");a.namespaceURI=null,a.setAttribute("ContentType",e),a.setAttribute("Extension",t),n.appendChild(a)}}},{key:"addImageRels",value:function(e,t,i){null==i&&(i=0);var s=0===i?e:e+"("+i+")",n=this.prefix+"/media/"+s;if(null!=this.zip.files[n])return this.addImageRels(e,t,i+1);var r={name:n,data:t,options:{binary:!0}};this.zip.file(r.name,r.data,r.options);var o=s.replace(a,"$1");this.addExtensionRels("image/"+o,o);var l=this.relsDoc.getElementsByTagName("Relationships")[0],c=this.relsDoc.createElement("Relationship");c.namespaceURI=null;var u=this.loadImageRels()+1;return c.setAttribute("Id","rId"+u),c.setAttribute("Type","http://schemas.openxmlformats.org/officeDocument/2006/relationships/image"),c.setAttribute("Target",this.mediaPrefix+"/"+s),l.appendChild(c),u}}]),e}()},{"./docUtils":1}],3:[function(e,t,i){"use strict";t.exports={getImageXml:function(e,t){return('<w:drawing>\n\t\t<wp:inline distT="0" distB="0" distL="0" distR="0">\n\t\t\t<wp:extent cx="'+t[0]+'" cy="'+t[1]+'"/>\n\t\t\t<wp:effectExtent l="0" t="0" r="0" b="0"/>\n\t\t\t<wp:docPr id="2" name="Image 2" descr="image"/>\n\t\t\t<wp:cNvGraphicFramePr>\n\t\t\t\t<a:graphicFrameLocks xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" noChangeAspect="1"/>\n\t\t\t</wp:cNvGraphicFramePr>\n\t\t\t<a:graphic xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main">\n\t\t\t\t<a:graphicData uri="http://schemas.openxmlformats.org/drawingml/2006/picture">\n\t\t\t\t\t<pic:pic xmlns:pic="http://schemas.openxmlformats.org/drawingml/2006/picture">\n\t\t\t\t\t\t<pic:nvPicPr>\n\t\t\t\t\t\t\t<pic:cNvPr id="0" name="Picture 1" descr="image"/>\n\t\t\t\t\t\t\t<pic:cNvPicPr>\n\t\t\t\t\t\t\t\t<a:picLocks noChangeAspect="1" noChangeArrowheads="1"/>\n\t\t\t\t\t\t\t</pic:cNvPicPr>\n\t\t\t\t\t\t</pic:nvPicPr>\n\t\t\t\t\t\t<pic:blipFill>\n\t\t\t\t\t\t\t<a:blip r:embed="rId'+e+'">\n\t\t\t\t\t\t\t\t<a:extLst>\n\t\t\t\t\t\t\t\t\t<a:ext uri="{28A0092B-C50C-407E-A947-70E740481C1C}">\n\t\t\t\t\t\t\t\t\t\t<a14:useLocalDpi xmlns:a14="http://schemas.microsoft.com/office/drawing/2010/main" val="0"/>\n\t\t\t\t\t\t\t\t\t</a:ext>\n\t\t\t\t\t\t\t\t</a:extLst>\n\t\t\t\t\t\t\t</a:blip>\n\t\t\t\t\t\t\t<a:srcRect/>\n\t\t\t\t\t\t\t<a:stretch>\n\t\t\t\t\t\t\t\t<a:fillRect/>\n\t\t\t\t\t\t\t</a:stretch>\n\t\t\t\t\t\t</pic:blipFill>\n\t\t\t\t\t\t<pic:spPr bwMode="auto">\n\t\t\t\t\t\t\t<a:xfrm>\n\t\t\t\t\t\t\t\t<a:off x="0" y="0"/>\n\t\t\t\t\t\t\t\t<a:ext cx="'+t[0]+'" cy="'+t[1]+'"/>\n\t\t\t\t\t\t\t</a:xfrm>\n\t\t\t\t\t\t\t<a:prstGeom prst="rect">\n\t\t\t\t\t\t\t\t<a:avLst/>\n\t\t\t\t\t\t\t</a:prstGeom>\n\t\t\t\t\t\t\t<a:noFill/>\n\t\t\t\t\t\t\t<a:ln>\n\t\t\t\t\t\t\t\t<a:noFill/>\n\t\t\t\t\t\t\t</a:ln>\n\t\t\t\t\t\t</pic:spPr>\n\t\t\t\t\t</pic:pic>\n\t\t\t\t</a:graphicData>\n\t\t\t</a:graphic>\n\t\t</wp:inline>\n\t</w:drawing>\n\t\t').replace(/\t|\n/g,"")},getImageXmlCentered:function(e,t){return('<w:p>\n\t\t\t<w:pPr>\n\t\t\t\t<w:jc w:val="center"/>\n\t\t\t</w:pPr>\n\t\t\t<w:r>\n\t\t\t\t<w:rPr/>\n\t\t\t\t<w:drawing>\n\t\t\t\t\t<wp:inline distT="0" distB="0" distL="0" distR="0">\n\t\t\t\t\t<wp:extent cx="'+t[0]+'" cy="'+t[1]+'"/>\n\t\t\t\t\t<wp:docPr id="0" name="Picture" descr=""/>\n\t\t\t\t\t<a:graphic xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main">\n\t\t\t\t\t\t<a:graphicData uri="http://schemas.openxmlformats.org/drawingml/2006/picture">\n\t\t\t\t\t\t<pic:pic xmlns:pic="http://schemas.openxmlformats.org/drawingml/2006/picture">\n\t\t\t\t\t\t\t<pic:nvPicPr>\n\t\t\t\t\t\t\t<pic:cNvPr id="0" name="Picture" descr=""/>\n\t\t\t\t\t\t\t<pic:cNvPicPr>\n\t\t\t\t\t\t\t\t<a:picLocks noChangeAspect="1" noChangeArrowheads="1"/>\n\t\t\t\t\t\t\t</pic:cNvPicPr>\n\t\t\t\t\t\t\t</pic:nvPicPr>\n\t\t\t\t\t\t\t<pic:blipFill>\n\t\t\t\t\t\t\t<a:blip r:embed="rId'+e+'"/>\n\t\t\t\t\t\t\t<a:stretch>\n\t\t\t\t\t\t\t\t<a:fillRect/>\n\t\t\t\t\t\t\t</a:stretch>\n\t\t\t\t\t\t\t</pic:blipFill>\n\t\t\t\t\t\t\t<pic:spPr bwMode="auto">\n\t\t\t\t\t\t\t<a:xfrm>\n\t\t\t\t\t\t\t\t<a:off x="0" y="0"/>\n\t\t\t\t\t\t\t\t<a:ext cx="'+t[0]+'" cy="'+t[1]+'"/>\n\t\t\t\t\t\t\t</a:xfrm>\n\t\t\t\t\t\t\t<a:prstGeom prst="rect">\n\t\t\t\t\t\t\t\t<a:avLst/>\n\t\t\t\t\t\t\t</a:prstGeom>\n\t\t\t\t\t\t\t<a:noFill/>\n\t\t\t\t\t\t\t<a:ln w="9525">\n\t\t\t\t\t\t\t\t<a:noFill/>\n\t\t\t\t\t\t\t\t<a:miter lim="800000"/>\n\t\t\t\t\t\t\t\t<a:headEnd/>\n\t\t\t\t\t\t\t\t<a:tailEnd/>\n\t\t\t\t\t\t\t</a:ln>\n\t\t\t\t\t\t\t</pic:spPr>\n\t\t\t\t\t\t</pic:pic>\n\t\t\t\t\t\t</a:graphicData>\n\t\t\t\t\t</a:graphic>\n\t\t\t\t\t</wp:inline>\n\t\t\t\t</w:drawing>\n\t\t\t</w:r>\n\t\t</w:p>\n\t\t').replace(/\t|\n/g,"")},getPptxImageXml:function(e,t,i){return('<p:pic>\n\t\t\t<p:nvPicPr>\n\t\t\t\t<p:cNvPr id="6" name="Picture 2"/>\n\t\t\t\t<p:cNvPicPr>\n\t\t\t\t\t<a:picLocks noChangeAspect="1" noChangeArrowheads="1"/>\n\t\t\t\t</p:cNvPicPr>\n\t\t\t\t<p:nvPr/>\n\t\t\t</p:nvPicPr>\n\t\t\t<p:blipFill>\n\t\t\t\t<a:blip r:embed="rId'+e+'" cstate="print">\n\t\t\t\t\t<a:extLst>\n\t\t\t\t\t\t<a:ext uri="{28A0092B-C50C-407E-A947-70E740481C1C}">\n\t\t\t\t\t\t\t<a14:useLocalDpi xmlns:a14="http://schemas.microsoft.com/office/drawing/2010/main" val="0"/>\n\t\t\t\t\t\t</a:ext>\n\t\t\t\t\t</a:extLst>\n\t\t\t\t</a:blip>\n\t\t\t\t<a:srcRect/>\n\t\t\t\t<a:stretch>\n\t\t\t\t\t<a:fillRect/>\n\t\t\t\t</a:stretch>\n\t\t\t</p:blipFill>\n\t\t\t<p:spPr bwMode="auto">\n\t\t\t\t<a:xfrm>\n\t\t\t\t\t<a:off x="'+i.x+'" y="'+i.y+'"/>\n\t\t\t\t\t<a:ext cx="'+t[0]+'" cy="'+t[1]+'"/>\n\t\t\t\t</a:xfrm>\n\t\t\t\t<a:prstGeom prst="rect">\n\t\t\t\t\t<a:avLst/>\n\t\t\t\t</a:prstGeom>\n\t\t\t\t<a:noFill/>\n\t\t\t\t<a:ln>\n\t\t\t\t\t<a:noFill/>\n\t\t\t\t</a:ln>\n\t\t\t\t<a:effectLst/>\n\t\t\t\t<a:extLst>\n\t\t\t\t\t<a:ext uri="{909E8E84-426E-40DD-AFC4-6F175D3DCCD1}">\n\t\t\t\t\t\t<a14:hiddenFill xmlns:a14="http://schemas.microsoft.com/office/drawing/2010/main">\n\t\t\t\t\t\t\t<a:solidFill>\n\t\t\t\t\t\t\t\t<a:schemeClr val="accent1"/>\n\t\t\t\t\t\t\t</a:solidFill>\n\t\t\t\t\t\t</a14:hiddenFill>\n\t\t\t\t\t</a:ext>\n\t\t\t\t\t<a:ext uri="{91240B29-F687-4F45-9708-019B960494DF}">\n\t\t\t\t\t\t<a14:hiddenLine xmlns:a14="http://schemas.microsoft.com/office/drawing/2010/main" w="9525">\n\t\t\t\t\t\t\t<a:solidFill>\n\t\t\t\t\t\t\t\t<a:schemeClr val="tx1"/>\n\t\t\t\t\t\t\t</a:solidFill>\n\t\t\t\t\t\t\t<a:miter lim="800000"/>\n\t\t\t\t\t\t\t<a:headEnd/>\n\t\t\t\t\t\t\t<a:tailEnd/>\n\t\t\t\t\t\t</a14:hiddenLine>\n\t\t\t\t\t</a:ext>\n\t\t\t\t\t<a:ext uri="{AF507438-7753-43E0-B8FC-AC1667EBCBE1}">\n\t\t\t\t\t\t<a14:hiddenEffects xmlns:a14="http://schemas.microsoft.com/office/drawing/2010/main">\n\t\t\t\t\t\t\t<a:effectLst>\n\t\t\t\t\t\t\t\t<a:outerShdw dist="35921" dir="2700000" algn="ctr" rotWithShape="0">\n\t\t\t\t\t\t\t\t\t<a:schemeClr val="bg2"/>\n\t\t\t\t\t\t\t\t</a:outerShdw>\n\t\t\t\t\t\t\t</a:effectLst>\n\t\t\t\t\t\t</a14:hiddenEffects>\n\t\t\t\t\t</a:ext>\n\t\t\t\t</a:extLst>\n\t\t\t</p:spPr>\n\t\t</p:pic>\n\t\t').replace(/\t|\n/g,"")}}},{}],4:[function(e,t,i){"use strict";var s=e("./memoize"),n=e("xmldom").DOMParser,a=e("xmldom").XMLSerializer,r=e("./errors"),o={};o.defaults={nullGetter:function(e){return e.module?(e.module,""):"undefined"},parser:s((function(e){return s=function(t){return"."===e?t:t[e]},(i="get")in(t={})?Object.defineProperty(t,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[i]=s,t;var t,i,s})),fileType:"docx",delimiters:{start:"{",end:"}"}},o.mergeObjects=function(){for(var e={},t=void 0,i=void 0,s=0;s<arguments.length;s+=1){t=arguments[s],i=Object.keys(t);for(var n=0;n<i.length;n+=1)e[i[n]]=t[i[n]]}return e},o.xml2str=function(e){return(new a).serializeToString(e)},o.decodeUtf8=function(e){try{if(void 0===e)return;return decodeURIComponent(escape(o.convertSpaces(e)))}catch(i){var t=new Error("End");throw t.properties.data=e,t.properties.explanation="Could not decode string to UTF8",t}},o.encodeUtf8=function(e){return unescape(encodeURIComponent(e))},o.str2xml=function(e,t){return new n({errorHandler:t}).parseFromString(e,"text/xml")},o.charMap={"&":"&amp;","'":"&apos;","<":"&lt;",">":"&gt;"};var l=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g;o.escapeRegExp=function(e){return e.replace(l,"\\$&")},o.charMapRegexes=Object.keys(o.charMap).map((function(e){var t=o.charMap[e];return{rstart:new RegExp(o.escapeRegExp(t),"g"),rend:new RegExp(o.escapeRegExp(e),"g"),start:t,end:e}})),o.wordToUtf8=function(e){for(var t=void 0,i=0,s=o.charMapRegexes.length;i<s;i++)t=o.charMapRegexes[i],e=e.replace(t.rstart,t.end);return e},o.utf8ToWord=function(e){"string"!=typeof e&&(e=e.toString());for(var t=void 0,i=0,s=o.charMapRegexes.length;i<s;i++)t=o.charMapRegexes[i],e=e.replace(t.rend,t.start);return e},o.cloneDeep=function(e){return JSON.parse(JSON.stringify(e))},o.concatArrays=function(e){return e.reduce((function(e,t){return Array.prototype.push.apply(e,t),e}),[])};var c=new RegExp(String.fromCharCode(160),"g");function u(e){var t=new r.XTTemplateError("No tag '"+e.element+"' was found at the "+e.position);throw t.properties={id:"no_xml_tag_found_at_"+e.position,explanation:"No tag '"+e.element+"' was found at the "+e.position,parsed:e.parsed,index:e.index,element:e.element},t}o.convertSpaces=function(e){return e.replace(c," ")},o.pregMatchAll=function(e,t){for(var i=[],s=void 0;null!=(s=e.exec(t));)i.push({array:s,offset:s.index});return i},o.sizeOfObject=function(e){return Object.keys(e).length},o.getRight=function(e,t,i){for(var s=i,n=e.length;s<n;s++)if(e[s].value==="</"+t+">")return s;u({position:"right",element:t,parsed:e,index:i})},o.getLeft=function(e,t,i){for(var s=e.slice(0,i),n=s.length-1;n>=0;n--){var a=s[n];if(0===a.value.indexOf("<"+t)&&-1!==[">"," "].indexOf(a.value[t.length+1]))return n}u({position:"left",element:t,parsed:e,index:i})},t.exports=o,o.traits=e("./traits"),o.moduleWrapper=e("./module-wrapper")},{"./errors":6,"./memoize":9,"./module-wrapper":11,"./traits":20,xmldom:23}],5:[function(e,t,i){"use strict";var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}();function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=e("./doc-utils"),r=a.moduleWrapper,o=function(){function e(){if(n(this,e),arguments.length>0)throw new Error("The constructor with parameters have been removed in docxtemplater 3.0, please check the upgrade guide.");this.compiled={},this.modules=[],this.setOptions({})}return s(e,[{key:"attachModule",value:function(e){return this.modules.push(r(e)),this}},{key:"setOptions",value:function(t){var i=this;return this.options=t,Object.keys(a.defaults).forEach((function(e){var t=a.defaults[e];i[e]=null!=i.options[e]?i.options[e]:t})),"docx"!==this.fileType&&"pptx"!==this.fileType||(this.fileTypeConfig=e.FileTypeConfig[this.fileType]),this.fileTypeConfig=this.options.fileTypeConfig||this.fileTypeConfig,this.options.xmlFileNames=[],this}},{key:"loadZip",value:function(e){if(e.loadAsync)throw new Error("Docxtemplater doesn't handle JSZip version >=3, see changelog");return this.zip=e,this}},{key:"compileFile",value:function(e){var t=this.createTemplateClass(e);t.parse(),this.compiled[e]=t}},{key:"compile",value:function(){this.templatedFiles=this.fileTypeConfig.getTemplatedFiles(this.zip)}},{key:"render",value:function(){var e=this;return this.modules=this.fileTypeConfig.baseModules.map((function(e){return e()})).concat(this.modules),this.options=this.modules.reduce((function(t,i){return i.optionsTransformer(t,e)}),this.options),this.xmlDocuments=this.options.xmlFileNames.reduce((function(t,i){var s=e.zip.files[i].asText();return t[i]=a.str2xml(s),t}),{}),this.modules.forEach((function(t){t.set({zip:e.zip,xmlDocuments:e.xmlDocuments,data:e.data})})),this.compile(),this.modules.forEach((function(t){t.set({compiled:e.compiled})})),this.templatedFiles.forEach((function(t){null!=e.zip.files[t]&&e.compileFile(t)})),this.mapper=this.modules.reduce((function(e,t){return t.getRenderedMap(e)}),{}),Object.keys(this.mapper).forEach((function(t){var i=e.mapper[t],s=i.from,n=e.compiled[s];n.setTags(i.data),n.render(),e.zip.file(t,n.content)})),Object.keys(this.xmlDocuments).forEach((function(t){e.zip.remove(t);var i=a.encodeUtf8(a.xml2str(e.xmlDocuments[t]));return e.zip.file(t,i,{})})),this}},{key:"setData",value:function(e){return this.data=e,this}},{key:"getZip",value:function(){return this.zip}},{key:"createTemplateClass",value:function(e){var t=this.zip.files[e].asText();return this.createTemplateClassFromContent(t,e)}},{key:"createTemplateClassFromContent",value:function(t,i){var s=this,n={filePath:i};return Object.keys(a.defaults).forEach((function(e){n[e]=s[e]})),n.fileTypeConfig=this.fileTypeConfig,n.modules=this.modules,new e.XmlTemplater(t,n)}},{key:"getFullText",value:function(e){return this.createTemplateClass(e||this.fileTypeConfig.textPath).getFullText()}},{key:"getTemplatedFiles",value:function(){return this.compile(),this.templatedFiles}}]),e}();o.DocUtils=e("./doc-utils"),o.Errors=e("./errors"),o.XmlTemplater=e("./xml-templater"),o.FileTypeConfig=e("./file-type-config"),o.XmlMatcher=e("./xml-matcher"),t.exports=o},{"./doc-utils":4,"./errors":6,"./file-type-config":7,"./xml-matcher":21,"./xml-templater":22}],6:[function(e,t,i){"use strict";function s(e){this.name="GenericError",this.message=e,this.stack=new Error(e).stack}function n(e){this.name="TemplateError",this.message=e,this.stack=new Error(e).stack}function a(e){this.name="ScopeParserError",this.message=e,this.stack=new Error(e).stack}function r(e){this.name="InternalError",this.properties={explanation:"InternalError"},this.message=e,this.stack=new Error(e).stack}s.prototype=Error.prototype,n.prototype=new s,a.prototype=new s,r.prototype=new s,t.exports={XTError:s,XTTemplateError:n,XTInternalError:r,XTScopeParserError:a}},{}],7:[function(e,t,i){"use strict";var s=e("./modules/loop"),n=e("./modules/space-preserve"),a=e("./modules/rawxml"),r=e("./modules/expand-pair-trait"),o=e("./modules/render"),l={getTemplatedFiles:function(e){return e.file(/ppt\/(slides|slideMasters)\/(slide|slideMaster)\d+\.xml/).map((function(e){return e.name})).concat(["ppt/presentation.xml"])},textPath:"ppt/slides/slide1.xml",tagsXmlTextArray:["a:t","m:t"],tagsXmlLexedArray:["p:sp","a:tc","a:tr","a:table","a:p","a:r"],tagRawXml:"p:sp",tagTextXml:"a:t",baseModules:[o,r,a,s]},c={getTemplatedFiles:function(e){return e.file(/word\/(header|footer)\d+\.xml/).map((function(e){return e.name})).concat(["word/document.xml"])},textPath:"word/document.xml",tagsXmlTextArray:["w:t","m:t"],tagsXmlLexedArray:["w:tc","w:tr","w:table","w:p","w:r"],tagRawXml:"w:p",tagTextXml:"w:t",baseModules:[o,n,r,a,s]};t.exports={docx:c,pptx:l}},{"./modules/expand-pair-trait":12,"./modules/loop":13,"./modules/rawxml":14,"./modules/render":15,"./modules/space-preserve":16}],8:[function(e,t,i){"use strict";var s=e("./errors"),n=e("./doc-utils");function a(e,t){return e[0]<=t.offset&&t.offset<e[1]}function r(e,t){if("tag"===e.type&&"start"===e.position&&e.text){if(t)throw new Error("Malformed xml : Already in text tag");return!0}if("tag"===e.type&&"end"===e.position&&e.text){if(!t)throw new Error("Malformed xml : Already not in text tag");return!1}return t}function o(e,t){return e.offset-t.offset}function l(e){var t=1;"/"===e[1]&&(t=2);var i=e.indexOf(" "),s=-1===i?e.length-1:i;return{tag:e.slice(t,s),position:1===t?"start":"end"}}function c(e){var t=new s.XTTemplateError("Unclosed tag");throw t.properties={xtag:e.xtag.split(" ")[0].substr(1),id:"unclosed_tag",context:e.xtag,explanation:"The tag beginning with '"+e.xtag.substr(0,10)+"' is unclosed"},t}function u(e,t){var i=!1,n={offset:0},a=void 0;e.forEach((function(e){a=t.substr(n.offset,e.offset-n.offset),("start"===e.position&&i||"end"===e.position&&!i)&&("start"===e.position?c({xtag:a}):function(e){var t=new s.XTTemplateError("Unopened tag");throw t.properties={xtag:e.xtag.split(" ")[0],id:"unopened_tag",context:e.xtag,explanation:"The tag beginning with '"+e.xtag.substr(0,10)+"' is unclosed"},t}({xtag:a})),i=!i,n=e}));var r=t.length;a=t.substr(n.offset,r-n.offset),i&&c({xtag:a})}function d(e,t,i){var s=[],n=-1;do{-1!==(n=e.indexOf(t,n+1))&&s.push({offset:n,position:i})}while(-1!==n);return s}function h(e){var t=this;this.innerContentParts=e,this.full="",this.parseDelimiters=function(e){t.full=t.innerContentParts.join("");var i=0;t.ranges=t.innerContentParts.map((function(e){return(i+=e.length)-e.length}));var s=n.concatArrays([d(t.full,e.start,"start"),d(t.full,e.end,"end")]).sort(o);u(s,t.full);var r={start:e.start.length,end:e.end.length},l=0,c=0;t.parsed=t.ranges.map((function(e,t){for(var i=[e,e+this.innerContentParts[t].length],n=this.innerContentParts[t],o=[];c<s.length&&a(i,s[c]);)o.push(s[c]),c++;var u=[],d=0;l>0&&(d=l,l=0),o.forEach((function(t){var i=n.substr(d,t.offset-e-d);i.length>0&&u.push({type:"content",value:i}),u.push({type:"delimiter",position:t.position}),d=t.offset-e+r[t.position]})),l=d-n.length;var h=n.substr(d);return h.length>0&&u.push({type:"content",value:h}),u}),t)}}t.exports={parse:function(e,t){var i=!1,s=[];e.forEach((function(e){(i=r(e,i))&&"content"===e.type&&s.push(e.value)}));var n=new h(s);n.parseDelimiters(t);var a=[],o=0;return e.forEach((function(e){i=r(e,i),"content"===e.type&&(e.position=i?"insidetag":"outsidetag"),i&&"content"===e.type?(Array.prototype.push.apply(a,n.parsed[o].map((function(e){return"content"===e.type&&(e.position="insidetag"),e}))),o++):a.push(e)})),a},xmlparse:function(e,t){var i=function(e,t,i){for(var s=0,a=e.length,r=n.concatArrays([t.map((function(e){return{tag:e,text:!0}})),i.map((function(e){return{tag:e,text:!1}}))]).reduce((function(e,t){return e[t.tag]=t.text,e}),{}),o=[];s<a&&-1!==(s=e.indexOf("<",s));){var c=s;s=e.indexOf(">",s);var u=e.slice(c,s+1),d=l(u),h=d.tag,p=d.position,f=r[h];null!=f&&o.push({type:"tag",position:p,text:f,offset:c,value:u})}return o}(e,t.text,t.other),s=0,a=i.reduce((function(t,i){var n=e.substr(s,i.offset-s);return n.length>0&&t.push({type:"content",value:n}),s=i.offset+i.value.length,delete i.offset,i.value.length>0&&t.push(i),t}),[]),r=e.substr(s);return r.length>0&&a.push({type:"content",value:r}),a}}},{"./doc-utils":4,"./errors":6}],9:[function(e,t,i){"use strict";t.exports=function(e){var t=JSON.stringify,i={};return function(){var s=t(arguments);return s in i?i[s]:i[s]=e.apply(this,arguments)}}},{}],10:[function(e,t,i){"use strict";function s(e,t){for(var i=-1,s=0,n=e.length;s<n;s++)t[s]>=e[s].length||(-1===i||e[s][t[s]].offset<e[i][t[i]].offset)&&(i=s);if(-1===i)throw new Error("minIndex negative");return i}t.exports=function(e){var t=e.reduce((function(e,t){return e+t.length}),0);e=e.filter((function(e){return e.length>0}));for(var i=new Array(t),n=e.map((function(){return 0})),a=0;a<=t-1;){var r=s(e,n);i[a]=e[r][n[r]],n[r]++,a++}return i}},{}],11:[function(e,t,i){"use strict";function s(){}function n(e){return e}t.exports=function(e){var t={set:s,parse:s,render:s,getTraits:s,optionsTransformer:n,getRenderedMap:n,postparse:n};if(Object.keys(t).every((function(t){return!e[t]})))throw new Error("This module cannot be wrapped, because it doesn't define any of the necessary functions");return Object.keys(t).forEach((function(i){e[i]=e[i]||t[i]})),e}},{}],12:[function(e,t,i){"use strict";var s=e("../mergesort"),n=e("../doc-utils"),a=e("../module-wrapper"),r=e("../traits").getExpandToDefault,o=e("../errors");function l(e){var t=e.tags,i=new o.XTTemplateError("Closing tag does not match opening tag");throw i.properties={id:"closing_tag_does_not_match_opening_tag",explanation:'The tag "'+t[0].value+'" is closed by the tag "'+t[1].value+'"',openingtag:t[0].value,closingtag:t[1].value},i}function c(e){switch(e.location){case"start":return 1;case"end":return-1;default:throw new Error("Location should be one of 'start' or 'end' (given : "+e.location+")")}}function u(e){if(0===e.length)return[];for(var t=1,i=e[0],s=1;s<e.length;s++){var n=e[s];if(0===(t+=c(n.part))){n.part.value!==i.part.value&&""!==n.part.value&&l({tags:[i.part,n.part]});var a=u(e.slice(s+1));return[[i,n]].concat(a)}}var r=i.part;!function(e){var t=e.location,i="start"===t?"unclosed":"unopened",s="start"===t?"Unclosed":"Unopened",n=new o.XTTemplateError(s+" loop"),a=e.part.value;throw n.properties={id:i+"_loop",explanation:"The loop with tag "+a+" is "+i,xtag:a},n}({part:r,location:r.location})}var d={name:"ExpandPairTrait",postparse:function(e,t){var i=t.getTraits,a=t.postparse,o=i("expandPair",e);o=o.map((function(e){return e||[]}));var l=u(o=s(o)),c=l.map((function(t){var i=t[0].part.expandTo;return"auto"===i&&(i=r(e.slice(t[0].offset,t[1].offset))),i?[n.getLeft(e,i,t[0].offset),n.getRight(e,i,t[1].offset)]:[t[0].offset,t[1].offset]})),d=0,h=void 0;return e.reduce((function(t,i,s){var n=d<l.length&&c[d][0]<=s,r=l[d],o=c[d];if(!n)return t.push(i),t;if(o[0]===s&&(h=[]),r[0].offset!==s&&r[1].offset!==s&&h.push(i),o[1]===s){var u=e[r[0].offset];delete u.location,delete u.expandTo,u.subparsed=a(h),t.push(u),d++}return t}),[])}};t.exports=function(){return a(d)}},{"../doc-utils":4,"../errors":6,"../mergesort":10,"../module-wrapper":11,"../traits":20}],13:[function(e,t,i){"use strict";var s=e("../doc-utils"),n=/^-([^\s]+)\s(.+)$/,a=e("../module-wrapper"),r="loop",o={name:"LoopModule",parse:function(e){var t=r,i="placeholder";return"#"===e[0]?{type:i,value:e.substr(1),expandTo:"auto",module:t,location:"start",inverted:!1}:"^"===e[0]?{type:i,value:e.substr(1),expandTo:"auto",module:t,location:"start",inverted:!0}:"/"===e[0]?{type:i,value:e.substr(1),module:t,location:"end"}:"-"===e[0]?{type:i,value:e.replace(n,"$2"),expandTo:e.replace(n,"$1"),module:t,location:"start",inverted:!1}:null},getTraits:function(e,t){if("expandPair"===e)return t.reduce((function(e,t,i){return"placeholder"===t.type&&t.module===r&&e.push({part:t,offset:i}),e}),[])},render:function(e,t){if("placeholder"===!e.type||e.module!==r)return null;var i=[];return t.scopeManager.loopOver(e.value,(function(n){var a=t.scopeManager.createSubScopeManager(n,e.value);i.push(t.render(s.mergeObjects({},t,{compiled:e.subparsed,tags:{},scopeManager:a})))}),e.inverted),{value:i.join("")}}};t.exports=function(){return a(o)}},{"../doc-utils":4,"../module-wrapper":11}],14:[function(e,t,i){"use strict";var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}();var n=e("../doc-utils"),a=e("../errors"),r="rawxml",o=e("../module-wrapper");function l(e){var t=e.part,i=e.left,s=e.right,n=e.postparsed,r=e.index,o=n.slice(i+1,s);return o.forEach((function(e,s){s!==r-i-1&&("placeholder"===e.type||"content"===e.type&&"insidetag"===e.position)&&function(e){var t=new a.XTTemplateError("Raw tag should be the only text in paragraph"),i=e.part.value;throw t.properties={id:"raw_xml_tag_should_be_only_text_in_paragraph",explanation:"The tag "+i,xtag:e.part.value,paragraphParts:e.paragraphParts},t}({paragraphParts:o,part:t})})),t}var c=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.name="RawXmlModule"}return s(e,[{key:"optionsTransformer",value:function(e,t){return this.fileTypeConfig=t.fileTypeConfig,e}},{key:"parse",value:function(e){return"@"!==e[0]?null:{type:"placeholder",value:e.substr(1),module:r}}},{key:"postparse",value:function(e){return n.traits.expandToOne(e,{moduleName:r,getInner:l,expandTo:this.fileTypeConfig.tagRawXml})}},{key:"render",value:function(e,t){if(e.module!==r)return null;var i=t.scopeManager.getValue(e.value);return null==i&&(i=t.nullGetter(e)),{value:i}}}]),e}();t.exports=function(){return o(new c)}},{"../doc-utils":4,"../errors":6,"../module-wrapper":11}],15:[function(e,t,i){"use strict";var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}();var n=e("../module-wrapper"),a=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.name="Render"}return s(e,[{key:"set",value:function(e){e.compiled&&(this.compiled=e.compiled),null!=e.data&&(this.data=e.data)}},{key:"getRenderedMap",value:function(e){var t=this;return Object.keys(this.compiled).reduce((function(e,i){return e[i]={from:i,data:t.data},e}),e)}}]),e}();t.exports=function(){return n(new a)}},{"../module-wrapper":11}],16:[function(e,t,i){"use strict";var s=e("../module-wrapper"),n={name:"SpacePreserveModule",postparse:function(e){var t=[],i=!1,s=e.reduce((function(e,s){return"tag"===s.type&&"start"===s.position&&s.text&&"<w:t>"===s.value&&(i=!0),i?("placeholder"!==s.type||s.module||(t[0].value='<w:t xml:space="preserve">'),t.push(s)):e.push(s),"tag"===s.type&&"end"===s.position&&s.text&&"</w:t>"===s.value&&(Array.prototype.push.apply(e,t),i=!1,t=[]),e}),[]);return Array.prototype.push.apply(s,t),s}};t.exports=function(){return s(n)}},{"../module-wrapper":11}],17:[function(e,t,i){"use strict";var s=e("./doc-utils"),n={postparse:function(e,t){function i(e,i){return t.map((function(t){return t.getTraits(e,i)}))}return function e(s){return t.reduce((function(t,s){return s.postparse(t,{postparse:e,getTraits:i})}),s)}(e)},parse:function(e,t){var i=!1,n=void 0,a=[];return e.reduce((function(e,r){return"delimiter"===r.type?(i="start"===r.position,"end"===r.position?(function(e,i){for(var s=void 0,n=0,a=t.length;n<a;n++)if(s=t[n].parse(e))return i.push(s),s;return null}(n=s.wordToUtf8(n),e)||e.push({type:"placeholder",value:n}),Array.prototype.push.apply(e,a),a=[],e):(n="",e)):i?("content"===r.type&&"insidetag"===r.position?n+=r.value:a.push(r),e):(e.push(r),e)}),[])}};t.exports=n},{"./doc-utils":4}],18:[function(e,t,i){"use strict";var s=e("./scope-manager"),n=e("./doc-utils");t.exports=function e(t){return t.render=e,t.modules=t.modules,t.scopeManager||(t.scopeManager=s.createBaseScopeManager(t)),t.compiled.map((function(e){var i=function(e,t){for(var i=void 0,s=0,n=t.modules.length;s<n;s++)if(i=t.modules[s].render(e,t))return i;return!1}(e,t);if(i)return i.value;if("placeholder"===e.type){var s=t.scopeManager.getValue(e.value);return null==s&&(s=t.nullGetter(e)),n.utf8ToWord(s)}if("content"===e.type||"tag"===e.type)return e.value;throw new Error('Unimplemented tag type "'+e.type+'"')})).join("")}},{"./doc-utils":4,"./scope-manager":19}],19:[function(e,t,i){"use strict";var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}();var n=e("./errors"),a=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.scopePath=t.scopePath,this.scopeList=t.scopeList,this.parser=t.parser}return s(e,[{key:"loopOver",value:function(e,t,i){return i=i||!1,this.loopOverValue(this.getValue(e),t,i)}},{key:"functorIfInverted",value:function(e,t,i){e&&t(i)}},{key:"isValueFalsy",value:function(e,t){return null==e||!e||"[object Array]"===t&&0===e.length}},{key:"loopOverValue",value:function(e,t,i){var s=Object.prototype.toString.call(e),n=this.scopeList[this.num];if(this.isValueFalsy(e,s))return this.functorIfInverted(i,t,n);if("[object Array]"!==s)return"[object Object]"===s?this.functorIfInverted(!i,t,e):!0===e?this.functorIfInverted(!i,t,n):void 0;for(var a,r=0;r<e.length;r++)a=e[r],this.functorIfInverted(!i,t,a)}},{key:"getValue",value:function(e,t){this.num=null==t?this.scopeList.length-1:t;var i=void 0,s=void 0,a=void 0,r=this.scopeList[this.num];try{s=this.parser(e)}catch(t){throw(i=new n.XTScopeParserError("Scope parser compilation failed")).properties={id:"scopeparser_compilation_failed",tag:e,explanation:"The scope parser for the tag "+e+" failed to compile",rootError:t},i}try{a=s.get(r,{num:this.num,scopeList:this.scopeList})}catch(t){throw(i=new n.XTScopeParserError("Scope parser execution failed")).properties={id:"scopeparser_execution_failed",explanation:"The scope parser for the tag "+e+" failed to execute",scope:r,tag:e,rootError:t},i}return null==a&&this.num>0?this.getValue(e,this.num-1):a}},{key:"createSubScopeManager",value:function(t,i){var s={scopePath:this.scopePath.slice(0),scopeList:this.scopeList.slice(0)};return s.parser=this.parser,s.scopeList=this.scopeList.concat(t),s.scopePath=this.scopePath.concat(i),new e(s)}}]),e}();a.createBaseScopeManager=function(e){var t=e.parser,i=e.tags,s={parser:t,tags:i,scopePath:[]};return s.scopeList=[i],new a(s)},t.exports=a},{"./errors":6}],20:[function(e,t,i){"use strict";var s=e("./doc-utils"),n=e("./errors");function a(e,t){if(0===e.length)return!1;var i=e[e.length-1].tag.substr(1),s=t.substr(2,t.length-3);return 0===i.indexOf(s)}function r(e,t){return e.push({tag:t}),e}function o(e,t,i){var a=e.expandTo||i.expandTo,r=t.indexOf(e);if(!a)return t;var o=void 0,l=void 0;try{o=s.getRight(t,a,r),l=s.getLeft(t,a,r)}catch(t){!function(e){var t=new n.XTTemplateError("Raw tag not in paragraph"),i=e.part.value;throw t.properties={id:"raw_tag_outerxml_invalid",explanation:'The tag "'+i+'"',rootError:e.rootError,xtag:i},t}({part:e,rootError:t})}var c=t.slice(l,r),u=t.slice(r+1,o+1),d=i.getInner({index:r,part:e,leftParts:c,rightParts:u,left:l,right:o,postparsed:t});return"[object Array]"===Object.prototype.toString.call(d)&&(d=s.concatArrays(d)),s.concatArrays([t.slice(0,l),[d],t.slice(o+1)])}t.exports={expandToOne:function(e,t){return e.reduce((function(e,i){return"placeholder"===i.type&&i.module===t.moduleName&&e.push(i),e}),[]).forEach((function(i){e=o(i,e,t)})),e},getExpandToDefault:function(e){for(var t=function(e){for(var t,i=e.filter((function(e){return"tag"===e.type})).map((function(e){return e.value})),s=[],n=0;n<i.length;n++)"/"===(t=i[n])[1]?a(s,t)?s.pop():s=r(s,t):"/"!==t[t.length-1]&&(s=r(s,t));return s}(e),i=0;i<t.length;i++)if(0===t[i].tag.indexOf("<w:tc"))return"w:tr";return!1}}},{"./doc-utils":4,"./errors":6}],21:[function(e,t,i){"use strict";var s=e("./doc-utils");var n=e("./memoize")((function(e,t){var i={};i.content=e,i.tagsXmlArray=t,i.tagsXmlArrayJoined=i.tagsXmlArray.join("|");var n=new RegExp("(<(?:"+i.tagsXmlArrayJoined+")[^>]*>)([^<>]*)</(?:"+i.tagsXmlArrayJoined+")>","g");return i.matches=s.pregMatchAll(n,i.content),i.charactersAddedCumulative=i.matches.map((function(){return 0})),i.charactersAdded=i.matches.map((function(){return 0})),function(e){function t(){var t={array:Array.prototype.slice.call(arguments)};t.array.shift();var i=t.array[0]+t.array[1];t.array.unshift(i),t.array.pop();var s=t.array.pop();return t.offset=s,t.first=!0,e.matches.unshift(t),e.charactersAdded.unshift(0),e.charactersAddedCumulative.unshift(0)}-1===e.content.indexOf("<")&&-1===e.content.indexOf(">")&&e.content.replace(/^()([^<>]*)$/,t);var i=new RegExp("^()([^<]+)</(?:"+e.tagsXmlArrayJoined+")>");return e.content.replace(i,t),i=new RegExp("(<(?:"+e.tagsXmlArrayJoined+")[^>]*>)([^>]+)$"),e.content.replace(i,(function(){var t={array:Array.prototype.slice.call(arguments)};t.array.pop();var i=t.array.pop();return t.offset=i,t.last=!0,e.matches.push(t),e.charactersAdded.push(0),e.charactersAddedCumulative.push(0)})),e}(i)}));t.exports=function(e,t){return s.cloneDeep(n(e,t))}},{"./doc-utils":4,"./memoize":9}],22:[function(e,t,i){"use strict";var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}();var n=e("./doc-utils"),a=e("./scope-manager"),r=e("./xml-matcher"),o=e("./errors"),l=e("./lexer"),c=e("./parser.js"),u=e("./render.js");t.exports=function(){function e(t,i){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.fromJson(i),this.setModules({inspect:{filePath:this.filePath}}),this.load(t)}return s(e,[{key:"load",value:function(e){if("string"!=typeof e){var t=new o.XTInternalError("Content must be a string");throw t.properties.id="xmltemplater_content_must_be_string",t}this.content=e}},{key:"setTags",value:function(e){return this.tags=null!=e?e:{},this.scopeManager=a.createBaseScopeManager({tags:this.tags,parser:this.parser}),this}},{key:"fromJson",value:function(e){this.filePath=e.filePath,this.modules=e.modules,this.fileTypeConfig=e.fileTypeConfig,Object.keys(n.defaults).map((function(t){this[t]=null!=e[t]?e[t]:n.defaults[t]}),this)}},{key:"getFullText",value:function(){return e=this.content,t=this.fileTypeConfig.tagsXmlTextArray,i=r(e,t).matches.map((function(e){return e.array[2]})),n.wordToUtf8(n.convertSpaces(i.join("")));var e,t,i}},{key:"setModules",value:function(e){this.modules.forEach((function(t){t.set(e)}))}},{key:"parse",value:function(){return this.xmllexed=l.xmlparse(this.content,{text:this.fileTypeConfig.tagsXmlTextArray,other:this.fileTypeConfig.tagsXmlLexedArray}),this.setModules({inspect:{xmllexed:this.xmllexed}}),this.lexed=l.parse(this.xmllexed,this.delimiters),this.setModules({inspect:{lexed:this.lexed}}),this.parsed=c.parse(this.lexed,this.modules),this.setModules({inspect:{parsed:this.parsed}}),this.postparsed=c.postparse(this.parsed,this.modules),this}},{key:"render",value:function(){return this.setModules({inspect:{postparsed:this.postparsed}}),this.content=u({compiled:this.postparsed,tags:this.tags,modules:this.modules,parser:this.parser,nullGetter:this.nullGetter,filePath:this.filePath}),this.setModules({inspect:{content:this.content}}),this}}]),e}()},{"./doc-utils":4,"./errors":6,"./lexer":8,"./parser.js":17,"./render.js":18,"./scope-manager":19,"./xml-matcher":21}],23:[function(e,t,i){function s(e){this.options=e||{locator:{}}}function n(){this.cdata=!1}function a(e,t){t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber}function r(e){if(e)return"\n@"+(e.systemId||"")+"#[line:"+e.lineNumber+",col:"+e.columnNumber+"]"}function o(e,t,i){return"string"==typeof e?e.substr(t,i):e.length>=t+i||t?new java.lang.String(e,t,i)+"":e}function l(e,t){e.currentElement?e.currentElement.appendChild(t):e.doc.appendChild(t)}s.prototype.parseFromString=function(e,t){var i=this.options,s=new c,a=i.domBuilder||new n,o=i.errorHandler,l=i.locator,u=i.xmlns||{},d={lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return l&&a.setDocumentLocator(l),s.errorHandler=function(e,t,i){if(!e){if(t instanceof n)return t;e=t}var s={},a=e instanceof Function;function o(t){var n=e[t];!n&&a&&(n=2==e.length?function(i){e(t,i)}:e),s[t]=n&&function(e){n("[xmldom "+t+"]\t"+e+r(i))}||function(){}}return i=i||{},o("warning"),o("error"),o("fatalError"),s}(o,a,l),s.domBuilder=i.domBuilder||a,/\/x?html?$/.test(t)&&(d.nbsp=" ",d.copy="",u[""]="http://www.w3.org/1999/xhtml"),u.xml=u.xml||"http://www.w3.org/XML/1998/namespace",e?s.parse(e,u,d):s.errorHandler.error("invalid doc source"),a.doc},n.prototype={startDocument:function(){this.doc=(new u).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(e,t,i,s){var n=this.doc,r=n.createElementNS(e,i||t),o=s.length;l(this,r),this.currentElement=r,this.locator&&a(this.locator,r);for(var c=0;c<o;c++){e=s.getURI(c);var u=s.getValue(c),d=(i=s.getQName(c),n.createAttributeNS(e,i));this.locator&&a(s.getLocator(c),d),d.value=d.nodeValue=u,r.setAttributeNode(d)}},endElement:function(e,t,i){var s=this.currentElement;s.tagName,this.currentElement=s.parentNode},startPrefixMapping:function(e,t){},endPrefixMapping:function(e){},processingInstruction:function(e,t){var i=this.doc.createProcessingInstruction(e,t);this.locator&&a(this.locator,i),l(this,i)},ignorableWhitespace:function(e,t,i){},characters:function(e,t,i){if(e=o.apply(this,arguments)){if(this.cdata)var s=this.doc.createCDATASection(e);else s=this.doc.createTextNode(e);this.currentElement?this.currentElement.appendChild(s):/^\s*$/.test(e)&&this.doc.appendChild(s),this.locator&&a(this.locator,s)}},skippedEntity:function(e){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(e){(this.locator=e)&&(e.lineNumber=0)},comment:function(e,t,i){e=o.apply(this,arguments);var s=this.doc.createComment(e);this.locator&&a(this.locator,s),l(this,s)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(e,t,i){var s=this.doc.implementation;if(s&&s.createDocumentType){var n=s.createDocumentType(e,t,i);this.locator&&a(this.locator,n),l(this,n)}},warning:function(e){console.warn("[xmldom warning]\t"+e,r(this.locator))},error:function(e){console.error("[xmldom error]\t"+e,r(this.locator))},fatalError:function(e){throw console.error("[xmldom fatalError]\t"+e,r(this.locator)),e}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,(function(e){n.prototype[e]=function(){return null}}));var c=e("./sax").XMLReader,u=i.DOMImplementation=e("./dom").DOMImplementation;i.XMLSerializer=e("./dom").XMLSerializer,i.DOMParser=s},{"./dom":24,"./sax":25}],24:[function(e,t,i){function s(e,t){for(var i in e)t[i]=e[i]}function n(e,t){var i=e.prototype;if(Object.create){var n=Object.create(t.prototype);i.__proto__=n}if(!(i instanceof t)){function a(){}a.prototype=t.prototype,s(i,a=new a),e.prototype=i=a}i.constructor!=e&&("function"!=typeof e&&console.error("unknow Class:"+e),i.constructor=e)}var a={},r=a.ELEMENT_NODE=1,o=a.ATTRIBUTE_NODE=2,l=a.TEXT_NODE=3,c=a.CDATA_SECTION_NODE=4,u=a.ENTITY_REFERENCE_NODE=5,d=a.ENTITY_NODE=6,h=a.PROCESSING_INSTRUCTION_NODE=7,p=a.COMMENT_NODE=8,f=a.DOCUMENT_NODE=9,m=a.DOCUMENT_TYPE_NODE=10,g=a.DOCUMENT_FRAGMENT_NODE=11,b=a.NOTATION_NODE=12,v={},w={},y=(v.INDEX_SIZE_ERR=(w[1]="Index size error",1),v.DOMSTRING_SIZE_ERR=(w[2]="DOMString size error",2),v.HIERARCHY_REQUEST_ERR=(w[3]="Hierarchy request error",3)),_=(v.WRONG_DOCUMENT_ERR=(w[4]="Wrong document",4),v.INVALID_CHARACTER_ERR=(w[5]="Invalid character",5),v.NO_DATA_ALLOWED_ERR=(w[6]="No data allowed",6),v.NO_MODIFICATION_ALLOWED_ERR=(w[7]="No modification allowed",7),v.NOT_FOUND_ERR=(w[8]="Not found",8)),x=(v.NOT_SUPPORTED_ERR=(w[9]="Not supported",9),v.INUSE_ATTRIBUTE_ERR=(w[10]="Attribute in use",10));function k(e,t){if(t instanceof Error)var i=t;else i=this,Error.call(this,w[e]),this.message=w[e],Error.captureStackTrace&&Error.captureStackTrace(this,k);return i.code=e,t&&(this.message=this.message+": "+t),i}function C(){}function A(e,t){this._node=e,this._refresh=t,D(this)}function D(e){var t=e._node._inc||e._node.ownerDocument._inc;if(e._inc!=t){var i=e._refresh(e._node);ne(e,"length",i.length),s(i,e),e._inc=t}}function I(){}function $(e,t){for(var i=e.length;i--;)if(e[i]===t)return i}function E(e,t,i,s){if(s?t[$(t,s)]=i:t[t.length++]=i,e){i.ownerElement=e;var n=e.ownerDocument;n&&(s&&V(n,e,s),function(e,t,i){e&&e._inc++,"http://www.w3.org/2000/xmlns/"==i.namespaceURI&&(t._nsMap[i.prefix?i.localName:""]=i.value)}(n,e,i))}}function F(e,t,i){var s=$(t,i);if(!(s>=0))throw k(_,new Error(e.tagName+"@"+i));for(var n=t.length-1;s<n;)t[s]=t[++s];if(t.length=n,e){var a=e.ownerDocument;a&&(V(a,e,i),i.ownerElement=null)}}function S(e){if(this._features={},e)for(var t in e)this._features=e[t]}function N(){}function j(e){return("<"==e?"&lt;":">"==e&&"&gt;")||"&"==e&&"&amp;"||'"'==e&&"&quot;"||"&#"+e.charCodeAt()+";"}function B(e,t){if(t(e))return!0;if(e=e.firstChild)do{if(B(e,t))return!0}while(e=e.nextSibling)}function O(){}function V(e,t,i,s){e&&e._inc++,"http://www.w3.org/2000/xmlns/"==i.namespaceURI&&delete t._nsMap[i.prefix?i.localName:""]}function T(e,t,i){if(e&&e._inc){e._inc++;var s=t.childNodes;if(i)s[s.length++]=i;else{for(var n=t.firstChild,a=0;n;)s[a++]=n,n=n.nextSibling;s.length=a}}}function P(e,t){var i=t.previousSibling,s=t.nextSibling;return i?i.nextSibling=s:e.firstChild=s,s?s.previousSibling=i:e.lastChild=i,T(e.ownerDocument,e),t}function L(e,t,i){var s=t.parentNode;if(s&&s.removeChild(t),t.nodeType===g){var n=t.firstChild;if(null==n)return t;var a=t.lastChild}else n=a=t;var r=i?i.previousSibling:e.lastChild;n.previousSibling=r,a.nextSibling=i,r?r.nextSibling=n:e.firstChild=n,null==i?e.lastChild=a:i.previousSibling=a;do{n.parentNode=e}while(n!==a&&(n=n.nextSibling));return T(e.ownerDocument||e,e),t.nodeType==g&&(t.firstChild=t.lastChild=null),t}function R(){this._nsMap={}}function M(){}function q(){}function U(){}function z(){}function W(){}function H(){}function K(){}function J(){}function G(){}function Y(){}function Q(){}function Z(){}function X(e,t){var i=[],s=9==this.nodeType?this.documentElement:this,n=s.prefix,a=s.namespaceURI;if(a&&null==n&&null==(n=s.lookupPrefix(a)))var r=[{namespace:a,prefix:null}];return te(this,i,e,t,r),i.join("")}function ee(e,t,i){var s=e.prefix||"",n=e.namespaceURI;if(!s&&!n)return!1;if("xml"===s&&"http://www.w3.org/XML/1998/namespace"===n||"http://www.w3.org/2000/xmlns/"==n)return!1;for(var a=i.length;a--;){var r=i[a];if(r.prefix==s)return r.namespace!=n}return!0}function te(e,t,i,s,n){if(s){if(!(e=s(e)))return;if("string"==typeof e)return void t.push(e)}switch(e.nodeType){case r:n||(n=[]),n.length;var a=e.attributes,d=a.length,b=e.firstChild,v=e.tagName;i="http://www.w3.org/1999/xhtml"===e.namespaceURI||i,t.push("<",v);for(var w=0;w<d;w++)"xmlns"==(y=a.item(w)).prefix?n.push({prefix:y.localName,namespace:y.value}):"xmlns"==y.nodeName&&n.push({prefix:"",namespace:y.value});for(w=0;w<d;w++){var y;if(ee(y=a.item(w),0,n)){var _=y.prefix||"",x=y.namespaceURI,k=_?" xmlns:"+_:" xmlns";t.push(k,'="',x,'"'),n.push({prefix:_,namespace:x})}te(y,t,i,s,n)}if(ee(e,0,n)&&(_=e.prefix||"",x=e.namespaceURI,k=_?" xmlns:"+_:" xmlns",t.push(k,'="',x,'"'),n.push({prefix:_,namespace:x})),b||i&&!/^(?:meta|link|img|br|hr|input)$/i.test(v)){if(t.push(">"),i&&/^script$/i.test(v))for(;b;)b.data?t.push(b.data):te(b,t,i,s,n),b=b.nextSibling;else for(;b;)te(b,t,i,s,n),b=b.nextSibling;t.push("</",v,">")}else t.push("/>");return;case f:case g:for(b=e.firstChild;b;)te(b,t,i,s,n),b=b.nextSibling;return;case o:return t.push(" ",e.name,'="',e.value.replace(/[<&"]/g,j),'"');case l:return t.push(e.data.replace(/[<&]/g,j));case c:return t.push("<![CDATA[",e.data,"]]>");case p:return t.push("\x3c!--",e.data,"--\x3e");case m:var C=e.publicId,A=e.systemId;if(t.push("<!DOCTYPE ",e.name),C)t.push(' PUBLIC "',C),A&&"."!=A&&t.push('" "',A),t.push('">');else if(A&&"."!=A)t.push(' SYSTEM "',A,'">');else{var D=e.internalSubset;D&&t.push(" [",D,"]"),t.push(">")}return;case h:return t.push("<?",e.target," ",e.data,"?>");case u:return t.push("&",e.nodeName,";");default:t.push("??",e.nodeName)}}function ie(e,t,i){var s;switch(t.nodeType){case r:(s=t.cloneNode(!1)).ownerDocument=e;case g:break;case o:i=!0}if(s||(s=t.cloneNode(!1)),s.ownerDocument=e,s.parentNode=null,i)for(var n=t.firstChild;n;)s.appendChild(ie(e,n,i)),n=n.nextSibling;return s}function se(e,t,i){var s=new t.constructor;for(var n in t){var a=t[n];"object"!=typeof a&&a!=s[n]&&(s[n]=a)}switch(t.childNodes&&(s.childNodes=new C),s.ownerDocument=e,s.nodeType){case r:var l=t.attributes,c=s.attributes=new I,u=l.length;c._ownerElement=s;for(var d=0;d<u;d++)s.setAttributeNode(se(e,l.item(d),!0));break;case o:i=!0}if(i)for(var h=t.firstChild;h;)s.appendChild(se(e,h,i)),h=h.nextSibling;return s}function ne(e,t,i){e[t]=i}v.INVALID_STATE_ERR=(w[11]="Invalid state",11),v.SYNTAX_ERR=(w[12]="Syntax error",12),v.INVALID_MODIFICATION_ERR=(w[13]="Invalid modification",13),v.NAMESPACE_ERR=(w[14]="Invalid namespace",14),v.INVALID_ACCESS_ERR=(w[15]="Invalid access",15),k.prototype=Error.prototype,s(v,k),C.prototype={length:0,item:function(e){return this[e]||null},toString:function(e,t){for(var i=[],s=0;s<this.length;s++)te(this[s],i,e,t);return i.join("")}},A.prototype.item=function(e){return D(this),this[e]},n(A,C),I.prototype={length:0,item:C.prototype.item,getNamedItem:function(e){for(var t=this.length;t--;){var i=this[t];if(i.nodeName==e)return i}},setNamedItem:function(e){var t=e.ownerElement;if(t&&t!=this._ownerElement)throw new k(x);var i=this.getNamedItem(e.nodeName);return E(this._ownerElement,this,e,i),i},setNamedItemNS:function(e){var t,i=e.ownerElement;if(i&&i!=this._ownerElement)throw new k(x);return t=this.getNamedItemNS(e.namespaceURI,e.localName),E(this._ownerElement,this,e,t),t},removeNamedItem:function(e){var t=this.getNamedItem(e);return F(this._ownerElement,this,t),t},removeNamedItemNS:function(e,t){var i=this.getNamedItemNS(e,t);return F(this._ownerElement,this,i),i},getNamedItemNS:function(e,t){for(var i=this.length;i--;){var s=this[i];if(s.localName==t&&s.namespaceURI==e)return s}return null}},S.prototype={hasFeature:function(e,t){var i=this._features[e.toLowerCase()];return!(!i||t&&!(t in i))},createDocument:function(e,t,i){var s=new O;if(s.implementation=this,s.childNodes=new C,s.doctype=i,i&&s.appendChild(i),t){var n=s.createElementNS(e,t);s.appendChild(n)}return s},createDocumentType:function(e,t,i){var s=new H;return s.name=e,s.nodeName=e,s.publicId=t,s.systemId=i,s}},N.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(e,t){return L(this,e,t)},replaceChild:function(e,t){this.insertBefore(e,t),t&&this.removeChild(t)},removeChild:function(e){return P(this,e)},appendChild:function(e){return this.insertBefore(e,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(e){return se(this.ownerDocument||this,this,e)},normalize:function(){for(var e=this.firstChild;e;){var t=e.nextSibling;t&&t.nodeType==l&&e.nodeType==l?(this.removeChild(t),e.appendData(t.data)):(e.normalize(),e=t)}},isSupported:function(e,t){return this.ownerDocument.implementation.hasFeature(e,t)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(e){for(var t=this;t;){var i=t._nsMap;if(i)for(var s in i)if(i[s]==e)return s;t=t.nodeType==o?t.ownerDocument:t.parentNode}return null},lookupNamespaceURI:function(e){for(var t=this;t;){var i=t._nsMap;if(i&&e in i)return i[e];t=t.nodeType==o?t.ownerDocument:t.parentNode}return null},isDefaultNamespace:function(e){return null==this.lookupPrefix(e)}},s(a,N),s(a,N.prototype),O.prototype={nodeName:"#document",nodeType:f,doctype:null,documentElement:null,_inc:1,insertBefore:function(e,t){if(e.nodeType==g){for(var i=e.firstChild;i;){var s=i.nextSibling;this.insertBefore(i,t),i=s}return e}return null==this.documentElement&&e.nodeType==r&&(this.documentElement=e),L(this,e,t),e.ownerDocument=this,e},removeChild:function(e){return this.documentElement==e&&(this.documentElement=null),P(this,e)},importNode:function(e,t){return ie(this,e,t)},getElementById:function(e){var t=null;return B(this.documentElement,(function(i){if(i.nodeType==r&&i.getAttribute("id")==e)return t=i,!0})),t},createElement:function(e){var t=new R;return t.ownerDocument=this,t.nodeName=e,t.tagName=e,t.childNodes=new C,(t.attributes=new I)._ownerElement=t,t},createDocumentFragment:function(){var e=new Y;return e.ownerDocument=this,e.childNodes=new C,e},createTextNode:function(e){var t=new U;return t.ownerDocument=this,t.appendData(e),t},createComment:function(e){var t=new z;return t.ownerDocument=this,t.appendData(e),t},createCDATASection:function(e){var t=new W;return t.ownerDocument=this,t.appendData(e),t},createProcessingInstruction:function(e,t){var i=new Q;return i.ownerDocument=this,i.tagName=i.target=e,i.nodeValue=i.data=t,i},createAttribute:function(e){var t=new M;return t.ownerDocument=this,t.name=e,t.nodeName=e,t.localName=e,t.specified=!0,t},createEntityReference:function(e){var t=new G;return t.ownerDocument=this,t.nodeName=e,t},createElementNS:function(e,t){var i=new R,s=t.split(":"),n=i.attributes=new I;return i.childNodes=new C,i.ownerDocument=this,i.nodeName=t,i.tagName=t,i.namespaceURI=e,2==s.length?(i.prefix=s[0],i.localName=s[1]):i.localName=t,n._ownerElement=i,i},createAttributeNS:function(e,t){var i=new M,s=t.split(":");return i.ownerDocument=this,i.nodeName=t,i.name=t,i.namespaceURI=e,i.specified=!0,2==s.length?(i.prefix=s[0],i.localName=s[1]):i.localName=t,i}},n(O,N),R.prototype={nodeType:r,hasAttribute:function(e){return null!=this.getAttributeNode(e)},getAttribute:function(e){var t=this.getAttributeNode(e);return t&&t.value||""},getAttributeNode:function(e){return this.attributes.getNamedItem(e)},setAttribute:function(e,t){var i=this.ownerDocument.createAttribute(e);i.value=i.nodeValue=""+t,this.setAttributeNode(i)},removeAttribute:function(e){var t=this.getAttributeNode(e);t&&this.removeAttributeNode(t)},appendChild:function(e){return e.nodeType===g?this.insertBefore(e,null):function(e,t){var i=t.parentNode;if(i){var s=e.lastChild;i.removeChild(t),s=e.lastChild}return s=e.lastChild,t.parentNode=e,t.previousSibling=s,t.nextSibling=null,s?s.nextSibling=t:e.firstChild=t,e.lastChild=t,T(e.ownerDocument,e,t),t}(this,e)},setAttributeNode:function(e){return this.attributes.setNamedItem(e)},setAttributeNodeNS:function(e){return this.attributes.setNamedItemNS(e)},removeAttributeNode:function(e){return this.attributes.removeNamedItem(e.nodeName)},removeAttributeNS:function(e,t){var i=this.getAttributeNodeNS(e,t);i&&this.removeAttributeNode(i)},hasAttributeNS:function(e,t){return null!=this.getAttributeNodeNS(e,t)},getAttributeNS:function(e,t){var i=this.getAttributeNodeNS(e,t);return i&&i.value||""},setAttributeNS:function(e,t,i){var s=this.ownerDocument.createAttributeNS(e,t);s.value=s.nodeValue=""+i,this.setAttributeNode(s)},getAttributeNodeNS:function(e,t){return this.attributes.getNamedItemNS(e,t)},getElementsByTagName:function(e){return new A(this,(function(t){var i=[];return B(t,(function(s){s===t||s.nodeType!=r||"*"!==e&&s.tagName!=e||i.push(s)})),i}))},getElementsByTagNameNS:function(e,t){return new A(this,(function(i){var s=[];return B(i,(function(n){n===i||n.nodeType!==r||"*"!==e&&n.namespaceURI!==e||"*"!==t&&n.localName!=t||s.push(n)})),s}))}},O.prototype.getElementsByTagName=R.prototype.getElementsByTagName,O.prototype.getElementsByTagNameNS=R.prototype.getElementsByTagNameNS,n(R,N),M.prototype.nodeType=o,n(M,N),q.prototype={data:"",substringData:function(e,t){return this.data.substring(e,e+t)},appendData:function(e){e=this.data+e,this.nodeValue=this.data=e,this.length=e.length},insertData:function(e,t){this.replaceData(e,0,t)},appendChild:function(e){throw new Error(w[y])},deleteData:function(e,t){this.replaceData(e,t,"")},replaceData:function(e,t,i){i=this.data.substring(0,e)+i+this.data.substring(e+t),this.nodeValue=this.data=i,this.length=i.length}},n(q,N),U.prototype={nodeName:"#text",nodeType:l,splitText:function(e){var t=this.data,i=t.substring(e);t=t.substring(0,e),this.data=this.nodeValue=t,this.length=t.length;var s=this.ownerDocument.createTextNode(i);return this.parentNode&&this.parentNode.insertBefore(s,this.nextSibling),s}},n(U,q),z.prototype={nodeName:"#comment",nodeType:p},n(z,q),W.prototype={nodeName:"#cdata-section",nodeType:c},n(W,q),H.prototype.nodeType=m,n(H,N),K.prototype.nodeType=b,n(K,N),J.prototype.nodeType=d,n(J,N),G.prototype.nodeType=u,n(G,N),Y.prototype.nodeName="#document-fragment",Y.prototype.nodeType=g,n(Y,N),Q.prototype.nodeType=h,n(Q,N),Z.prototype.serializeToString=function(e,t,i){return X.call(e,t,i)},N.prototype.toString=X;try{if(Object.defineProperty){function ae(e){switch(e.nodeType){case r:case g:var t=[];for(e=e.firstChild;e;)7!==e.nodeType&&8!==e.nodeType&&t.push(ae(e)),e=e.nextSibling;return t.join("");default:return e.nodeValue}}Object.defineProperty(A.prototype,"length",{get:function(){return D(this),this.$$length}}),Object.defineProperty(N.prototype,"textContent",{get:function(){return ae(this)},set:function(e){switch(this.nodeType){case r:case g:for(;this.firstChild;)this.removeChild(this.firstChild);(e||String(e))&&this.appendChild(this.ownerDocument.createTextNode(e));break;default:this.data=e,this.value=e,this.nodeValue=e}}}),ne=function(e,t,i){e["$$"+t]=i}}}catch(re){}i.DOMImplementation=S,i.XMLSerializer=Z},{}],25:[function(e,t,i){var s=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,n=new RegExp("[\\-\\.0-9"+s.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),a=new RegExp("^"+s.source+n.source+"*(?::"+s.source+n.source+"*)?$");function r(){}function o(e,t,i,s,n){function a(e){var t=e.slice(1,-1);return t in i?i[t]:"#"===t.charAt(0)?function(e){if(e>65535){var t=55296+((e-=65536)>>10),i=56320+(1023&e);return String.fromCharCode(t,i)}return String.fromCharCode(e)}(parseInt(t.substr(1).replace("x","0x"))):(n.error("entity not found:"+e),e)}function r(t){if(t>x){var i=e.substring(x,t).replace(/&#?\w+;/g,a);w&&o(x),s.characters(i,0,t-x),x=t}}function o(t,i){for(;t>=b&&(i=v.exec(e));)p=i.index,b=p+i[0].length,w.lineNumber++;w.columnNumber=t-p+1}for(var p=0,b=0,v=/.*(?:\r\n?|\n)|.*$/g,w=s.locator,y=[{currentNSMap:t}],_={},x=0;;){try{var k=e.indexOf("<",x);if(k<0){if(!e.substr(x).match(/^\s*$/)){var C=s.doc,A=C.createTextNode(e.substr(x));C.appendChild(A),s.currentElement=A}return}switch(k>x&&r(k),e.charAt(k+1)){case"/":var D=e.indexOf(">",k+3),I=e.substring(k+2,D),$=y.pop();D<0?(I=e.substring(k+2).replace(/[\s<].*/,""),n.error("end tag name: "+I+" is not complete:"+$.tagName),D=k+1+I.length):I.match(/\s</)&&(I=I.replace(/[\s<].*/,""),n.error("end tag name: "+I+" maybe not complete"),D=k+1+I.length);var E=$.localNSMap,F=$.tagName==I;if(F||$.tagName&&$.tagName.toLowerCase()==I.toLowerCase()){if(s.endElement($.uri,$.localName,I),E)for(var S in E)s.endPrefixMapping(S);F||n.fatalError("end tag name: "+I+" is not match the current start tagName:"+$.tagName)}else y.push($);D++;break;case"?":w&&o(k),D=m(e,k,s);break;case"!":w&&o(k),D=f(e,k,s,n);break;default:w&&o(k);var N=new g,j=y[y.length-1].currentNSMap,B=(D=c(e,k,N,j,a,n),N.length);if(!N.closed&&h(e,D,N.tagName,_)&&(N.closed=!0,i.nbsp||n.warning("unclosed xml attribute")),w&&B){for(var O=l(w,{}),V=0;V<B;V++){var T=N[V];o(T.offset),T.locator=l(w,{})}s.locator=O,u(N,s,j)&&y.push(N),s.locator=w}else u(N,s,j)&&y.push(N);"http://www.w3.org/1999/xhtml"!==N.uri||N.closed?D++:D=d(e,D,N.tagName,a,s)}}catch(e){n.error("element parse error: "+e),D=-1}D>x?x=D:r(Math.max(k,x)+1)}}function l(e,t){return t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber,t}function c(e,t,i,s,n,a){for(var r,o=++t,l=0;;){var c=e.charAt(o);switch(c){case"=":if(1===l)r=e.slice(t,o),l=3;else{if(2!==l)throw new Error("attribute equal must after attrName");l=3}break;case"'":case'"':if(3===l||1===l){if(1===l&&(a.warning('attribute value must after "="'),r=e.slice(t,o)),t=o+1,!((o=e.indexOf(c,t))>0))throw new Error("attribute value no end '"+c+"' match");u=e.slice(t,o).replace(/&#?\w+;/g,n),i.add(r,u,t-1),l=5}else{if(4!=l)throw new Error('attribute value must after "="');u=e.slice(t,o).replace(/&#?\w+;/g,n),i.add(r,u,t),a.warning('attribute "'+r+'" missed start quot('+c+")!!"),t=o+1,l=5}break;case"/":switch(l){case 0:i.setTagName(e.slice(t,o));case 5:case 6:case 7:l=7,i.closed=!0;case 4:case 1:case 2:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return a.error("unexpected end of input"),0==l&&i.setTagName(e.slice(t,o)),o;case">":switch(l){case 0:i.setTagName(e.slice(t,o));case 5:case 6:case 7:break;case 4:case 1:"/"===(u=e.slice(t,o)).slice(-1)&&(i.closed=!0,u=u.slice(0,-1));case 2:2===l&&(u=r),4==l?(a.warning('attribute "'+u+'" missed quot(")!!'),i.add(r,u.replace(/&#?\w+;/g,n),t)):("http://www.w3.org/1999/xhtml"===s[""]&&u.match(/^(?:disabled|checked|selected)$/i)||a.warning('attribute "'+u+'" missed value!! "'+u+'" instead!!'),i.add(u,u,t));break;case 3:throw new Error("attribute value missed!!")}return o;case"":c=" ";default:if(c<=" ")switch(l){case 0:i.setTagName(e.slice(t,o)),l=6;break;case 1:r=e.slice(t,o),l=2;break;case 4:var u=e.slice(t,o).replace(/&#?\w+;/g,n);a.warning('attribute "'+u+'" missed quot(")!!'),i.add(r,u,t);case 5:l=6}else switch(l){case 2:i.tagName,"http://www.w3.org/1999/xhtml"===s[""]&&r.match(/^(?:disabled|checked|selected)$/i)||a.warning('attribute "'+r+'" missed value!! "'+r+'" instead2!!'),i.add(r,r,t),t=o,l=1;break;case 5:a.warning('attribute space is required"'+r+'"!!');case 6:l=1,t=o;break;case 3:l=4,t=o;break;case 7:throw new Error("elements closed character '/' and '>' must be connected to")}}o++}}function u(e,t,i){for(var s=e.tagName,n=null,a=e.length;a--;){var r=e[a],o=r.qName,l=r.value;if((h=o.indexOf(":"))>0)var c=r.prefix=o.slice(0,h),u=o.slice(h+1),d="xmlns"===c&&u;else u=o,c=null,d="xmlns"===o&&"";r.localName=u,!1!==d&&(null==n&&(n={},p(i,i={})),i[d]=n[d]=l,r.uri="http://www.w3.org/2000/xmlns/",t.startPrefixMapping(d,l))}for(a=e.length;a--;)(c=(r=e[a]).prefix)&&("xml"===c&&(r.uri="http://www.w3.org/XML/1998/namespace"),"xmlns"!==c&&(r.uri=i[c||""]));var h;(h=s.indexOf(":"))>0?(c=e.prefix=s.slice(0,h),u=e.localName=s.slice(h+1)):(c=null,u=e.localName=s);var f=e.uri=i[c||""];if(t.startElement(f,u,s,e),!e.closed)return e.currentNSMap=i,e.localNSMap=n,!0;if(t.endElement(f,u,s),n)for(c in n)t.endPrefixMapping(c)}function d(e,t,i,s,n){if(/^(?:script|textarea)$/i.test(i)){var a=e.indexOf("</"+i+">",t),r=e.substring(t+1,a);if(/[&<]/.test(r))return/^script$/i.test(i)?(n.characters(r,0,r.length),a):(r=r.replace(/&#?\w+;/g,s),n.characters(r,0,r.length),a)}return t+1}function h(e,t,i,s){var n=s[i];return null==n&&((n=e.lastIndexOf("</"+i+">"))<t&&(n=e.lastIndexOf("</"+i)),s[i]=n),n<t}function p(e,t){for(var i in e)t[i]=e[i]}function f(e,t,i,s){if("-"===e.charAt(t+2))return"-"===e.charAt(t+3)?(n=e.indexOf("--\x3e",t+4))>t?(i.comment(e,t+4,n-t-4),n+3):(s.error("Unclosed comment"),-1):-1;if("CDATA["==e.substr(t+3,6)){var n=e.indexOf("]]>",t+9);return i.startCDATA(),i.characters(e,t+9,n-t-9),i.endCDATA(),n+3}var a=function(e,t){var i,s=[],n=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(n.lastIndex=t,n.exec(e);i=n.exec(e);)if(s.push(i),i[1])return s}(e,t),r=a.length;if(r>1&&/!doctype/i.test(a[0][0])){var o=a[1][0],l=r>3&&/^public$/i.test(a[2][0])&&a[3][0],c=r>4&&a[4][0],u=a[r-1];return i.startDTD(o,l&&l.replace(/^(['"])(.*?)\1$/,"$2"),c&&c.replace(/^(['"])(.*?)\1$/,"$2")),i.endDTD(),u.index+u[0].length}return-1}function m(e,t,i){var s=e.indexOf("?>",t);if(s){var n=e.substring(t,s).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return n?(n[0].length,i.processingInstruction(n[1],n[2]),s+2):-1}return-1}function g(e){}function b(e,t){return e.__proto__=t,e}r.prototype={parse:function(e,t,i){var s=this.domBuilder;s.startDocument(),p(t,t={}),o(e,t,i,s,this.errorHandler),s.endDocument()}},g.prototype={setTagName:function(e){if(!a.test(e))throw new Error("invalid tagName:"+e);this.tagName=e},add:function(e,t,i){if(!a.test(e))throw new Error("invalid attribute:"+e);this[this.length++]={qName:e,value:t,offset:i}},length:0,getLocalName:function(e){return this[e].localName},getLocator:function(e){return this[e].locator},getQName:function(e){return this[e].qName},getURI:function(e){return this[e].uri},getValue:function(e){return this[e].value}},b({},b.prototype)instanceof b||(b=function(e,t){function i(){}for(t in i.prototype=t,i=new i,e)i[t]=e[t];return i}),i.XMLReader=r},{}],"/src/js/index.js":[function(e,t,i){"use strict";var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}();var n=e("./templates"),a=e("docxtemplater").DocUtils,r=e("xmldom").DOMParser;var o=e("./imgManager"),l="open-xml-templating/docxtemplater-image-module";function c(e){return e.part}function u(e){var t=e.part,i=e.left,s=e.right,n=e.postparsed.slice(i+1,s).reduce((function(e,t){return e+t.value}),""),a=(new r).parseFromString("<xml>"+n+"</xml>"),o=a.getElementsByTagName("a:off"),l=a.getElementsByTagName("a:ext");return t.ext={cx:parseInt(l[0].getAttribute("cx"),10),cy:parseInt(l[0].getAttribute("cy"),10)},t.offset={x:parseInt(o[0].getAttribute("x"),10),y:parseInt(o[0].getAttribute("y"),10)},t}var d=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name="ImageModule",this.options=t||{},this.imgManagers={},null==this.options.centered&&(this.options.centered=!1),null==this.options.getImage)throw new Error("You should pass getImage");if(null==this.options.getSize)throw new Error("You should pass getSize");this.imageNumber=1}return s(e,[{key:"optionsTransformer",value:function(e,t){var i=t.zip.file(/\.xml\.rels/).concat(t.zip.file(/\[Content_Types\].xml/)).map((function(e){return e.name}));return this.fileTypeConfig=t.fileTypeConfig,this.fileType=t.fileType,this.zip=t.zip,e.xmlFileNames=e.xmlFileNames.concat(i),e}},{key:"set",value:function(e){e.zip&&(this.zip=e.zip),e.xmlDocuments&&(this.xmlDocuments=e.xmlDocuments)}},{key:"parse",value:function(e){var t=l,i="placeholder";return"%%"===e.substring(0,2)?{type:i,value:e.substr(2),module:t,centered:!0}:"%"===e.substring(0,1)?{type:i,value:e.substr(1),module:t,centered:!1}:null}},{key:"postparse",value:function(e){var t=void 0,i=void 0;return"pptx"===this.fileType?(t="p:sp",i=u):(t=this.options.centered?"w:p":"w:t",i=c),a.traits.expandToOne(e,{moduleName:l,getInner:i,expandTo:t})}},{key:"render",value:function(e,t){this.imgManagers[t.filePath]=this.imgManagers[t.filePath]||new o(this.zip,t.filePath,this.xmlDocuments,this.fileType);var i=this.imgManagers[t.filePath];if("placeholder"===!e.type||e.module!==l)return null;try{var s=t.scopeManager.getValue(e.value);if(!s)throw new Error("tagValue is empty");var n=this.options.getImage(s,e.value),a=i.addImageRels(this.getNextImageName(),n),r=this.options.getSize(n,s,e.value);return this.getRenderedPart(e,a,r)}catch(e){return{value:this.fileTypeConfig.tagTextXml}}}},{key:"getRenderedPart",value:function(e,t,i){if((s=t)!=s)throw new Error("rId is NaN, aborting");var s,n=[a.convertPixelsToEmus(i[0]),a.convertPixelsToEmus(i[1])],r=this.options.centered||e.centered;return{value:"pptx"===this.fileType?this.getRenderedPartPptx(e,t,n,r):this.getRenderedPartDocx(t,n,r)}}},{key:"getRenderedPartPptx",value:function(e,t,i,s){var a={x:e.offset.x,y:e.offset.y},r=e.ext.cx,o=e.ext.cy,l=i[0],c=i[1];return s&&(a.x+=r/2-l/2,a.y+=o/2-c/2),n.getPptxImageXml(t,[l,c],a)}},{key:"getRenderedPartDocx",value:function(e,t,i){return i?n.getImageXmlCentered(e,t):n.getImageXml(e,t)}},{key:"getNextImageName",value:function(){var e="image_generated_"+this.imageNumber+".png";return this.imageNumber++,e}}]),e}();t.exports=d},{"./imgManager":2,"./templates":3,docxtemplater:5,xmldom:23}]},{},[])("/src/js/index.js")},11824:e=>{e.exports=function e(t,i,s){function n(r,o){if(!i[r]){if(!t[r]){if(a)return a(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var c=i[r]={exports:{}};t[r][0].call(c.exports,(function(e){return n(t[r][1][e]||e)}),c,c.exports,e,t,i,s)}return i[r].exports}for(var a=void 0,r=0;r<s.length;r++)n(s[r]);return n}({1:[function(e,t,i){"use strict";var s=e("./memoize"),n=e("xmldom").DOMParser,a=e("xmldom").XMLSerializer,r=e("./errors"),o={};o.defaults={nullGetter:function(e){return e.module?(e.module,""):"undefined"},parser:s((function(e){return s=function(t){return"."===e?t:t[e]},(i="get")in(t={})?Object.defineProperty(t,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[i]=s,t;var t,i,s})),delimiters:{start:"{",end:"}"}},o.mergeObjects=function(){for(var e={},t=void 0,i=void 0,s=0;s<arguments.length;s+=1){t=arguments[s],i=Object.keys(t);for(var n=0;n<i.length;n+=1)e[i[n]]=t[i[n]]}return e},o.xml2str=function(e){return(new a).serializeToString(e)},o.decodeUtf8=function(e){try{if(void 0===e)return;return decodeURIComponent(escape(o.convertSpaces(e)))}catch(i){var t=new Error("End");throw t.properties.data=e,t.properties.explanation="Could not decode string to UTF8",t}},o.encodeUtf8=function(e){return unescape(encodeURIComponent(e))},o.str2xml=function(e,t){return new n({errorHandler:t}).parseFromString(e,"text/xml")},o.charMap={"&":"&amp;","'":"&apos;","<":"&lt;",">":"&gt;"};var l=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g;o.escapeRegExp=function(e){return e.replace(l,"\\$&")},o.charMapRegexes=Object.keys(o.charMap).map((function(e){var t=o.charMap[e];return{rstart:new RegExp(o.escapeRegExp(t),"g"),rend:new RegExp(o.escapeRegExp(e),"g"),start:t,end:e}})),o.wordToUtf8=function(e){for(var t=void 0,i=0,s=o.charMapRegexes.length;i<s;i++)t=o.charMapRegexes[i],e=e.replace(t.rstart,t.end);return e},o.utf8ToWord=function(e){"string"!=typeof e&&(e=e.toString());for(var t=void 0,i=0,s=o.charMapRegexes.length;i<s;i++)t=o.charMapRegexes[i],e=e.replace(t.rend,t.start);return e},o.cloneDeep=function(e){return JSON.parse(JSON.stringify(e))},o.concatArrays=function(e){return e.reduce((function(e,t){return Array.prototype.push.apply(e,t),e}),[])};var c=new RegExp(String.fromCharCode(160),"g");function u(e){var t=new r.XTTemplateError("No tag '"+e.element+"' was found at the "+e.position);throw t.properties={id:"no_xml_tag_found_at_"+e.position,explanation:"No tag '"+e.element+"' was found at the "+e.position,parsed:e.parsed,index:e.index,element:e.element},t}o.convertSpaces=function(e){return e.replace(c," ")},o.pregMatchAll=function(e,t){for(var i=[],s=void 0;null!=(s=e.exec(t));)i.push({array:s,offset:s.index});return i},o.sizeOfObject=function(e){return Object.keys(e).length},o.getRight=function(e,t,i){for(var s=i,n=e.length;s<n;s++)if(e[s].value==="</"+t+">")return s;u({position:"right",element:t,parsed:e,index:i})},o.getLeft=function(e,t,i){for(var s=i;s>=0;s--){var n=e[s];if(0===n.value.indexOf("<"+t)&&-1!==[">"," "].indexOf(n.value[t.length+1]))return s}u({position:"left",element:t,parsed:e,index:i})},t.exports=o},{"./errors":2,"./memoize":5,xmldom:19}],2:[function(e,t,i){"use strict";function s(e){this.name="GenericError",this.message=e,this.stack=new Error(e).stack}function n(e){this.name="TemplateError",this.message=e,this.stack=new Error(e).stack}function a(e){this.name="ScopeParserError",this.message=e,this.stack=new Error(e).stack}function r(e){this.name="InternalError",this.properties={explanation:"InternalError"},this.message=e,this.stack=new Error(e).stack}s.prototype=Error.prototype,n.prototype=new s,a.prototype=new s,r.prototype=new s,t.exports={XTError:s,XTTemplateError:n,XTInternalError:r,XTScopeParserError:a}},{}],3:[function(e,t,i){"use strict";var s=e("./modules/loop"),n=e("./modules/space-preserve"),a=e("./modules/rawxml"),r=e("./modules/expand-pair-trait"),o=e("./modules/render"),l={getTemplatedFiles:function(e){return e.file(/ppt\/(slides|slideMasters)\/(slide|slideMaster)\d+\.xml/).map((function(e){return e.name})).concat(["ppt/presentation.xml"])},textPath:"ppt/slides/slide1.xml",tagsXmlTextArray:["a:t","m:t"],tagsXmlLexedArray:["p:sp","a:tc","a:tr","a:table","a:p","a:r"],tagRawXml:"p:sp",tagTextXml:"a:t",baseModules:[o,r,a,s]},c={getTemplatedFiles:function(e){return e.file(/word\/(header|footer)\d+\.xml/).map((function(e){return e.name})).concat(["word/document.xml"])},textPath:"word/document.xml",tagsXmlTextArray:["w:t","m:t"],tagsXmlLexedArray:["w:tc","w:tr","w:table","w:p","w:r"],tagRawXml:"w:p",tagTextXml:"w:t",baseModules:[o,n,r,a,s]};t.exports={docx:c,pptx:l}},{"./modules/expand-pair-trait":8,"./modules/loop":9,"./modules/rawxml":10,"./modules/render":11,"./modules/space-preserve":12}],4:[function(e,t,i){"use strict";var s=e("./errors"),n=e("./doc-utils");function a(e,t){return e[0]<=t.offset&&t.offset<e[1]}function r(e,t){if("tag"===e.type&&"start"===e.position&&e.text){if(t)throw new Error("Malformed xml : Already in text tag");return!0}if("tag"===e.type&&"end"===e.position&&e.text){if(!t)throw new Error("Malformed xml : Already not in text tag");return!1}return t}function o(e,t){return e.offset-t.offset}function l(e){var t=1;"/"===e[1]&&(t=2);var i=e.indexOf(" "),s=-1===i?e.length-1:i;return{tag:e.slice(t,s),position:1===t?"start":"end"}}function c(e){var t=new s.XTTemplateError("Unclosed tag");throw t.properties={xtag:e.xtag.split(" ")[0].substr(1),id:"unclosed_tag",context:e.xtag,explanation:"The tag beginning with '"+e.xtag.substr(0,10)+"' is unclosed"},t}function u(e,t){var i=!1,n={offset:0},a=void 0;e.forEach((function(e){a=t.substr(n.offset,e.offset-n.offset),("start"===e.position&&i||"end"===e.position&&!i)&&("start"===e.position?c({xtag:a}):function(e){var t=new s.XTTemplateError("Unopened tag");throw t.properties={xtag:e.xtag.split(" ")[0],id:"unopened_tag",context:e.xtag,explanation:"The tag beginning with '"+e.xtag.substr(0,10)+"' is unclosed"},t}({xtag:a})),i=!i,n=e}));var r=t.length;a=t.substr(n.offset,r-n.offset),i&&c({xtag:a})}function d(e,t,i){var s=[],n=-1;do{-1!==(n=e.indexOf(t,n+1))&&s.push({offset:n,position:i})}while(-1!==n);return s}function h(e){var t=this;this.innerContentParts=e,this.full="",this.parseDelimiters=function(e){t.full=t.innerContentParts.join("");var i=0;t.ranges=t.innerContentParts.map((function(e){return(i+=e.length)-e.length}));var s=n.concatArrays([d(t.full,e.start,"start"),d(t.full,e.end,"end")]).sort(o);u(s,t.full);var r={start:e.start.length,end:e.end.length},l=0,c=0;t.parsed=t.ranges.map((function(e,t){for(var i=[e,e+this.innerContentParts[t].length],n=this.innerContentParts[t],o=[];c<s.length&&a(i,s[c]);)o.push(s[c]),c++;var u=[],d=0;l>0&&(d=l,l=0),o.forEach((function(t){var i=n.substr(d,t.offset-e-d);i.length>0&&u.push({type:"content",value:i}),u.push({type:"delimiter",position:t.position}),d=t.offset-e+r[t.position]})),l=d-n.length;var h=n.substr(d);return h.length>0&&u.push({type:"content",value:h}),u}),t)}}t.exports={parse:function(e,t){var i=!1,s=[];e.forEach((function(e){(i=r(e,i))&&"content"===e.type&&s.push(e.value)}));var n=new h(s);n.parseDelimiters(t);var a=[],o=0;return e.forEach((function(e){i=r(e,i),"content"===e.type&&(e.position=i?"insidetag":"outsidetag"),i&&"content"===e.type?(Array.prototype.push.apply(a,n.parsed[o].map((function(e){return"content"===e.type&&(e.position="insidetag"),e}))),o++):a.push(e)})),a},xmlparse:function(e,t){var i=function(e,t,i){for(var s=0,a=e.length,r=n.concatArrays([t.map((function(e){return{tag:e,text:!0}})),i.map((function(e){return{tag:e,text:!1}}))]).reduce((function(e,t){return e[t.tag]=t.text,e}),{}),o=[];s<a&&-1!==(s=e.indexOf("<",s));){var c=s;s=e.indexOf(">",s);var u=e.slice(c,s+1),d=l(u),h=d.tag,p=d.position,f=r[h];null!=f&&o.push({type:"tag",position:p,text:f,offset:c,value:u})}return o}(e,t.text,t.other),s=0,a=i.reduce((function(t,i){var n=e.substr(s,i.offset-s);return n.length>0&&t.push({type:"content",value:n}),s=i.offset+i.value.length,delete i.offset,i.value.length>0&&t.push(i),t}),[]),r=e.substr(s);return r.length>0&&a.push({type:"content",value:r}),a}}},{"./doc-utils":1,"./errors":2}],5:[function(e,t,i){"use strict";t.exports=function(e){var t=JSON.stringify,i={};return function(){var s=t(arguments);return s in i?i[s]:i[s]=e.apply(this,arguments)}}},{}],6:[function(e,t,i){"use strict";function s(e,t){for(var i=-1,s=0,n=e.length;s<n;s++)t[s]>=e[s].length||(-1===i||e[s][t[s]].offset<e[i][t[i]].offset)&&(i=s);if(-1===i)throw new Error("minIndex negative");return i}t.exports=function(e){var t=e.reduce((function(e,t){return e+t.length}),0);e=e.filter((function(e){return e.length>0}));for(var i=new Array(t),n=e.map((function(){return 0})),a=0;a<=t-1;){var r=s(e,n);i[a]=e[r][n[r]],n[r]++,a++}return i}},{}],7:[function(e,t,i){"use strict";function s(){}function n(e){return e}t.exports=function(e){var t={set:s,parse:s,render:s,getTraits:s,optionsTransformer:n,getRenderedMap:n,postparse:n};if(Object.keys(t).every((function(t){return!e[t]})))throw new Error("This module cannot be wrapped, because it doesn't define any of the necessary functions");return Object.keys(t).forEach((function(i){e[i]=e[i]||t[i]})),e}},{}],8:[function(e,t,i){"use strict";var s=e("../mergesort"),n=e("../doc-utils"),a=e("../module-wrapper"),r=e("../traits").getExpandToDefault,o=e("../errors");function l(e){var t=e.tags,i=new o.XTTemplateError("Closing tag does not match opening tag");throw i.properties={id:"closing_tag_does_not_match_opening_tag",explanation:'The tag "'+t[0].value+'" is closed by the tag "'+t[1].value+'"',openingtag:t[0].value,closingtag:t[1].value},i}function c(e){switch(e.location){case"start":return 1;case"end":return-1;default:throw new Error("Location should be one of 'start' or 'end' (given : "+e.location+")")}}function u(e){if(0===e.length)return[];for(var t=1,i=e[0],s=1;s<e.length;s++){var n=e[s];if(0===(t+=c(n.part))){n.part.value!==i.part.value&&""!==n.part.value&&l({tags:[i.part,n.part]});var a=u(e.slice(s+1));return[[i,n]].concat(a)}}var r=i.part;!function(e){var t=e.location,i="start"===t?"unclosed":"unopened",s="start"===t?"Unclosed":"Unopened",n=new o.XTTemplateError(s+" loop"),a=e.part.value;throw n.properties={id:i+"_loop",explanation:"The loop with tag "+a+" is "+i,xtag:a},n}({part:r,location:r.location})}var d={name:"ExpandPairTrait",postparse:function(e,t){var i=t.getTraits,a=t.postparse,o=i("expandPair",e);o=o.map((function(e){return e||[]}));var l=u(o=s(o)),c=l.map((function(t){var i=t[0].part.expandTo;return"auto"===i&&(i=r(e.slice(t[0].offset,t[1].offset))),i?[n.getLeft(e,i,t[0].offset),n.getRight(e,i,t[1].offset)]:[t[0].offset,t[1].offset]})),d=0,h=void 0;return e.reduce((function(t,i,s){var n=d<l.length&&c[d][0]<=s,r=l[d],o=c[d];if(!n)return t.push(i),t;if(o[0]===s&&(h=[]),r[0].offset!==s&&r[1].offset!==s&&h.push(i),o[1]===s){var u=e[r[0].offset];delete u.location,delete u.expandTo,u.subparsed=a(h),t.push(u),d++}return t}),[])}};t.exports=function(){return a(d)}},{"../doc-utils":1,"../errors":2,"../mergesort":6,"../module-wrapper":7,"../traits":16}],9:[function(e,t,i){"use strict";var s=e("../doc-utils"),n=/^-([^\s]+)\s(.+)$/,a=e("../module-wrapper"),r="loop",o={name:"LoopModule",parse:function(e){var t=r,i="placeholder";return"#"===e[0]?{type:i,value:e.substr(1),expandTo:"auto",module:t,location:"start",inverted:!1}:"^"===e[0]?{type:i,value:e.substr(1),expandTo:"auto",module:t,location:"start",inverted:!0}:"/"===e[0]?{type:i,value:e.substr(1),module:t,location:"end"}:"-"===e[0]?{type:i,value:e.replace(n,"$2"),expandTo:e.replace(n,"$1"),module:t,location:"start",inverted:!1}:null},getTraits:function(e,t){if("expandPair"===e)return t.reduce((function(e,t,i){return"placeholder"===t.type&&t.module===r&&e.push({part:t,offset:i}),e}),[])},render:function(e,t){if("placeholder"===!e.type||e.module!==r)return null;var i=[];return t.scopeManager.loopOver(e.value,(function(n){var a=t.scopeManager.createSubScopeManager(n,e.value);i.push(t.render(s.mergeObjects({},t,{compiled:e.subparsed,tags:{},scopeManager:a})))}),e.inverted),{value:i.join("")}}};t.exports=function(){return a(o)}},{"../doc-utils":1,"../module-wrapper":7}],10:[function(e,t,i){"use strict";var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}();var n=e("../doc-utils"),a=e("../errors"),r="rawxml",o=e("../module-wrapper");function l(e){var t=e.part,i=e.left,s=e.right,n=e.postparsed,r=e.index,o=n.slice(i+1,s);return o.forEach((function(e,s){s!==r-i-1&&("placeholder"===e.type||"content"===e.type&&"insidetag"===e.position)&&function(e){var t=new a.XTTemplateError("Raw tag should be the only text in paragraph"),i=e.part.value;throw t.properties={id:"raw_xml_tag_should_be_only_text_in_paragraph",explanation:"The tag "+i,xtag:e.part.value,paragraphParts:e.paragraphParts},t}({paragraphParts:o,part:t})})),t}var c=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.name="RawXmlModule"}return s(e,[{key:"optionsTransformer",value:function(e,t){return this.fileTypeConfig=t.fileTypeConfig,e}},{key:"parse",value:function(e){return"@"!==e[0]?null:{type:"placeholder",value:e.substr(1),module:r}}},{key:"postparse",value:function(e){return n.traits.expandToOne(e,{moduleName:r,getInner:l,expandTo:this.fileTypeConfig.tagRawXml})}},{key:"render",value:function(e,t){if(e.module!==r)return null;var i=t.scopeManager.getValue(e.value);return null==i&&(i=t.nullGetter(e)),{value:i}}}]),e}();t.exports=function(){return o(new c)}},{"../doc-utils":1,"../errors":2,"../module-wrapper":7}],11:[function(e,t,i){"use strict";var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}();var n=e("../module-wrapper"),a=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.name="Render"}return s(e,[{key:"set",value:function(e){e.compiled&&(this.compiled=e.compiled),null!=e.data&&(this.data=e.data)}},{key:"getRenderedMap",value:function(e){var t=this;return Object.keys(this.compiled).reduce((function(e,i){return e[i]={from:i,data:t.data},e}),e)}}]),e}();t.exports=function(){return n(new a)}},{"../module-wrapper":7}],12:[function(e,t,i){"use strict";var s=e("../module-wrapper"),n={name:"SpacePreserveModule",postparse:function(e){var t=[],i=!1,s=e.reduce((function(e,s){return"tag"===s.type&&"start"===s.position&&s.text&&"<w:t>"===s.value&&(i=!0),i?("placeholder"!==s.type||s.module||(t[0].value='<w:t xml:space="preserve">'),t.push(s)):e.push(s),"tag"===s.type&&"end"===s.position&&s.text&&"</w:t>"===s.value&&(Array.prototype.push.apply(e,t),i=!1,t=[]),e}),[]);return Array.prototype.push.apply(s,t),s}};t.exports=function(){return s(n)}},{"../module-wrapper":7}],13:[function(e,t,i){"use strict";var s=e("./doc-utils"),n={postparse:function(e,t){function i(e,i){return t.map((function(t){return t.getTraits(e,i)}))}return function e(s){return t.reduce((function(t,s){return s.postparse(t,{postparse:e,getTraits:i})}),s)}(e)},parse:function(e,t){var i=!1,n=void 0,a=[];return e.reduce((function(e,r){return"delimiter"===r.type?(i="start"===r.position,"end"===r.position?(function(e,i){for(var s=void 0,n=0,a=t.length;n<a;n++)if(s=t[n].parse(e))return i.push(s),s;return null}(n=s.wordToUtf8(n),e)||e.push({type:"placeholder",value:n}),Array.prototype.push.apply(e,a),a=[],e):(n="",e)):i?("content"===r.type&&"insidetag"===r.position?n+=r.value:a.push(r),e):(e.push(r),e)}),[])}};t.exports=n},{"./doc-utils":1}],14:[function(e,t,i){"use strict";var s=e("./scope-manager"),n=e("./doc-utils");t.exports=function e(t){return t.render=e,t.modules=t.modules,t.scopeManager||(t.scopeManager=s.createBaseScopeManager(t)),t.compiled.map((function(e){var i=function(e,t){for(var i=void 0,s=0,n=t.modules.length;s<n;s++)if(i=t.modules[s].render(e,t))return i;return!1}(e,t);if(i)return i.value;if("placeholder"===e.type){var s=t.scopeManager.getValue(e.value);return null==s&&(s=t.nullGetter(e)),n.utf8ToWord(s)}if("content"===e.type||"tag"===e.type)return e.value;throw new Error('Unimplemented tag type "'+e.type+'"')})).join("")}},{"./doc-utils":1,"./scope-manager":15}],15:[function(e,t,i){"use strict";var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}();var n=e("./errors"),a=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.scopePath=t.scopePath,this.scopeList=t.scopeList,this.parser=t.parser}return s(e,[{key:"loopOver",value:function(e,t,i){return i=i||!1,this.loopOverValue(this.getValue(e),t,i)}},{key:"functorIfInverted",value:function(e,t,i){e&&t(i)}},{key:"isValueFalsy",value:function(e,t){return null==e||!e||"[object Array]"===t&&0===e.length}},{key:"loopOverValue",value:function(e,t,i){var s=Object.prototype.toString.call(e),n=this.scopeList[this.num];if(this.isValueFalsy(e,s))return this.functorIfInverted(i,t,n);if("[object Array]"!==s)return"[object Object]"===s?this.functorIfInverted(!i,t,e):!0===e?this.functorIfInverted(!i,t,n):void 0;for(var a,r=0;r<e.length;r++)a=e[r],this.functorIfInverted(!i,t,a)}},{key:"getValue",value:function(e,t){this.num=null==t?this.scopeList.length-1:t;var i=void 0,s=void 0,a=void 0,r=this.scopeList[this.num];try{s=this.parser(e)}catch(t){throw(i=new n.XTScopeParserError("Scope parser compilation failed")).properties={id:"scopeparser_compilation_failed",tag:e,explanation:"The scope parser for the tag "+e+" failed to compile",rootError:t},i}try{a=s.get(r,{num:this.num,scopeList:this.scopeList})}catch(t){throw(i=new n.XTScopeParserError("Scope parser execution failed")).properties={id:"scopeparser_execution_failed",explanation:"The scope parser for the tag "+e+" failed to execute",scope:r,tag:e,rootError:t},i}return null==a&&this.num>0?this.getValue(e,this.num-1):a}},{key:"createSubScopeManager",value:function(t,i){var s={scopePath:this.scopePath.slice(0),scopeList:this.scopeList.slice(0)};return s.parser=this.parser,s.scopeList=this.scopeList.concat(t),s.scopePath=this.scopePath.concat(i),new e(s)}}]),e}();a.createBaseScopeManager=function(e){var t=e.parser,i=e.tags,s={parser:t,tags:i,scopePath:[]};return s.scopeList=[i],new a(s)},t.exports=a},{"./errors":2}],16:[function(e,t,i){"use strict";var s=e("./doc-utils"),n=e("./errors");function a(e,t){if(0===e.length)return!1;var i=e[e.length-1].tag.substr(1),s=t.substr(2,t.length-3);return 0===i.indexOf(s)}function r(e,t){return e.push({tag:t}),e}function o(e,t,i){var a=e.expandTo||i.expandTo,r=t.indexOf(e);if(!a)return t;var o=void 0,l=void 0;try{o=s.getRight(t,a,r),l=s.getLeft(t,a,r)}catch(i){throw i instanceof n.XTTemplateError&&function(e){var t=new n.XTTemplateError("Raw tag not in paragraph"),i=e.part.value;throw t.properties={id:"raw_tag_outerxml_invalid",explanation:'The tag "'+i+'"',rootError:e.rootError,xtag:i,postparsed:e.postparsed,expandTo:e.expandTo,index:e.index},t}({part:e,rootError:i,postparsed:t,expandTo:a,index:r}),i}var c=t.slice(l,r),u=t.slice(r+1,o+1),d=i.getInner({index:r,part:e,leftParts:c,rightParts:u,left:l,right:o,postparsed:t});return d.length||(d.expanded=[c,u],d=[d]),s.concatArrays([t.slice(0,l),d,t.slice(o+1)])}t.exports={expandToOne:function(e,t){return e.reduce((function(e,i){return"placeholder"===i.type&&i.module===t.moduleName&&e.push(i),e}),[]).forEach((function(i){e=o(i,e,t)})),e},getExpandToDefault:function(e){for(var t=function(e){for(var t,i=e.filter((function(e){return"tag"===e.type})).map((function(e){return e.value})),s=[],n=0;n<i.length;n++)"/"===(t=i[n])[1]?a(s,t)?s.pop():s=r(s,t):"/"!==t[t.length-1]&&(s=r(s,t));return s}(e),i=0;i<t.length;i++){var s=t[i];if(0===s.tag.indexOf("<w:tc"))return"w:tr";if(0===s.tag.indexOf("<a:tc"))return"a:tr"}return!1}}},{"./doc-utils":1,"./errors":2}],17:[function(e,t,i){"use strict";var s=e("./doc-utils");var n=e("./memoize")((function(e,t){var i={};i.content=e,i.tagsXmlArray=t,i.tagsXmlArrayJoined=i.tagsXmlArray.join("|");var n=new RegExp("(<(?:"+i.tagsXmlArrayJoined+")[^>]*>)([^<>]*)</(?:"+i.tagsXmlArrayJoined+")>","g");return i.matches=s.pregMatchAll(n,i.content),i.charactersAddedCumulative=i.matches.map((function(){return 0})),i.charactersAdded=i.matches.map((function(){return 0})),function(e){function t(){var t={array:Array.prototype.slice.call(arguments)};t.array.shift();var i=t.array[0]+t.array[1];t.array.unshift(i),t.array.pop();var s=t.array.pop();return t.offset=s,t.first=!0,e.matches.unshift(t),e.charactersAdded.unshift(0),e.charactersAddedCumulative.unshift(0)}-1===e.content.indexOf("<")&&-1===e.content.indexOf(">")&&e.content.replace(/^()([^<>]*)$/,t);var i=new RegExp("^()([^<]+)</(?:"+e.tagsXmlArrayJoined+")>");return e.content.replace(i,t),i=new RegExp("(<(?:"+e.tagsXmlArrayJoined+")[^>]*>)([^>]+)$"),e.content.replace(i,(function(){var t={array:Array.prototype.slice.call(arguments)};t.array.pop();var i=t.array.pop();return t.offset=i,t.last=!0,e.matches.push(t),e.charactersAdded.push(0),e.charactersAddedCumulative.push(0)})),e}(i)}));t.exports=function(e,t){return s.cloneDeep(n(e,t))}},{"./doc-utils":1,"./memoize":5}],18:[function(e,t,i){"use strict";var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}();var n=e("./doc-utils"),a=e("./scope-manager"),r=e("./xml-matcher"),o=e("./errors"),l=e("./lexer"),c=e("./parser.js"),u=e("./render.js");t.exports=function(){function e(t,i){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.fromJson(i),this.setModules({inspect:{filePath:this.filePath}}),this.load(t)}return s(e,[{key:"load",value:function(e){if("string"!=typeof e){var t=new o.XTInternalError("Content must be a string");throw t.properties.id="xmltemplater_content_must_be_string",t}this.content=e}},{key:"setTags",value:function(e){return this.tags=null!=e?e:{},this.scopeManager=a.createBaseScopeManager({tags:this.tags,parser:this.parser}),this}},{key:"fromJson",value:function(e){this.filePath=e.filePath,this.modules=e.modules,this.fileTypeConfig=e.fileTypeConfig,Object.keys(n.defaults).map((function(t){this[t]=null!=e[t]?e[t]:n.defaults[t]}),this)}},{key:"getFullText",value:function(){return e=this.content,t=this.fileTypeConfig.tagsXmlTextArray,i=r(e,t).matches.map((function(e){return e.array[2]})),n.wordToUtf8(n.convertSpaces(i.join("")));var e,t,i}},{key:"setModules",value:function(e){this.modules.forEach((function(t){t.set(e)}))}},{key:"parse",value:function(){return this.xmllexed=l.xmlparse(this.content,{text:this.fileTypeConfig.tagsXmlTextArray,other:this.fileTypeConfig.tagsXmlLexedArray}),this.setModules({inspect:{xmllexed:this.xmllexed}}),this.lexed=l.parse(this.xmllexed,this.delimiters),this.setModules({inspect:{lexed:this.lexed}}),this.parsed=c.parse(this.lexed,this.modules),this.setModules({inspect:{parsed:this.parsed}}),this.postparsed=c.postparse(this.parsed,this.modules),this}},{key:"render",value:function(e){return this.filePath=e,this.setModules({inspect:{postparsed:this.postparsed}}),this.content=u({compiled:this.postparsed,tags:this.tags,modules:this.modules,parser:this.parser,nullGetter:this.nullGetter,filePath:this.filePath}),this.setModules({inspect:{content:this.content}}),this}}]),e}()},{"./doc-utils":1,"./errors":2,"./lexer":4,"./parser.js":13,"./render.js":14,"./scope-manager":15,"./xml-matcher":17}],19:[function(e,t,i){function s(e){this.options=e||{locator:{}}}function n(){this.cdata=!1}function a(e,t){t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber}function r(e){if(e)return"\n@"+(e.systemId||"")+"#[line:"+e.lineNumber+",col:"+e.columnNumber+"]"}function o(e,t,i){return"string"==typeof e?e.substr(t,i):e.length>=t+i||t?new java.lang.String(e,t,i)+"":e}function l(e,t){e.currentElement?e.currentElement.appendChild(t):e.doc.appendChild(t)}s.prototype.parseFromString=function(e,t){var i=this.options,s=new c,a=i.domBuilder||new n,o=i.errorHandler,l=i.locator,u=i.xmlns||{},d={lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return l&&a.setDocumentLocator(l),s.errorHandler=function(e,t,i){if(!e){if(t instanceof n)return t;e=t}var s={},a=e instanceof Function;function o(t){var n=e[t];!n&&a&&(n=2==e.length?function(i){e(t,i)}:e),s[t]=n&&function(e){n("[xmldom "+t+"]\t"+e+r(i))}||function(){}}return i=i||{},o("warning"),o("error"),o("fatalError"),s}(o,a,l),s.domBuilder=i.domBuilder||a,/\/x?html?$/.test(t)&&(d.nbsp=" ",d.copy="",u[""]="http://www.w3.org/1999/xhtml"),u.xml=u.xml||"http://www.w3.org/XML/1998/namespace",e?s.parse(e,u,d):s.errorHandler.error("invalid doc source"),a.doc},n.prototype={startDocument:function(){this.doc=(new u).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(e,t,i,s){var n=this.doc,r=n.createElementNS(e,i||t),o=s.length;l(this,r),this.currentElement=r,this.locator&&a(this.locator,r);for(var c=0;c<o;c++){e=s.getURI(c);var u=s.getValue(c),d=(i=s.getQName(c),n.createAttributeNS(e,i));this.locator&&a(s.getLocator(c),d),d.value=d.nodeValue=u,r.setAttributeNode(d)}},endElement:function(e,t,i){var s=this.currentElement;s.tagName,this.currentElement=s.parentNode},startPrefixMapping:function(e,t){},endPrefixMapping:function(e){},processingInstruction:function(e,t){var i=this.doc.createProcessingInstruction(e,t);this.locator&&a(this.locator,i),l(this,i)},ignorableWhitespace:function(e,t,i){},characters:function(e,t,i){if(e=o.apply(this,arguments)){if(this.cdata)var s=this.doc.createCDATASection(e);else s=this.doc.createTextNode(e);this.currentElement?this.currentElement.appendChild(s):/^\s*$/.test(e)&&this.doc.appendChild(s),this.locator&&a(this.locator,s)}},skippedEntity:function(e){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(e){(this.locator=e)&&(e.lineNumber=0)},comment:function(e,t,i){e=o.apply(this,arguments);var s=this.doc.createComment(e);this.locator&&a(this.locator,s),l(this,s)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(e,t,i){var s=this.doc.implementation;if(s&&s.createDocumentType){var n=s.createDocumentType(e,t,i);this.locator&&a(this.locator,n),l(this,n)}},warning:function(e){console.warn("[xmldom warning]\t"+e,r(this.locator))},error:function(e){console.error("[xmldom error]\t"+e,r(this.locator))},fatalError:function(e){throw console.error("[xmldom fatalError]\t"+e,r(this.locator)),e}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,(function(e){n.prototype[e]=function(){return null}}));var c=e("./sax").XMLReader,u=i.DOMImplementation=e("./dom").DOMImplementation;i.XMLSerializer=e("./dom").XMLSerializer,i.DOMParser=s},{"./dom":20,"./sax":21}],20:[function(e,t,i){function s(e,t){for(var i in e)t[i]=e[i]}function n(e,t){var i=e.prototype;if(Object.create){var n=Object.create(t.prototype);i.__proto__=n}if(!(i instanceof t)){function a(){}a.prototype=t.prototype,s(i,a=new a),e.prototype=i=a}i.constructor!=e&&("function"!=typeof e&&console.error("unknow Class:"+e),i.constructor=e)}var a={},r=a.ELEMENT_NODE=1,o=a.ATTRIBUTE_NODE=2,l=a.TEXT_NODE=3,c=a.CDATA_SECTION_NODE=4,u=a.ENTITY_REFERENCE_NODE=5,d=a.ENTITY_NODE=6,h=a.PROCESSING_INSTRUCTION_NODE=7,p=a.COMMENT_NODE=8,f=a.DOCUMENT_NODE=9,m=a.DOCUMENT_TYPE_NODE=10,g=a.DOCUMENT_FRAGMENT_NODE=11,b=a.NOTATION_NODE=12,v={},w={},y=(v.INDEX_SIZE_ERR=(w[1]="Index size error",1),v.DOMSTRING_SIZE_ERR=(w[2]="DOMString size error",2),v.HIERARCHY_REQUEST_ERR=(w[3]="Hierarchy request error",3)),_=(v.WRONG_DOCUMENT_ERR=(w[4]="Wrong document",4),v.INVALID_CHARACTER_ERR=(w[5]="Invalid character",5),v.NO_DATA_ALLOWED_ERR=(w[6]="No data allowed",6),v.NO_MODIFICATION_ALLOWED_ERR=(w[7]="No modification allowed",7),v.NOT_FOUND_ERR=(w[8]="Not found",8)),x=(v.NOT_SUPPORTED_ERR=(w[9]="Not supported",9),v.INUSE_ATTRIBUTE_ERR=(w[10]="Attribute in use",10));function k(e,t){if(t instanceof Error)var i=t;else i=this,Error.call(this,w[e]),this.message=w[e],Error.captureStackTrace&&Error.captureStackTrace(this,k);return i.code=e,t&&(this.message=this.message+": "+t),i}function C(){}function A(e,t){this._node=e,this._refresh=t,D(this)}function D(e){var t=e._node._inc||e._node.ownerDocument._inc;if(e._inc!=t){var i=e._refresh(e._node);ne(e,"length",i.length),s(i,e),e._inc=t}}function I(){}function $(e,t){for(var i=e.length;i--;)if(e[i]===t)return i}function E(e,t,i,s){if(s?t[$(t,s)]=i:t[t.length++]=i,e){i.ownerElement=e;var n=e.ownerDocument;n&&(s&&V(n,e,s),function(e,t,i){e&&e._inc++,"http://www.w3.org/2000/xmlns/"==i.namespaceURI&&(t._nsMap[i.prefix?i.localName:""]=i.value)}(n,e,i))}}function F(e,t,i){var s=$(t,i);if(!(s>=0))throw k(_,new Error(e.tagName+"@"+i));for(var n=t.length-1;s<n;)t[s]=t[++s];if(t.length=n,e){var a=e.ownerDocument;a&&(V(a,e,i),i.ownerElement=null)}}function S(e){if(this._features={},e)for(var t in e)this._features=e[t]}function N(){}function j(e){return("<"==e?"&lt;":">"==e&&"&gt;")||"&"==e&&"&amp;"||'"'==e&&"&quot;"||"&#"+e.charCodeAt()+";"}function B(e,t){if(t(e))return!0;if(e=e.firstChild)do{if(B(e,t))return!0}while(e=e.nextSibling)}function O(){}function V(e,t,i,s){e&&e._inc++,"http://www.w3.org/2000/xmlns/"==i.namespaceURI&&delete t._nsMap[i.prefix?i.localName:""]}function T(e,t,i){if(e&&e._inc){e._inc++;var s=t.childNodes;if(i)s[s.length++]=i;else{for(var n=t.firstChild,a=0;n;)s[a++]=n,n=n.nextSibling;s.length=a}}}function P(e,t){var i=t.previousSibling,s=t.nextSibling;return i?i.nextSibling=s:e.firstChild=s,s?s.previousSibling=i:e.lastChild=i,T(e.ownerDocument,e),t}function L(e,t,i){var s=t.parentNode;if(s&&s.removeChild(t),t.nodeType===g){var n=t.firstChild;if(null==n)return t;var a=t.lastChild}else n=a=t;var r=i?i.previousSibling:e.lastChild;n.previousSibling=r,a.nextSibling=i,r?r.nextSibling=n:e.firstChild=n,null==i?e.lastChild=a:i.previousSibling=a;do{n.parentNode=e}while(n!==a&&(n=n.nextSibling));return T(e.ownerDocument||e,e),t.nodeType==g&&(t.firstChild=t.lastChild=null),t}function R(){this._nsMap={}}function M(){}function q(){}function U(){}function z(){}function W(){}function H(){}function K(){}function J(){}function G(){}function Y(){}function Q(){}function Z(){}function X(e,t){var i=[],s=9==this.nodeType?this.documentElement:this,n=s.prefix,a=s.namespaceURI;if(a&&null==n&&null==(n=s.lookupPrefix(a)))var r=[{namespace:a,prefix:null}];return te(this,i,e,t,r),i.join("")}function ee(e,t,i){var s=e.prefix||"",n=e.namespaceURI;if(!s&&!n)return!1;if("xml"===s&&"http://www.w3.org/XML/1998/namespace"===n||"http://www.w3.org/2000/xmlns/"==n)return!1;for(var a=i.length;a--;){var r=i[a];if(r.prefix==s)return r.namespace!=n}return!0}function te(e,t,i,s,n){if(s){if(!(e=s(e)))return;if("string"==typeof e)return void t.push(e)}switch(e.nodeType){case r:n||(n=[]),n.length;var a=e.attributes,d=a.length,b=e.firstChild,v=e.tagName;i="http://www.w3.org/1999/xhtml"===e.namespaceURI||i,t.push("<",v);for(var w=0;w<d;w++)"xmlns"==(y=a.item(w)).prefix?n.push({prefix:y.localName,namespace:y.value}):"xmlns"==y.nodeName&&n.push({prefix:"",namespace:y.value});for(w=0;w<d;w++){var y;if(ee(y=a.item(w),0,n)){var _=y.prefix||"",x=y.namespaceURI,k=_?" xmlns:"+_:" xmlns";t.push(k,'="',x,'"'),n.push({prefix:_,namespace:x})}te(y,t,i,s,n)}if(ee(e,0,n)&&(_=e.prefix||"",x=e.namespaceURI,k=_?" xmlns:"+_:" xmlns",t.push(k,'="',x,'"'),n.push({prefix:_,namespace:x})),b||i&&!/^(?:meta|link|img|br|hr|input)$/i.test(v)){if(t.push(">"),i&&/^script$/i.test(v))for(;b;)b.data?t.push(b.data):te(b,t,i,s,n),b=b.nextSibling;else for(;b;)te(b,t,i,s,n),b=b.nextSibling;t.push("</",v,">")}else t.push("/>");return;case f:case g:for(b=e.firstChild;b;)te(b,t,i,s,n),b=b.nextSibling;return;case o:return t.push(" ",e.name,'="',e.value.replace(/[<&"]/g,j),'"');case l:return t.push(e.data.replace(/[<&]/g,j));case c:return t.push("<![CDATA[",e.data,"]]>");case p:return t.push("\x3c!--",e.data,"--\x3e");case m:var C=e.publicId,A=e.systemId;if(t.push("<!DOCTYPE ",e.name),C)t.push(' PUBLIC "',C),A&&"."!=A&&t.push('" "',A),t.push('">');else if(A&&"."!=A)t.push(' SYSTEM "',A,'">');else{var D=e.internalSubset;D&&t.push(" [",D,"]"),t.push(">")}return;case h:return t.push("<?",e.target," ",e.data,"?>");case u:return t.push("&",e.nodeName,";");default:t.push("??",e.nodeName)}}function ie(e,t,i){var s;switch(t.nodeType){case r:(s=t.cloneNode(!1)).ownerDocument=e;case g:break;case o:i=!0}if(s||(s=t.cloneNode(!1)),s.ownerDocument=e,s.parentNode=null,i)for(var n=t.firstChild;n;)s.appendChild(ie(e,n,i)),n=n.nextSibling;return s}function se(e,t,i){var s=new t.constructor;for(var n in t){var a=t[n];"object"!=typeof a&&a!=s[n]&&(s[n]=a)}switch(t.childNodes&&(s.childNodes=new C),s.ownerDocument=e,s.nodeType){case r:var l=t.attributes,c=s.attributes=new I,u=l.length;c._ownerElement=s;for(var d=0;d<u;d++)s.setAttributeNode(se(e,l.item(d),!0));break;case o:i=!0}if(i)for(var h=t.firstChild;h;)s.appendChild(se(e,h,i)),h=h.nextSibling;return s}function ne(e,t,i){e[t]=i}v.INVALID_STATE_ERR=(w[11]="Invalid state",11),v.SYNTAX_ERR=(w[12]="Syntax error",12),v.INVALID_MODIFICATION_ERR=(w[13]="Invalid modification",13),v.NAMESPACE_ERR=(w[14]="Invalid namespace",14),v.INVALID_ACCESS_ERR=(w[15]="Invalid access",15),k.prototype=Error.prototype,s(v,k),C.prototype={length:0,item:function(e){return this[e]||null},toString:function(e,t){for(var i=[],s=0;s<this.length;s++)te(this[s],i,e,t);return i.join("")}},A.prototype.item=function(e){return D(this),this[e]},n(A,C),I.prototype={length:0,item:C.prototype.item,getNamedItem:function(e){for(var t=this.length;t--;){var i=this[t];if(i.nodeName==e)return i}},setNamedItem:function(e){var t=e.ownerElement;if(t&&t!=this._ownerElement)throw new k(x);var i=this.getNamedItem(e.nodeName);return E(this._ownerElement,this,e,i),i},setNamedItemNS:function(e){var t,i=e.ownerElement;if(i&&i!=this._ownerElement)throw new k(x);return t=this.getNamedItemNS(e.namespaceURI,e.localName),E(this._ownerElement,this,e,t),t},removeNamedItem:function(e){var t=this.getNamedItem(e);return F(this._ownerElement,this,t),t},removeNamedItemNS:function(e,t){var i=this.getNamedItemNS(e,t);return F(this._ownerElement,this,i),i},getNamedItemNS:function(e,t){for(var i=this.length;i--;){var s=this[i];if(s.localName==t&&s.namespaceURI==e)return s}return null}},S.prototype={hasFeature:function(e,t){var i=this._features[e.toLowerCase()];return!(!i||t&&!(t in i))},createDocument:function(e,t,i){var s=new O;if(s.implementation=this,s.childNodes=new C,s.doctype=i,i&&s.appendChild(i),t){var n=s.createElementNS(e,t);s.appendChild(n)}return s},createDocumentType:function(e,t,i){var s=new H;return s.name=e,s.nodeName=e,s.publicId=t,s.systemId=i,s}},N.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(e,t){return L(this,e,t)},replaceChild:function(e,t){this.insertBefore(e,t),t&&this.removeChild(t)},removeChild:function(e){return P(this,e)},appendChild:function(e){return this.insertBefore(e,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(e){return se(this.ownerDocument||this,this,e)},normalize:function(){for(var e=this.firstChild;e;){var t=e.nextSibling;t&&t.nodeType==l&&e.nodeType==l?(this.removeChild(t),e.appendData(t.data)):(e.normalize(),e=t)}},isSupported:function(e,t){return this.ownerDocument.implementation.hasFeature(e,t)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(e){for(var t=this;t;){var i=t._nsMap;if(i)for(var s in i)if(i[s]==e)return s;t=t.nodeType==o?t.ownerDocument:t.parentNode}return null},lookupNamespaceURI:function(e){for(var t=this;t;){var i=t._nsMap;if(i&&e in i)return i[e];t=t.nodeType==o?t.ownerDocument:t.parentNode}return null},isDefaultNamespace:function(e){return null==this.lookupPrefix(e)}},s(a,N),s(a,N.prototype),O.prototype={nodeName:"#document",nodeType:f,doctype:null,documentElement:null,_inc:1,insertBefore:function(e,t){if(e.nodeType==g){for(var i=e.firstChild;i;){var s=i.nextSibling;this.insertBefore(i,t),i=s}return e}return null==this.documentElement&&e.nodeType==r&&(this.documentElement=e),L(this,e,t),e.ownerDocument=this,e},removeChild:function(e){return this.documentElement==e&&(this.documentElement=null),P(this,e)},importNode:function(e,t){return ie(this,e,t)},getElementById:function(e){var t=null;return B(this.documentElement,(function(i){if(i.nodeType==r&&i.getAttribute("id")==e)return t=i,!0})),t},createElement:function(e){var t=new R;return t.ownerDocument=this,t.nodeName=e,t.tagName=e,t.childNodes=new C,(t.attributes=new I)._ownerElement=t,t},createDocumentFragment:function(){var e=new Y;return e.ownerDocument=this,e.childNodes=new C,e},createTextNode:function(e){var t=new U;return t.ownerDocument=this,t.appendData(e),t},createComment:function(e){var t=new z;return t.ownerDocument=this,t.appendData(e),t},createCDATASection:function(e){var t=new W;return t.ownerDocument=this,t.appendData(e),t},createProcessingInstruction:function(e,t){var i=new Q;return i.ownerDocument=this,i.tagName=i.target=e,i.nodeValue=i.data=t,i},createAttribute:function(e){var t=new M;return t.ownerDocument=this,t.name=e,t.nodeName=e,t.localName=e,t.specified=!0,t},createEntityReference:function(e){var t=new G;return t.ownerDocument=this,t.nodeName=e,t},createElementNS:function(e,t){var i=new R,s=t.split(":"),n=i.attributes=new I;return i.childNodes=new C,i.ownerDocument=this,i.nodeName=t,i.tagName=t,i.namespaceURI=e,2==s.length?(i.prefix=s[0],i.localName=s[1]):i.localName=t,n._ownerElement=i,i},createAttributeNS:function(e,t){var i=new M,s=t.split(":");return i.ownerDocument=this,i.nodeName=t,i.name=t,i.namespaceURI=e,i.specified=!0,2==s.length?(i.prefix=s[0],i.localName=s[1]):i.localName=t,i}},n(O,N),R.prototype={nodeType:r,hasAttribute:function(e){return null!=this.getAttributeNode(e)},getAttribute:function(e){var t=this.getAttributeNode(e);return t&&t.value||""},getAttributeNode:function(e){return this.attributes.getNamedItem(e)},setAttribute:function(e,t){var i=this.ownerDocument.createAttribute(e);i.value=i.nodeValue=""+t,this.setAttributeNode(i)},removeAttribute:function(e){var t=this.getAttributeNode(e);t&&this.removeAttributeNode(t)},appendChild:function(e){return e.nodeType===g?this.insertBefore(e,null):function(e,t){var i=t.parentNode;if(i){var s=e.lastChild;i.removeChild(t),s=e.lastChild}return s=e.lastChild,t.parentNode=e,t.previousSibling=s,t.nextSibling=null,s?s.nextSibling=t:e.firstChild=t,e.lastChild=t,T(e.ownerDocument,e,t),t}(this,e)},setAttributeNode:function(e){return this.attributes.setNamedItem(e)},setAttributeNodeNS:function(e){return this.attributes.setNamedItemNS(e)},removeAttributeNode:function(e){return this.attributes.removeNamedItem(e.nodeName)},removeAttributeNS:function(e,t){var i=this.getAttributeNodeNS(e,t);i&&this.removeAttributeNode(i)},hasAttributeNS:function(e,t){return null!=this.getAttributeNodeNS(e,t)},getAttributeNS:function(e,t){var i=this.getAttributeNodeNS(e,t);return i&&i.value||""},setAttributeNS:function(e,t,i){var s=this.ownerDocument.createAttributeNS(e,t);s.value=s.nodeValue=""+i,this.setAttributeNode(s)},getAttributeNodeNS:function(e,t){return this.attributes.getNamedItemNS(e,t)},getElementsByTagName:function(e){return new A(this,(function(t){var i=[];return B(t,(function(s){s===t||s.nodeType!=r||"*"!==e&&s.tagName!=e||i.push(s)})),i}))},getElementsByTagNameNS:function(e,t){return new A(this,(function(i){var s=[];return B(i,(function(n){n===i||n.nodeType!==r||"*"!==e&&n.namespaceURI!==e||"*"!==t&&n.localName!=t||s.push(n)})),s}))}},O.prototype.getElementsByTagName=R.prototype.getElementsByTagName,O.prototype.getElementsByTagNameNS=R.prototype.getElementsByTagNameNS,n(R,N),M.prototype.nodeType=o,n(M,N),q.prototype={data:"",substringData:function(e,t){return this.data.substring(e,e+t)},appendData:function(e){e=this.data+e,this.nodeValue=this.data=e,this.length=e.length},insertData:function(e,t){this.replaceData(e,0,t)},appendChild:function(e){throw new Error(w[y])},deleteData:function(e,t){this.replaceData(e,t,"")},replaceData:function(e,t,i){i=this.data.substring(0,e)+i+this.data.substring(e+t),this.nodeValue=this.data=i,this.length=i.length}},n(q,N),U.prototype={nodeName:"#text",nodeType:l,splitText:function(e){var t=this.data,i=t.substring(e);t=t.substring(0,e),this.data=this.nodeValue=t,this.length=t.length;var s=this.ownerDocument.createTextNode(i);return this.parentNode&&this.parentNode.insertBefore(s,this.nextSibling),s}},n(U,q),z.prototype={nodeName:"#comment",nodeType:p},n(z,q),W.prototype={nodeName:"#cdata-section",nodeType:c},n(W,q),H.prototype.nodeType=m,n(H,N),K.prototype.nodeType=b,n(K,N),J.prototype.nodeType=d,n(J,N),G.prototype.nodeType=u,n(G,N),Y.prototype.nodeName="#document-fragment",Y.prototype.nodeType=g,n(Y,N),Q.prototype.nodeType=h,n(Q,N),Z.prototype.serializeToString=function(e,t,i){return X.call(e,t,i)},N.prototype.toString=X;try{if(Object.defineProperty){function ae(e){switch(e.nodeType){case r:case g:var t=[];for(e=e.firstChild;e;)7!==e.nodeType&&8!==e.nodeType&&t.push(ae(e)),e=e.nextSibling;return t.join("");default:return e.nodeValue}}Object.defineProperty(A.prototype,"length",{get:function(){return D(this),this.$$length}}),Object.defineProperty(N.prototype,"textContent",{get:function(){return ae(this)},set:function(e){switch(this.nodeType){case r:case g:for(;this.firstChild;)this.removeChild(this.firstChild);(e||String(e))&&this.appendChild(this.ownerDocument.createTextNode(e));break;default:this.data=e,this.value=e,this.nodeValue=e}}}),ne=function(e,t,i){e["$$"+t]=i}}}catch(re){}i.DOMImplementation=S,i.XMLSerializer=Z},{}],21:[function(e,t,i){var s=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,n=new RegExp("[\\-\\.0-9"+s.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),a=new RegExp("^"+s.source+n.source+"*(?::"+s.source+n.source+"*)?$");function r(){}function o(e,t,i,s,n){function a(e){var t=e.slice(1,-1);return t in i?i[t]:"#"===t.charAt(0)?function(e){if(e>65535){var t=55296+((e-=65536)>>10),i=56320+(1023&e);return String.fromCharCode(t,i)}return String.fromCharCode(e)}(parseInt(t.substr(1).replace("x","0x"))):(n.error("entity not found:"+e),e)}function r(t){if(t>x){var i=e.substring(x,t).replace(/&#?\w+;/g,a);w&&o(x),s.characters(i,0,t-x),x=t}}function o(t,i){for(;t>=b&&(i=v.exec(e));)p=i.index,b=p+i[0].length,w.lineNumber++;w.columnNumber=t-p+1}for(var p=0,b=0,v=/.*(?:\r\n?|\n)|.*$/g,w=s.locator,y=[{currentNSMap:t}],_={},x=0;;){try{var k=e.indexOf("<",x);if(k<0){if(!e.substr(x).match(/^\s*$/)){var C=s.doc,A=C.createTextNode(e.substr(x));C.appendChild(A),s.currentElement=A}return}switch(k>x&&r(k),e.charAt(k+1)){case"/":var D=e.indexOf(">",k+3),I=e.substring(k+2,D),$=y.pop();D<0?(I=e.substring(k+2).replace(/[\s<].*/,""),n.error("end tag name: "+I+" is not complete:"+$.tagName),D=k+1+I.length):I.match(/\s</)&&(I=I.replace(/[\s<].*/,""),n.error("end tag name: "+I+" maybe not complete"),D=k+1+I.length);var E=$.localNSMap,F=$.tagName==I;if(F||$.tagName&&$.tagName.toLowerCase()==I.toLowerCase()){if(s.endElement($.uri,$.localName,I),E)for(var S in E)s.endPrefixMapping(S);F||n.fatalError("end tag name: "+I+" is not match the current start tagName:"+$.tagName)}else y.push($);D++;break;case"?":w&&o(k),D=m(e,k,s);break;case"!":w&&o(k),D=f(e,k,s,n);break;default:w&&o(k);var N=new g,j=y[y.length-1].currentNSMap,B=(D=c(e,k,N,j,a,n),N.length);if(!N.closed&&h(e,D,N.tagName,_)&&(N.closed=!0,i.nbsp||n.warning("unclosed xml attribute")),w&&B){for(var O=l(w,{}),V=0;V<B;V++){var T=N[V];o(T.offset),T.locator=l(w,{})}s.locator=O,u(N,s,j)&&y.push(N),s.locator=w}else u(N,s,j)&&y.push(N);"http://www.w3.org/1999/xhtml"!==N.uri||N.closed?D++:D=d(e,D,N.tagName,a,s)}}catch(e){n.error("element parse error: "+e),D=-1}D>x?x=D:r(Math.max(k,x)+1)}}function l(e,t){return t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber,t}function c(e,t,i,s,n,a){for(var r,o=++t,l=0;;){var c=e.charAt(o);switch(c){case"=":if(1===l)r=e.slice(t,o),l=3;else{if(2!==l)throw new Error("attribute equal must after attrName");l=3}break;case"'":case'"':if(3===l||1===l){if(1===l&&(a.warning('attribute value must after "="'),r=e.slice(t,o)),t=o+1,!((o=e.indexOf(c,t))>0))throw new Error("attribute value no end '"+c+"' match");u=e.slice(t,o).replace(/&#?\w+;/g,n),i.add(r,u,t-1),l=5}else{if(4!=l)throw new Error('attribute value must after "="');u=e.slice(t,o).replace(/&#?\w+;/g,n),i.add(r,u,t),a.warning('attribute "'+r+'" missed start quot('+c+")!!"),t=o+1,l=5}break;case"/":switch(l){case 0:i.setTagName(e.slice(t,o));case 5:case 6:case 7:l=7,i.closed=!0;case 4:case 1:case 2:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return a.error("unexpected end of input"),0==l&&i.setTagName(e.slice(t,o)),o;case">":switch(l){case 0:i.setTagName(e.slice(t,o));case 5:case 6:case 7:break;case 4:case 1:"/"===(u=e.slice(t,o)).slice(-1)&&(i.closed=!0,u=u.slice(0,-1));case 2:2===l&&(u=r),4==l?(a.warning('attribute "'+u+'" missed quot(")!!'),i.add(r,u.replace(/&#?\w+;/g,n),t)):("http://www.w3.org/1999/xhtml"===s[""]&&u.match(/^(?:disabled|checked|selected)$/i)||a.warning('attribute "'+u+'" missed value!! "'+u+'" instead!!'),i.add(u,u,t));break;case 3:throw new Error("attribute value missed!!")}return o;case"":c=" ";default:if(c<=" ")switch(l){case 0:i.setTagName(e.slice(t,o)),l=6;break;case 1:r=e.slice(t,o),l=2;break;case 4:var u=e.slice(t,o).replace(/&#?\w+;/g,n);a.warning('attribute "'+u+'" missed quot(")!!'),i.add(r,u,t);case 5:l=6}else switch(l){case 2:i.tagName,"http://www.w3.org/1999/xhtml"===s[""]&&r.match(/^(?:disabled|checked|selected)$/i)||a.warning('attribute "'+r+'" missed value!! "'+r+'" instead2!!'),i.add(r,r,t),t=o,l=1;break;case 5:a.warning('attribute space is required"'+r+'"!!');case 6:l=1,t=o;break;case 3:l=4,t=o;break;case 7:throw new Error("elements closed character '/' and '>' must be connected to")}}o++}}function u(e,t,i){for(var s=e.tagName,n=null,a=e.length;a--;){var r=e[a],o=r.qName,l=r.value;if((h=o.indexOf(":"))>0)var c=r.prefix=o.slice(0,h),u=o.slice(h+1),d="xmlns"===c&&u;else u=o,c=null,d="xmlns"===o&&"";r.localName=u,!1!==d&&(null==n&&(n={},p(i,i={})),i[d]=n[d]=l,r.uri="http://www.w3.org/2000/xmlns/",t.startPrefixMapping(d,l))}for(a=e.length;a--;)(c=(r=e[a]).prefix)&&("xml"===c&&(r.uri="http://www.w3.org/XML/1998/namespace"),"xmlns"!==c&&(r.uri=i[c||""]));var h;(h=s.indexOf(":"))>0?(c=e.prefix=s.slice(0,h),u=e.localName=s.slice(h+1)):(c=null,u=e.localName=s);var f=e.uri=i[c||""];if(t.startElement(f,u,s,e),!e.closed)return e.currentNSMap=i,e.localNSMap=n,!0;if(t.endElement(f,u,s),n)for(c in n)t.endPrefixMapping(c)}function d(e,t,i,s,n){if(/^(?:script|textarea)$/i.test(i)){var a=e.indexOf("</"+i+">",t),r=e.substring(t+1,a);if(/[&<]/.test(r))return/^script$/i.test(i)?(n.characters(r,0,r.length),a):(r=r.replace(/&#?\w+;/g,s),n.characters(r,0,r.length),a)}return t+1}function h(e,t,i,s){var n=s[i];return null==n&&((n=e.lastIndexOf("</"+i+">"))<t&&(n=e.lastIndexOf("</"+i)),s[i]=n),n<t}function p(e,t){for(var i in e)t[i]=e[i]}function f(e,t,i,s){if("-"===e.charAt(t+2))return"-"===e.charAt(t+3)?(n=e.indexOf("--\x3e",t+4))>t?(i.comment(e,t+4,n-t-4),n+3):(s.error("Unclosed comment"),-1):-1;if("CDATA["==e.substr(t+3,6)){var n=e.indexOf("]]>",t+9);return i.startCDATA(),i.characters(e,t+9,n-t-9),i.endCDATA(),n+3}var a=function(e,t){var i,s=[],n=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(n.lastIndex=t,n.exec(e);i=n.exec(e);)if(s.push(i),i[1])return s}(e,t),r=a.length;if(r>1&&/!doctype/i.test(a[0][0])){var o=a[1][0],l=r>3&&/^public$/i.test(a[2][0])&&a[3][0],c=r>4&&a[4][0],u=a[r-1];return i.startDTD(o,l&&l.replace(/^(['"])(.*?)\1$/,"$2"),c&&c.replace(/^(['"])(.*?)\1$/,"$2")),i.endDTD(),u.index+u[0].length}return-1}function m(e,t,i){var s=e.indexOf("?>",t);if(s){var n=e.substring(t,s).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return n?(n[0].length,i.processingInstruction(n[1],n[2]),s+2):-1}return-1}function g(e){}function b(e,t){return e.__proto__=t,e}r.prototype={parse:function(e,t,i){var s=this.domBuilder;s.startDocument(),p(t,t={}),o(e,t,i,s,this.errorHandler),s.endDocument()}},g.prototype={setTagName:function(e){if(!a.test(e))throw new Error("invalid tagName:"+e);this.tagName=e},add:function(e,t,i){if(!a.test(e))throw new Error("invalid attribute:"+e);this[this.length++]={qName:e,value:t,offset:i}},length:0,getLocalName:function(e){return this[e].localName},getLocator:function(e){return this[e].locator},getQName:function(e){return this[e].qName},getURI:function(e){return this[e].uri},getValue:function(e){return this[e].value}},b({},b.prototype)instanceof b||(b=function(e,t){function i(){}for(t in i.prototype=t,i=new i,e)i[t]=e[t];return i}),i.XMLReader=r},{}],"/src/js/docxtemplater.js":[function(e,t,i){"use strict";var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}();function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=e("./doc-utils");a.traits=e("./traits"),a.moduleWrapper=e("./module-wrapper");var r=a.moduleWrapper,o=function(){function e(){if(n(this,e),arguments.length>0)throw new Error("The constructor with parameters have been removed in docxtemplater 3.0, please check the upgrade guide.");this.compiled={},this.modules=[],this.setOptions({})}return s(e,[{key:"attachModule",value:function(e){return this.modules.push(r(e)),this}},{key:"setOptions",value:function(e){var t=this;return this.options=e,Object.keys(a.defaults).forEach((function(e){var i=a.defaults[e];t[e]=null!=t.options[e]?t.options[e]:i})),this.zip&&this.updateFileTypeConfig(),this}},{key:"loadZip",value:function(e){if(e.loadAsync)throw new Error("Docxtemplater doesn't handle JSZip version >=3, see changelog");return this.zip=e,this.updateFileTypeConfig(),this}},{key:"compileFile",value:function(e){var t=this.createTemplateClass(e);t.parse(),this.compiled[e]=t}},{key:"compile",value:function(){return this.templatedFiles=this.fileTypeConfig.getTemplatedFiles(this.zip),this}},{key:"updateFileTypeConfig",value:function(){return this.fileType=this.zip.files["word/document.xml"]?"docx":"pptx",this.fileTypeConfig=this.options.fileTypeConfig||e.FileTypeConfig[this.fileType],this}},{key:"render",value:function(){var e=this;return this.options.xmlFileNames=[],this.modules=this.fileTypeConfig.baseModules.map((function(e){return e()})).concat(this.modules),this.options=this.modules.reduce((function(t,i){return i.optionsTransformer(t,e)}),this.options),this.xmlDocuments=this.options.xmlFileNames.reduce((function(t,i){var s=e.zip.files[i].asText();return t[i]=a.str2xml(s),t}),{}),this.modules.forEach((function(t){t.set({zip:e.zip,xmlDocuments:e.xmlDocuments,data:e.data})})),this.compile(),this.modules.forEach((function(t){t.set({compiled:e.compiled})})),this.templatedFiles.forEach((function(t){null!=e.zip.files[t]&&e.compileFile(t)})),this.mapper=this.modules.reduce((function(e,t){return t.getRenderedMap(e)}),{}),Object.keys(this.mapper).forEach((function(t){var i=e.mapper[t],s=i.from,n=e.compiled[s];n.setTags(i.data),n.render(t),e.zip.file(t,n.content)})),Object.keys(this.xmlDocuments).forEach((function(t){e.zip.remove(t);var i=a.xml2str(e.xmlDocuments[t]);return e.zip.file(t,i,{})})),this}},{key:"setData",value:function(e){return this.data=e,this}},{key:"getZip",value:function(){return this.zip}},{key:"createTemplateClass",value:function(e){var t=this.zip.files[e].asText();return this.createTemplateClassFromContent(t,e)}},{key:"createTemplateClassFromContent",value:function(t,i){var s=this,n={filePath:i};return Object.keys(a.defaults).forEach((function(e){n[e]=s[e]})),n.fileTypeConfig=this.fileTypeConfig,n.modules=this.modules,new e.XmlTemplater(t,n)}},{key:"getFullText",value:function(e){return this.createTemplateClass(e||this.fileTypeConfig.textPath).getFullText()}},{key:"getTemplatedFiles",value:function(){return this.compile(),this.templatedFiles}}]),e}();o.DocUtils=e("./doc-utils"),o.Errors=e("./errors"),o.XmlTemplater=e("./xml-templater"),o.FileTypeConfig=e("./file-type-config"),o.XmlMatcher=e("./xml-matcher"),t.exports=o},{"./doc-utils":1,"./errors":2,"./file-type-config":3,"./module-wrapper":7,"./traits":16,"./xml-matcher":17,"./xml-templater":18}]},{},[])("/src/js/docxtemplater.js")},58296:e=>{e.exports=function e(t,i,s){function n(r,o){if(!i[r]){if(!t[r]){if(a)return a(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var c=i[r]={exports:{}};t[r][0].call(c.exports,(function(e){return n(t[r][1][e]||e)}),c,c.exports,e,t,i,s)}return i[r].exports}for(var a=void 0,r=0;r<s.length;r++)n(s[r]);return n}({1:[function(e,t,i){"use strict";function s(e){if(e){this.data=e,this.length=this.data.length,this.index=0,this.zero=0;for(var t=0;t<this.data.length;t++)e[t]=255&e[t]}}var n=e("./dataReader");s.prototype=new n,s.prototype.byteAt=function(e){return this.data[this.zero+e]},s.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),i=e.charCodeAt(1),s=e.charCodeAt(2),n=e.charCodeAt(3),a=this.length-4;a>=0;--a)if(this.data[a]===t&&this.data[a+1]===i&&this.data[a+2]===s&&this.data[a+3]===n)return a-this.zero;return-1},s.prototype.readData=function(e){if(this.checkOffset(e),0===e)return[];var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=s},{"./dataReader":6}],2:[function(e,t,i){"use strict";var s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(e,t){for(var i,n,a,r,o,l,c,u="",d=0;d<e.length;)r=(i=e.charCodeAt(d++))>>2,o=(3&i)<<4|(n=e.charCodeAt(d++))>>4,l=(15&n)<<2|(a=e.charCodeAt(d++))>>6,c=63&a,isNaN(n)?l=c=64:isNaN(a)&&(c=64),u=u+s.charAt(r)+s.charAt(o)+s.charAt(l)+s.charAt(c);return u},i.decode=function(e,t){var i,n,a,r,o,l,c="",u=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");u<e.length;)i=s.indexOf(e.charAt(u++))<<2|(r=s.indexOf(e.charAt(u++)))>>4,n=(15&r)<<4|(o=s.indexOf(e.charAt(u++)))>>2,a=(3&o)<<6|(l=s.indexOf(e.charAt(u++))),c+=String.fromCharCode(i),64!=o&&(c+=String.fromCharCode(n)),64!=l&&(c+=String.fromCharCode(a));return c}},{}],3:[function(e,t,i){"use strict";function s(){this.compressedSize=0,this.uncompressedSize=0,this.crc32=0,this.compressionMethod=null,this.compressedContent=null}s.prototype={getContent:function(){return null},getCompressedContent:function(){return null}},t.exports=s},{}],4:[function(e,t,i){"use strict";i.STORE={magic:"\0\0",compress:function(e,t){return e},uncompress:function(e){return e},compressInputType:null,uncompressInputType:null},i.DEFLATE=e("./flate")},{"./flate":9}],5:[function(e,t,i){"use strict";var s=e("./utils"),n=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];t.exports=function(e,t){if(void 0===e||!e.length)return 0;var i="string"!==s.getTypeOf(e);void 0===t&&(t=0);var a=0;t^=-1;for(var r=0,o=e.length;r<o;r++)a=i?e[r]:e.charCodeAt(r),t=t>>>8^n[255&(t^a)];return-1^t}},{"./utils":22}],6:[function(e,t,i){"use strict";function s(e){this.data=null,this.length=0,this.index=0,this.zero=0}var n=e("./utils");s.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(e){},readInt:function(e){var t,i=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)i=(i<<8)+this.byteAt(t);return this.index+=e,i},readString:function(e){return n.transformTo("string",this.readData(e))},readData:function(e){},lastIndexOfSignature:function(e){},readDate:function(){var e=this.readInt(4);return new Date(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1)}},t.exports=s},{"./utils":22}],7:[function(e,t,i){"use strict";i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!1,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],8:[function(e,t,i){"use strict";var s=e("./utils");i.string2binary=function(e){return s.string2binary(e)},i.string2Uint8Array=function(e){return s.transformTo("uint8array",e)},i.uint8Array2String=function(e){return s.transformTo("string",e)},i.string2Blob=function(e){var t=s.transformTo("arraybuffer",e);return s.arrayBuffer2Blob(t)},i.arrayBuffer2Blob=function(e){return s.arrayBuffer2Blob(e)},i.transformTo=function(e,t){return s.transformTo(e,t)},i.getTypeOf=function(e){return s.getTypeOf(e)},i.checkSupport=function(e){return s.checkSupport(e)},i.MAX_VALUE_16BITS=s.MAX_VALUE_16BITS,i.MAX_VALUE_32BITS=s.MAX_VALUE_32BITS,i.pretty=function(e){return s.pretty(e)},i.findCompression=function(e){return s.findCompression(e)},i.isRegExp=function(e){return s.isRegExp(e)}},{"./utils":22}],9:[function(e,t,i){"use strict";var s="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,n=e("pako");i.uncompressInputType=s?"uint8array":"array",i.compressInputType=s?"uint8array":"array",i.magic="\b\0",i.compress=function(e,t){return n.deflateRaw(e,{level:t.level||-1})},i.uncompress=function(e){return n.inflateRaw(e)}},{pako:25}],10:[function(e,t,i){"use strict";function s(e,t){return this instanceof s?(this.files={},this.comment=null,this.root="",e&&this.load(e,t),void(this.clone=function(){var e=new s;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e})):new s(e,t)}var n=e("./base64");s.prototype=e("./object"),s.prototype.load=e("./load"),s.support=e("./support"),s.defaults=e("./defaults"),s.utils=e("./deprecatedPublicUtils"),s.base64={encode:function(e){return n.encode(e)},decode:function(e){return n.decode(e)}},s.compressions=e("./compressions"),t.exports=s},{"./base64":2,"./compressions":4,"./defaults":7,"./deprecatedPublicUtils":8,"./load":11,"./object":14,"./support":18}],11:[function(e,t,i){"use strict";var s=e("./base64"),n=e("./utf8"),a=e("./utils"),r=e("./zipEntries");t.exports=function(e,t){var i,o,l,c;for((t=a.extend(t||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:n.utf8decode})).base64&&(e=s.decode(e)),i=(o=new r(e,t)).files,l=0;l<i.length;l++)c=i[l],this.file(c.fileNameStr,c.decompressed,{binary:!0,optimizedBinaryString:!0,date:c.date,dir:c.dir,comment:c.fileCommentStr.length?c.fileCommentStr:null,unixPermissions:c.unixPermissions,dosPermissions:c.dosPermissions,createFolders:t.createFolders});return o.zipComment.length&&(this.comment=o.zipComment),this}},{"./base64":2,"./utf8":21,"./utils":22,"./zipEntries":23}],12:[function(e,t,i){(function(e){"use strict";t.exports=function(t,i){return new e(t,i)},t.exports.test=function(t){return e.isBuffer(t)}}).call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{}],13:[function(e,t,i){"use strict";function s(e){this.data=e,this.length=this.data.length,this.index=0,this.zero=0}var n=e("./uint8ArrayReader");s.prototype=new n,s.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=s},{"./uint8ArrayReader":19}],14:[function(e,t,i){"use strict";var s=e("./support"),n=e("./utils"),a=e("./crc32"),r=e("./signature"),o=e("./defaults"),l=e("./base64"),c=e("./compressions"),u=e("./compressedObject"),d=e("./nodeBuffer"),h=e("./utf8"),p=e("./stringWriter"),f=e("./uint8ArrayWriter"),m=function(e){if(e._data instanceof u&&(e._data=e._data.getContent(),e.options.binary=!0,e.options.base64=!1,"uint8array"===n.getTypeOf(e._data))){var t=e._data;e._data=new Uint8Array(t.length),0!==t.length&&e._data.set(t,0)}return e._data},g=function(e){var t=m(e);return"string"===n.getTypeOf(t)?!e.options.binary&&s.nodebuffer?d(t,"utf-8"):e.asBinary():t},b=function(e){var t=m(this);return null==t?"":(this.options.base64&&(t=l.decode(t)),t=e&&this.options.binary?D.utf8decode(t):n.transformTo("string",t),e||this.options.binary||(t=n.transformTo("string",D.utf8encode(t))),t)},v=function(e,t,i){this.name=e,this.dir=i.dir,this.date=i.date,this.comment=i.comment,this.unixPermissions=i.unixPermissions,this.dosPermissions=i.dosPermissions,this._data=t,this.options=i,this._initialMetadata={dir:i.dir,date:i.date}};v.prototype={asText:function(){return b.call(this,!0)},asBinary:function(){return b.call(this,!1)},asNodeBuffer:function(){var e=g(this);return n.transformTo("nodebuffer",e)},asUint8Array:function(){var e=g(this);return n.transformTo("uint8array",e)},asArrayBuffer:function(){return this.asUint8Array().buffer}};var w=function(e,t){var i,s="";for(i=0;i<t;i++)s+=String.fromCharCode(255&e),e>>>=8;return s},y=function(e,t,i){var s,a=n.getTypeOf(t);if("string"==typeof(i=function(e){return!0!==(e=e||{}).base64||null!==e.binary&&void 0!==e.binary||(e.binary=!0),(e=n.extend(e,o)).date=e.date||new Date,null!==e.compression&&(e.compression=e.compression.toUpperCase()),e}(i)).unixPermissions&&(i.unixPermissions=parseInt(i.unixPermissions,8)),i.unixPermissions&&16384&i.unixPermissions&&(i.dir=!0),i.dosPermissions&&16&i.dosPermissions&&(i.dir=!0),i.dir&&(e=x(e)),i.createFolders&&(s=_(e))&&k.call(this,s,!0),i.dir||null==t)i.base64=!1,i.binary=!1,t=null,a=null;else if("string"===a)i.binary&&!i.base64&&!0!==i.optimizedBinaryString&&(t=n.string2binary(t));else{if(i.base64=!1,i.binary=!0,!(a||t instanceof u))throw new Error("The data of '"+e+"' is in an unsupported format !");"arraybuffer"===a&&(t=n.transformTo("uint8array",t))}var r=new v(e,t,i);return this.files[e]=r,r},_=function(e){"/"==e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return t>0?e.substring(0,t):""},x=function(e){return"/"!=e.slice(-1)&&(e+="/"),e},k=function(e,t){return t=void 0!==t&&t,e=x(e),this.files[e]||y.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]},C=function(e,t,i){var s,r=new u;return e._data instanceof u?(r.uncompressedSize=e._data.uncompressedSize,r.crc32=e._data.crc32,0===r.uncompressedSize||e.dir?(t=c.STORE,r.compressedContent="",r.crc32=0):e._data.compressionMethod===t.magic?r.compressedContent=e._data.getCompressedContent():(s=e._data.getContent(),r.compressedContent=t.compress(n.transformTo(t.compressInputType,s),i))):((s=g(e))&&0!==s.length&&!e.dir||(t=c.STORE,s=""),r.uncompressedSize=s.length,r.crc32=a(s),r.compressedContent=t.compress(n.transformTo(t.compressInputType,s),i)),r.compressedSize=r.compressedContent.length,r.compressionMethod=t.magic,r},A=function(e,t,i,s,o,l){var c,u,d,p,f=(i.compressedContent,l!==h.utf8encode),m=n.transformTo("string",l(t.name)),g=n.transformTo("string",h.utf8encode(t.name)),b=t.comment||"",v=n.transformTo("string",l(b)),y=n.transformTo("string",h.utf8encode(b)),_=g.length!==t.name.length,x=y.length!==b.length,k=t.options,C="",A="",D="";d=t._initialMetadata.dir!==t.dir?t.dir:k.dir,p=t._initialMetadata.date!==t.date?t.date:k.date;var I=0,$=0;d&&(I|=16),"UNIX"===o?($=798,I|=function(e,t){var i=e;return e||(i=t?16893:33204),(65535&i)<<16}(t.unixPermissions,d)):($=20,I|=function(e,t){return 63&(e||0)}(t.dosPermissions)),c=p.getHours(),c<<=6,c|=p.getMinutes(),c<<=5,c|=p.getSeconds()/2,u=p.getFullYear()-1980,u<<=4,u|=p.getMonth()+1,u<<=5,u|=p.getDate(),_&&(A=w(1,1)+w(a(m),4)+g,C+="up"+w(A.length,2)+A),x&&(D=w(1,1)+w(this.crc32(v),4)+y,C+="uc"+w(D.length,2)+D);var E="";return E+="\n\0",E+=f||!_&&!x?"\0\0":"\0\b",E+=i.compressionMethod,E+=w(c,2),E+=w(u,2),E+=w(i.crc32,4),E+=w(i.compressedSize,4),E+=w(i.uncompressedSize,4),E+=w(m.length,2),E+=w(C.length,2),{fileRecord:r.LOCAL_FILE_HEADER+E+m+C,dirRecord:r.CENTRAL_FILE_HEADER+w($,2)+E+w(v.length,2)+"\0\0\0\0"+w(I,4)+w(s,4)+m+C+v,compressedObject:i}},D={load:function(e,t){throw new Error("Load method is not defined. Is the file jszip-load.js included ?")},filter:function(e){var t,i,s,a,r=[];for(t in this.files)this.files.hasOwnProperty(t)&&(s=this.files[t],a=new v(s.name,s._data,n.extend(s.options)),i=t.slice(this.root.length,t.length),t.slice(0,this.root.length)===this.root&&e(i,a)&&r.push(a));return r},file:function(e,t,i){if(1===arguments.length){if(n.isRegExp(e)){var s=e;return this.filter((function(e,t){return!t.dir&&s.test(e)}))}return this.filter((function(t,i){return!i.dir&&t===e}))[0]||null}return e=this.root+e,y.call(this,e,t,i),this},folder:function(e){if(!e)return this;if(n.isRegExp(e))return this.filter((function(t,i){return i.dir&&e.test(t)}));var t=this.root+e,i=k.call(this,t),s=this.clone();return s.root=i.name,s},remove:function(e){e=this.root+e;var t=this.files[e];if(t||("/"!=e.slice(-1)&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var i=this.filter((function(t,i){return i.name.slice(0,e.length)===e})),s=0;s<i.length;s++)delete this.files[i[s].name];return this},generate:function(e){e=n.extend(e||{},{base64:!0,compression:"STORE",compressionOptions:null,type:"base64",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:h.utf8encode}),n.checkSupport(e.type),"darwin"!==e.platform&&"freebsd"!==e.platform&&"linux"!==e.platform&&"sunos"!==e.platform||(e.platform="UNIX"),"win32"===e.platform&&(e.platform="DOS");var t,i,s=[],a=0,o=0,u=n.transformTo("string",e.encodeFileName(e.comment||this.comment||""));for(var d in this.files)if(this.files.hasOwnProperty(d)){var m=this.files[d],g=m.options.compression||e.compression.toUpperCase(),b=c[g];if(!b)throw new Error(g+" is not a valid compression method !");var v=m.options.compressionOptions||e.compressionOptions||{},y=C.call(this,m,b,v),_=A.call(this,d,m,y,a,e.platform,e.encodeFileName);a+=_.fileRecord.length+y.compressedSize,o+=_.dirRecord.length,s.push(_)}var x;x=r.CENTRAL_DIRECTORY_END+"\0\0\0\0"+w(s.length,2)+w(s.length,2)+w(o,4)+w(a,4)+w(u.length,2)+u;var k=e.type.toLowerCase();for(t="uint8array"===k||"arraybuffer"===k||"blob"===k||"nodebuffer"===k?new f(a+o+x.length):new p(a+o+x.length),i=0;i<s.length;i++)t.append(s[i].fileRecord),t.append(s[i].compressedObject.compressedContent);for(i=0;i<s.length;i++)t.append(s[i].dirRecord);t.append(x);var D=t.finalize();switch(e.type.toLowerCase()){case"uint8array":case"arraybuffer":case"nodebuffer":return n.transformTo(e.type.toLowerCase(),D);case"blob":return n.arrayBuffer2Blob(n.transformTo("arraybuffer",D),e.mimeType);case"base64":return e.base64?l.encode(D):D;default:return D}},crc32:function(e,t){return a(e,t)},utf8encode:function(e){return n.transformTo("string",h.utf8encode(e))},utf8decode:function(e){return h.utf8decode(e)}};t.exports=D},{"./base64":2,"./compressedObject":3,"./compressions":4,"./crc32":5,"./defaults":7,"./nodeBuffer":12,"./signature":15,"./stringWriter":17,"./support":18,"./uint8ArrayWriter":20,"./utf8":21,"./utils":22}],15:[function(e,t,i){"use strict";i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\b"},{}],16:[function(e,t,i){"use strict";function s(e,t){this.data=e,t||(this.data=a.string2binary(this.data)),this.length=this.data.length,this.index=0,this.zero=0}var n=e("./dataReader"),a=e("./utils");s.prototype=new n,s.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)},s.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero},s.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=s},{"./dataReader":6,"./utils":22}],17:[function(e,t,i){"use strict";var s=e("./utils"),n=function(){this.data=[]};n.prototype={append:function(e){e=s.transformTo("string",e),this.data.push(e)},finalize:function(){return this.data.join("")}},t.exports=n},{"./utils":22}],18:[function(e,t,i){(function(e){"use strict";if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,i.nodebuffer=void 0!==e,i.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)i.blob=!1;else{var t=new ArrayBuffer(0);try{i.blob=0===new Blob([t],{type:"application/zip"}).size}catch(e){try{var s=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);s.append(t),i.blob=0===s.getBlob("application/zip").size}catch(e){i.blob=!1}}}}).call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{}],19:[function(e,t,i){"use strict";function s(e){e&&(this.data=e,this.length=this.data.length,this.index=0,this.zero=0)}var n=e("./arrayReader");s.prototype=new n,s.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=s},{"./arrayReader":1}],20:[function(e,t,i){"use strict";var s=e("./utils"),n=function(e){this.data=new Uint8Array(e),this.index=0};n.prototype={append:function(e){0!==e.length&&(e=s.transformTo("uint8array",e),this.data.set(e,this.index),this.index+=e.length)},finalize:function(){return this.data}},t.exports=n},{"./utils":22}],21:[function(e,t,i){"use strict";for(var s=e("./utils"),n=e("./support"),a=e("./nodeBuffer"),r=new Array(256),o=0;o<256;o++)r[o]=o>=252?6:o>=248?5:o>=240?4:o>=224?3:o>=192?2:1;r[254]=r[254]=1;var l=function(e,t){var i;for((t=t||e.length)>e.length&&(t=e.length),i=t-1;i>=0&&128==(192&e[i]);)i--;return i<0||0===i?t:i+r[e[i]]>t?i:t},c=function(e){var t,i,n,a,o=e.length,l=new Array(2*o);for(i=0,t=0;t<o;)if((n=e[t++])<128)l[i++]=n;else if((a=r[n])>4)l[i++]=65533,t+=a-1;else{for(n&=2===a?31:3===a?15:7;a>1&&t<o;)n=n<<6|63&e[t++],a--;a>1?l[i++]=65533:n<65536?l[i++]=n:(n-=65536,l[i++]=55296|n>>10&1023,l[i++]=56320|1023&n)}return l.length!==i&&(l.subarray?l=l.subarray(0,i):l.length=i),s.applyFromCharCode(l)};i.utf8encode=function(e){return n.nodebuffer?a(e,"utf-8"):function(e){var t,i,s,a,r,o=e.length,l=0;for(a=0;a<o;a++)55296==(64512&(i=e.charCodeAt(a)))&&a+1<o&&56320==(64512&(s=e.charCodeAt(a+1)))&&(i=65536+(i-55296<<10)+(s-56320),a++),l+=i<128?1:i<2048?2:i<65536?3:4;for(t=n.uint8array?new Uint8Array(l):new Array(l),r=0,a=0;r<l;a++)55296==(64512&(i=e.charCodeAt(a)))&&a+1<o&&56320==(64512&(s=e.charCodeAt(a+1)))&&(i=65536+(i-55296<<10)+(s-56320),a++),i<128?t[r++]=i:i<2048?(t[r++]=192|i>>>6,t[r++]=128|63&i):i<65536?(t[r++]=224|i>>>12,t[r++]=128|i>>>6&63,t[r++]=128|63&i):(t[r++]=240|i>>>18,t[r++]=128|i>>>12&63,t[r++]=128|i>>>6&63,t[r++]=128|63&i);return t}(e)},i.utf8decode=function(e){if(n.nodebuffer)return s.transformTo("nodebuffer",e).toString("utf-8");for(var t=[],i=0,a=(e=s.transformTo(n.uint8array?"uint8array":"array",e)).length;i<a;){var r=l(e,Math.min(i+65536,a));n.uint8array?t.push(c(e.subarray(i,r))):t.push(c(e.slice(i,r))),i=r}return t.join("")}},{"./nodeBuffer":12,"./support":18,"./utils":22}],22:[function(e,t,i){"use strict";function s(e){return e}function n(e,t){for(var i=0;i<e.length;++i)t[i]=255&e.charCodeAt(i);return t}function a(e){var t=65536,s=[],n=e.length,a=i.getTypeOf(e),r=0,o=!0;try{switch(a){case"uint8array":String.fromCharCode.apply(null,new Uint8Array(0));break;case"nodebuffer":String.fromCharCode.apply(null,c(0))}}catch(e){o=!1}if(!o){for(var l="",u=0;u<e.length;u++)l+=String.fromCharCode(e[u]);return l}for(;r<n&&t>1;)try{"array"===a||"nodebuffer"===a?s.push(String.fromCharCode.apply(null,e.slice(r,Math.min(r+t,n)))):s.push(String.fromCharCode.apply(null,e.subarray(r,Math.min(r+t,n)))),r+=t}catch(e){t=Math.floor(t/2)}return s.join("")}function r(e,t){for(var i=0;i<e.length;i++)t[i]=e[i];return t}var o=e("./support"),l=e("./compressions"),c=e("./nodeBuffer");i.string2binary=function(e){for(var t="",i=0;i<e.length;i++)t+=String.fromCharCode(255&e.charCodeAt(i));return t},i.arrayBuffer2Blob=function(e,t){i.checkSupport("blob"),t=t||"application/zip";try{return new Blob([e],{type:t})}catch(i){try{var s=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);return s.append(e),s.getBlob(t)}catch(e){throw new Error("Bug : can't construct the Blob.")}}},i.applyFromCharCode=a;var u={};u.string={string:s,array:function(e){return n(e,new Array(e.length))},arraybuffer:function(e){return u.string.uint8array(e).buffer},uint8array:function(e){return n(e,new Uint8Array(e.length))},nodebuffer:function(e){return n(e,c(e.length))}},u.array={string:a,array:s,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return c(e)}},u.arraybuffer={string:function(e){return a(new Uint8Array(e))},array:function(e){return r(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:s,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return c(new Uint8Array(e))}},u.uint8array={string:a,array:function(e){return r(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:s,nodebuffer:function(e){return c(e)}},u.nodebuffer={string:a,array:function(e){return r(e,new Array(e.length))},arraybuffer:function(e){return u.nodebuffer.uint8array(e).buffer},uint8array:function(e){return r(e,new Uint8Array(e.length))},nodebuffer:s},i.transformTo=function(e,t){if(t||(t=""),!e)return t;i.checkSupport(e);var s=i.getTypeOf(t);return u[s][e](t)},i.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":o.nodebuffer&&c.test(e)?"nodebuffer":o.uint8array&&e instanceof Uint8Array?"uint8array":o.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(e){if(!o[e.toLowerCase()])throw new Error(e+" is not supported by this browser")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(e){var t,i,s="";for(i=0;i<(e||"").length;i++)s+="\\x"+((t=e.charCodeAt(i))<16?"0":"")+t.toString(16).toUpperCase();return s},i.findCompression=function(e){for(var t in l)if(l.hasOwnProperty(t)&&l[t].magic===e)return l[t];return null},i.isRegExp=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},i.extend=function(){var e,t,i={};for(e=0;e<arguments.length;e++)for(t in arguments[e])arguments[e].hasOwnProperty(t)&&void 0===i[t]&&(i[t]=arguments[e][t]);return i}},{"./compressions":4,"./nodeBuffer":12,"./support":18}],23:[function(e,t,i){"use strict";function s(e,t){this.files=[],this.loadOptions=t,e&&this.load(e)}var n=e("./stringReader"),a=e("./nodeBufferReader"),r=e("./uint8ArrayReader"),o=e("./arrayReader"),l=e("./utils"),c=e("./signature"),u=e("./zipEntry"),d=e("./support");e("./object"),s.prototype={checkSignature:function(e){var t=this.reader.readString(4);if(t!==e)throw new Error("Corrupted zip or bug : unexpected signature ("+l.pretty(t)+", expected "+l.pretty(e)+")")},isSignature:function(e,t){var i=this.reader.index;this.reader.setIndex(e);var s=this.reader.readString(4)===t;return this.reader.setIndex(i),s},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength),t=d.uint8array?"uint8array":"array",i=l.transformTo(t,e);this.zipComment=this.loadOptions.decodeFileName(i)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.versionMadeBy=this.reader.readString(2),this.versionNeeded=this.reader.readInt(2),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,i,s=this.zip64EndOfCentralSize-44;0<s;)e=this.reader.readInt(2),t=this.reader.readInt(4),i=this.reader.readString(t),this.zip64ExtensibleData[e]={id:e,length:t,value:i}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(c.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8(),t.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readString(4)===c.CENTRAL_FILE_HEADER;)(e=new u({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(c.CENTRAL_DIRECTORY_END);if(e<0)throw this.isSignature(0,c.LOCAL_FILE_HEADER)?new Error("Corrupted zip : can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see http://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(e);var t=e;if(this.checkSignature(c.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===l.MAX_VALUE_16BITS||this.diskWithCentralDirStart===l.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===l.MAX_VALUE_16BITS||this.centralDirRecords===l.MAX_VALUE_16BITS||this.centralDirSize===l.MAX_VALUE_32BITS||this.centralDirOffset===l.MAX_VALUE_32BITS){if(this.zip64=!0,(e=this.reader.lastIndexOfSignature(c.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip : can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(e),this.checkSignature(c.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,c.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(c.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip : can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(c.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var i=this.centralDirOffset+this.centralDirSize;this.zip64&&(i+=20,i+=12+this.zip64EndOfCentralSize);var s=t-i;if(s>0)this.isSignature(t,c.CENTRAL_FILE_HEADER)||(this.reader.zero=s);else if(s<0)throw new Error("Corrupted zip: missing "+Math.abs(s)+" bytes.")},prepareReader:function(e){var t=l.getTypeOf(e);if(l.checkSupport(t),"string"!==t||d.uint8array)if("nodebuffer"===t)this.reader=new a(e);else if(d.uint8array)this.reader=new r(l.transformTo("uint8array",e));else{if(!d.array)throw new Error("Unexpected error: unsupported type '"+t+"'");this.reader=new o(l.transformTo("array",e))}else this.reader=new n(e,this.loadOptions.optimizedBinaryString)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=s},{"./arrayReader":1,"./nodeBufferReader":13,"./object":14,"./signature":15,"./stringReader":16,"./support":18,"./uint8ArrayReader":19,"./utils":22,"./zipEntry":24}],24:[function(e,t,i){"use strict";function s(e,t){this.options=e,this.loadOptions=t}var n=e("./stringReader"),a=e("./utils"),r=e("./compressedObject"),o=e("./object"),l=e("./support");s.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},prepareCompressedContent:function(e,t,i){return function(){var s=e.index;e.setIndex(t);var n=e.readData(i);return e.setIndex(s),n}},prepareContent:function(e,t,i,s,n){return function(){var e=a.transformTo(s.uncompressInputType,this.getCompressedContent()),t=s.uncompress(e);if(t.length!==n)throw new Error("Bug : uncompressed data size mismatch");return t}},readLocalPart:function(e){var t,i;if(e.skip(22),this.fileNameLength=e.readInt(2),i=e.readInt(2),this.fileName=e.readData(this.fileNameLength),e.skip(i),-1==this.compressedSize||-1==this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize == -1 || uncompressedSize == -1)");if(null===(t=a.findCompression(this.compressionMethod)))throw new Error("Corrupted zip : compression "+a.pretty(this.compressionMethod)+" unknown (inner file : "+a.transformTo("string",this.fileName)+")");if(this.decompressed=new r,this.decompressed.compressedSize=this.compressedSize,this.decompressed.uncompressedSize=this.uncompressedSize,this.decompressed.crc32=this.crc32,this.decompressed.compressionMethod=this.compressionMethod,this.decompressed.getCompressedContent=this.prepareCompressedContent(e,e.index,this.compressedSize,t),this.decompressed.getContent=this.prepareContent(e,e.index,this.compressedSize,t,this.uncompressedSize),this.loadOptions.checkCRC32&&(this.decompressed=a.transformTo("string",this.decompressed.getContent()),o.crc32(this.decompressed)!==this.crc32))throw new Error("Corrupted zip : CRC32 mismatch")},readCentralPart:function(e){if(this.versionMadeBy=e.readInt(2),this.versionNeeded=e.readInt(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4),this.fileNameLength=e.readInt(2),this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");this.fileName=e.readData(this.fileNameLength),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0===e&&(this.dosPermissions=63&this.externalFileAttributes),3===e&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(e){if(this.extraFields[1]){var t=new n(this.extraFields[1].value);this.uncompressedSize===a.MAX_VALUE_32BITS&&(this.uncompressedSize=t.readInt(8)),this.compressedSize===a.MAX_VALUE_32BITS&&(this.compressedSize=t.readInt(8)),this.localHeaderOffset===a.MAX_VALUE_32BITS&&(this.localHeaderOffset=t.readInt(8)),this.diskNumberStart===a.MAX_VALUE_32BITS&&(this.diskNumberStart=t.readInt(4))}},readExtraFields:function(e){var t,i,s,n=e.index;for(this.extraFields=this.extraFields||{};e.index<n+this.extraFieldsLength;)t=e.readInt(2),i=e.readInt(2),s=e.readString(i),this.extraFields[t]={id:t,length:i,value:s}},handleUTF8:function(){var e=l.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=o.utf8decode(this.fileName),this.fileCommentStr=o.utf8decode(this.fileComment);else{var t=this.findExtraFieldUnicodePath();if(null!==t)this.fileNameStr=t;else{var i=a.transformTo(e,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(i)}var s=this.findExtraFieldUnicodeComment();if(null!==s)this.fileCommentStr=s;else{var n=a.transformTo(e,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(n)}}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=new n(e.value);return 1!==t.readInt(1)||o.crc32(this.fileName)!==t.readInt(4)?null:o.utf8decode(t.readString(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=new n(e.value);return 1!==t.readInt(1)||o.crc32(this.fileComment)!==t.readInt(4)?null:o.utf8decode(t.readString(e.length-5))}return null}},t.exports=s},{"./compressedObject":3,"./object":14,"./stringReader":16,"./support":18,"./utils":22}],25:[function(e,t,i){"use strict";var s={};(0,e("./lib/utils/common").assign)(s,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),t.exports=s},{"./lib/deflate":26,"./lib/inflate":27,"./lib/utils/common":28,"./lib/zlib/constants":31}],26:[function(e,t,i){"use strict";function s(e){if(!(this instanceof s))return new s(e);this.options=r.assign({level:h,method:f,chunkSize:16384,windowBits:15,memLevel:8,strategy:p,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var i=a.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(i!==d)throw new Error(l[i]);if(t.header&&a.deflateSetHeader(this.strm,t.header),t.dictionary){var n;if(n="string"==typeof t.dictionary?o.string2buf(t.dictionary):"[object ArrayBuffer]"===u.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(i=a.deflateSetDictionary(this.strm,n))!==d)throw new Error(l[i]);this._dict_set=!0}}function n(e,t){var i=new s(t);if(i.push(e,!0),i.err)throw i.msg;return i.result}var a=e("./zlib/deflate"),r=e("./utils/common"),o=e("./utils/strings"),l=e("./zlib/messages"),c=e("./zlib/zstream"),u=Object.prototype.toString,d=0,h=-1,p=0,f=8;s.prototype.push=function(e,t){var i,s,n=this.strm,l=this.options.chunkSize;if(this.ended)return!1;s=t===~~t?t:!0===t?4:0,"string"==typeof e?n.input=o.string2buf(e):"[object ArrayBuffer]"===u.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;do{if(0===n.avail_out&&(n.output=new r.Buf8(l),n.next_out=0,n.avail_out=l),1!==(i=a.deflate(n,s))&&i!==d)return this.onEnd(i),this.ended=!0,!1;0!==n.avail_out&&(0!==n.avail_in||4!==s&&2!==s)||("string"===this.options.to?this.onData(o.buf2binstring(r.shrinkBuf(n.output,n.next_out))):this.onData(r.shrinkBuf(n.output,n.next_out)))}while((n.avail_in>0||0===n.avail_out)&&1!==i);return 4===s?(i=a.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===d):2!==s||(this.onEnd(d),n.avail_out=0,!0)},s.prototype.onData=function(e){this.chunks.push(e)},s.prototype.onEnd=function(e){e===d&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},i.Deflate=s,i.deflate=n,i.deflateRaw=function(e,t){return(t=t||{}).raw=!0,n(e,t)},i.gzip=function(e,t){return(t=t||{}).gzip=!0,n(e,t)}},{"./utils/common":28,"./utils/strings":29,"./zlib/deflate":33,"./zlib/messages":38,"./zlib/zstream":40}],27:[function(e,t,i){"use strict";function s(e){if(!(this instanceof s))return new s(e);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var i=a.inflateInit2(this.strm,t.windowBits);if(i!==l.Z_OK)throw new Error(c[i]);this.header=new d,a.inflateGetHeader(this.strm,this.header)}function n(e,t){var i=new s(t);if(i.push(e,!0),i.err)throw i.msg;return i.result}var a=e("./zlib/inflate"),r=e("./utils/common"),o=e("./utils/strings"),l=e("./zlib/constants"),c=e("./zlib/messages"),u=e("./zlib/zstream"),d=e("./zlib/gzheader"),h=Object.prototype.toString;s.prototype.push=function(e,t){var i,s,n,c,u,d,p=this.strm,f=this.options.chunkSize,m=this.options.dictionary,g=!1;if(this.ended)return!1;s=t===~~t?t:!0===t?l.Z_FINISH:l.Z_NO_FLUSH,"string"==typeof e?p.input=o.binstring2buf(e):"[object ArrayBuffer]"===h.call(e)?p.input=new Uint8Array(e):p.input=e,p.next_in=0,p.avail_in=p.input.length;do{if(0===p.avail_out&&(p.output=new r.Buf8(f),p.next_out=0,p.avail_out=f),(i=a.inflate(p,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&m&&(d="string"==typeof m?o.string2buf(m):"[object ArrayBuffer]"===h.call(m)?new Uint8Array(m):m,i=a.inflateSetDictionary(this.strm,d)),i===l.Z_BUF_ERROR&&!0===g&&(i=l.Z_OK,g=!1),i!==l.Z_STREAM_END&&i!==l.Z_OK)return this.onEnd(i),this.ended=!0,!1;p.next_out&&(0!==p.avail_out&&i!==l.Z_STREAM_END&&(0!==p.avail_in||s!==l.Z_FINISH&&s!==l.Z_SYNC_FLUSH)||("string"===this.options.to?(n=o.utf8border(p.output,p.next_out),c=p.next_out-n,u=o.buf2string(p.output,n),p.next_out=c,p.avail_out=f-c,c&&r.arraySet(p.output,p.output,n,c,0),this.onData(u)):this.onData(r.shrinkBuf(p.output,p.next_out)))),0===p.avail_in&&0===p.avail_out&&(g=!0)}while((p.avail_in>0||0===p.avail_out)&&i!==l.Z_STREAM_END);return i===l.Z_STREAM_END&&(s=l.Z_FINISH),s===l.Z_FINISH?(i=a.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===l.Z_OK):s!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),p.avail_out=0,!0)},s.prototype.onData=function(e){this.chunks.push(e)},s.prototype.onEnd=function(e){e===l.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},i.Inflate=s,i.inflate=n,i.inflateRaw=function(e,t){return(t=t||{}).raw=!0,n(e,t)},i.ungzip=n},{"./utils/common":28,"./utils/strings":29,"./zlib/constants":31,"./zlib/gzheader":34,"./zlib/inflate":36,"./zlib/messages":38,"./zlib/zstream":40}],28:[function(e,t,i){"use strict";var s="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;i.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var i=t.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var s in i)i.hasOwnProperty(s)&&(e[s]=i[s])}}return e},i.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var n={arraySet:function(e,t,i,s,n){if(t.subarray&&e.subarray)e.set(t.subarray(i,i+s),n);else for(var a=0;a<s;a++)e[n+a]=t[i+a]},flattenChunks:function(e){var t,i,s,n,a,r;for(s=0,t=0,i=e.length;t<i;t++)s+=e[t].length;for(r=new Uint8Array(s),n=0,t=0,i=e.length;t<i;t++)a=e[t],r.set(a,n),n+=a.length;return r}},a={arraySet:function(e,t,i,s,n){for(var a=0;a<s;a++)e[n+a]=t[i+a]},flattenChunks:function(e){return[].concat.apply([],e)}};i.setTyped=function(e){e?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,n)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],29:[function(e,t,i){"use strict";function s(e,t){if(t<65537&&(e.subarray&&r||!e.subarray&&a))return String.fromCharCode.apply(null,n.shrinkBuf(e,t));for(var i="",s=0;s<t;s++)i+=String.fromCharCode(e[s]);return i}var n=e("./common"),a=!0,r=!0;try{String.fromCharCode.apply(null,[0])}catch(e){a=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){r=!1}for(var o=new n.Buf8(256),l=0;l<256;l++)o[l]=l>=252?6:l>=248?5:l>=240?4:l>=224?3:l>=192?2:1;o[254]=o[254]=1,i.string2buf=function(e){var t,i,s,a,r,o=e.length,l=0;for(a=0;a<o;a++)55296==(64512&(i=e.charCodeAt(a)))&&a+1<o&&56320==(64512&(s=e.charCodeAt(a+1)))&&(i=65536+(i-55296<<10)+(s-56320),a++),l+=i<128?1:i<2048?2:i<65536?3:4;for(t=new n.Buf8(l),r=0,a=0;r<l;a++)55296==(64512&(i=e.charCodeAt(a)))&&a+1<o&&56320==(64512&(s=e.charCodeAt(a+1)))&&(i=65536+(i-55296<<10)+(s-56320),a++),i<128?t[r++]=i:i<2048?(t[r++]=192|i>>>6,t[r++]=128|63&i):i<65536?(t[r++]=224|i>>>12,t[r++]=128|i>>>6&63,t[r++]=128|63&i):(t[r++]=240|i>>>18,t[r++]=128|i>>>12&63,t[r++]=128|i>>>6&63,t[r++]=128|63&i);return t},i.buf2binstring=function(e){return s(e,e.length)},i.binstring2buf=function(e){for(var t=new n.Buf8(e.length),i=0,s=t.length;i<s;i++)t[i]=e.charCodeAt(i);return t},i.buf2string=function(e,t){var i,n,a,r,l=t||e.length,c=new Array(2*l);for(n=0,i=0;i<l;)if((a=e[i++])<128)c[n++]=a;else if((r=o[a])>4)c[n++]=65533,i+=r-1;else{for(a&=2===r?31:3===r?15:7;r>1&&i<l;)a=a<<6|63&e[i++],r--;r>1?c[n++]=65533:a<65536?c[n++]=a:(a-=65536,c[n++]=55296|a>>10&1023,c[n++]=56320|1023&a)}return s(c,n)},i.utf8border=function(e,t){var i;for((t=t||e.length)>e.length&&(t=e.length),i=t-1;i>=0&&128==(192&e[i]);)i--;return i<0||0===i?t:i+o[e[i]]>t?i:t}},{"./common":28}],30:[function(e,t,i){"use strict";t.exports=function(e,t,i,s){for(var n=65535&e|0,a=e>>>16&65535|0,r=0;0!==i;){i-=r=i>2e3?2e3:i;do{a=a+(n=n+t[s++]|0)|0}while(--r);n%=65521,a%=65521}return n|a<<16|0}},{}],31:[function(e,t,i){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],32:[function(e,t,i){"use strict";var s=function(){for(var e,t=[],i=0;i<256;i++){e=i;for(var s=0;s<8;s++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t}();t.exports=function(e,t,i,n){var a=s,r=n+i;e^=-1;for(var o=n;o<r;o++)e=e>>>8^a[255&(e^t[o])];return-1^e}},{}],33:[function(e,t,i){"use strict";function s(e,t){return e.msg=I[t],t}function n(e){return(e<<1)-(e>4?9:0)}function a(e){for(var t=e.length;--t>=0;)e[t]=0}function r(e){var t=e.state,i=t.pending;i>e.avail_out&&(i=e.avail_out),0!==i&&(k.arraySet(e.output,t.pending_buf,t.pending_out,i,e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,0===t.pending&&(t.pending_out=0))}function o(e,t){C._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,r(e.strm)}function l(e,t){e.pending_buf[e.pending++]=t}function c(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function u(e,t,i,s){var n=e.avail_in;return n>s&&(n=s),0===n?0:(e.avail_in-=n,k.arraySet(t,e.input,e.next_in,n,i),1===e.state.wrap?e.adler=A(e.adler,t,n,i):2===e.state.wrap&&(e.adler=D(e.adler,t,n,i)),e.next_in+=n,e.total_in+=n,n)}function d(e,t){var i,s,n=e.max_chain_length,a=e.strstart,r=e.prev_length,o=e.nice_match,l=e.strstart>e.w_size-ie?e.strstart-(e.w_size-ie):0,c=e.window,u=e.w_mask,d=e.prev,h=e.strstart+te,p=c[a+r-1],f=c[a+r];e.prev_length>=e.good_match&&(n>>=2),o>e.lookahead&&(o=e.lookahead);do{if(c[(i=t)+r]===f&&c[i+r-1]===p&&c[i]===c[a]&&c[++i]===c[a+1]){a+=2,i++;do{}while(c[++a]===c[++i]&&c[++a]===c[++i]&&c[++a]===c[++i]&&c[++a]===c[++i]&&c[++a]===c[++i]&&c[++a]===c[++i]&&c[++a]===c[++i]&&c[++a]===c[++i]&&a<h);if(s=te-(h-a),a=h-te,s>r){if(e.match_start=t,r=s,s>=o)break;p=c[a+r-1],f=c[a+r]}}}while((t=d[t&u])>l&&0!=--n);return r<=e.lookahead?r:e.lookahead}function h(e){var t,i,s,n,a,r=e.w_size;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=r+(r-ie)){k.arraySet(e.window,e.window,r,r,0),e.match_start-=r,e.strstart-=r,e.block_start-=r,t=i=e.hash_size;do{s=e.head[--t],e.head[t]=s>=r?s-r:0}while(--i);t=i=r;do{s=e.prev[--t],e.prev[t]=s>=r?s-r:0}while(--i);n+=r}if(0===e.strm.avail_in)break;if(i=u(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=i,e.lookahead+e.insert>=ee)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+ee-1])&e.hash_mask,e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<ee)););}while(e.lookahead<ie&&0!==e.strm.avail_in)}function p(e,t){for(var i,s;;){if(e.lookahead<ie){if(h(e),e.lookahead<ie&&t===$)return de;if(0===e.lookahead)break}if(i=0,e.lookahead>=ee&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ee-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==i&&e.strstart-i<=e.w_size-ie&&(e.match_length=d(e,i)),e.match_length>=ee)if(s=C._tr_tally(e,e.strstart-e.match_start,e.match_length-ee),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=ee){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ee-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else s=C._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(s&&(o(e,!1),0===e.strm.avail_out))return de}return e.insert=e.strstart<ee-1?e.strstart:ee-1,t===S?(o(e,!0),0===e.strm.avail_out?pe:fe):e.last_lit&&(o(e,!1),0===e.strm.avail_out)?de:he}function f(e,t){for(var i,s,n;;){if(e.lookahead<ie){if(h(e),e.lookahead<ie&&t===$)return de;if(0===e.lookahead)break}if(i=0,e.lookahead>=ee&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ee-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=ee-1,0!==i&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-ie&&(e.match_length=d(e,i),e.match_length<=5&&(e.strategy===L||e.match_length===ee&&e.strstart-e.match_start>4096)&&(e.match_length=ee-1)),e.prev_length>=ee&&e.match_length<=e.prev_length){n=e.strstart+e.lookahead-ee,s=C._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-ee),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=n&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ee-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=ee-1,e.strstart++,s&&(o(e,!1),0===e.strm.avail_out))return de}else if(e.match_available){if((s=C._tr_tally(e,0,e.window[e.strstart-1]))&&o(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return de}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(s=C._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<ee-1?e.strstart:ee-1,t===S?(o(e,!0),0===e.strm.avail_out?pe:fe):e.last_lit&&(o(e,!1),0===e.strm.avail_out)?de:he}function m(e,t){for(var i,s,n,a,r=e.window;;){if(e.lookahead<=te){if(h(e),e.lookahead<=te&&t===$)return de;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=ee&&e.strstart>0&&(s=r[n=e.strstart-1])===r[++n]&&s===r[++n]&&s===r[++n]){a=e.strstart+te;do{}while(s===r[++n]&&s===r[++n]&&s===r[++n]&&s===r[++n]&&s===r[++n]&&s===r[++n]&&s===r[++n]&&s===r[++n]&&n<a);e.match_length=te-(a-n),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=ee?(i=C._tr_tally(e,1,e.match_length-ee),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(i=C._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),i&&(o(e,!1),0===e.strm.avail_out))return de}return e.insert=0,t===S?(o(e,!0),0===e.strm.avail_out?pe:fe):e.last_lit&&(o(e,!1),0===e.strm.avail_out)?de:he}function g(e,t){for(var i;;){if(0===e.lookahead&&(h(e),0===e.lookahead)){if(t===$)return de;break}if(e.match_length=0,i=C._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,i&&(o(e,!1),0===e.strm.avail_out))return de}return e.insert=0,t===S?(o(e,!0),0===e.strm.avail_out?pe:fe):e.last_lit&&(o(e,!1),0===e.strm.avail_out)?de:he}function b(e,t,i,s,n){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=s,this.func=n}function v(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=W,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new k.Buf16(2*Z),this.dyn_dtree=new k.Buf16(2*(2*Y+1)),this.bl_tree=new k.Buf16(2*(2*Q+1)),a(this.dyn_ltree),a(this.dyn_dtree),a(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new k.Buf16(X+1),this.heap=new k.Buf16(2*G+1),a(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new k.Buf16(2*G+1),a(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function w(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=z,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?ne:ce,e.adler=2===t.wrap?0:1,t.last_flush=$,C._tr_init(t),j):s(e,O)}function y(e){var t=w(e);return t===j&&function(e){e.window_size=2*e.w_size,a(e.head),e.max_lazy_match=x[e.level].max_lazy,e.good_match=x[e.level].good_length,e.nice_match=x[e.level].nice_length,e.max_chain_length=x[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=ee-1,e.match_available=0,e.ins_h=0}(e.state),t}function _(e,t,i,n,a,r){if(!e)return O;var o=1;if(t===P&&(t=6),n<0?(o=0,n=-n):n>15&&(o=2,n-=16),a<1||a>H||i!==W||n<8||n>15||t<0||t>9||r<0||r>q)return s(e,O);8===n&&(n=9);var l=new v;return e.state=l,l.strm=e,l.wrap=o,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=a+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+ee-1)/ee),l.window=new k.Buf8(2*l.w_size),l.head=new k.Buf16(l.hash_size),l.prev=new k.Buf16(l.w_size),l.lit_bufsize=1<<a+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new k.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=r,l.method=i,y(e)}var x,k=e("../utils/common"),C=e("./trees"),A=e("./adler32"),D=e("./crc32"),I=e("./messages"),$=0,E=1,F=3,S=4,N=5,j=0,B=1,O=-2,V=-3,T=-5,P=-1,L=1,R=2,M=3,q=4,U=0,z=2,W=8,H=9,K=15,J=8,G=286,Y=30,Q=19,Z=2*G+1,X=15,ee=3,te=258,ie=te+ee+1,se=32,ne=42,ae=69,re=73,oe=91,le=103,ce=113,ue=666,de=1,he=2,pe=3,fe=4,me=3;x=[new b(0,0,0,0,(function(e,t){var i=65535;for(i>e.pending_buf_size-5&&(i=e.pending_buf_size-5);;){if(e.lookahead<=1){if(h(e),0===e.lookahead&&t===$)return de;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var s=e.block_start+i;if((0===e.strstart||e.strstart>=s)&&(e.lookahead=e.strstart-s,e.strstart=s,o(e,!1),0===e.strm.avail_out))return de;if(e.strstart-e.block_start>=e.w_size-ie&&(o(e,!1),0===e.strm.avail_out))return de}return e.insert=0,t===S?(o(e,!0),0===e.strm.avail_out?pe:fe):(e.strstart>e.block_start&&(o(e,!1),e.strm.avail_out),de)})),new b(4,4,8,4,p),new b(4,5,16,8,p),new b(4,6,32,32,p),new b(4,4,16,16,f),new b(8,16,32,32,f),new b(8,16,128,128,f),new b(8,32,128,256,f),new b(32,128,258,1024,f),new b(32,258,258,4096,f)],i.deflateInit=function(e,t){return _(e,t,W,K,J,U)},i.deflateInit2=_,i.deflateReset=y,i.deflateResetKeep=w,i.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?O:(e.state.gzhead=t,j):O},i.deflate=function(e,t){var i,o,u,d;if(!e||!e.state||t>N||t<0)return e?s(e,O):O;if(o=e.state,!e.output||!e.input&&0!==e.avail_in||o.status===ue&&t!==S)return s(e,0===e.avail_out?T:O);if(o.strm=e,i=o.last_flush,o.last_flush=t,o.status===ne)if(2===o.wrap)e.adler=0,l(o,31),l(o,139),l(o,8),o.gzhead?(l(o,(o.gzhead.text?1:0)+(o.gzhead.hcrc?2:0)+(o.gzhead.extra?4:0)+(o.gzhead.name?8:0)+(o.gzhead.comment?16:0)),l(o,255&o.gzhead.time),l(o,o.gzhead.time>>8&255),l(o,o.gzhead.time>>16&255),l(o,o.gzhead.time>>24&255),l(o,9===o.level?2:o.strategy>=R||o.level<2?4:0),l(o,255&o.gzhead.os),o.gzhead.extra&&o.gzhead.extra.length&&(l(o,255&o.gzhead.extra.length),l(o,o.gzhead.extra.length>>8&255)),o.gzhead.hcrc&&(e.adler=D(e.adler,o.pending_buf,o.pending,0)),o.gzindex=0,o.status=ae):(l(o,0),l(o,0),l(o,0),l(o,0),l(o,0),l(o,9===o.level?2:o.strategy>=R||o.level<2?4:0),l(o,me),o.status=ce);else{var h=W+(o.w_bits-8<<4)<<8;h|=(o.strategy>=R||o.level<2?0:o.level<6?1:6===o.level?2:3)<<6,0!==o.strstart&&(h|=se),h+=31-h%31,o.status=ce,c(o,h),0!==o.strstart&&(c(o,e.adler>>>16),c(o,65535&e.adler)),e.adler=1}if(o.status===ae)if(o.gzhead.extra){for(u=o.pending;o.gzindex<(65535&o.gzhead.extra.length)&&(o.pending!==o.pending_buf_size||(o.gzhead.hcrc&&o.pending>u&&(e.adler=D(e.adler,o.pending_buf,o.pending-u,u)),r(e),u=o.pending,o.pending!==o.pending_buf_size));)l(o,255&o.gzhead.extra[o.gzindex]),o.gzindex++;o.gzhead.hcrc&&o.pending>u&&(e.adler=D(e.adler,o.pending_buf,o.pending-u,u)),o.gzindex===o.gzhead.extra.length&&(o.gzindex=0,o.status=re)}else o.status=re;if(o.status===re)if(o.gzhead.name){u=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>u&&(e.adler=D(e.adler,o.pending_buf,o.pending-u,u)),r(e),u=o.pending,o.pending===o.pending_buf_size)){d=1;break}d=o.gzindex<o.gzhead.name.length?255&o.gzhead.name.charCodeAt(o.gzindex++):0,l(o,d)}while(0!==d);o.gzhead.hcrc&&o.pending>u&&(e.adler=D(e.adler,o.pending_buf,o.pending-u,u)),0===d&&(o.gzindex=0,o.status=oe)}else o.status=oe;if(o.status===oe)if(o.gzhead.comment){u=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>u&&(e.adler=D(e.adler,o.pending_buf,o.pending-u,u)),r(e),u=o.pending,o.pending===o.pending_buf_size)){d=1;break}d=o.gzindex<o.gzhead.comment.length?255&o.gzhead.comment.charCodeAt(o.gzindex++):0,l(o,d)}while(0!==d);o.gzhead.hcrc&&o.pending>u&&(e.adler=D(e.adler,o.pending_buf,o.pending-u,u)),0===d&&(o.status=le)}else o.status=le;if(o.status===le&&(o.gzhead.hcrc?(o.pending+2>o.pending_buf_size&&r(e),o.pending+2<=o.pending_buf_size&&(l(o,255&e.adler),l(o,e.adler>>8&255),e.adler=0,o.status=ce)):o.status=ce),0!==o.pending){if(r(e),0===e.avail_out)return o.last_flush=-1,j}else if(0===e.avail_in&&n(t)<=n(i)&&t!==S)return s(e,T);if(o.status===ue&&0!==e.avail_in)return s(e,T);if(0!==e.avail_in||0!==o.lookahead||t!==$&&o.status!==ue){var p=o.strategy===R?g(o,t):o.strategy===M?m(o,t):x[o.level].func(o,t);if(p!==pe&&p!==fe||(o.status=ue),p===de||p===pe)return 0===e.avail_out&&(o.last_flush=-1),j;if(p===he&&(t===E?C._tr_align(o):t!==N&&(C._tr_stored_block(o,0,0,!1),t===F&&(a(o.head),0===o.lookahead&&(o.strstart=0,o.block_start=0,o.insert=0))),r(e),0===e.avail_out))return o.last_flush=-1,j}return t!==S?j:o.wrap<=0?B:(2===o.wrap?(l(o,255&e.adler),l(o,e.adler>>8&255),l(o,e.adler>>16&255),l(o,e.adler>>24&255),l(o,255&e.total_in),l(o,e.total_in>>8&255),l(o,e.total_in>>16&255),l(o,e.total_in>>24&255)):(c(o,e.adler>>>16),c(o,65535&e.adler)),r(e),o.wrap>0&&(o.wrap=-o.wrap),0!==o.pending?j:B)},i.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==ne&&t!==ae&&t!==re&&t!==oe&&t!==le&&t!==ce&&t!==ue?s(e,O):(e.state=null,t===ce?s(e,V):j):O},i.deflateSetDictionary=function(e,t){var i,s,n,r,o,l,c,u,d=t.length;if(!e||!e.state)return O;if(2===(r=(i=e.state).wrap)||1===r&&i.status!==ne||i.lookahead)return O;for(1===r&&(e.adler=A(e.adler,t,d,0)),i.wrap=0,d>=i.w_size&&(0===r&&(a(i.head),i.strstart=0,i.block_start=0,i.insert=0),u=new k.Buf8(i.w_size),k.arraySet(u,t,d-i.w_size,i.w_size,0),t=u,d=i.w_size),o=e.avail_in,l=e.next_in,c=e.input,e.avail_in=d,e.next_in=0,e.input=t,h(i);i.lookahead>=ee;){s=i.strstart,n=i.lookahead-(ee-1);do{i.ins_h=(i.ins_h<<i.hash_shift^i.window[s+ee-1])&i.hash_mask,i.prev[s&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=s,s++}while(--n);i.strstart=s,i.lookahead=ee-1,h(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=ee-1,i.match_available=0,e.next_in=l,e.input=c,e.avail_in=o,i.wrap=r,j},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":28,"./adler32":30,"./crc32":32,"./messages":38,"./trees":39}],34:[function(e,t,i){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],35:[function(e,t,i){"use strict";t.exports=function(e,t){var i,s,n,a,r,o,l,c,u,d,h,p,f,m,g,b,v,w,y,_,x,k,C,A,D;i=e.state,s=e.next_in,A=e.input,n=s+(e.avail_in-5),a=e.next_out,D=e.output,r=a-(t-e.avail_out),o=a+(e.avail_out-257),l=i.dmax,c=i.wsize,u=i.whave,d=i.wnext,h=i.window,p=i.hold,f=i.bits,m=i.lencode,g=i.distcode,b=(1<<i.lenbits)-1,v=(1<<i.distbits)-1;e:do{f<15&&(p+=A[s++]<<f,f+=8,p+=A[s++]<<f,f+=8),w=m[p&b];t:for(;;){if(p>>>=y=w>>>24,f-=y,0==(y=w>>>16&255))D[a++]=65535&w;else{if(!(16&y)){if(0==(64&y)){w=m[(65535&w)+(p&(1<<y)-1)];continue t}if(32&y){i.mode=12;break e}e.msg="invalid literal/length code",i.mode=30;break e}_=65535&w,(y&=15)&&(f<y&&(p+=A[s++]<<f,f+=8),_+=p&(1<<y)-1,p>>>=y,f-=y),f<15&&(p+=A[s++]<<f,f+=8,p+=A[s++]<<f,f+=8),w=g[p&v];i:for(;;){if(p>>>=y=w>>>24,f-=y,!(16&(y=w>>>16&255))){if(0==(64&y)){w=g[(65535&w)+(p&(1<<y)-1)];continue i}e.msg="invalid distance code",i.mode=30;break e}if(x=65535&w,f<(y&=15)&&(p+=A[s++]<<f,(f+=8)<y&&(p+=A[s++]<<f,f+=8)),(x+=p&(1<<y)-1)>l){e.msg="invalid distance too far back",i.mode=30;break e}if(p>>>=y,f-=y,x>(y=a-r)){if((y=x-y)>u&&i.sane){e.msg="invalid distance too far back",i.mode=30;break e}if(k=0,C=h,0===d){if(k+=c-y,y<_){_-=y;do{D[a++]=h[k++]}while(--y);k=a-x,C=D}}else if(d<y){if(k+=c+d-y,(y-=d)<_){_-=y;do{D[a++]=h[k++]}while(--y);if(k=0,d<_){_-=y=d;do{D[a++]=h[k++]}while(--y);k=a-x,C=D}}}else if(k+=d-y,y<_){_-=y;do{D[a++]=h[k++]}while(--y);k=a-x,C=D}for(;_>2;)D[a++]=C[k++],D[a++]=C[k++],D[a++]=C[k++],_-=3;_&&(D[a++]=C[k++],_>1&&(D[a++]=C[k++]))}else{k=a-x;do{D[a++]=D[k++],D[a++]=D[k++],D[a++]=D[k++],_-=3}while(_>2);_&&(D[a++]=D[k++],_>1&&(D[a++]=D[k++]))}break}}break}}while(s<n&&a<o);s-=_=f>>3,p&=(1<<(f-=_<<3))-1,e.next_in=s,e.next_out=a,e.avail_in=s<n?n-s+5:5-(s-n),e.avail_out=a<o?o-a+257:257-(a-o),i.hold=p,i.bits=f}},{}],36:[function(e,t,i){"use strict";function s(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function n(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new p.Buf16(320),this.work=new p.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function a(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=N,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new p.Buf32(ce),t.distcode=t.distdyn=new p.Buf32(ue),t.sane=1,t.back=-1,C):I}function r(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,a(e)):I}function o(e,t){var i,s;return e&&e.state?(s=e.state,t<0?(i=0,t=-t):(i=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?I:(null!==s.window&&s.wbits!==t&&(s.window=null),s.wrap=i,s.wbits=t,r(e))):I}function l(e,t){var i,s;return e?(s=new n,e.state=s,s.window=null,(i=o(e,t))!==C&&(e.state=null),i):I}function c(e){if(he){var t;for(d=new p.Buf32(512),h=new p.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(b(w,e.lens,0,288,d,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;b(y,e.lens,0,32,h,0,e.work,{bits:5}),he=!1}e.lencode=d,e.lenbits=9,e.distcode=h,e.distbits=5}function u(e,t,i,s){var n,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new p.Buf8(a.wsize)),s>=a.wsize?(p.arraySet(a.window,t,i-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((n=a.wsize-a.wnext)>s&&(n=s),p.arraySet(a.window,t,i-s,n,a.wnext),(s-=n)?(p.arraySet(a.window,t,i-s,s,0),a.wnext=s,a.whave=a.wsize):(a.wnext+=n,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=n))),0}var d,h,p=e("../utils/common"),f=e("./adler32"),m=e("./crc32"),g=e("./inffast"),b=e("./inftrees"),v=0,w=1,y=2,_=4,x=5,k=6,C=0,A=1,D=2,I=-2,$=-3,E=-4,F=-5,S=8,N=1,j=2,B=3,O=4,V=5,T=6,P=7,L=8,R=9,M=10,q=11,U=12,z=13,W=14,H=15,K=16,J=17,G=18,Y=19,Q=20,Z=21,X=22,ee=23,te=24,ie=25,se=26,ne=27,ae=28,re=29,oe=30,le=31,ce=852,ue=592,de=15,he=!0;i.inflateReset=r,i.inflateReset2=o,i.inflateResetKeep=a,i.inflateInit=function(e){return l(e,de)},i.inflateInit2=l,i.inflate=function(e,t){var i,n,a,r,o,l,d,h,ce,ue,de,he,pe,fe,me,ge,be,ve,we,ye,_e,xe,ke,Ce,Ae=0,De=new p.Buf8(4),Ie=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return I;(i=e.state).mode===U&&(i.mode=z),o=e.next_out,a=e.output,d=e.avail_out,r=e.next_in,n=e.input,l=e.avail_in,h=i.hold,ce=i.bits,ue=l,de=d,xe=C;e:for(;;)switch(i.mode){case N:if(0===i.wrap){i.mode=z;break}for(;ce<16;){if(0===l)break e;l--,h+=n[r++]<<ce,ce+=8}if(2&i.wrap&&35615===h){i.check=0,De[0]=255&h,De[1]=h>>>8&255,i.check=m(i.check,De,2,0),h=0,ce=0,i.mode=j;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&h)<<8)+(h>>8))%31){e.msg="incorrect header check",i.mode=oe;break}if((15&h)!==S){e.msg="unknown compression method",i.mode=oe;break}if(ce-=4,_e=8+(15&(h>>>=4)),0===i.wbits)i.wbits=_e;else if(_e>i.wbits){e.msg="invalid window size",i.mode=oe;break}i.dmax=1<<_e,e.adler=i.check=1,i.mode=512&h?M:U,h=0,ce=0;break;case j:for(;ce<16;){if(0===l)break e;l--,h+=n[r++]<<ce,ce+=8}if(i.flags=h,(255&i.flags)!==S){e.msg="unknown compression method",i.mode=oe;break}if(57344&i.flags){e.msg="unknown header flags set",i.mode=oe;break}i.head&&(i.head.text=h>>8&1),512&i.flags&&(De[0]=255&h,De[1]=h>>>8&255,i.check=m(i.check,De,2,0)),h=0,ce=0,i.mode=B;case B:for(;ce<32;){if(0===l)break e;l--,h+=n[r++]<<ce,ce+=8}i.head&&(i.head.time=h),512&i.flags&&(De[0]=255&h,De[1]=h>>>8&255,De[2]=h>>>16&255,De[3]=h>>>24&255,i.check=m(i.check,De,4,0)),h=0,ce=0,i.mode=O;case O:for(;ce<16;){if(0===l)break e;l--,h+=n[r++]<<ce,ce+=8}i.head&&(i.head.xflags=255&h,i.head.os=h>>8),512&i.flags&&(De[0]=255&h,De[1]=h>>>8&255,i.check=m(i.check,De,2,0)),h=0,ce=0,i.mode=V;case V:if(1024&i.flags){for(;ce<16;){if(0===l)break e;l--,h+=n[r++]<<ce,ce+=8}i.length=h,i.head&&(i.head.extra_len=h),512&i.flags&&(De[0]=255&h,De[1]=h>>>8&255,i.check=m(i.check,De,2,0)),h=0,ce=0}else i.head&&(i.head.extra=null);i.mode=T;case T:if(1024&i.flags&&((he=i.length)>l&&(he=l),he&&(i.head&&(_e=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),p.arraySet(i.head.extra,n,r,he,_e)),512&i.flags&&(i.check=m(i.check,n,he,r)),l-=he,r+=he,i.length-=he),i.length))break e;i.length=0,i.mode=P;case P:if(2048&i.flags){if(0===l)break e;he=0;do{_e=n[r+he++],i.head&&_e&&i.length<65536&&(i.head.name+=String.fromCharCode(_e))}while(_e&&he<l);if(512&i.flags&&(i.check=m(i.check,n,he,r)),l-=he,r+=he,_e)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=L;case L:if(4096&i.flags){if(0===l)break e;he=0;do{_e=n[r+he++],i.head&&_e&&i.length<65536&&(i.head.comment+=String.fromCharCode(_e))}while(_e&&he<l);if(512&i.flags&&(i.check=m(i.check,n,he,r)),l-=he,r+=he,_e)break e}else i.head&&(i.head.comment=null);i.mode=R;case R:if(512&i.flags){for(;ce<16;){if(0===l)break e;l--,h+=n[r++]<<ce,ce+=8}if(h!==(65535&i.check)){e.msg="header crc mismatch",i.mode=oe;break}h=0,ce=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=U;break;case M:for(;ce<32;){if(0===l)break e;l--,h+=n[r++]<<ce,ce+=8}e.adler=i.check=s(h),h=0,ce=0,i.mode=q;case q:if(0===i.havedict)return e.next_out=o,e.avail_out=d,e.next_in=r,e.avail_in=l,i.hold=h,i.bits=ce,D;e.adler=i.check=1,i.mode=U;case U:if(t===x||t===k)break e;case z:if(i.last){h>>>=7&ce,ce-=7&ce,i.mode=ne;break}for(;ce<3;){if(0===l)break e;l--,h+=n[r++]<<ce,ce+=8}switch(i.last=1&h,ce-=1,3&(h>>>=1)){case 0:i.mode=W;break;case 1:if(c(i),i.mode=Q,t===k){h>>>=2,ce-=2;break e}break;case 2:i.mode=J;break;case 3:e.msg="invalid block type",i.mode=oe}h>>>=2,ce-=2;break;case W:for(h>>>=7&ce,ce-=7&ce;ce<32;){if(0===l)break e;l--,h+=n[r++]<<ce,ce+=8}if((65535&h)!=(h>>>16^65535)){e.msg="invalid stored block lengths",i.mode=oe;break}if(i.length=65535&h,h=0,ce=0,i.mode=H,t===k)break e;case H:i.mode=K;case K:if(he=i.length){if(he>l&&(he=l),he>d&&(he=d),0===he)break e;p.arraySet(a,n,r,he,o),l-=he,r+=he,d-=he,o+=he,i.length-=he;break}i.mode=U;break;case J:for(;ce<14;){if(0===l)break e;l--,h+=n[r++]<<ce,ce+=8}if(i.nlen=257+(31&h),h>>>=5,ce-=5,i.ndist=1+(31&h),h>>>=5,ce-=5,i.ncode=4+(15&h),h>>>=4,ce-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=oe;break}i.have=0,i.mode=G;case G:for(;i.have<i.ncode;){for(;ce<3;){if(0===l)break e;l--,h+=n[r++]<<ce,ce+=8}i.lens[Ie[i.have++]]=7&h,h>>>=3,ce-=3}for(;i.have<19;)i.lens[Ie[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,ke={bits:i.lenbits},xe=b(v,i.lens,0,19,i.lencode,0,i.work,ke),i.lenbits=ke.bits,xe){e.msg="invalid code lengths set",i.mode=oe;break}i.have=0,i.mode=Y;case Y:for(;i.have<i.nlen+i.ndist;){for(;ge=(Ae=i.lencode[h&(1<<i.lenbits)-1])>>>16&255,be=65535&Ae,!((me=Ae>>>24)<=ce);){if(0===l)break e;l--,h+=n[r++]<<ce,ce+=8}if(be<16)h>>>=me,ce-=me,i.lens[i.have++]=be;else{if(16===be){for(Ce=me+2;ce<Ce;){if(0===l)break e;l--,h+=n[r++]<<ce,ce+=8}if(h>>>=me,ce-=me,0===i.have){e.msg="invalid bit length repeat",i.mode=oe;break}_e=i.lens[i.have-1],he=3+(3&h),h>>>=2,ce-=2}else if(17===be){for(Ce=me+3;ce<Ce;){if(0===l)break e;l--,h+=n[r++]<<ce,ce+=8}ce-=me,_e=0,he=3+(7&(h>>>=me)),h>>>=3,ce-=3}else{for(Ce=me+7;ce<Ce;){if(0===l)break e;l--,h+=n[r++]<<ce,ce+=8}ce-=me,_e=0,he=11+(127&(h>>>=me)),h>>>=7,ce-=7}if(i.have+he>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=oe;break}for(;he--;)i.lens[i.have++]=_e}}if(i.mode===oe)break;if(0===i.lens[256]){e.msg="invalid code -- missing end-of-block",i.mode=oe;break}if(i.lenbits=9,ke={bits:i.lenbits},xe=b(w,i.lens,0,i.nlen,i.lencode,0,i.work,ke),i.lenbits=ke.bits,xe){e.msg="invalid literal/lengths set",i.mode=oe;break}if(i.distbits=6,i.distcode=i.distdyn,ke={bits:i.distbits},xe=b(y,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,ke),i.distbits=ke.bits,xe){e.msg="invalid distances set",i.mode=oe;break}if(i.mode=Q,t===k)break e;case Q:i.mode=Z;case Z:if(l>=6&&d>=258){e.next_out=o,e.avail_out=d,e.next_in=r,e.avail_in=l,i.hold=h,i.bits=ce,g(e,de),o=e.next_out,a=e.output,d=e.avail_out,r=e.next_in,n=e.input,l=e.avail_in,h=i.hold,ce=i.bits,i.mode===U&&(i.back=-1);break}for(i.back=0;ge=(Ae=i.lencode[h&(1<<i.lenbits)-1])>>>16&255,be=65535&Ae,!((me=Ae>>>24)<=ce);){if(0===l)break e;l--,h+=n[r++]<<ce,ce+=8}if(ge&&0==(240&ge)){for(ve=me,we=ge,ye=be;ge=(Ae=i.lencode[ye+((h&(1<<ve+we)-1)>>ve)])>>>16&255,be=65535&Ae,!(ve+(me=Ae>>>24)<=ce);){if(0===l)break e;l--,h+=n[r++]<<ce,ce+=8}h>>>=ve,ce-=ve,i.back+=ve}if(h>>>=me,ce-=me,i.back+=me,i.length=be,0===ge){i.mode=se;break}if(32&ge){i.back=-1,i.mode=U;break}if(64&ge){e.msg="invalid literal/length code",i.mode=oe;break}i.extra=15&ge,i.mode=X;case X:if(i.extra){for(Ce=i.extra;ce<Ce;){if(0===l)break e;l--,h+=n[r++]<<ce,ce+=8}i.length+=h&(1<<i.extra)-1,h>>>=i.extra,ce-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=ee;case ee:for(;ge=(Ae=i.distcode[h&(1<<i.distbits)-1])>>>16&255,be=65535&Ae,!((me=Ae>>>24)<=ce);){if(0===l)break e;l--,h+=n[r++]<<ce,ce+=8}if(0==(240&ge)){for(ve=me,we=ge,ye=be;ge=(Ae=i.distcode[ye+((h&(1<<ve+we)-1)>>ve)])>>>16&255,be=65535&Ae,!(ve+(me=Ae>>>24)<=ce);){if(0===l)break e;l--,h+=n[r++]<<ce,ce+=8}h>>>=ve,ce-=ve,i.back+=ve}if(h>>>=me,ce-=me,i.back+=me,64&ge){e.msg="invalid distance code",i.mode=oe;break}i.offset=be,i.extra=15&ge,i.mode=te;case te:if(i.extra){for(Ce=i.extra;ce<Ce;){if(0===l)break e;l--,h+=n[r++]<<ce,ce+=8}i.offset+=h&(1<<i.extra)-1,h>>>=i.extra,ce-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=oe;break}i.mode=ie;case ie:if(0===d)break e;if(he=de-d,i.offset>he){if((he=i.offset-he)>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=oe;break}he>i.wnext?(he-=i.wnext,pe=i.wsize-he):pe=i.wnext-he,he>i.length&&(he=i.length),fe=i.window}else fe=a,pe=o-i.offset,he=i.length;he>d&&(he=d),d-=he,i.length-=he;do{a[o++]=fe[pe++]}while(--he);0===i.length&&(i.mode=Z);break;case se:if(0===d)break e;a[o++]=i.length,d--,i.mode=Z;break;case ne:if(i.wrap){for(;ce<32;){if(0===l)break e;l--,h|=n[r++]<<ce,ce+=8}if(de-=d,e.total_out+=de,i.total+=de,de&&(e.adler=i.check=i.flags?m(i.check,a,de,o-de):f(i.check,a,de,o-de)),de=d,(i.flags?h:s(h))!==i.check){e.msg="incorrect data check",i.mode=oe;break}h=0,ce=0}i.mode=ae;case ae:if(i.wrap&&i.flags){for(;ce<32;){if(0===l)break e;l--,h+=n[r++]<<ce,ce+=8}if(h!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=oe;break}h=0,ce=0}i.mode=re;case re:xe=A;break e;case oe:xe=$;break e;case le:return E;default:return I}return e.next_out=o,e.avail_out=d,e.next_in=r,e.avail_in=l,i.hold=h,i.bits=ce,(i.wsize||de!==e.avail_out&&i.mode<oe&&(i.mode<ne||t!==_))&&u(e,e.output,e.next_out,de-e.avail_out)?(i.mode=le,E):(ue-=e.avail_in,de-=e.avail_out,e.total_in+=ue,e.total_out+=de,i.total+=de,i.wrap&&de&&(e.adler=i.check=i.flags?m(i.check,a,de,e.next_out-de):f(i.check,a,de,e.next_out-de)),e.data_type=i.bits+(i.last?64:0)+(i.mode===U?128:0)+(i.mode===Q||i.mode===H?256:0),(0===ue&&0===de||t===_)&&xe===C&&(xe=F),xe)},i.inflateEnd=function(e){if(!e||!e.state)return I;var t=e.state;return t.window&&(t.window=null),e.state=null,C},i.inflateGetHeader=function(e,t){var i;return e&&e.state?0==(2&(i=e.state).wrap)?I:(i.head=t,t.done=!1,C):I},i.inflateSetDictionary=function(e,t){var i,s=t.length;return e&&e.state?0!==(i=e.state).wrap&&i.mode!==q?I:i.mode===q&&f(1,t,s,0)!==i.check?$:u(e,t,s,s)?(i.mode=le,E):(i.havedict=1,C):I},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":28,"./adler32":30,"./crc32":32,"./inffast":35,"./inftrees":37}],37:[function(e,t,i){"use strict";var s=e("../utils/common"),n=15,a=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],r=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,i,c,u,d,h,p){var f,m,g,b,v,w,y,_,x,k=p.bits,C=0,A=0,D=0,I=0,$=0,E=0,F=0,S=0,N=0,j=0,B=null,O=0,V=new s.Buf16(16),T=new s.Buf16(16),P=null,L=0;for(C=0;C<=n;C++)V[C]=0;for(A=0;A<c;A++)V[t[i+A]]++;for($=k,I=n;I>=1&&0===V[I];I--);if($>I&&($=I),0===I)return u[d++]=20971520,u[d++]=20971520,p.bits=1,0;for(D=1;D<I&&0===V[D];D++);for($<D&&($=D),S=1,C=1;C<=n;C++)if(S<<=1,(S-=V[C])<0)return-1;if(S>0&&(0===e||1!==I))return-1;for(T[1]=0,C=1;C<n;C++)T[C+1]=T[C]+V[C];for(A=0;A<c;A++)0!==t[i+A]&&(h[T[t[i+A]]++]=A);if(0===e?(B=P=h,w=19):1===e?(B=a,O-=257,P=r,L-=257,w=256):(B=o,P=l,w=-1),j=0,A=0,C=D,v=d,E=$,F=0,g=-1,b=(N=1<<$)-1,1===e&&N>852||2===e&&N>592)return 1;for(;;){y=C-F,h[A]<w?(_=0,x=h[A]):h[A]>w?(_=P[L+h[A]],x=B[O+h[A]]):(_=96,x=0),f=1<<C-F,D=m=1<<E;do{u[v+(j>>F)+(m-=f)]=y<<24|_<<16|x|0}while(0!==m);for(f=1<<C-1;j&f;)f>>=1;if(0!==f?(j&=f-1,j+=f):j=0,A++,0==--V[C]){if(C===I)break;C=t[i+h[A]]}if(C>$&&(j&b)!==g){for(0===F&&(F=$),v+=D,S=1<<(E=C-F);E+F<I&&!((S-=V[E+F])<=0);)E++,S<<=1;if(N+=1<<E,1===e&&N>852||2===e&&N>592)return 1;u[g=j&b]=$<<24|E<<16|v-d|0}}return 0!==j&&(u[v+j]=C-F<<24|64<<16|0),p.bits=$,0}},{"../utils/common":28}],38:[function(e,t,i){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],39:[function(e,t,i){"use strict";function s(e){for(var t=e.length;--t>=0;)e[t]=0}function n(e,t,i,s,n){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=s,this.max_length=n,this.has_stree=e&&e.length}function a(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function r(e){return e<256?J[e]:J[256+(e>>>7)]}function o(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function l(e,t,i){e.bi_valid>V-i?(e.bi_buf|=t<<e.bi_valid&65535,o(e,e.bi_buf),e.bi_buf=t>>V-e.bi_valid,e.bi_valid+=i-V):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)}function c(e,t,i){l(e,i[2*t],i[2*t+1])}function u(e,t){var i=0;do{i|=1&e,e>>>=1,i<<=1}while(--t>0);return i>>>1}function d(e,t,i){var s,n,a=new Array(O+1),r=0;for(s=1;s<=O;s++)a[s]=r=r+i[s-1]<<1;for(n=0;n<=t;n++){var o=e[2*n+1];0!==o&&(e[2*n]=u(a[o]++,o))}}function h(e){var t;for(t=0;t<S;t++)e.dyn_ltree[2*t]=0;for(t=0;t<N;t++)e.dyn_dtree[2*t]=0;for(t=0;t<j;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*P]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function p(e){e.bi_valid>8?o(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function f(e,t,i,s){var n=2*t,a=2*i;return e[n]<e[a]||e[n]===e[a]&&s[t]<=s[i]}function m(e,t,i){for(var s=e.heap[i],n=i<<1;n<=e.heap_len&&(n<e.heap_len&&f(t,e.heap[n+1],e.heap[n],e.depth)&&n++,!f(t,s,e.heap[n],e.depth));)e.heap[i]=e.heap[n],i=n,n<<=1;e.heap[i]=s}function g(e,t,i){var s,n,a,o,u=0;if(0!==e.last_lit)do{s=e.pending_buf[e.d_buf+2*u]<<8|e.pending_buf[e.d_buf+2*u+1],n=e.pending_buf[e.l_buf+u],u++,0===s?c(e,n,t):(c(e,(a=G[n])+F+1,t),0!==(o=q[a])&&l(e,n-=Y[a],o),c(e,a=r(--s),i),0!==(o=U[a])&&l(e,s-=Q[a],o))}while(u<e.last_lit);c(e,P,t)}function b(e,t){var i,s,n,a=t.dyn_tree,r=t.stat_desc.static_tree,o=t.stat_desc.has_stree,l=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=B,i=0;i<l;i++)0!==a[2*i]?(e.heap[++e.heap_len]=c=i,e.depth[i]=0):a[2*i+1]=0;for(;e.heap_len<2;)a[2*(n=e.heap[++e.heap_len]=c<2?++c:0)]=1,e.depth[n]=0,e.opt_len--,o&&(e.static_len-=r[2*n+1]);for(t.max_code=c,i=e.heap_len>>1;i>=1;i--)m(e,a,i);n=l;do{i=e.heap[1],e.heap[1]=e.heap[e.heap_len--],m(e,a,1),s=e.heap[1],e.heap[--e.heap_max]=i,e.heap[--e.heap_max]=s,a[2*n]=a[2*i]+a[2*s],e.depth[n]=(e.depth[i]>=e.depth[s]?e.depth[i]:e.depth[s])+1,a[2*i+1]=a[2*s+1]=n,e.heap[1]=n++,m(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var i,s,n,a,r,o,l=t.dyn_tree,c=t.max_code,u=t.stat_desc.static_tree,d=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,p=t.stat_desc.extra_base,f=t.stat_desc.max_length,m=0;for(a=0;a<=O;a++)e.bl_count[a]=0;for(l[2*e.heap[e.heap_max]+1]=0,i=e.heap_max+1;i<B;i++)(a=l[2*l[2*(s=e.heap[i])+1]+1]+1)>f&&(a=f,m++),l[2*s+1]=a,s>c||(e.bl_count[a]++,r=0,s>=p&&(r=h[s-p]),o=l[2*s],e.opt_len+=o*(a+r),d&&(e.static_len+=o*(u[2*s+1]+r)));if(0!==m){do{for(a=f-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[f]--,m-=2}while(m>0);for(a=f;0!==a;a--)for(s=e.bl_count[a];0!==s;)(n=e.heap[--i])>c||(l[2*n+1]!==a&&(e.opt_len+=(a-l[2*n+1])*l[2*n],l[2*n+1]=a),s--)}}(e,t),d(a,c,e.bl_count)}function v(e,t,i){var s,n,a=-1,r=t[1],o=0,l=7,c=4;for(0===r&&(l=138,c=3),t[2*(i+1)+1]=65535,s=0;s<=i;s++)n=r,r=t[2*(s+1)+1],++o<l&&n===r||(o<c?e.bl_tree[2*n]+=o:0!==n?(n!==a&&e.bl_tree[2*n]++,e.bl_tree[2*L]++):o<=10?e.bl_tree[2*R]++:e.bl_tree[2*M]++,o=0,a=n,0===r?(l=138,c=3):n===r?(l=6,c=3):(l=7,c=4))}function w(e,t,i){var s,n,a=-1,r=t[1],o=0,u=7,d=4;for(0===r&&(u=138,d=3),s=0;s<=i;s++)if(n=r,r=t[2*(s+1)+1],!(++o<u&&n===r)){if(o<d)do{c(e,n,e.bl_tree)}while(0!=--o);else 0!==n?(n!==a&&(c(e,n,e.bl_tree),o--),c(e,L,e.bl_tree),l(e,o-3,2)):o<=10?(c(e,R,e.bl_tree),l(e,o-3,3)):(c(e,M,e.bl_tree),l(e,o-11,7));o=0,a=n,0===r?(u=138,d=3):n===r?(u=6,d=3):(u=7,d=4)}}function y(e,t,i,s){l(e,(D<<1)+(s?1:0),3),function(e,t,i,s){p(e),s&&(o(e,i),o(e,~i)),_.arraySet(e.pending_buf,e.window,t,i,e.pending),e.pending+=i}(e,t,i,!0)}var _=e("../utils/common"),x=4,k=0,C=1,A=2,D=0,I=1,$=2,E=29,F=256,S=F+1+E,N=30,j=19,B=2*S+1,O=15,V=16,T=7,P=256,L=16,R=17,M=18,q=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],U=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],z=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],W=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],H=new Array(2*(S+2));s(H);var K=new Array(2*N);s(K);var J=new Array(512);s(J);var G=new Array(256);s(G);var Y=new Array(E);s(Y);var Q=new Array(N);s(Q);var Z,X,ee,te=!1;i._tr_init=function(e){te||(function(){var e,t,i,s,a,r=new Array(O+1);for(i=0,s=0;s<E-1;s++)for(Y[s]=i,e=0;e<1<<q[s];e++)G[i++]=s;for(G[i-1]=s,a=0,s=0;s<16;s++)for(Q[s]=a,e=0;e<1<<U[s];e++)J[a++]=s;for(a>>=7;s<N;s++)for(Q[s]=a<<7,e=0;e<1<<U[s]-7;e++)J[256+a++]=s;for(t=0;t<=O;t++)r[t]=0;for(e=0;e<=143;)H[2*e+1]=8,e++,r[8]++;for(;e<=255;)H[2*e+1]=9,e++,r[9]++;for(;e<=279;)H[2*e+1]=7,e++,r[7]++;for(;e<=287;)H[2*e+1]=8,e++,r[8]++;for(d(H,S+1,r),e=0;e<N;e++)K[2*e+1]=5,K[2*e]=u(e,5);Z=new n(H,q,F+1,S,O),X=new n(K,U,0,N,O),ee=new n(new Array(0),z,0,j,T)}(),te=!0),e.l_desc=new a(e.dyn_ltree,Z),e.d_desc=new a(e.dyn_dtree,X),e.bl_desc=new a(e.bl_tree,ee),e.bi_buf=0,e.bi_valid=0,h(e)},i._tr_stored_block=y,i._tr_flush_block=function(e,t,i,s){var n,a,r=0;e.level>0?(e.strm.data_type===A&&(e.strm.data_type=function(e){var t,i=4093624447;for(t=0;t<=31;t++,i>>>=1)if(1&i&&0!==e.dyn_ltree[2*t])return k;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return C;for(t=32;t<F;t++)if(0!==e.dyn_ltree[2*t])return C;return k}(e)),b(e,e.l_desc),b(e,e.d_desc),r=function(e){var t;for(v(e,e.dyn_ltree,e.l_desc.max_code),v(e,e.dyn_dtree,e.d_desc.max_code),b(e,e.bl_desc),t=j-1;t>=3&&0===e.bl_tree[2*W[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),n=e.opt_len+3+7>>>3,(a=e.static_len+3+7>>>3)<=n&&(n=a)):n=a=i+5,i+4<=n&&-1!==t?y(e,t,i,s):e.strategy===x||a===n?(l(e,(I<<1)+(s?1:0),3),g(e,H,K)):(l(e,($<<1)+(s?1:0),3),function(e,t,i,s){var n;for(l(e,t-257,5),l(e,i-1,5),l(e,s-4,4),n=0;n<s;n++)l(e,e.bl_tree[2*W[n]+1],3);w(e,e.dyn_ltree,t-1),w(e,e.dyn_dtree,i-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,r+1),g(e,e.dyn_ltree,e.dyn_dtree)),h(e),s&&p(e)},i._tr_tally=function(e,t,i){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&i,e.last_lit++,0===t?e.dyn_ltree[2*i]++:(e.matches++,t--,e.dyn_ltree[2*(G[i]+F+1)]++,e.dyn_dtree[2*r(t)]++),e.last_lit===e.lit_bufsize-1},i._tr_align=function(e){l(e,I<<1,3),c(e,P,H),function(e){16===e.bi_valid?(o(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},{"../utils/common":28}],40:[function(e,t,i){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}]},{},[10])(10)},78128:e=>{e.exports=class{get key(){return"activelist"}constructor(e,t){e.Label,e.labels,e.unique(this.key);var i={name:this.key};this.view=this.key,this._logic={},webix.protoUI(i,webix.ui.list,webix.ActiveContent)}}},11837:e=>{e.exports=class{get key(){return"countfooter"}constructor(e,t){e.Label,this.view=this.key,this._logic={},webix.ui.datafilter.countColumn=webix.extend({refresh:function(e,t,i){var s=0;(e.find({})||[]).forEach((e=>{if(null!=e){var t=e[i.columnId]||e[i.columnId+"__relation"];t&&Array.isArray(t)?s+=t.length:null!=t&&""!=t&&0!=t&&"false"!=t&&"0"!=t&&(s+=1)}})),t.innerHTML=s}},webix.ui.datafilter.summColumn)}}},60427:(e,t,i)=>{var s=[i(78128),i(11837),i(95624),i(23501),i(84352),i(54520),i(79119),i(60271),i(77408).Z,i(65179),i(48666),i(96437),i(36574).Z,i(99221),i(93930)];e.exports=class{constructor(){}initComponents(e){e.custom=e.custom||{},s.forEach((t=>{var i=new t(e);e.custom[i.key]=i})),e.AB.custom=e.custom}}},95624:e=>{e.exports=class{get key(){return"datetimepicker"}constructor(e){e.Label,e.labels,e.unique(this.key),e.unique("custom_datetimepicker"),this.view=this.key,this._logic={},webix.editors.$popup.datetime={view:"popup",width:250,height:250,padding:0,body:{view:"calendar",icons:!0,borderless:!0,timepicker:!0}},webix.editors.datetime=webix.extend({popupType:"datetime"},webix.editors.date)}}},23501:e=>{e.exports=class{get key(){return"editlist"}constructor(e){e.Label,e.labels,e.unique(this.key);var t={name:this.key};this.view=this.key,this._logic={},webix.protoUI(t,webix.EditAbility,webix.ui.list)}}},84352:e=>{e.exports=class{get key(){return"edittree"}constructor(e){e.Label,e.labels,e.unique(this.key);var t={name:this.key};this.view=this.key,this._logic={},webix.protoUI(t,webix.EditAbility,webix.ui.tree)}}},54520:e=>{e.exports=class{get key(){return"editunitlist"}constructor(e){var t={name:this.key};this.view=this.key,this._logic={},webix.protoUI(t,webix.EditAbility,webix.ui.unitlist)}}},79119:e=>{e.exports=class{get key(){return"focusabletemplate"}constructor(e){e.Label,e.labels,e.unique(this.key);var t={name:this.key,focus:function(){return!1}};this.view=this.key,this._logic={},webix.protoUI(t,webix.ui.template,webix.UIManager)}}},77408:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var s=i(27787),n=i.n(s);class a extends(n()){get key(){return"formiobuilder"}constructor(e){super(e),this.label=this.AB.Label(),this.view=this.key}async init(){if(this.initialized)return;const{FormBuilder:e}=await Promise.all([i.e(83),i.e(583)]).then(i.bind(i,43083));this.FormBuilder=e,this.AB.Webix.protoUI(this.ui(),this.AB.Webix.ui.popup),this.initialized=!0}ui(){return{name:this.key,defaults:{css:"scrolly forceOpen",hidden:!1,autofit:!0},$init:async function(e){const t=this.parseDataFields(e.dataFields),i=e.formComponents?e.formComponents:{components:[t.approveButton.schema]};try{this.builder=new this.FormBuilder(this.$view,i,{noDefaultSubmitButton:!0,noNewEdit:!0,builder:{basic:!1,advanced:!1,customBasic:!1,premium:!1,custom:{title:this.label("Fields"),weight:0,default:!0,components:t},layout:{components:{table:!0}}}}),await this.builder.ready}catch(e){this.notify("Error initializing formio builder",e)}},getFormData:function(){return this.builder.schema},label:this.label,parseDataFields:this.parseDataFields,notify:this.AB.notify.developer,FormBuilder:this.FormBuilder}}parseDataFields(e){const t={};return e.forEach((({field:e,key:i,label:s})=>{if(!e)return;const n={abFieldID:e.id,label:e.label,disabled:!0,key:i,_key:i,type:"textfield",input:!0};switch(e.key){case"boolean":n.type="checkbox";break;case"calculate":n.inputType="text",n.calculateValue=`value = ${e.settings.formula.replace(/{/g,"data['").replace(/}/g,"']")}`;break;case"connectObject":n.inputType="text",n.calculateValue=`value = data['${i}.format']`;break;case"date":n.type="datetime",n.format="MMMM d, yyyy";break;case"datetime":n.type="datetime",n.format="MMMM d, yyyy h:mm a";break;case"email":n.type="email";break;case"file":n.type="htmlelement",n.tag="a",n.className="btn btn-primary btn-block",n.content=`<i class='fa fa-paperclip'></i> {{data['${i}']?.filename ?? "No File"}}`,n.attrs=[{attr:"href",value:e.urlFile(`{{data['${i}'].uuid}}`)},{attr:"target",value:"_blank"}],n.refreshOnChange=!0,n.input=!1;break;case"image":n.type="htmlelement",n.tag="img",n.className="img-thumbnail max100",n.content="",n.attrs=[{attr:"src",value:e.urlImage(`{{data['${i}']}}`)}],n.refreshOnChange=!0,n.input=!1;break;case"list":var a=[];e.settings.options.forEach((e=>{a.push({label:e.text,value:e.id})})),n.type="select",n.data={values:a},n.multiple=e.settings.isMultiple;break;case"LongText":n.type="textarea";break;case"number":n.type="number";break;case"TextFormula":n.inputType="text",n.calculateValue=`value = '${e.settings.textFormula}'`}t[i]={title:s,key:i,icon:e.icon,schema:n}})),t.approveButton={title:this.label("Approve Button"),key:"approve",icon:"check-square",schema:{label:this.label("Approve"),type:"button",key:"approve",event:"approve",block:!0,size:"lg",input:!1,leftIcon:"fa fa-thumbs-up",action:"event",theme:"success"}},t.denyButton={title:this.label("Deny Button"),key:"deny",icon:"ban",schema:{label:this.label("Deny"),type:"button",key:"deny",event:"deny",block:!0,size:"lg",input:!1,leftIcon:"fa fa-thumbs-down",action:"event",theme:"danger"}},t.customButton={title:this.label("Custom Action Button"),key:"custom",icon:"cog",schema:{label:this.label("Custom Name"),type:"button",key:"custom",event:"yourEvent",block:!0,size:"lg",input:!1,leftIcon:"fa fa-cog",action:"event",theme:"primary"}},t}}},60271:(e,t,i)=>{const s=i(27787);e.exports=class extends s{get key(){return"formiopreview"}async init(){if(this.initialized)return;const{Form:e}=await Promise.all([i.e(83),i.e(583)]).then(i.bind(i,43083));var t={name:this.key,defaults:{css:"scrolly",borderless:!0},$init:async function(e){this.$ready.push((()=>this.initForm(e)))},initForm:async t=>{var i=t.formComponents??{},s=t.formData??{};const n=$$(t.id);for(var a in s)Array.isArray(s[a])&&"object"==typeof s[a][0]&&(s[a]=s[a].map((e=>e.id)));const r=new e(n.$view,i);await r.build(),r.instance.submission={data:s},(i.components||[]).forEach((e=>{"button"==e.type&&"event"==e.action&&e.event&&r.instance.once(e.event,(function(){t?.onButton(e.event)}))}))}};this.view=this.key,this._logic={},this.AB.Webix.protoUI(t,this.AB.Webix.ui.view),this.initialized=!0}}},27787:(e,t,i)=>{var s=i(26263);e.exports=class extends s{constructor({AB:e}){super(),this.initialized=!1,this.AB=e,this.setDefaultUI()}setDefaultUI(){this.AB.Webix.protoUI({name:this.key,defaults:{template:"This custom webix component has not been initialized. <br>Call AB.custom.#key#.init() before using this component.",data:{key:this.key}},$init:()=>console.warn(`${this.key} custom webix component used before being initalized`)},this.AB.Webix.ui.template)}}},65179:e=>{e.exports=class{get key(){return"numbertext"}constructor(e){e.Label,e.labels,e.unique(this.key);var t={name:this.key,defaults:{css:"webix_el_text"},$getValue:function(){var e=this.getInputNode().value;return e?JSON.parse(e):""}};this.view=this.key,this._logic={},webix.protoUI(t,webix.ui.text)}}},48666:e=>{e.exports=class{get key(){return"thaicalendar"}constructor(e){this.view=this.key;const t=webix.i18n,i={name:this.key,defaults:{calendarHeader:function(e){return`${t.calendar.monthFull[e.getMonth()]} ${e.getFullYear()+543}`}}};webix.ui.calendar.$protoWait[0]._zoom_logic&&(i._zoom_logic=AB.cloneDeep(webix.ui.calendar.$protoWait[0]._zoom_logic),i._zoom_logic[1]=Object.assign(i._zoom_logic[1],{_getTitle:this._getYearTitle}),i._zoom_logic[2]=Object.assign(i._zoom_logic[2],{_getTitle:this._getYearRangeTitle,_getContent:this._getYearContent,_setContent:this._setYear})),webix.ui.calendar.$protoWait[0].Qd&&(i.Qd=AB.cloneDeep(webix.ui.calendar.$protoWait[0].Qd),i.Qd[1]=Object.assign(i.Qd[1],{Jv:this._getYearTitle}),i.Qd[2]=Object.assign(i.Qd[2],{Jv:this._getYearRangeTitle,Zv:this._getYearContent,Xv:this._setYear})),webix.protoUI(i,webix.ui.calendar),webix.editors.$popup.thaidate={view:"popup",width:250,height:250,padding:0,body:{view:this.key,icons:!0,borderless:!0,timepicker:!1}},webix.editors.$popup.thaidatetime={view:"popup",width:250,height:250,padding:0,body:{view:this.key,icons:!0,borderless:!0,timepicker:!0}},webix.editors.thaidate=webix.extend({popupType:"thaidate"},webix.editors.date),webix.editors.thaidatetime=webix.extend({popupType:"thaidatetime"},webix.editors.date)}_getYearTitle(e){return e.getFullYear()+543}_getYearRangeTitle(e,t){let i=e.getFullYear()+543;return t._zoom_start_date=i=i-i%10-1,i+" - "+(i+10+1)}_getYearContent(e,t){return t._zoom_start_date+e}_setYear(e,t,i){e.setFullYear(i._zoom_start_date-543+t)}}},96437:e=>{e.exports=class{get key(){return"timepicker"}constructor(e){e.Label,e.labels,e.unique(this.key),e.unique("custom_timepicker"),this.view=this.key,this._logic={},webix.editors.$popup.time={view:"popup",body:{view:"calendar",width:220,height:200,type:"time"}},webix.editors.time=webix.extend({popupType:"time"},webix.editors.date)}}},36574:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var s=i(27787),n=i.n(s);class a extends(n()){get key(){return"tinymce-editor"}async init(){this.initialized||(await Promise.all([i.e(226),i.e(41)]).then(i.bind(i,76041)),this.initialized=!0)}}},99221:e=>{e.exports=class{get key(){return"totalfooter"}constructor(e,t){e.Label,this.view=this.key,this._logic={},webix.ui.datafilter.totalColumn=webix.extend({refresh:function(e,t,i){var s=0;e.eachRow((function(t){var n=e.getItem(t),a=i.field.format(n);a&&(s+=parseFloat(a))})),t.innerHTML=s}},webix.ui.datafilter.summColumn)}}},93930:e=>{e.exports=class{get key(){return"treesuggest"}constructor(e){e.Label,e.labels,e.unique(this.key);var t={name:this.key,defaults:{type:"tree",width:0,body:{borderless:!0,select:!0,template:function(e,t){return"<span>"+(e.$count?"<b>"+e.value+"</b>":e.value)+"</span>"},ready:function(){this.openAll()},on:{onAfterSelect:function(e,t){this.getItem(e).$count&&(this.getParentView().setMasterValue(""),this.show($$(this.getParentView().config.master).getInputNode()))}}}}};this.view=this.key,this._logic={},webix.protoUI(t,webix.ui.suggest)}}}}]);
//# sourceMappingURL=AB.0db397646ae48c78c0ea.js.map